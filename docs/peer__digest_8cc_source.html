<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squid Web Cache: squid/src/peer_digest.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Squid Web Cache<span id="projectnumber">&#160;master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('peer__digest_8cc_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">peer_digest.cc</div></div>
</div><!--header-->
<div class="contents">
<a href="peer__digest_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 1996-2025 The Squid Software Foundation and contributors</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Squid software is distributed under GPLv2+ license and includes</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * contributions from numerous individuals and organizations.</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * Please see the COPYING and CONTRIBUTORS files for details.</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> */</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">/* DEBUG: section 72    Peer Digest Routines */</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="squid_8h.html">squid.h</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#if USE_CACHE_DIGESTS</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="IoManip_8h.html">base/IoManip.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="CacheDigest_8h.html">CacheDigest.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="CachePeer_8h.html">CachePeer.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="event_8h.html">event.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="FwdState_8h.html">FwdState.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="HttpReply_8h.html">HttpReply.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="HttpRequest_8h.html">HttpRequest.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="internal_8h.html">internal.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="MemObject_8h.html">MemObject.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="mime__header_8h.html">mime_header.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="neighbors_8h.html">neighbors.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="PeerDigest_8h.html">PeerDigest.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="Store_8h.html">Store.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="store__key__md5_8h.html">store_key_md5.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="StoreClient_8h.html">StoreClient.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="tools_8h.html">tools.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">/* local types */</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment">/* local prototypes */</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="keyword">static</span> time_t <a class="code hl_function" href="peer__digest_8cc.html#a1dde7943ac07627f181b2d352666613b">peerDigestIncDelay</a>(<span class="keyword">const</span> <a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd);</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="keyword">static</span> time_t <a class="code hl_function" href="peer__digest_8cc.html#ab7e3423151070ce91e9cd0e3dd0978ca">peerDigestNewDelay</a>(<span class="keyword">const</span> <a class="code hl_class" href="classStoreEntry.html">StoreEntry</a> * e);</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">peerDigestSetCheck</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd, time_t delay);</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a2e92a9f6695f604a92e714e53f8da9a2">   38</a></span><span class="keyword">static</span> <a class="code hl_typedef" href="event_8h.html#a8408906d26bb4a96322adc2e7b41b3f5">EVH</a> <a class="code hl_variable" href="peer__digest_8cc.html#a2e92a9f6695f604a92e714e53f8da9a2">peerDigestCheck</a>;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="peer__digest_8cc.html#a60e1976e553a117d9db10eb4189c9dd3">peerDigestRequest</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd);</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a33dd444bfbbb30f61fa6ffd3badf63b5">   40</a></span><span class="keyword">static</span> <a class="code hl_typedef" href="StoreClient_8h.html#a48e07440f256e626bf7b91ee8236f028">STCB</a> <a class="code hl_variable" href="peer__digest_8cc.html#a33dd444bfbbb30f61fa6ffd3badf63b5">peerDigestHandleReply</a>;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="peer__digest_8cc.html#abf6315d68622d881f89535f88d8a1dca">peerDigestFetchReply</a>(<span class="keywordtype">void</span> *, <span class="keywordtype">char</span> *, ssize_t);</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="keywordtype">int</span> <a class="code hl_function" href="peer__digest_8cc.html#a16f22e1993b64c3dd36a2aed8356667a">peerDigestSwapInCBlock</a>(<span class="keywordtype">void</span> *, <span class="keywordtype">char</span> *, ssize_t);</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keywordtype">int</span> <a class="code hl_function" href="peer__digest_8cc.html#ae38a5569d80c5857995d0611d4a6b32a">peerDigestSwapInMask</a>(<span class="keywordtype">void</span> *, <span class="keywordtype">char</span> *, ssize_t);</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a>(<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> * fetch, <span class="keywordtype">char</span> *buf, ssize_t <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *step_name);</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *reason, <span class="keywordtype">bool</span> sawError);</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="peer__digest_8cc.html#a73843370a1af215cecd871179900160f">peerDigestFetchSetStats</a>(<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> * fetch);</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="peer__digest_8cc.html#a7d583c1b6dce1cb450c46120c22699f8">peerDigestSetCBlock</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf);</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="peer__digest_8cc.html#ae199004959205be451d747bb247d5a89">peerDigestUseful</a>(<span class="keyword">const</span> <a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd);</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">/* local constants */</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#ac11c7a5daca5ee893877fd2b5c94384b">   51</a></span><a class="code hl_class" href="classVersion.html">Version</a> <span class="keyword">const</span> <a class="code hl_variable" href="peer__digest_8cc.html#ac11c7a5daca5ee893877fd2b5c94384b">CacheDigestVer</a> = { 5, 3 };</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a0ac3e5d29d436286af90126f25e5ad7e">   53</a></span><span class="preprocessor">#define StoreDigestCBlockSize sizeof(StoreDigestCBlock)</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">/* min interval for requesting digests from a given peer */</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">   56</a></span><span class="keyword">static</span> <span class="keyword">const</span> time_t <a class="code hl_variable" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a> = 5 * 60;   <span class="comment">/* seconds */</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="comment">/* min interval for requesting digests (cumulative request stream) */</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a736990ad18de5290b23cd8f47940a964">   58</a></span><span class="keyword">static</span> <span class="keyword">const</span> time_t <a class="code hl_variable" href="peer__digest_8cc.html#a736990ad18de5290b23cd8f47940a964">GlobDigestReqMinGap</a> = 1 * 60;   <span class="comment">/* seconds */</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="comment">/* local vars */</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#adc707070a53a4eb35029e1fec217f7eb">   62</a></span><span class="keyword">static</span> time_t <a class="code hl_variable" href="peer__digest_8cc.html#adc707070a53a4eb35029e1fec217f7eb">pd_last_req_time</a> = 0; <span class="comment">/* last call to Check */</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span> </div>
<div class="foldopen" id="foldopen00064" data-start="{" data-end="}">
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="classPeerDigest.html#aa90950f790d3e263b45d43910603a88c">   64</a></span><a class="code hl_function" href="classPeerDigest.html#aa90950f790d3e263b45d43910603a88c">PeerDigest::PeerDigest</a>(<a class="code hl_class" href="classCachePeer.html">CachePeer</a> * <span class="keyword">const</span> p):</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    peer(p),</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    host(peer-&gt;host) <span class="comment">// if peer disappears, we will know its name</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>{</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.initialized = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>}</div>
</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><a class="code hl_define" href="cbdata_8h.html#a4710a3530194cffbc7f74fa2b2c4529d">CBDATA_CLASS_INIT</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a>);</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><a class="code hl_define" href="cbdata_8h.html#a4710a3530194cffbc7f74fa2b2c4529d">CBDATA_CLASS_INIT</a>(<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a>);</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="foldopen" id="foldopen00075" data-start="{" data-end="}">
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno"><a class="line" href="classDigestFetchState.html#ac076eb3cda4a0b9749a4c69a52e293c3">   75</a></span><a class="code hl_function" href="classDigestFetchState.html#ac076eb3cda4a0b9749a4c69a52e293c3">DigestFetchState::DigestFetchState</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> *aPd, <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *req) :</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    pd(aPd),</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    entry(nullptr),</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    old_entry(nullptr),</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    sc(nullptr),</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    old_sc(nullptr),</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    request(req),</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    offset(0),</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    mask_offset(0),</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    start_time(<a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>),</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    resp_time(0),</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    expires(0),</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    bufofs(0),</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    state(<a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea8f81f1c162dd711a1da7a78ec1a2ea93">DIGEST_READ_REPLY</a>)</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>{</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <a class="code hl_function" href="http_2Message_8h.html#afbf13ecd1cc5c007367ae094c1aa19a9">HTTPMSGLOCK</a>(<a class="code hl_variable" href="classDigestFetchState.html#a4b303477db1bb7fb8eab3d01ad114711">request</a>);</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <a class="code hl_variable" href="classDigestFetchState.html#a5c7d7dab2b59bf4f2a0bc805b12d6126">sent</a>.msg = 0;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <a class="code hl_variable" href="classDigestFetchState.html#a5c7d7dab2b59bf4f2a0bc805b12d6126">sent</a>.bytes = 0;</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <a class="code hl_variable" href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">recv</a>.msg = 0;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <a class="code hl_variable" href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">recv</a>.bytes = 0;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    *<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a> = 0;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>}</div>
</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="foldopen" id="foldopen00101" data-start="{" data-end="}">
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno"><a class="line" href="classDigestFetchState.html#ad3ac5410b910029def0c87b2feb3b867">  101</a></span><a class="code hl_function" href="classDigestFetchState.html#ad3ac5410b910029def0c87b2feb3b867">DigestFetchState::~DigestFetchState</a>()</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>{</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>) {</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;deleting old entry&quot;</span>);</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        <a class="code hl_function" href="store__client_8cc.html#a06631df680fe4de46f305a34874175f9">storeUnregister</a>(<a class="code hl_variable" href="classDigestFetchState.html#a8d55ebf7e4bd9a2c3cf584aec2893d0a">old_sc</a>, <a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>        <a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#addfd77d9dd303940e6f323d714da2e89">releaseRequest</a>();</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        <a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#a35618603cff249c1cc64abf8127f3b7d">unlock</a>(<span class="stringliteral">&quot;DigestFetchState destructed old&quot;</span>);</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>        <a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="comment">/* unlock everything */</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    <a class="code hl_function" href="store__client_8cc.html#a06631df680fe4de46f305a34874175f9">storeUnregister</a>(<a class="code hl_variable" href="classDigestFetchState.html#a02dd4541a2ab0f48ad8a6ffff4e63224">sc</a>, <a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#a35618603cff249c1cc64abf8127f3b7d">unlock</a>(<span class="stringliteral">&quot;DigestFetchState destructed&quot;</span>);</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <a class="code hl_function" href="http_2Message_8h.html#adc5c03415efc511e2b62e809310969b6">HTTPMSGUNLOCK</a>(<a class="code hl_variable" href="classDigestFetchState.html#a4b303477db1bb7fb8eab3d01ad114711">request</a>);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>}</div>
</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="foldopen" id="foldopen00120" data-start="{" data-end="}">
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno"><a class="line" href="classPeerDigest.html#a8e09586c9bb65e0b1a46ed8536ed6a2c">  120</a></span><a class="code hl_function" href="classPeerDigest.html#a8e09586c9bb65e0b1a46ed8536ed6a2c">PeerDigest::~PeerDigest</a>()</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>{</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.next_check &amp;&amp; <a class="code hl_function" href="event_8cc.html#a5e368c7b2d3b8bc0e1667ece2c440944">eventFind</a>(<a class="code hl_variable" href="peer__digest_8cc.html#a2e92a9f6695f604a92e714e53f8da9a2">peerDigestCheck</a>, <span class="keyword">this</span>))</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        <a class="code hl_function" href="event_8cc.html#ae111818525827ae123def674b61b7770">eventDelete</a>(<a class="code hl_variable" href="peer__digest_8cc.html#a2e92a9f6695f604a92e714e53f8da9a2">peerDigestCheck</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <span class="keyword">delete</span> <a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="comment">// req_result pointer is not owned by us</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>}</div>
</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="comment">/* called by peer to indicate that somebody actually needs this digest */</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00130" data-start="{" data-end="}">
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#ac02c7896e61987e7f1482f789ae81d09">  130</a></span><a class="code hl_function" href="peer__digest_8cc.html#ac02c7896e61987e7f1482f789ae81d09">peerDigestNeeded</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd)</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>{</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a7f51eda03c147d679e7bc936f9d12743">flags</a>.<a class="code hl_variable" href="classPeerDigest.html#aa9a3df5f91ebee81d092046902dab9df">needed</a>);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a7f51eda03c147d679e7bc936f9d12743">flags</a>.<a class="code hl_variable" href="classPeerDigest.html#aa9a3df5f91ebee81d092046902dab9df">needed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#aa9a3df5f91ebee81d092046902dab9df">needed</a> = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <a class="code hl_function" href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">peerDigestSetCheck</a>(pd, 0);  <span class="comment">/* check asap */</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>}</div>
</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="comment">/* increment retry delay [after an unsuccessful attempt] */</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="keyword">static</span> time_t</div>
<div class="foldopen" id="foldopen00143" data-start="{" data-end="}">
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a1dde7943ac07627f181b2d352666613b">  143</a></span><a class="code hl_function" href="peer__digest_8cc.html#a1dde7943ac07627f181b2d352666613b">peerDigestIncDelay</a>(<span class="keyword">const</span> <a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd)</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>{</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd);</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="keywordflow">return</span> pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a0c29a605ba3621faa56b45456bd5111f">retry_delay</a> &gt; 0 ?</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>           2 * pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a0c29a605ba3621faa56b45456bd5111f">retry_delay</a> :  <span class="comment">/* exponential backoff */</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>           <a class="code hl_variable" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a>; <span class="comment">/* minimal delay */</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>}</div>
</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="comment">/* artificially increases Expires: setting to avoid race conditions</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment"> * returns the delay till that [increased] expiration time */</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="keyword">static</span> time_t</div>
<div class="foldopen" id="foldopen00154" data-start="{" data-end="}">
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#ab7e3423151070ce91e9cd0e3dd0978ca">  154</a></span><a class="code hl_function" href="peer__digest_8cc.html#ab7e3423151070ce91e9cd0e3dd0978ca">peerDigestNewDelay</a>(<span class="keyword">const</span> <a class="code hl_class" href="classStoreEntry.html">StoreEntry</a> * e)</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>{</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(e);</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="keywordflow">if</span> (e-&gt;<a class="code hl_variable" href="classStoreEntry.html#a42dc938e1e2a49b3d4275eabeb8eb699">expires</a> &gt; 0)</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        <span class="keywordflow">return</span> e-&gt;<a class="code hl_variable" href="classStoreEntry.html#a42dc938e1e2a49b3d4275eabeb8eb699">expires</a> + <a class="code hl_variable" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a> - <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a>;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>}</div>
</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">/* registers next digest verification */</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00166" data-start="{" data-end="}">
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">  166</a></span><a class="code hl_function" href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">peerDigestSetCheck</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd, time_t delay)</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>{</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <a class="code hl_function" href="event_8cc.html#afbfd8e1e91d5ad60e6124aea52a5f006">eventAdd</a>(<span class="stringliteral">&quot;peerDigestCheck&quot;</span>, <a class="code hl_variable" href="peer__digest_8cc.html#a2e92a9f6695f604a92e714e53f8da9a2">peerDigestCheck</a>, pd, (<span class="keywordtype">double</span>) delay, 1);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a66f52082c83b12257f328d80a2b93783">next_check</a> = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a> + delay;</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;peerDigestSetCheck: will check peer &quot;</span> &lt;&lt; pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a> &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; delay &lt;&lt; <span class="stringliteral">&quot; secs&quot;</span>);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>}</div>
</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="comment">/* callback for eventAdd() (with peer digest locked)</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment"> * request new digest if our copy is too old or if we lack one;</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="comment"> * schedule next check otherwise */</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00177" data-start="{" data-end="}">
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a56ecd255e7dc3857bcdbc8e10a4ffbe3">  177</a></span><a class="code hl_variable" href="peer__digest_8cc.html#a2e92a9f6695f604a92e714e53f8da9a2">peerDigestCheck</a>(<span class="keywordtype">void</span> *data)</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>{</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> *pd = (<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> *)data;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    time_t req_time;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a7f51eda03c147d679e7bc936f9d12743">flags</a>.<a class="code hl_variable" href="classPeerDigest.html#a425fece3a08f57e0f794cf006b1c9112">requested</a>);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a66f52082c83b12257f328d80a2b93783">next_check</a> = 0;   <span class="comment">/* unknown */</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <a class="code hl_define" href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a>(pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a767983550bfc63d3c1883e52e97f5b57">peer</a>.<a class="code hl_function" href="classCbcPointer.html#a2125df76c0d5eb45bdb8b18e88a71258">valid</a>());</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;cache_peer &quot;</span> &lt;&lt; <a class="code hl_function" href="IoManip_8h.html#afb10fe715d55bc0f31985b3de7269ce0">RawPointer</a>(pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a767983550bfc63d3c1883e52e97f5b57">peer</a>).orNil());</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;peerDigestCheck: time: &quot;</span> &lt;&lt; <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a> &lt;&lt;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>           <span class="stringliteral">&quot;, last received: &quot;</span> &lt;&lt; (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a73fdc1c068feb98d0a38f8c9471f2d05">received</a> &lt;&lt; <span class="stringliteral">&quot;  (&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>           std::showpos &lt;&lt; (<span class="keywordtype">int</span>) (<a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a> - pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a73fdc1c068feb98d0a38f8c9471f2d05">received</a>) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="comment">/* decide when we should send the request:</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="comment">     * request now unless too close to other requests */</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    req_time = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="comment">/* per-peer limit */</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="keywordflow">if</span> (req_time - pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a73fdc1c068feb98d0a38f8c9471f2d05">received</a> &lt; <a class="code hl_variable" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a>) {</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;peerDigestCheck: &quot;</span> &lt;&lt; pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a> &lt;&lt;</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>               <span class="stringliteral">&quot;, avoiding close peer requests (&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>               (<span class="keywordtype">int</span>) (req_time - pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a73fdc1c068feb98d0a38f8c9471f2d05">received</a>) &lt;&lt; <span class="stringliteral">&quot; &lt; &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>               (<span class="keywordtype">int</span>) <a class="code hl_variable" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a> &lt;&lt; <span class="stringliteral">&quot; secs).&quot;</span>);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        req_time = pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a73fdc1c068feb98d0a38f8c9471f2d05">received</a> + <a class="code hl_variable" href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a>;</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    }</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="comment">/* global limit */</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="keywordflow">if</span> (req_time - <a class="code hl_variable" href="peer__digest_8cc.html#adc707070a53a4eb35029e1fec217f7eb">pd_last_req_time</a> &lt; <a class="code hl_variable" href="peer__digest_8cc.html#a736990ad18de5290b23cd8f47940a964">GlobDigestReqMinGap</a>) {</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;peerDigestCheck: &quot;</span> &lt;&lt; pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a> &lt;&lt;</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>               <span class="stringliteral">&quot;, avoiding close requests (&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>               (<span class="keywordtype">int</span>) (req_time - <a class="code hl_variable" href="peer__digest_8cc.html#adc707070a53a4eb35029e1fec217f7eb">pd_last_req_time</a>) &lt;&lt; <span class="stringliteral">&quot; &lt; &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>               (<span class="keywordtype">int</span>) <a class="code hl_variable" href="peer__digest_8cc.html#a736990ad18de5290b23cd8f47940a964">GlobDigestReqMinGap</a> &lt;&lt; <span class="stringliteral">&quot; secs).&quot;</span>);</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        req_time = <a class="code hl_variable" href="peer__digest_8cc.html#adc707070a53a4eb35029e1fec217f7eb">pd_last_req_time</a> + <a class="code hl_variable" href="peer__digest_8cc.html#a736990ad18de5290b23cd8f47940a964">GlobDigestReqMinGap</a>;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    }</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="keywordflow">if</span> (req_time &lt;= <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>)</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        <a class="code hl_function" href="peer__digest_8cc.html#a60e1976e553a117d9db10eb4189c9dd3">peerDigestRequest</a>(pd);  <span class="comment">/* will set pd-&gt;flags.requested */</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        <a class="code hl_function" href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">peerDigestSetCheck</a>(pd, req_time - <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>);</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>}</div>
</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="comment">/* ask store for a digest */</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00226" data-start="{" data-end="}">
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a60e1976e553a117d9db10eb4189c9dd3">  226</a></span><a class="code hl_function" href="peer__digest_8cc.html#a60e1976e553a117d9db10eb4189c9dd3">peerDigestRequest</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd)</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>{</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <span class="keyword">const</span> <span class="keyword">auto</span> p = pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a767983550bfc63d3c1883e52e97f5b57">peer</a>.<a class="code hl_function" href="classCbcPointer.html#a51352b9142632d3c8d28530bf151a3c3">get</a>(); <span class="comment">// TODO: Replace with a reference.</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <a class="code hl_class" href="classStoreEntry.html">StoreEntry</a> *e, *old_e;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    <span class="keywordtype">char</span> *url = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *req;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> tempBuffer;</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad8f02ae83b3c0e2e25affd61ad6ed42e">req_result</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a7f51eda03c147d679e7bc936f9d12743">flags</a>.<a class="code hl_variable" href="classPeerDigest.html#a425fece3a08f57e0f794cf006b1c9112">requested</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <span class="comment">/* compute future request components */</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <span class="keywordflow">if</span> (p-&gt;digest_url)</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        url = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(p-&gt;digest_url);</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        url = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(<a class="code hl_function" href="internal_8cc.html#a94c438ab838433612ab410d1899c6493">internalRemoteUri</a>(p-&gt;secure.encryptTransport, p-&gt;host, p-&gt;http_port, <span class="stringliteral">&quot;/squid-internal-periodic/&quot;</span>, <a class="code hl_class" href="classSBuf.html">SBuf</a>(<a class="code hl_variable" href="globals_8h.html#aa8b8f241dcb0dc81ff34222dd5c3edda">StoreDigestFileName</a>)));</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, url);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="keyword">const</span> <span class="keyword">auto</span> mx = MasterXaction::MakePortless&lt;XactionInitiator::initCacheDigest&gt;();</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    req = <a class="code hl_function" href="classHttpRequest.html#a3738e100587f43de4a040b3f0463e21d">HttpRequest::FromUrlXXX</a>(url, mx);</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(req);</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="comment">/* add custom headers */</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!req-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_variable" href="classHttpHeader.html#ae6dc1e75bf86278c8f7be265cc326531">len</a>);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    req-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a187949b24278b65f28338947c605b130">putStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a2923fc380e340d596af9507645069f49">Http::HdrType::ACCEPT</a>, <a class="code hl_variable" href="globals_8h.html#a6210bdd4d1e40a71dce6f39b8a891f94">StoreDigestMimeStr</a>);</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span> </div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    req-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a187949b24278b65f28338947c605b130">putStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a2923fc380e340d596af9507645069f49">Http::HdrType::ACCEPT</a>, <span class="stringliteral">&quot;text/html&quot;</span>);</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="keywordflow">if</span> (p-&gt;login &amp;&amp;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            p-&gt;login[0] != <span class="charliteral">&#39;*&#39;</span> &amp;&amp;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            strcmp(p-&gt;login, <span class="stringliteral">&quot;PASS&quot;</span>) != 0 &amp;&amp;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            strcmp(p-&gt;login, <span class="stringliteral">&quot;PASSTHRU&quot;</span>) != 0 &amp;&amp;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            strncmp(p-&gt;login, <span class="stringliteral">&quot;NEGOTIATE&quot;</span>,9) != 0 &amp;&amp;</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            strcmp(p-&gt;login, <span class="stringliteral">&quot;PROXYPASS&quot;</span>) != 0) {</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        req-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aff2c3402a1b8f1ebc50bc6a3e5933708">userInfo</a>(<a class="code hl_class" href="classSBuf.html">SBuf</a>(p-&gt;login)); <span class="comment">// XXX: performance regression make peer login SBuf as well.</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    }</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    <span class="comment">/* create fetch state structure */</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    <a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *fetch = <span class="keyword">new</span> <a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a>(pd, req);</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="comment">/* update timestamps */</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a425fece3a08f57e0f794cf006b1c9112">requested</a> = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <a class="code hl_variable" href="peer__digest_8cc.html#adc707070a53a4eb35029e1fec217f7eb">pd_last_req_time</a> = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    req-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#af33cb0e80d9996c532479ef942d1eb91">cachable</a>.<a class="code hl_function" href="classSupportOrVeto.html#a89cd12f04613edb8f17087b2ae1e2a3a">support</a>(); <span class="comment">// prevent RELEASE_REQUEST in storeCreateEntry()</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="comment">/* the rest is based on clientReplyContext::processExpired() */</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    req-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#a8f900e1c576cb7ea9b979d7001540025">refresh</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    old_e = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a> = <a class="code hl_function" href="store_8cc.html#a70101e23661f7fe20ce50890c448e92c">storeGetPublicByRequest</a>(req);</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    <span class="comment">// XXX: Missing a hittingRequiresCollapsing() &amp;&amp; startCollapsingOn() check.</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="keywordflow">if</span> (old_e) {</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 5, <span class="stringliteral">&quot;found old &quot;</span> &lt;&lt; *old_e);</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        old_e-&gt;<a class="code hl_function" href="classStoreEntry.html#a53a607cfbdb22fde40edd2c72bfb6dd3">lock</a>(<span class="stringliteral">&quot;peerDigestRequest&quot;</span>);</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>        old_e-&gt;<a class="code hl_function" href="classStoreEntry.html#a249ad3e6bfa297da0fa7a0e9accf6002">ensureMemObject</a>(url, url, req-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a>);</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>        fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a8d55ebf7e4bd9a2c3cf584aec2893d0a">old_sc</a> = <a class="code hl_function" href="store__client_8cc.html#ae077d286d865af03eb1357a8de9ba75b">storeClientListAdd</a>(old_e, fetch);</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    }</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    e = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a> = <a class="code hl_function" href="store_8cc.html#a872157d7a8c43bb5facb072ce03c4d48">storeCreateEntry</a>(url, url, req-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>, req-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a>);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 5, <span class="stringliteral">&quot;created &quot;</span> &lt;&lt; *e);</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_define" href="defines_8h.html#ac1f8e975d5c9f901f8ec9f29db1aca92">EBIT_TEST</a>(e-&gt;<a class="code hl_variable" href="classStoreEntry.html#a15b61bc1167a3670130a81bc5eca9f16">flags</a>, <a class="code hl_enumvalue" href="enums_8h.html#a16685eea158879e41b101ca3634de462a6e99a1b0a211e1f4d482be594fe0e19f">KEY_PRIVATE</a>));</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a02dd4541a2ab0f48ad8a6ffff4e63224">sc</a> = <a class="code hl_function" href="store__client_8cc.html#ae077d286d865af03eb1357a8de9ba75b">storeClientListAdd</a>(e, fetch);</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="comment">/* set lastmod to trigger IMS request if possible */</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="comment">// TODO: Also check for fetch-&gt;pd-&gt;cd presence as a precondition for sending</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="comment">// IMS requests because peerDigestFetchReply() does not accept 304 responses</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="comment">// without an in-memory cache digest.</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keywordflow">if</span> (old_e)</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        e-&gt;<a class="code hl_function" href="classStoreEntry.html#a4550da0757f7c3aa6af8e8e9c3bcdb48">lastModified</a>(old_e-&gt;<a class="code hl_function" href="classStoreEntry.html#a4550da0757f7c3aa6af8e8e9c3bcdb48">lastModified</a>());</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    <span class="comment">/* push towards peer cache */</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <a class="code hl_function" href="classFwdState.html#aee3d157b8666452a80f9f976a5558df1">FwdState::fwdStart</a>(<a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a>(), e, req);</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a61c7333c49e943c24964ae030c96b5ec">offset</a> = 0;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> = <a class="code hl_define" href="defines_8h.html#a24eea21c7d960e4fe969fab7acb064d6">SM_PAGE_SIZE</a>;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a>;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    <a class="code hl_function" href="store__client_8cc.html#a1d6f3137e148014416e0812a317f853f">storeClientCopy</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a02dd4541a2ab0f48ad8a6ffff4e63224">sc</a>, e, tempBuffer,</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                    <a class="code hl_variable" href="peer__digest_8cc.html#a33dd444bfbbb30f61fa6ffd3badf63b5">peerDigestHandleReply</a>, fetch);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <a class="code hl_define" href="xalloc_8h.html#a74ad4c3c3aa58c8fea96eb0dc090fd67">safe_free</a>(url);</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>}</div>
</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span><span class="comment">/* Handle the data copying .. */</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span> </div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment">/*</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="comment"> * This routine handles the copy data and then redirects the</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="comment"> * copy to a bunch of subfunctions depending upon the copy state.</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span><span class="comment"> * It also tracks the buffer offset and &quot;seen&quot;, since I&#39;m actually</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="comment"> * not interested in rewriting everything to suit my little idea.</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span><span class="comment"> */</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00324" data-start="{" data-end="}">
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a752e6c96725e6d3e24860ce735246d33">  324</a></span><a class="code hl_variable" href="peer__digest_8cc.html#a33dd444bfbbb30f61fa6ffd3badf63b5">peerDigestHandleReply</a>(<span class="keywordtype">void</span> *data, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> receivedData)</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>{</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *fetch = (<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *)data;</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    <span class="keywordtype">int</span> retsize = -1;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <a class="code hl_enumeration" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7e">digest_read_state_t</a> prevstate;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <span class="keywordtype">int</span> newsize;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="keywordflow">if</span> (receivedData.<a class="code hl_variable" href="classStoreIOBuffer.html#acb67e9b7fb58fa7b15114bd024533f44">flags</a>.<a class="code hl_variable" href="classStoreIOBuffer.html#a1e3225390c0c4999a67e22a9b503ca16">error</a>) {</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>        <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;failure loading digest reply from Store&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    }</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <span class="keywordflow">if</span> (!fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>) {</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;digest disappeared while loading digest reply from Store&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span> </div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    <span class="comment">/* The existing code assumes that the received pointer is</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span><span class="comment">     * where we asked the data to be put</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="comment">     */</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!receivedData.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a> || fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a> + fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a> == receivedData.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a>);</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <span class="comment">/* Update the buffer size */</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a> += receivedData.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a>;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a> &lt;= <a class="code hl_define" href="defines_8h.html#a24eea21c7d960e4fe969fab7acb064d6">SM_PAGE_SIZE</a>);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    <span class="comment">/* If we&#39;ve fetched enough, return */</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a>(fetch, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a>, <span class="stringliteral">&quot;peerDigestHandleReply&quot;</span>))</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="comment">/* Call the right function based on the state */</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="comment">/* (Those functions will update the state if needed) */</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="comment">/* Give us a temporary reference. Some of the calls we make may</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span><span class="comment">     * try to destroy the fetch structure, and we like to know if they</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="comment">     * do</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span><span class="comment">     */</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <a class="code hl_class" href="classCbcPointer.html">CbcPointer&lt;DigestFetchState&gt;</a> tmpLock = fetch;</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="comment">/* Repeat this loop until we&#39;re out of data OR the state changes */</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="comment">/* (So keep going if the state has changed and we still have data */</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>        prevstate = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a>;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>        <span class="keywordflow">switch</span> (fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a>) {</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea8f81f1c162dd711a1da7a78ec1a2ea93">DIGEST_READ_REPLY</a>:</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>            retsize = <a class="code hl_function" href="peer__digest_8cc.html#abf6315d68622d881f89535f88d8a1dca">peerDigestFetchReply</a>(fetch, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a>);</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span> </div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea42354375080a1355a9eaed4460513f29">DIGEST_READ_CBLOCK</a>:</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>            retsize = <a class="code hl_function" href="peer__digest_8cc.html#a16f22e1993b64c3dd36a2aed8356667a">peerDigestSwapInCBlock</a>(fetch, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a>);</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7eaa2ff1f21931fc22e004ca50b332cc1f5">DIGEST_READ_MASK</a>:</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>            retsize = <a class="code hl_function" href="peer__digest_8cc.html#ae38a5569d80c5857995d0611d4a6b32a">peerDigestSwapInMask</a>(fetch, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a>);</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea395cd4a56d66faf5fd6bc78c1e96f6ab">DIGEST_READ_NONE</a>:</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>            <a class="code hl_function" href="fatal_8cc.html#ab64d40563aeeae7c01b72bea4c3ed032">fatal</a>(<span class="stringliteral">&quot;Bad digest transfer mode!\n&quot;</span>);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>        }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span> </div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>        <span class="keywordflow">if</span> (retsize &lt; 0)</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>        <span class="comment">/*</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="comment">         * The returned size indicates how much of the buffer was read -</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span><span class="comment">         * so move the remainder of the buffer to the beginning</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="comment">         * and update the bufofs / bufsize</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="comment">         */</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>        newsize = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a> - retsize;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>        memmove(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a> + retsize, newsize);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a> = newsize;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    } <span class="keywordflow">while</span> (<a class="code hl_function" href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a>(fetch) &amp;&amp; prevstate != fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a> &amp;&amp; fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a> &gt; 0);</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="comment">// Check for EOF here, thus giving the parser one extra run. We could avoid this overhead by</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <span class="comment">// checking at the beginning of this function. However, in this case, we would have to require</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <span class="comment">// that the parser does not regard EOF as a special condition (it is true now but may change</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <span class="comment">// in the future).</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <span class="keywordflow">if</span> (fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a02dd4541a2ab0f48ad8a6ffff4e63224">sc</a>-&gt;<a class="code hl_function" href="classstore__client.html#acfaef784458c7015d7a937e23e23bd32">atEof</a>()) {</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;premature end of digest reply&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    }</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    <span class="comment">/* Update the copy offset */</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aab4771b97698e061294c45717d50c682">offset</a> += receivedData.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a>;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="comment">/* Schedule another copy */</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a>(fetch)) {</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> tempBuffer;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>        tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a61c7333c49e943c24964ae030c96b5ec">offset</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aab4771b97698e061294c45717d50c682">offset</a>;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>        tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> = <a class="code hl_define" href="defines_8h.html#a24eea21c7d960e4fe969fab7acb064d6">SM_PAGE_SIZE</a> - fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a>;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>        tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">buf</a> + fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">bufofs</a>;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        <a class="code hl_function" href="store__client_8cc.html#a1d6f3137e148014416e0812a317f853f">storeClientCopy</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a02dd4541a2ab0f48ad8a6ffff4e63224">sc</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>, tempBuffer,</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                        <a class="code hl_variable" href="peer__digest_8cc.html#a33dd444bfbbb30f61fa6ffd3badf63b5">peerDigestHandleReply</a>, fetch);</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    }</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>}</div>
</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00432" data-start="{" data-end="}">
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#abf6315d68622d881f89535f88d8a1dca">  432</a></span><a class="code hl_function" href="peer__digest_8cc.html#abf6315d68622d881f89535f88d8a1dca">peerDigestFetchReply</a>(<span class="keywordtype">void</span> *data, <span class="keywordtype">char</span> *buf, ssize_t <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>{</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *fetch = (<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *)data;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <span class="keyword">const</span> <span class="keyword">auto</span> pd = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>.<a class="code hl_function" href="classCbcPointer.html#a51352b9142632d3c8d28530bf151a3c3">get</a>();</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd &amp;&amp; buf);</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aab4771b97698e061294c45717d50c682">offset</a>);</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span> </div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a> == <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea8f81f1c162dd711a1da7a78ec1a2ea93">DIGEST_READ_REPLY</a>);</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span> </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a>(fetch, buf, <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <span class="stringliteral">&quot;peerDigestFetchReply&quot;</span>))</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    {</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;reply = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#a19fd5af89e99c467c29f7bd951ac901d">mem</a>().<a class="code hl_function" href="classMemObject.html#a89697947bc40cdbe591b9e26951b59ba">freshestReply</a>();</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>        <span class="keyword">const</span> <span class="keyword">auto</span> status = reply.<a class="code hl_variable" href="classHttpReply.html#a01790af23c553b590ac6009ebb693b6d">sline</a>.<a class="code hl_function" href="classHttp_1_1StatusLine.html#af852e58bb3e96bc41cd16787b0a7d7db">status</a>();</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(status != <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722aab61d70dce6e121feb658b24ef1cd815">Http::scNone</a>);</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;peerDigestFetchReply: &quot;</span> &lt;&lt; pd-&gt;host &lt;&lt; <span class="stringliteral">&quot; status: &quot;</span> &lt;&lt; status &lt;&lt;</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>               <span class="stringliteral">&quot;, expires: &quot;</span> &lt;&lt; (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) reply.expires &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; std::showpos &lt;&lt;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>               (<span class="keywordtype">int</span>) (reply.expires - <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span> </div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        <span class="comment">/* this &quot;if&quot; is based on clientHandleIMSReply() */</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span> </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="keywordflow">if</span> (status == <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722aac99376ecec42f14e89b637dc6286ccf">Http::scNotModified</a>) {</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>            <span class="comment">/* our old entry is fine */</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>);</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span> </div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            <span class="keywordflow">if</span> (!fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_variable" href="classMemObject.html#a38fde17e9fa64949670b7a25e0735e64">request</a>)</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_variable" href="classMemObject.html#a38fde17e9fa64949670b7a25e0735e64">request</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_variable" href="classMemObject.html#a38fde17e9fa64949670b7a25e0735e64">request</a>;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_variable" href="classMemObject.html#a38fde17e9fa64949670b7a25e0735e64">request</a>);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceStore.html#a0151d620409db8bd3af40e3570a18f8c">Store::Root</a>().updateOnNotModified(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>, *fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>)) {</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>                <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;header update failure after a 304 response&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>            }</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            <span class="comment">/* get rid of 304 reply */</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            <a class="code hl_function" href="store__client_8cc.html#a06631df680fe4de46f305a34874175f9">storeUnregister</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a02dd4541a2ab0f48ad8a6ffff4e63224">sc</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>, fetch);</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>            fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#a35618603cff249c1cc64abf8127f3b7d">unlock</a>(<span class="stringliteral">&quot;peerDigestFetchReply 304&quot;</span>);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span> </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>            fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>;</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>            fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span> </div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>            <span class="comment">/* preserve request -- we need its size to update counters */</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>            <span class="comment">/* requestUnlink(r); */</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>            <span class="comment">/* fetch-&gt;entry-&gt;mem_obj-&gt;request = nullptr; */</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>            <span class="keywordflow">if</span> (!fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>) {</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>                <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;304 without the old in-memory digest&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>            }</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span> </div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>            <span class="comment">// stay with the old in-memory digest</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>            <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;Not modified&quot;</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722aad8d279f381aa192a9f4389158d1b25e">Http::scOkay</a>) {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>            <span class="comment">/* get rid of old entry if any */</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span> </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>            <span class="keywordflow">if</span> (fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>) {</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;peerDigestFetchReply: got new digest, releasing old one&quot;</span>);</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                <a class="code hl_function" href="store__client_8cc.html#a06631df680fe4de46f305a34874175f9">storeUnregister</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a8d55ebf7e4bd9a2c3cf584aec2893d0a">old_sc</a>, fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>, fetch);</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#addfd77d9dd303940e6f323d714da2e89">releaseRequest</a>();</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#a35618603cff249c1cc64abf8127f3b7d">unlock</a>(<span class="stringliteral">&quot;peerDigestFetchReply 200&quot;</span>);</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">old_entry</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>            }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>            fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a> = <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea42354375080a1355a9eaed4460513f29">DIGEST_READ_CBLOCK</a>;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>            <span class="comment">/* some kind of a bug */</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>            <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, reply.sline.reason(), <span class="keyword">true</span>);</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>            <span class="keywordflow">return</span> -1;      <span class="comment">/* XXX -1 will abort stuff in ReadReply! */</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>        }</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    }</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span> </div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    <span class="keywordflow">return</span> 0; <span class="comment">// we consumed/used no buffered bytes</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>}</div>
</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00512" data-start="{" data-end="}">
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a16f22e1993b64c3dd36a2aed8356667a">  512</a></span><a class="code hl_function" href="peer__digest_8cc.html#a16f22e1993b64c3dd36a2aed8356667a">peerDigestSwapInCBlock</a>(<span class="keywordtype">void</span> *data, <span class="keywordtype">char</span> *buf, ssize_t <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>{</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *fetch = (<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *)data;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a> == <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea42354375080a1355a9eaed4460513f29">DIGEST_READ_CBLOCK</a>);</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a>(fetch, buf, <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <span class="stringliteral">&quot;peerDigestSwapInCBlock&quot;</span>))</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> &gt;= (ssize_t)<a class="code hl_define" href="peer__digest_8cc.html#a0ac3e5d29d436286af90126f25e5ad7e">StoreDigestCBlockSize</a>) {</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>        <span class="keyword">const</span> <span class="keyword">auto</span> pd = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>.<a class="code hl_function" href="classCbcPointer.html#a51352b9142632d3c8d28530bf151a3c3">get</a>();</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd);</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>);</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="peer__digest_8cc.html#a7d583c1b6dce1cb450c46120c22699f8">peerDigestSetCBlock</a>(pd, buf)) {</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>            <span class="comment">/* XXX: soon we will have variable header size */</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>            <span class="comment">/* switch to CD buffer and fetch digest guts */</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>            buf = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd-&gt;cd-&gt;mask);</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>            fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a> = <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7eaa2ff1f21931fc22e004ca50b332cc1f5">DIGEST_READ_MASK</a>;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="peer__digest_8cc.html#a0ac3e5d29d436286af90126f25e5ad7e">StoreDigestCBlockSize</a>;</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>            <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;invalid digest cblock&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>        }</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    }</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span> </div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    <span class="comment">/* need more data, do we have space? */</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> &gt;= <a class="code hl_define" href="defines_8h.html#a24eea21c7d960e4fe969fab7acb064d6">SM_PAGE_SIZE</a>) {</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, <span class="stringliteral">&quot;digest cblock too big&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    }</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="keywordflow">return</span> 0;       <span class="comment">/* We need more data */</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>}</div>
</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span><span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00550" data-start="{" data-end="}">
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#ae38a5569d80c5857995d0611d4a6b32a">  550</a></span><a class="code hl_function" href="peer__digest_8cc.html#ae38a5569d80c5857995d0611d4a6b32a">peerDigestSwapInMask</a>(<span class="keywordtype">void</span> *data, <span class="keywordtype">char</span> *buf, ssize_t <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>{</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    <a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *fetch = (<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> *)data;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>    <span class="keyword">const</span> <span class="keyword">auto</span> pd = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>.<a class="code hl_function" href="classCbcPointer.html#a51352b9142632d3c8d28530bf151a3c3">get</a>();</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd);</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd-&gt;cd &amp;&amp; pd-&gt;cd-&gt;mask);</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span> </div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="comment">     * NOTENOTENOTENOTENOTE: buf doesn&#39;t point to pd-&gt;cd-&gt;mask anymore!</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment">     * we need to do the copy ourselves!</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="comment">     */</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    memcpy(pd-&gt;cd-&gt;mask + fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#af9402fd5859c1cdb5bd650e923b76cf5">mask_offset</a>, buf, <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="comment">/* NOTE! buf points to the middle of pd-&gt;cd-&gt;mask! */</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span> </div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a>(fetch, <span class="keyword">nullptr</span>, <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <span class="stringliteral">&quot;peerDigestSwapInMask&quot;</span>))</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span> </div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#af9402fd5859c1cdb5bd650e923b76cf5">mask_offset</a> += <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span> </div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    <span class="keywordflow">if</span> (fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#af9402fd5859c1cdb5bd650e923b76cf5">mask_offset</a> &gt;= pd-&gt;cd-&gt;mask_size) {</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;peerDigestSwapInMask: Done! Got &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>               fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#af9402fd5859c1cdb5bd650e923b76cf5">mask_offset</a> &lt;&lt; <span class="stringliteral">&quot;, expected &quot;</span> &lt;&lt; pd-&gt;cd-&gt;mask_size);</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#af9402fd5859c1cdb5bd650e923b76cf5">mask_offset</a> == pd-&gt;cd-&gt;mask_size);</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_function" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a>(fetch, <span class="keyword">nullptr</span>, 0, <span class="stringliteral">&quot;peerDigestSwapInMask&quot;</span>));</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>        <span class="keywordflow">return</span> -1;      <span class="comment">/* XXX! */</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    }</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="comment">/* We always read everything, so return size */</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>}</div>
</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00583" data-start="{" data-end="}">
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">  583</a></span><a class="code hl_function" href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a>(<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> * fetch, <span class="keywordtype">char</span> *, ssize_t <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *step_name)</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>{</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> hostUnknown(<span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>); <span class="comment">// peer host (if any)</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> host = hostUnknown;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="keyword">const</span> <span class="keyword">auto</span> pd = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>.<a class="code hl_function" href="classCbcPointer.html#a51352b9142632d3c8d28530bf151a3c3">get</a>();</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    <a class="code hl_define" href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a>(pd);</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *reason = <span class="keyword">nullptr</span>;  <span class="comment">/* reason for completion */</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *no_bug = <span class="keyword">nullptr</span>;  <span class="comment">/* successful completion if set */</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span> </div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <span class="comment">/* test possible exiting conditions (the same for most steps!)</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span><span class="comment">     * cases marked with &#39;?!&#39; should not happen */</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span> </div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    <span class="keywordflow">if</span> (!reason) {</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        host = pd-&gt;host;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    }</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 6, step_name &lt;&lt; <span class="stringliteral">&quot;: peer &quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot;, offset: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>           fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aab4771b97698e061294c45717d50c682">offset</a> &lt;&lt; <span class="stringliteral">&quot; size: &quot;</span> &lt;&lt; <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span> </div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <span class="comment">/* continue checking (with pd and host known and valid) */</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <span class="keywordflow">if</span> (!reason) {</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> &lt; 0)</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>            reason = <span class="stringliteral">&quot;swap failure&quot;</span>;</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>)</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>            reason = <span class="stringliteral">&quot;swap aborted?!&quot;</span>;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_define" href="defines_8h.html#ac1f8e975d5c9f901f8ec9f29db1aca92">EBIT_TEST</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#a15b61bc1167a3670130a81bc5eca9f16">flags</a>, <a class="code hl_enumvalue" href="enums_8h.html#a16685eea158879e41b101ca3634de462af1d0ae16fcfb269505ed3e22bc2e3fe5">ENTRY_ABORTED</a>))</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>            reason = <span class="stringliteral">&quot;swap aborted&quot;</span>;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    }</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    <span class="comment">/* continue checking (maybe-successful eof case) */</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    <span class="keywordflow">if</span> (!reason &amp;&amp; !<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> &amp;&amp; fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">state</a> != <a class="code hl_enumvalue" href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea8f81f1c162dd711a1da7a78ec1a2ea93">DIGEST_READ_REPLY</a>) {</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        <span class="keywordflow">if</span> (!pd-&gt;cd)</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>            reason = <span class="stringliteral">&quot;null digest?!&quot;</span>;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#af9402fd5859c1cdb5bd650e923b76cf5">mask_offset</a> != pd-&gt;cd-&gt;mask_size)</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>            reason = <span class="stringliteral">&quot;premature end of digest?!&quot;</span>;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_function" href="peer__digest_8cc.html#ae199004959205be451d747bb247d5a89">peerDigestUseful</a>(pd))</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>            reason = <span class="stringliteral">&quot;useless digest&quot;</span>;</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>            reason = no_bug = <span class="stringliteral">&quot;success&quot;</span>;</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    }</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <span class="comment">/* finish if we have a reason */</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    <span class="keywordflow">if</span> (reason) {</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> level = strstr(reason, <span class="stringliteral">&quot;?!&quot;</span>) ? 1 : 3;</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, level, <span class="stringliteral">&quot;&quot;</span> &lt;&lt; step_name &lt;&lt; <span class="stringliteral">&quot;: peer &quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot;, exiting after &#39;&quot;</span> &lt;&lt; reason &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>        <a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(fetch, reason, !no_bug);</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    }</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span> </div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>    <span class="keywordflow">return</span> reason != <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>}</div>
</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="comment">/* complete the digest transfer, update stats, unlock/release everything */</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00638" data-start="{" data-end="}">
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">  638</a></span><a class="code hl_function" href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a>(<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> * <span class="keyword">const</span> fetch, <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> reason, <span class="keyword">const</span> <span class="keywordtype">bool</span> err)</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>{</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(reason);</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span> </div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;peer: &quot;</span> &lt;&lt; <a class="code hl_function" href="IoManip_8h.html#afb10fe715d55bc0f31985b3de7269ce0">RawPointer</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>.<a class="code hl_function" href="classCbcPointer.html#a2125df76c0d5eb45bdb8b18e88a71258">valid</a>() ? fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>-&gt;<a class="code hl_variable" href="classPeerDigest.html#a767983550bfc63d3c1883e52e97f5b57">peer</a> : <span class="keyword">nullptr</span>).orNil() &lt;&lt; <span class="stringliteral">&quot;, reason: &quot;</span> &lt;&lt; reason &lt;&lt; <span class="stringliteral">&quot;, err: &quot;</span> &lt;&lt; err);</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    <span class="comment">/* note: order is significant */</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    <a class="code hl_function" href="peer__digest_8cc.html#a73843370a1af215cecd871179900160f">peerDigestFetchSetStats</a>(fetch);</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> pd = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">pd</a>.<a class="code hl_function" href="classCbcPointer.html#a51352b9142632d3c8d28530bf151a3c3">get</a>())</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        pd-&gt;noteFetchFinished(*fetch, reason, err);</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span> </div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    <span class="keyword">delete</span> fetch;</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>}</div>
</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00653" data-start="{" data-end="}">
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno"><a class="line" href="classPeerDigest.html#a95b59cf96ae6686926de7a51c250f043">  653</a></span><a class="code hl_function" href="classPeerDigest.html#a95b59cf96ae6686926de7a51c250f043">PeerDigest::noteFetchFinished</a>(<span class="keyword">const</span> <a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> &amp;finishedFetch, <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> outcomeDescription, <span class="keyword">const</span> <span class="keywordtype">bool</span> sawError)</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>{</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    <span class="keyword">const</span> <span class="keyword">auto</span> pd = <span class="keyword">this</span>; <span class="comment">// TODO: remove this diff reducer</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    <span class="keyword">const</span> <span class="keyword">auto</span> fetch = &amp;finishedFetch; <span class="comment">// TODO: remove this diff reducer</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span> </div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    pd-&gt;flags.requested = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    pd-&gt;req_result = outcomeDescription;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span> </div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    pd-&gt;times.received = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>;</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>    pd-&gt;times.req_delay = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9a524b5b0cd45af883253a3fa9292acc">resp_time</a>;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>    pd-&gt;stats.sent.kbytes += fetch-&gt;sent.bytes;</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    pd-&gt;stats.recv.kbytes += fetch-&gt;recv.bytes;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    pd-&gt;stats.sent.msgs += fetch-&gt;sent.msg;</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    pd-&gt;stats.recv.msgs += fetch-&gt;recv.msg;</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span> </div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>    <span class="keywordflow">if</span> (sawError) {</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;disabling (&quot;</span> &lt;&lt; outcomeDescription &lt;&lt; <span class="stringliteral">&quot;) digest from &quot;</span> &lt;&lt; <a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a>);</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>        pd-&gt;times.retry_delay = <a class="code hl_function" href="peer__digest_8cc.html#a1dde7943ac07627f181b2d352666613b">peerDigestIncDelay</a>(pd);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>        <a class="code hl_function" href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">peerDigestSetCheck</a>(pd, pd-&gt;times.retry_delay);</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>        <span class="keyword">delete</span> pd-&gt;cd;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>        pd-&gt;cd = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span> </div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>        pd-&gt;flags.usable = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>        pd-&gt;flags.usable = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        pd-&gt;times.retry_delay = 0;</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        <a class="code hl_function" href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">peerDigestSetCheck</a>(pd, <a class="code hl_function" href="peer__digest_8cc.html#ab7e3423151070ce91e9cd0e3dd0978ca">peerDigestNewDelay</a>(fetch-&gt;entry));</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span> </div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>        <span class="comment">/* XXX: ugly condition, but how? */</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span> </div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>        <span class="keywordflow">if</span> (fetch-&gt;entry-&gt;store_status == <a class="code hl_enumvalue" href="enums_8h.html#af7404120c842ff6e605306823971959ea28557c32623d21545b6eb07a444c2de5">STORE_OK</a>)</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;reused old digest from &quot;</span> &lt;&lt; <a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a>);</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;received valid digest from &quot;</span> &lt;&lt; <a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a>);</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>    }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>}</div>
</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span> </div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span><span class="comment">/* calculate fetch stats after completion */</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00693" data-start="{" data-end="}">
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a73843370a1af215cecd871179900160f">  693</a></span><a class="code hl_function" href="peer__digest_8cc.html#a73843370a1af215cecd871179900160f">peerDigestFetchSetStats</a>(<a class="code hl_class" href="classDigestFetchState.html">DigestFetchState</a> * fetch)</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>{</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    <a class="code hl_class" href="classMemObject.html">MemObject</a> *mem;</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a> &amp;&amp; fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4b303477db1bb7fb8eab3d01ad114711">request</a>);</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    mem = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>;</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(mem);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    <span class="comment">/* XXX: outgoing numbers are not precise */</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    <span class="comment">/* XXX: we must distinguish between 304 hits and misses here */</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a5c7d7dab2b59bf4f2a0bc805b12d6126">sent</a>.<a class="code hl_variable" href="classDigestFetchState.html#a1d576eda05fc2627ae51efe1f5caea2d">bytes</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a4b303477db1bb7fb8eab3d01ad114711">request</a>-&gt;<a class="code hl_function" href="classHttpRequest.html#a303ac1c50029e7e710b473013c5db40d">prefixLen</a>();</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>    <span class="comment">/* XXX: this is slightly wrong: we don&#39;t KNOW that the entire memobject</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span><span class="comment">     * was fetched. We only know how big it is</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span><span class="comment">     */</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">recv</a>.<a class="code hl_variable" href="classDigestFetchState.html#a1d576eda05fc2627ae51efe1f5caea2d">bytes</a> = mem-&gt;<a class="code hl_function" href="classMemObject.html#a19c0beedbbd977686e00e7b3c885936a">size</a>();</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a5c7d7dab2b59bf4f2a0bc805b12d6126">sent</a>.<a class="code hl_variable" href="classDigestFetchState.html#a7121e83f5feeb23366e3d632c6a74ad2">msg</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">recv</a>.<a class="code hl_variable" href="classDigestFetchState.html#a7121e83f5feeb23366e3d632c6a74ad2">msg</a> = 1;</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#ae4c0745c9cd5b7798e05cff583025e95">expires</a> = fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_variable" href="classStoreEntry.html#a42dc938e1e2a49b3d4275eabeb8eb699">expires</a>;</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9a524b5b0cd45af883253a3fa9292acc">resp_time</a> = <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a> - fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#aad4bf75c7b334ba08623d4c59346406f">start_time</a>;</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span> </div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;peerDigestFetchFinish: recv &quot;</span> &lt;&lt; fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">recv</a>.<a class="code hl_variable" href="classDigestFetchState.html#a1d576eda05fc2627ae51efe1f5caea2d">bytes</a> &lt;&lt;</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>           <span class="stringliteral">&quot; bytes in &quot;</span> &lt;&lt; (<span class="keywordtype">int</span>) fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9a524b5b0cd45af883253a3fa9292acc">resp_time</a> &lt;&lt; <span class="stringliteral">&quot; secs&quot;</span>);</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 3, <span class="stringliteral">&quot;peerDigestFetchFinish: expires: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>           (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#ae4c0745c9cd5b7798e05cff583025e95">expires</a> &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; std::showpos &lt;&lt;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>           (<span class="keywordtype">int</span>) (fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#ae4c0745c9cd5b7798e05cff583025e95">expires</a> - <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>) &lt;&lt; <span class="stringliteral">&quot;), lmt: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>           std::noshowpos &lt;&lt; (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#a4550da0757f7c3aa6af8e8e9c3bcdb48">lastModified</a>() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>           std::showpos &lt;&lt; (<span class="keywordtype">int</span>) (fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#a4550da0757f7c3aa6af8e8e9c3bcdb48">lastModified</a>() - <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a>) &lt;&lt;</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>           <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">cd</a>.<a class="code hl_variable" href="classStatCounters.html#a02f82ebe2a2b7ffc4584f3a8080391fb">kbytes_sent</a> += fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a5c7d7dab2b59bf4f2a0bc805b12d6126">sent</a>.<a class="code hl_variable" href="classDigestFetchState.html#a1d576eda05fc2627ae51efe1f5caea2d">bytes</a>;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">cd</a>.<a class="code hl_variable" href="classStatCounters.html#a443932ed31bacf8bf40e07131bdf4707">kbytes_recv</a> += fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">recv</a>.<a class="code hl_variable" href="classDigestFetchState.html#a1d576eda05fc2627ae51efe1f5caea2d">bytes</a>;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>    <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">cd</a>.<a class="code hl_variable" href="classStatCounters.html#a7dc74dd3a13681593e20ca86e8708f52">msgs_sent</a> += fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a5c7d7dab2b59bf4f2a0bc805b12d6126">sent</a>.<a class="code hl_variable" href="classDigestFetchState.html#a7121e83f5feeb23366e3d632c6a74ad2">msg</a>;</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">cd</a>.<a class="code hl_variable" href="classStatCounters.html#afd8d722173779b05f1cf155c65aa14cd">msgs_recv</a> += fetch-&gt;<a class="code hl_variable" href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">recv</a>.<a class="code hl_variable" href="classDigestFetchState.html#a7121e83f5feeb23366e3d632c6a74ad2">msg</a>;</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>}</div>
</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span> </div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00729" data-start="{" data-end="}">
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a7d583c1b6dce1cb450c46120c22699f8">  729</a></span><a class="code hl_function" href="peer__digest_8cc.html#a7d583c1b6dce1cb450c46120c22699f8">peerDigestSetCBlock</a>(<a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf)</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>{</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <a class="code hl_class" href="classStoreDigestCBlock.html">StoreDigestCBlock</a> cblock;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    <span class="keywordtype">int</span> freed_size = 0;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    <span class="keyword">const</span> <span class="keyword">auto</span> host = pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a>;</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    memcpy(&amp;cblock, buf, <span class="keyword">sizeof</span>(cblock));</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>    <span class="comment">/* network -&gt; host conversions */</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>    cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a> = ntohs(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a>);</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>    cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a> = ntohs(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a>);</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>    cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">capacity</a> = ntohl(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">capacity</a>);</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a70d983d1f0fb5c4fe48163a50ab713d4">count</a> = ntohl(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a70d983d1f0fb5c4fe48163a50ab713d4">count</a>);</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>    cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a91921a4a684140969ac8369d5ceb0ea4">del_count</a> = ntohl(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a91921a4a684140969ac8369d5ceb0ea4">del_count</a>);</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> = ntohl(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a>);</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;got digest cblock from &quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot;; ver: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>           (<span class="keywordtype">int</span>) cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a> &lt;&lt; <span class="stringliteral">&quot; (req: &quot;</span> &lt;&lt; (<span class="keywordtype">int</span>) cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a> &lt;&lt;</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>           <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;\t size: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>           cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> &lt;&lt; <span class="stringliteral">&quot; bytes, e-cnt: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>           cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a70d983d1f0fb5c4fe48163a50ab713d4">count</a> &lt;&lt; <span class="stringliteral">&quot;, e-util: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>           <a class="code hl_function" href="util_8h.html#ae17f6645fa95b2fac13aa19a2421904e">xpercentInt</a>(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a70d983d1f0fb5c4fe48163a50ab713d4">count</a>, cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">capacity</a>) &lt;&lt; <span class="stringliteral">&quot;%&quot;</span> );</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>    <span class="comment">/* check version requirements (both ways) */</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordflow">if</span> (cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a> &gt; <a class="code hl_variable" href="peer__digest_8cc.html#ac11c7a5daca5ee893877fd2b5c94384b">CacheDigestVer</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a>) {</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;&quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot; digest requires version &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>               cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a> &lt;&lt; <span class="stringliteral">&quot;; have: &quot;</span> &lt;&lt; <a class="code hl_variable" href="peer__digest_8cc.html#ac11c7a5daca5ee893877fd2b5c94384b">CacheDigestVer</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a>);</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span> </div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>    }</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    <span class="keywordflow">if</span> (cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a> &lt; <a class="code hl_variable" href="peer__digest_8cc.html#ac11c7a5daca5ee893877fd2b5c94384b">CacheDigestVer</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a>) {</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;&quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot; digest is version &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>               cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a> &lt;&lt; <span class="stringliteral">&quot;; we require: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>               <a class="code hl_variable" href="peer__digest_8cc.html#ac11c7a5daca5ee893877fd2b5c94384b">CacheDigestVer</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a>);</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>    }</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span> </div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    <span class="comment">/* check consistency */</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>    <span class="keywordflow">if</span> (cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">required</a> &gt; cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">ver</a>.<a class="code hl_variable" href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">current</a> ||</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>            cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> &lt;= 0 || cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">capacity</a> &lt;= 0 ||</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>            cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a1e6bd46ca2f02299ea9ecc863dc4ec04">bits_per_entry</a> &lt;= 0 || cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#ae00db924e32555fec73c96402ae3ff44">hash_func_count</a> &lt;= 0) {</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, <a class="code hl_define" href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a>, <span class="stringliteral">&quot;&quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot; digest cblock is corrupted.&quot;</span>);</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>    }</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span> </div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>    <span class="comment">/* check consistency further */</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>    <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> != <a class="code hl_function" href="classCacheDigest.html#a2630d90d179b1bb088f20e166627b187">CacheDigest::CalcMaskSize</a>(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">capacity</a>, cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a1e6bd46ca2f02299ea9ecc863dc4ec04">bits_per_entry</a>)) {</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, <a class="code hl_define" href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a>, host &lt;&lt; <span class="stringliteral">&quot; digest cblock is corrupted &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>               <span class="stringliteral">&quot;(mask size mismatch: &quot;</span> &lt;&lt; cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> &lt;&lt; <span class="stringliteral">&quot; ? &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>               <a class="code hl_function" href="classCacheDigest.html#a2630d90d179b1bb088f20e166627b187">CacheDigest::CalcMaskSize</a>(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">capacity</a>, cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a1e6bd46ca2f02299ea9ecc863dc4ec04">bits_per_entry</a>)</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>               &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>    }</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span> </div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>    <span class="comment">/* there are some things we cannot do yet */</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    <span class="keywordflow">if</span> (cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#ae00db924e32555fec73c96402ae3ff44">hash_func_count</a> != <a class="code hl_variable" href="globals_8h.html#a6094ab7939a6b76534b8496ea58a9f9d">CacheDigestHashFuncCount</a>) {</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, <a class="code hl_define" href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a>, <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot; digest: unsupported #hash functions: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>               cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#ae00db924e32555fec73c96402ae3ff44">hash_func_count</a> &lt;&lt; <span class="stringliteral">&quot; ? &quot;</span> &lt;&lt; <a class="code hl_variable" href="globals_8h.html#a6094ab7939a6b76534b8496ea58a9f9d">CacheDigestHashFuncCount</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    }</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span> </div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span><span class="comment">     * no cblock bugs below this point</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span><span class="comment">     */</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>    <span class="comment">/* check size changes */</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    <span class="keywordflow">if</span> (pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a> &amp;&amp; cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> != (ssize_t)pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>-&gt;<a class="code hl_variable" href="classCacheDigest.html#a9915df131fbbb003c54ee85ce03b575e">mask_size</a>) {</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, host &lt;&lt; <span class="stringliteral">&quot; digest changed size: &quot;</span> &lt;&lt; cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> &lt;&lt;</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>               <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>-&gt;<a class="code hl_variable" href="classCacheDigest.html#a9915df131fbbb003c54ee85ce03b575e">mask_size</a>);</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>        freed_size = pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>-&gt;<a class="code hl_variable" href="classCacheDigest.html#a9915df131fbbb003c54ee85ce03b575e">mask_size</a>;</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        <span class="keyword">delete</span> pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>;</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>        pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    }</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="keywordflow">if</span> (!pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>) {</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, 2, <span class="stringliteral">&quot;creating &quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot; digest; size: &quot;</span> &lt;&lt; cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>               std::showpos &lt;&lt;  (<span class="keywordtype">int</span>) (cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> - freed_size) &lt;&lt; <span class="stringliteral">&quot;) bytes&quot;</span>);</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a> = <span class="keyword">new</span> <a class="code hl_class" href="classCacheDigest.html">CacheDigest</a>(cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">capacity</a>, cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a1e6bd46ca2f02299ea9ecc863dc4ec04">bits_per_entry</a>);</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span> </div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>        <span class="keywordflow">if</span> (cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> &gt;= freed_size)</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>            <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">cd</a>.<a class="code hl_variable" href="classStatCounters.html#ab29b015b264d1b0d0f62f4d17916b08f">memory</a> += (cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">mask_size</a> - freed_size);</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>    }</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span> </div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>);</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>    <span class="comment">/* these assignments leave us in an inconsistent state until we finish reading the digest */</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>-&gt;<a class="code hl_variable" href="classCacheDigest.html#a93354d9b6a81a05f8b7abaf4482d007d">count</a> = cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a70d983d1f0fb5c4fe48163a50ab713d4">count</a>;</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>    pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>-&gt;<a class="code hl_variable" href="classCacheDigest.html#a69f0b80c34f75fbcabd646ee459808ad">del_count</a> = cblock.<a class="code hl_variable" href="classStoreDigestCBlock.html#a91921a4a684140969ac8369d5ceb0ea4">del_count</a>;</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>}</div>
</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span> </div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00821" data-start="{" data-end="}">
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#ae199004959205be451d747bb247d5a89">  821</a></span><a class="code hl_function" href="peer__digest_8cc.html#ae199004959205be451d747bb247d5a89">peerDigestUseful</a>(<span class="keyword">const</span> <a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd)</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>{</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    <span class="comment">/* TODO: we should calculate the prob of a false hit instead of bit util */</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    <span class="keyword">const</span> <span class="keyword">auto</span> bit_util = pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>-&gt;<a class="code hl_function" href="classCacheDigest.html#a262b95df0c4f31a480ebef0a834be558">usedMaskPercent</a>();</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span> </div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <span class="keywordflow">if</span> (bit_util &gt; 65.0) {</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(72, <a class="code hl_define" href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a>, <span class="stringliteral">&quot;WARNING: &quot;</span> &lt;&lt; pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a> &lt;&lt;</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>               <span class="stringliteral">&quot; peer digest has too many bits on (&quot;</span> &lt;&lt; bit_util &lt;&lt; <span class="stringliteral">&quot;%).&quot;</span>);</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>    }</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span> </div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>}</div>
</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span> </div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00836" data-start="{" data-end="}">
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#ac6ad5ab90b4b69b4fe8ec36ddc64299a">  836</a></span><a class="code hl_function" href="peer__digest_8cc.html#ac6ad5ab90b4b69b4fe8ec36ddc64299a">saneDiff</a>(time_t diff)</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>{</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="keywordflow">return</span> abs((<span class="keywordtype">int</span>) diff) &gt; <a class="code hl_variable" href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a> / 2 ? 0 : diff;</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>}</div>
</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span> </div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00842" data-start="{" data-end="}">
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno"><a class="line" href="peer__digest_8cc.html#a64134b370cd7239c0946dc8b2017ec34">  842</a></span><a class="code hl_function" href="peer__digest_8cc.html#a64134b370cd7239c0946dc8b2017ec34">peerDigestStatsReport</a>(<span class="keyword">const</span> <a class="code hl_class" href="classPeerDigest.html">PeerDigest</a> * pd, <a class="code hl_class" href="classStoreEntry.html">StoreEntry</a> * e)</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>{</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span><span class="preprocessor">#define f2s(flag) (pd-&gt;flags.flag ? &quot;yes&quot; : &quot;no&quot;)</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span><span class="preprocessor">#define appendTime(tm) storeAppendPrintf(e, &quot;%s\t %10ld\t %+d\t %+d\n&quot;, \</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span><span class="preprocessor">    &quot;&quot;#tm, (long int)pd-&gt;times.tm, \</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span><span class="preprocessor">    saneDiff(pd-&gt;times.tm - squid_curtime), \</span></div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span><span class="preprocessor">    saneDiff(pd-&gt;times.tm - pd-&gt;times.initialized))</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span> </div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pd);</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span> </div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>    <span class="keyword">auto</span> host = pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">host</a>;</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\npeer digest from &quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;\n&quot;</span>, <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(host));</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <a class="code hl_function" href="CacheDigest_8cc.html#a0ba5ee324bc800f79460c0a897721b3a">cacheDigestGuessStatsReport</a>(&amp;pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a274131576cf202fe61684f2e7e4a0519">stats</a>.<a class="code hl_variable" href="classPeerDigest.html#a4bea7b592a5860d191d18f293e20f91d">guess</a>, e, host);</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\nevent\t timestamp\t secs from now\t secs from init\n&quot;</span>);</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    <a class="code hl_define" href="peer__digest_8cc.html#a0cc84ff398a211b56f0a22cb5d74e423">appendTime</a>(initialized);</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>    <a class="code hl_define" href="peer__digest_8cc.html#a0cc84ff398a211b56f0a22cb5d74e423">appendTime</a>(needed);</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>    <a class="code hl_define" href="peer__digest_8cc.html#a0cc84ff398a211b56f0a22cb5d74e423">appendTime</a>(requested);</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    <a class="code hl_define" href="peer__digest_8cc.html#a0cc84ff398a211b56f0a22cb5d74e423">appendTime</a>(received);</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    <a class="code hl_define" href="peer__digest_8cc.html#a0cc84ff398a211b56f0a22cb5d74e423">appendTime</a>(next_check);</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span> </div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;peer digest state:\n&quot;</span>);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\tneeded: %3s, usable: %3s, requested: %3s\n&quot;</span>,</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>                      <a class="code hl_define" href="peer__digest_8cc.html#a632a468e3faf8eac39a23d4dcebab3aa">f2s</a>(needed), <a class="code hl_define" href="peer__digest_8cc.html#a632a468e3faf8eac39a23d4dcebab3aa">f2s</a>(usable), <a class="code hl_define" href="peer__digest_8cc.html#a632a468e3faf8eac39a23d4dcebab3aa">f2s</a>(requested));</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\n\tlast retry delay: %d secs\n&quot;</span>,</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>                      (<span class="keywordtype">int</span>) pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#a0c29a605ba3621faa56b45456bd5111f">retry_delay</a>);</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\tlast request response time: %d secs\n&quot;</span>,</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>                      (<span class="keywordtype">int</span>) pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">times</a>.<a class="code hl_variable" href="classPeerDigest.html#ad754df7fb823f96b7da4a99405bea7d3">req_delay</a>);</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\tlast request result: %s\n&quot;</span>,</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>                      pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad8f02ae83b3c0e2e25affd61ad6ed42e">req_result</a> ? pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad8f02ae83b3c0e2e25affd61ad6ed42e">req_result</a> : <span class="stringliteral">&quot;(none)&quot;</span>);</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\npeer digest traffic:\n&quot;</span>);</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\trequests sent: %d, volume: %d KB\n&quot;</span>,</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>                      pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a274131576cf202fe61684f2e7e4a0519">stats</a>.<a class="code hl_variable" href="classPeerDigest.html#a4bd9bcd2a5c1c7f06bfe12e392cfe10e">sent</a>.<a class="code hl_variable" href="classPeerDigest.html#a6dcfc3b15faed8000f040a7a0c5361fc">msgs</a>, (<span class="keywordtype">int</span>) pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a274131576cf202fe61684f2e7e4a0519">stats</a>.<a class="code hl_variable" href="classPeerDigest.html#a4bd9bcd2a5c1c7f06bfe12e392cfe10e">sent</a>.<a class="code hl_variable" href="classPeerDigest.html#a1705c1fd5eec90d11aec97ed7bbfede5">kbytes</a>.<a class="code hl_variable" href="classByteCounter.html#a06e62a14d39564b60ba794224380abce">kb</a>);</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\treplies recv:  %d, volume: %d KB\n&quot;</span>,</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>                      pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a274131576cf202fe61684f2e7e4a0519">stats</a>.<a class="code hl_variable" href="classPeerDigest.html#a8a51fa331d2c07bbc0da2cb69753fb77">recv</a>.<a class="code hl_variable" href="classPeerDigest.html#a6dcfc3b15faed8000f040a7a0c5361fc">msgs</a>, (<span class="keywordtype">int</span>) pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#a274131576cf202fe61684f2e7e4a0519">stats</a>.<a class="code hl_variable" href="classPeerDigest.html#a8a51fa331d2c07bbc0da2cb69753fb77">recv</a>.<a class="code hl_variable" href="classPeerDigest.html#a1705c1fd5eec90d11aec97ed7bbfede5">kbytes</a>.<a class="code hl_variable" href="classByteCounter.html#a06e62a14d39564b60ba794224380abce">kb</a>);</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span> </div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\npeer digest structure:\n&quot;</span>);</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span> </div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>    <span class="keywordflow">if</span> (pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>)</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>        <a class="code hl_function" href="CacheDigest_8cc.html#a768871dd4b21d74d0a4649987724bdd2">cacheDigestReport</a>(pd-&gt;<a class="code hl_variable" href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">cd</a>, host, e);</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>        <a class="code hl_function" href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a>(e, <span class="stringliteral">&quot;\tno in-memory copy\n&quot;</span>);</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>}</div>
</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span> </div>
<div class="ttc" id="aAssure_8h_html_a1fcca4cd6cfc3b9f835aa3652eb0c2f5"><div class="ttname"><a href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a></div><div class="ttdeci">#define Assure(condition)</div><div class="ttdef"><b>Definition</b> <a href="Assure_8h_source.html#l00035">Assure.h:35</a></div></div>
<div class="ttc" id="aCacheDigest_8cc_html_a0ba5ee324bc800f79460c0a897721b3a"><div class="ttname"><a href="CacheDigest_8cc.html#a0ba5ee324bc800f79460c0a897721b3a">cacheDigestGuessStatsReport</a></div><div class="ttdeci">void cacheDigestGuessStatsReport(const CacheDigestGuessStats *stats, StoreEntry *sentry, const SBuf &amp;label)</div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8cc_source.html#l00209">CacheDigest.cc:209</a></div></div>
<div class="ttc" id="aCacheDigest_8cc_html_a768871dd4b21d74d0a4649987724bdd2"><div class="ttname"><a href="CacheDigest_8cc.html#a768871dd4b21d74d0a4649987724bdd2">cacheDigestReport</a></div><div class="ttdeci">void cacheDigestReport(CacheDigest *cd, const SBuf &amp;label, StoreEntry *e)</div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8cc_source.html#l00243">CacheDigest.cc:243</a></div></div>
<div class="ttc" id="aCacheDigest_8h_html"><div class="ttname"><a href="CacheDigest_8h.html">CacheDigest.h</a></div></div>
<div class="ttc" id="aCachePeer_8h_html"><div class="ttname"><a href="CachePeer_8h.html">CachePeer.h</a></div></div>
<div class="ttc" id="aFwdState_8h_html"><div class="ttname"><a href="FwdState_8h.html">FwdState.h</a></div></div>
<div class="ttc" id="aHttpReply_8h_html"><div class="ttname"><a href="HttpReply_8h.html">HttpReply.h</a></div></div>
<div class="ttc" id="aHttpRequest_8h_html"><div class="ttname"><a href="HttpRequest_8h.html">HttpRequest.h</a></div></div>
<div class="ttc" id="aIoManip_8h_html"><div class="ttname"><a href="IoManip_8h.html">IoManip.h</a></div></div>
<div class="ttc" id="aIoManip_8h_html_afb10fe715d55bc0f31985b3de7269ce0"><div class="ttname"><a href="IoManip_8h.html#afb10fe715d55bc0f31985b3de7269ce0">RawPointer</a></div><div class="ttdeci">RawPointerT&lt; Pointer &gt; RawPointer(const char *label, const Pointer &amp;ptr)</div><div class="ttdoc">convenience wrapper for creating RawPointerT&lt;&gt; objects</div><div class="ttdef"><b>Definition</b> <a href="IoManip_8h_source.html#l00073">IoManip.h:73</a></div></div>
<div class="ttc" id="aMemObject_8h_html"><div class="ttname"><a href="MemObject_8h.html">MemObject.h</a></div></div>
<div class="ttc" id="aModDevPoll_8cc_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition</b> <a href="ModDevPoll_8cc_source.html#l00070">ModDevPoll.cc:70</a></div></div>
<div class="ttc" id="aPeerDigest_8h_html"><div class="ttname"><a href="PeerDigest_8h.html">PeerDigest.h</a></div></div>
<div class="ttc" id="aPool_8cc_html_a161e26ef0307ccb4300ad3ea54bf9fd4"><div class="ttname"><a href="Pool_8cc.html#a161e26ef0307ccb4300ad3ea54bf9fd4">squid_curtime</a></div><div class="ttdeci">time_t squid_curtime</div><div class="ttdef"><b>Definition</b> <a href="stub__libtime_8cc_source.html#l00020">stub_libtime.cc:20</a></div></div>
<div class="ttc" id="aSBuf_8h_html_a225d674d14bd9377da94fdb0edc08ecc"><div class="ttname"><a href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a></div><div class="ttdeci">#define SQUIDSBUFPH</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00031">SBuf.h:31</a></div></div>
<div class="ttc" id="aSBuf_8h_html_aba15ad960fbece70b7940c8d3a5c344b"><div class="ttname"><a href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a></div><div class="ttdeci">#define SQUIDSBUFPRINT(s)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00032">SBuf.h:32</a></div></div>
<div class="ttc" id="aStatCounters_8cc_html_a97511f6512b50279a2cd9cf1446060d7"><div class="ttname"><a href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a></div><div class="ttdeci">StatCounters statCounter</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8cc_source.html#l00012">StatCounters.cc:12</a></div></div>
<div class="ttc" id="aStoreClient_8h_html"><div class="ttname"><a href="StoreClient_8h.html">StoreClient.h</a></div></div>
<div class="ttc" id="aStoreClient_8h_html_a48e07440f256e626bf7b91ee8236f028"><div class="ttname"><a href="StoreClient_8h.html#a48e07440f256e626bf7b91ee8236f028">STCB</a></div><div class="ttdeci">void(void *, StoreIOBuffer) STCB</div><div class="ttdef"><b>Definition</b> <a href="StoreClient_8h_source.html#l00032">StoreClient.h:32</a></div></div>
<div class="ttc" id="aStore_8h_html"><div class="ttname"><a href="Store_8h.html">Store.h</a></div></div>
<div class="ttc" id="aassert_8h_html_a33fa45e42155e69ce8d0da0fd978b351"><div class="ttname"><a href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a></div><div class="ttdeci">#define assert(EX)</div><div class="ttdef"><b>Definition</b> <a href="assert_8h_source.html#l00017">assert.h:17</a></div></div>
<div class="ttc" id="acbdata_8cc_html_aa6ed5c53b844c6f8f3e7c39daa051835"><div class="ttname"><a href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a></div><div class="ttdeci">int cbdataReferenceValid(const void *p)</div><div class="ttdef"><b>Definition</b> <a href="cbdata_8cc_source.html#l00270">cbdata.cc:270</a></div></div>
<div class="ttc" id="acbdata_8h_html_a4710a3530194cffbc7f74fa2b2c4529d"><div class="ttname"><a href="cbdata_8h.html#a4710a3530194cffbc7f74fa2b2c4529d">CBDATA_CLASS_INIT</a></div><div class="ttdeci">#define CBDATA_CLASS_INIT(type)</div><div class="ttdef"><b>Definition</b> <a href="cbdata_8h_source.html#l00325">cbdata.h:325</a></div></div>
<div class="ttc" id="aclassAnyP_1_1Uri_html_aff2c3402a1b8f1ebc50bc6a3e5933708"><div class="ttname"><a href="classAnyP_1_1Uri.html#aff2c3402a1b8f1ebc50bc6a3e5933708">AnyP::Uri::userInfo</a></div><div class="ttdeci">void userInfo(const SBuf &amp;s)</div><div class="ttdef"><b>Definition</b> <a href="Uri_8h_source.html#l00070">Uri.h:70</a></div></div>
<div class="ttc" id="aclassByteCounter_html_a06e62a14d39564b60ba794224380abce"><div class="ttname"><a href="classByteCounter.html#a06e62a14d39564b60ba794224380abce">ByteCounter::kb</a></div><div class="ttdeci">size_t kb</div><div class="ttdef"><b>Definition</b> <a href="ByteCounter_8h_source.html#l00025">ByteCounter.h:25</a></div></div>
<div class="ttc" id="aclassCacheDigest_html"><div class="ttname"><a href="classCacheDigest.html">CacheDigest</a></div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8h_source.html#l00020">CacheDigest.h:21</a></div></div>
<div class="ttc" id="aclassCacheDigest_html_a262b95df0c4f31a480ebef0a834be558"><div class="ttname"><a href="classCacheDigest.html#a262b95df0c4f31a480ebef0a834be558">CacheDigest::usedMaskPercent</a></div><div class="ttdeci">double usedMaskPercent() const</div><div class="ttdoc">percentage of mask bits which are used</div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8cc_source.html#l00183">CacheDigest.cc:183</a></div></div>
<div class="ttc" id="aclassCacheDigest_html_a2630d90d179b1bb088f20e166627b187"><div class="ttname"><a href="classCacheDigest.html#a2630d90d179b1bb088f20e166627b187">CacheDigest::CalcMaskSize</a></div><div class="ttdeci">static uint32_t CalcMaskSize(uint64_t cap, uint8_t bpe)</div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8cc_source.html#l00271">CacheDigest.cc:271</a></div></div>
<div class="ttc" id="aclassCacheDigest_html_a69f0b80c34f75fbcabd646ee459808ad"><div class="ttname"><a href="classCacheDigest.html#a69f0b80c34f75fbcabd646ee459808ad">CacheDigest::del_count</a></div><div class="ttdeci">uint64_t del_count</div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8h_source.html#l00056">CacheDigest.h:56</a></div></div>
<div class="ttc" id="aclassCacheDigest_html_a93354d9b6a81a05f8b7abaf4482d007d"><div class="ttname"><a href="classCacheDigest.html#a93354d9b6a81a05f8b7abaf4482d007d">CacheDigest::count</a></div><div class="ttdeci">uint64_t count</div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8h_source.html#l00055">CacheDigest.h:55</a></div></div>
<div class="ttc" id="aclassCacheDigest_html_a9915df131fbbb003c54ee85ce03b575e"><div class="ttname"><a href="classCacheDigest.html#a9915df131fbbb003c54ee85ce03b575e">CacheDigest::mask_size</a></div><div class="ttdeci">uint32_t mask_size</div><div class="ttdef"><b>Definition</b> <a href="CacheDigest_8h_source.html#l00059">CacheDigest.h:59</a></div></div>
<div class="ttc" id="aclassCachePeer_html"><div class="ttname"><a href="classCachePeer.html">CachePeer</a></div><div class="ttdef"><b>Definition</b> <a href="CachePeer_8h_source.html#l00028">CachePeer.h:29</a></div></div>
<div class="ttc" id="aclassCbcPointer_html"><div class="ttname"><a href="classCbcPointer.html">CbcPointer</a></div><div class="ttdef"><b>Definition</b> <a href="CbcPointer_8h_source.html#l00025">CbcPointer.h:26</a></div></div>
<div class="ttc" id="aclassCbcPointer_html_a2125df76c0d5eb45bdb8b18e88a71258"><div class="ttname"><a href="classCbcPointer.html#a2125df76c0d5eb45bdb8b18e88a71258">CbcPointer::valid</a></div><div class="ttdeci">Cbc * valid() const</div><div class="ttdoc">was set and is valid</div><div class="ttdef"><b>Definition</b> <a href="CbcPointer_8h_source.html#l00041">CbcPointer.h:41</a></div></div>
<div class="ttc" id="aclassCbcPointer_html_a51352b9142632d3c8d28530bf151a3c3"><div class="ttname"><a href="classCbcPointer.html#a51352b9142632d3c8d28530bf151a3c3">CbcPointer::get</a></div><div class="ttdeci">Cbc * get() const</div><div class="ttdoc">a temporary valid raw Cbc pointer or NULL</div><div class="ttdef"><b>Definition</b> <a href="CbcPointer_8h_source.html#l00159">CbcPointer.h:159</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html"><div class="ttname"><a href="classDigestFetchState.html">DigestFetchState</a></div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00044">PeerDigest.h:45</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a02dd4541a2ab0f48ad8a6ffff4e63224"><div class="ttname"><a href="classDigestFetchState.html#a02dd4541a2ab0f48ad8a6ffff4e63224">DigestFetchState::sc</a></div><div class="ttdeci">store_client * sc</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00055">PeerDigest.h:55</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a1d576eda05fc2627ae51efe1f5caea2d"><div class="ttname"><a href="classDigestFetchState.html#a1d576eda05fc2627ae51efe1f5caea2d">DigestFetchState::bytes</a></div><div class="ttdeci">int bytes</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00066">PeerDigest.h:66</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a448e4be628717c97ec311d76dc130169"><div class="ttname"><a href="classDigestFetchState.html#a448e4be628717c97ec311d76dc130169">DigestFetchState::entry</a></div><div class="ttdeci">StoreEntry * entry</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00053">PeerDigest.h:53</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a4af436123622d72ee8ca1590392fce58"><div class="ttname"><a href="classDigestFetchState.html#a4af436123622d72ee8ca1590392fce58">DigestFetchState::pd</a></div><div class="ttdeci">CbcPointer&lt; PeerDigest &gt; pd</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00052">PeerDigest.h:52</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a4b303477db1bb7fb8eab3d01ad114711"><div class="ttname"><a href="classDigestFetchState.html#a4b303477db1bb7fb8eab3d01ad114711">DigestFetchState::request</a></div><div class="ttdeci">HttpRequest * request</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00057">PeerDigest.h:57</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a5c7d7dab2b59bf4f2a0bc805b12d6126"><div class="ttname"><a href="classDigestFetchState.html#a5c7d7dab2b59bf4f2a0bc805b12d6126">DigestFetchState::sent</a></div><div class="ttdeci">struct DigestFetchState::@67 sent</div></div>
<div class="ttc" id="aclassDigestFetchState_html_a7121e83f5feeb23366e3d632c6a74ad2"><div class="ttname"><a href="classDigestFetchState.html#a7121e83f5feeb23366e3d632c6a74ad2">DigestFetchState::msg</a></div><div class="ttdeci">int msg</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00065">PeerDigest.h:65</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a755eaa4fea1cf741d252fc9db86ba0a2"><div class="ttname"><a href="classDigestFetchState.html#a755eaa4fea1cf741d252fc9db86ba0a2">DigestFetchState::buf</a></div><div class="ttdeci">char buf[SM_PAGE_SIZE]</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00069">PeerDigest.h:69</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a8d55ebf7e4bd9a2c3cf584aec2893d0a"><div class="ttname"><a href="classDigestFetchState.html#a8d55ebf7e4bd9a2c3cf584aec2893d0a">DigestFetchState::old_sc</a></div><div class="ttdeci">store_client * old_sc</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00056">PeerDigest.h:56</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a93afdf0648ed4126f0ba4086f37405b6"><div class="ttname"><a href="classDigestFetchState.html#a93afdf0648ed4126f0ba4086f37405b6">DigestFetchState::bufofs</a></div><div class="ttdeci">ssize_t bufofs</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00070">PeerDigest.h:70</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a9a524b5b0cd45af883253a3fa9292acc"><div class="ttname"><a href="classDigestFetchState.html#a9a524b5b0cd45af883253a3fa9292acc">DigestFetchState::resp_time</a></div><div class="ttdeci">time_t resp_time</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00061">PeerDigest.h:61</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_a9f1479c91e918d29a049f5d051cc9ddf"><div class="ttname"><a href="classDigestFetchState.html#a9f1479c91e918d29a049f5d051cc9ddf">DigestFetchState::recv</a></div><div class="ttdeci">struct DigestFetchState::@67 recv</div></div>
<div class="ttc" id="aclassDigestFetchState_html_aab4771b97698e061294c45717d50c682"><div class="ttname"><a href="classDigestFetchState.html#aab4771b97698e061294c45717d50c682">DigestFetchState::offset</a></div><div class="ttdeci">int offset</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00058">PeerDigest.h:58</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_aad4bf75c7b334ba08623d4c59346406f"><div class="ttname"><a href="classDigestFetchState.html#aad4bf75c7b334ba08623d4c59346406f">DigestFetchState::start_time</a></div><div class="ttdeci">time_t start_time</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00060">PeerDigest.h:60</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_ac076eb3cda4a0b9749a4c69a52e293c3"><div class="ttname"><a href="classDigestFetchState.html#ac076eb3cda4a0b9749a4c69a52e293c3">DigestFetchState::DigestFetchState</a></div><div class="ttdeci">DigestFetchState(PeerDigest *, HttpRequest *)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00075">peer_digest.cc:75</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_ad3ac5410b910029def0c87b2feb3b867"><div class="ttname"><a href="classDigestFetchState.html#ad3ac5410b910029def0c87b2feb3b867">DigestFetchState::~DigestFetchState</a></div><div class="ttdeci">~DigestFetchState()</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00101">peer_digest.cc:101</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_ae4c0745c9cd5b7798e05cff583025e95"><div class="ttname"><a href="classDigestFetchState.html#ae4c0745c9cd5b7798e05cff583025e95">DigestFetchState::expires</a></div><div class="ttdeci">time_t expires</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00062">PeerDigest.h:62</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_aef0fc14ead75cb1c1a2b6e75f8d98740"><div class="ttname"><a href="classDigestFetchState.html#aef0fc14ead75cb1c1a2b6e75f8d98740">DigestFetchState::state</a></div><div class="ttdeci">digest_read_state_t state</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00071">PeerDigest.h:71</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_af9402fd5859c1cdb5bd650e923b76cf5"><div class="ttname"><a href="classDigestFetchState.html#af9402fd5859c1cdb5bd650e923b76cf5">DigestFetchState::mask_offset</a></div><div class="ttdeci">uint32_t mask_offset</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00059">PeerDigest.h:59</a></div></div>
<div class="ttc" id="aclassDigestFetchState_html_afbd45c285ca89baa005b5f89bc5791a2"><div class="ttname"><a href="classDigestFetchState.html#afbd45c285ca89baa005b5f89bc5791a2">DigestFetchState::old_entry</a></div><div class="ttdeci">StoreEntry * old_entry</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00054">PeerDigest.h:54</a></div></div>
<div class="ttc" id="aclassFwdState_html_aee3d157b8666452a80f9f976a5558df1"><div class="ttname"><a href="classFwdState.html#aee3d157b8666452a80f9f976a5558df1">FwdState::fwdStart</a></div><div class="ttdeci">static void fwdStart(const Comm::ConnectionPointer &amp;client, StoreEntry *, HttpRequest *)</div><div class="ttdoc">Same as Start() but no master xaction info (AccessLogEntry) available.</div><div class="ttdef"><b>Definition</b> <a href="FwdState_8cc_source.html#l00407">FwdState.cc:407</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a187949b24278b65f28338947c605b130"><div class="ttname"><a href="classHttpHeader.html#a187949b24278b65f28338947c605b130">HttpHeader::putStr</a></div><div class="ttdeci">void putStr(Http::HdrType id, const char *str)</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01128">HttpHeader.cc:1128</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_ae6dc1e75bf86278c8f7be265cc326531"><div class="ttname"><a href="classHttpHeader.html#ae6dc1e75bf86278c8f7be265cc326531">HttpHeader::len</a></div><div class="ttdeci">int len</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00178">HttpHeader.h:178</a></div></div>
<div class="ttc" id="aclassHttpReply_html_a01790af23c553b590ac6009ebb693b6d"><div class="ttname"><a href="classHttpReply.html#a01790af23c553b590ac6009ebb693b6d">HttpReply::sline</a></div><div class="ttdeci">Http::StatusLine sline</div><div class="ttdef"><b>Definition</b> <a href="HttpReply_8h_source.html#l00056">HttpReply.h:56</a></div></div>
<div class="ttc" id="aclassHttpRequest_html"><div class="ttname"><a href="classHttpRequest.html">HttpRequest</a></div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00048">HttpRequest.h:49</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a1f0af82ff15e9a29d15319fc3cf05a54"><div class="ttname"><a href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">HttpRequest::method</a></div><div class="ttdeci">HttpRequestMethod method</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00114">HttpRequest.h:114</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a303ac1c50029e7e710b473013c5db40d"><div class="ttname"><a href="classHttpRequest.html#a303ac1c50029e7e710b473013c5db40d">HttpRequest::prefixLen</a></div><div class="ttdeci">int prefixLen() const</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00366">HttpRequest.cc:366</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a3738e100587f43de4a040b3f0463e21d"><div class="ttname"><a href="classHttpRequest.html#a3738e100587f43de4a040b3f0463e21d">HttpRequest::FromUrlXXX</a></div><div class="ttdeci">static HttpRequest * FromUrlXXX(const char *url, const MasterXaction::Pointer &amp;, const HttpRequestMethod &amp;method=Http::METHOD_GET)</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00525">HttpRequest.cc:525</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a76422841293a4230a1a76479e6964c04"><div class="ttname"><a href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">HttpRequest::flags</a></div><div class="ttdeci">RequestFlags flags</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00141">HttpRequest.h:141</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_af191362e7cf9b99f7f15dd20a0076e89"><div class="ttname"><a href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">HttpRequest::url</a></div><div class="ttdeci">AnyP::Uri url</div><div class="ttdoc">the request URI</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00115">HttpRequest.h:115</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a79ae935ff618211b139dcfdd8a5277ec"><div class="ttname"><a href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">Http::Message::header</a></div><div class="ttdeci">HttpHeader header</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00074">Message.h:74</a></div></div>
<div class="ttc" id="aclassHttp_1_1StatusLine_html_af852e58bb3e96bc41cd16787b0a7d7db"><div class="ttname"><a href="classHttp_1_1StatusLine.html#af852e58bb3e96bc41cd16787b0a7d7db">Http::StatusLine::status</a></div><div class="ttdeci">Http::StatusCode status() const</div><div class="ttdoc">retrieve the status code for this status line</div><div class="ttdef"><b>Definition</b> <a href="StatusLine_8h_source.html#l00045">StatusLine.h:45</a></div></div>
<div class="ttc" id="aclassMemObject_html"><div class="ttname"><a href="classMemObject.html">MemObject</a></div><div class="ttdef"><b>Definition</b> <a href="MemObject_8h_source.html#l00033">MemObject.h:34</a></div></div>
<div class="ttc" id="aclassMemObject_html_a19c0beedbbd977686e00e7b3c885936a"><div class="ttname"><a href="classMemObject.html#a19c0beedbbd977686e00e7b3c885936a">MemObject::size</a></div><div class="ttdeci">int64_t size() const</div><div class="ttdef"><b>Definition</b> <a href="MemObject_8cc_source.html#l00229">MemObject.cc:229</a></div></div>
<div class="ttc" id="aclassMemObject_html_a38fde17e9fa64949670b7a25e0735e64"><div class="ttname"><a href="classMemObject.html#a38fde17e9fa64949670b7a25e0735e64">MemObject::request</a></div><div class="ttdeci">HttpRequestPointer request</div><div class="ttdef"><b>Definition</b> <a href="MemObject_8h_source.html#l00205">MemObject.h:205</a></div></div>
<div class="ttc" id="aclassMemObject_html_a89697947bc40cdbe591b9e26951b59ba"><div class="ttname"><a href="classMemObject.html#a89697947bc40cdbe591b9e26951b59ba">MemObject::freshestReply</a></div><div class="ttdeci">const HttpReply &amp; freshestReply() const</div><div class="ttdef"><b>Definition</b> <a href="MemObject_8h_source.html#l00068">MemObject.h:68</a></div></div>
<div class="ttc" id="aclassPeerDigest_html"><div class="ttname"><a href="classPeerDigest.html">PeerDigest</a></div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00074">PeerDigest.h:75</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a0c29a605ba3621faa56b45456bd5111f"><div class="ttname"><a href="classPeerDigest.html#a0c29a605ba3621faa56b45456bd5111f">PeerDigest::retry_delay</a></div><div class="ttdeci">time_t retry_delay</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00102">PeerDigest.h:102</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a1705c1fd5eec90d11aec97ed7bbfede5"><div class="ttname"><a href="classPeerDigest.html#a1705c1fd5eec90d11aec97ed7bbfede5">PeerDigest::kbytes</a></div><div class="ttdeci">ByteCounter kbytes</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00115">PeerDigest.h:115</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a274131576cf202fe61684f2e7e4a0519"><div class="ttname"><a href="classPeerDigest.html#a274131576cf202fe61684f2e7e4a0519">PeerDigest::stats</a></div><div class="ttdeci">struct PeerDigest::@70 stats</div></div>
<div class="ttc" id="aclassPeerDigest_html_a425fece3a08f57e0f794cf006b1c9112"><div class="ttname"><a href="classPeerDigest.html#a425fece3a08f57e0f794cf006b1c9112">PeerDigest::requested</a></div><div class="ttdeci">bool requested</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00094">PeerDigest.h:94</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a4bd9bcd2a5c1c7f06bfe12e392cfe10e"><div class="ttname"><a href="classPeerDigest.html#a4bd9bcd2a5c1c7f06bfe12e392cfe10e">PeerDigest::sent</a></div><div class="ttdeci">struct PeerDigest::@70::@71 sent</div></div>
<div class="ttc" id="aclassPeerDigest_html_a4bea7b592a5860d191d18f293e20f91d"><div class="ttname"><a href="classPeerDigest.html#a4bea7b592a5860d191d18f293e20f91d">PeerDigest::guess</a></div><div class="ttdeci">CacheDigestGuessStats guess</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00110">PeerDigest.h:110</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a66411290776ea0eb67c02cfce879b4ee"><div class="ttname"><a href="classPeerDigest.html#a66411290776ea0eb67c02cfce879b4ee">PeerDigest::times</a></div><div class="ttdeci">struct PeerDigest::@69 times</div></div>
<div class="ttc" id="aclassPeerDigest_html_a66f52082c83b12257f328d80a2b93783"><div class="ttname"><a href="classPeerDigest.html#a66f52082c83b12257f328d80a2b93783">PeerDigest::next_check</a></div><div class="ttdeci">time_t next_check</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00101">PeerDigest.h:101</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a6dcfc3b15faed8000f040a7a0c5361fc"><div class="ttname"><a href="classPeerDigest.html#a6dcfc3b15faed8000f040a7a0c5361fc">PeerDigest::msgs</a></div><div class="ttdeci">int msgs</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00114">PeerDigest.h:114</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a73fdc1c068feb98d0a38f8c9471f2d05"><div class="ttname"><a href="classPeerDigest.html#a73fdc1c068feb98d0a38f8c9471f2d05">PeerDigest::received</a></div><div class="ttdeci">time_t received</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00105">PeerDigest.h:105</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a767983550bfc63d3c1883e52e97f5b57"><div class="ttname"><a href="classPeerDigest.html#a767983550bfc63d3c1883e52e97f5b57">PeerDigest::peer</a></div><div class="ttdeci">CbcPointer&lt; CachePeer &gt; peer</div><div class="ttdoc">pointer back to peer structure, argh</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00086">PeerDigest.h:86</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a7f51eda03c147d679e7bc936f9d12743"><div class="ttname"><a href="classPeerDigest.html#a7f51eda03c147d679e7bc936f9d12743">PeerDigest::flags</a></div><div class="ttdeci">struct PeerDigest::@68 flags</div></div>
<div class="ttc" id="aclassPeerDigest_html_a8a51fa331d2c07bbc0da2cb69753fb77"><div class="ttname"><a href="classPeerDigest.html#a8a51fa331d2c07bbc0da2cb69753fb77">PeerDigest::recv</a></div><div class="ttdeci">struct PeerDigest::@70::@71 recv</div></div>
<div class="ttc" id="aclassPeerDigest_html_a8e09586c9bb65e0b1a46ed8536ed6a2c"><div class="ttname"><a href="classPeerDigest.html#a8e09586c9bb65e0b1a46ed8536ed6a2c">PeerDigest::~PeerDigest</a></div><div class="ttdeci">~PeerDigest()</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00120">peer_digest.cc:120</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_a95b59cf96ae6686926de7a51c250f043"><div class="ttname"><a href="classPeerDigest.html#a95b59cf96ae6686926de7a51c250f043">PeerDigest::noteFetchFinished</a></div><div class="ttdeci">void noteFetchFinished(const DigestFetchState &amp;, const char *outcomeDescription, bool sawError)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00653">peer_digest.cc:653</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_aa90950f790d3e263b45d43910603a88c"><div class="ttname"><a href="classPeerDigest.html#aa90950f790d3e263b45d43910603a88c">PeerDigest::PeerDigest</a></div><div class="ttdeci">PeerDigest(CachePeer *)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00064">peer_digest.cc:64</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_aa9a3df5f91ebee81d092046902dab9df"><div class="ttname"><a href="classPeerDigest.html#aa9a3df5f91ebee81d092046902dab9df">PeerDigest::needed</a></div><div class="ttdeci">bool needed</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00092">PeerDigest.h:92</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_ad4120741fa9efb6fa9584d0ff2c402de"><div class="ttname"><a href="classPeerDigest.html#ad4120741fa9efb6fa9584d0ff2c402de">PeerDigest::cd</a></div><div class="ttdeci">CacheDigest * cd</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00087">PeerDigest.h:87</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_ad754df7fb823f96b7da4a99405bea7d3"><div class="ttname"><a href="classPeerDigest.html#ad754df7fb823f96b7da4a99405bea7d3">PeerDigest::req_delay</a></div><div class="ttdeci">time_t req_delay</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00104">PeerDigest.h:104</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_ad8f02ae83b3c0e2e25affd61ad6ed42e"><div class="ttname"><a href="classPeerDigest.html#ad8f02ae83b3c0e2e25affd61ad6ed42e">PeerDigest::req_result</a></div><div class="ttdeci">const char * req_result</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00089">PeerDigest.h:89</a></div></div>
<div class="ttc" id="aclassPeerDigest_html_aecfc830b2a6dd52b3a6a49fb714cd6ac"><div class="ttname"><a href="classPeerDigest.html#aecfc830b2a6dd52b3a6a49fb714cd6ac">PeerDigest::host</a></div><div class="ttdeci">const SBuf host</div><div class="ttdoc">copy of peer-&gt;host</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00088">PeerDigest.h:88</a></div></div>
<div class="ttc" id="aclassRefCount_html"><div class="ttname"><a href="classRefCount.html">RefCount&lt; Comm::Connection &gt;</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_a8f900e1c576cb7ea9b979d7001540025"><div class="ttname"><a href="classRequestFlags.html#a8f900e1c576cb7ea9b979d7001540025">RequestFlags::refresh</a></div><div class="ttdeci">bool refresh</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00044">RequestFlags.h:44</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_af33cb0e80d9996c532479ef942d1eb91"><div class="ttname"><a href="classRequestFlags.html#af33cb0e80d9996c532479ef942d1eb91">RequestFlags::cachable</a></div><div class="ttdeci">SupportOrVeto cachable</div><div class="ttdoc">whether the response may be stored in the cache</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00035">RequestFlags.h:35</a></div></div>
<div class="ttc" id="aclassSBuf_html"><div class="ttname"><a href="classSBuf.html">SBuf</a></div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00093">SBuf.h:94</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a02f82ebe2a2b7ffc4584f3a8080391fb"><div class="ttname"><a href="classStatCounters.html#a02f82ebe2a2b7ffc4584f3a8080391fb">StatCounters::kbytes_sent</a></div><div class="ttdeci">ByteCounter kbytes_sent</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00076">StatCounters.h:76</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a443932ed31bacf8bf40e07131bdf4707"><div class="ttname"><a href="classStatCounters.html#a443932ed31bacf8bf40e07131bdf4707">StatCounters::kbytes_recv</a></div><div class="ttdeci">ByteCounter kbytes_recv</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00079">StatCounters.h:79</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a7dc74dd3a13681593e20ca86e8708f52"><div class="ttname"><a href="classStatCounters.html#a7dc74dd3a13681593e20ca86e8708f52">StatCounters::msgs_sent</a></div><div class="ttdeci">int msgs_sent</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00106">StatCounters.h:106</a></div></div>
<div class="ttc" id="aclassStatCounters_html_aa00575c8fd1645b8e42c0062dc8f84ad"><div class="ttname"><a href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">StatCounters::cd</a></div><div class="ttdeci">struct StatCounters::@110 cd</div></div>
<div class="ttc" id="aclassStatCounters_html_ab29b015b264d1b0d0f62f4d17916b08f"><div class="ttname"><a href="classStatCounters.html#ab29b015b264d1b0d0f62f4d17916b08f">StatCounters::memory</a></div><div class="ttdeci">ByteCounter memory</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00105">StatCounters.h:105</a></div></div>
<div class="ttc" id="aclassStatCounters_html_afd8d722173779b05f1cf155c65aa14cd"><div class="ttname"><a href="classStatCounters.html#afd8d722173779b05f1cf155c65aa14cd">StatCounters::msgs_recv</a></div><div class="ttdeci">int msgs_recv</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00107">StatCounters.h:107</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html"><div class="ttname"><a href="classStoreDigestCBlock.html">StoreDigestCBlock</a></div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00026">PeerDigest.h:27</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html_a1e6bd46ca2f02299ea9ecc863dc4ec04"><div class="ttname"><a href="classStoreDigestCBlock.html#a1e6bd46ca2f02299ea9ecc863dc4ec04">StoreDigestCBlock::bits_per_entry</a></div><div class="ttdeci">unsigned char bits_per_entry</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00034">PeerDigest.h:34</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html_a2237b9d88aaaa5eecf5155caacf22cc3"><div class="ttname"><a href="classStoreDigestCBlock.html#a2237b9d88aaaa5eecf5155caacf22cc3">StoreDigestCBlock::mask_size</a></div><div class="ttdeci">int mask_size</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00033">PeerDigest.h:33</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html_a70d983d1f0fb5c4fe48163a50ab713d4"><div class="ttname"><a href="classStoreDigestCBlock.html#a70d983d1f0fb5c4fe48163a50ab713d4">StoreDigestCBlock::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00031">PeerDigest.h:31</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html_a747a9327fc70cbe1f3c232850d8c3bd7"><div class="ttname"><a href="classStoreDigestCBlock.html#a747a9327fc70cbe1f3c232850d8c3bd7">StoreDigestCBlock::capacity</a></div><div class="ttdeci">int capacity</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00030">PeerDigest.h:30</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html_a91921a4a684140969ac8369d5ceb0ea4"><div class="ttname"><a href="classStoreDigestCBlock.html#a91921a4a684140969ac8369d5ceb0ea4">StoreDigestCBlock::del_count</a></div><div class="ttdeci">int del_count</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00032">PeerDigest.h:32</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html_acb6d26f876cd62f1e575d3458dab0dd7"><div class="ttname"><a href="classStoreDigestCBlock.html#acb6d26f876cd62f1e575d3458dab0dd7">StoreDigestCBlock::ver</a></div><div class="ttdeci">Version ver</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00029">PeerDigest.h:29</a></div></div>
<div class="ttc" id="aclassStoreDigestCBlock_html_ae00db924e32555fec73c96402ae3ff44"><div class="ttname"><a href="classStoreDigestCBlock.html#ae00db924e32555fec73c96402ae3ff44">StoreDigestCBlock::hash_func_count</a></div><div class="ttdeci">unsigned char hash_func_count</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00035">PeerDigest.h:35</a></div></div>
<div class="ttc" id="aclassStoreEntry_html"><div class="ttname"><a href="classStoreEntry.html">StoreEntry</a></div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00037">Store.h:38</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a15b61bc1167a3670130a81bc5eca9f16"><div class="ttname"><a href="classStoreEntry.html#a15b61bc1167a3670130a81bc5eca9f16">StoreEntry::flags</a></div><div class="ttdeci">uint16_t flags</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00231">Store.h:231</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a19fd5af89e99c467c29f7bd951ac901d"><div class="ttname"><a href="classStoreEntry.html#a19fd5af89e99c467c29f7bd951ac901d">StoreEntry::mem</a></div><div class="ttdeci">MemObject &amp; mem()</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00047">Store.h:47</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a249ad3e6bfa297da0fa7a0e9accf6002"><div class="ttname"><a href="classStoreEntry.html#a249ad3e6bfa297da0fa7a0e9accf6002">StoreEntry::ensureMemObject</a></div><div class="ttdeci">void ensureMemObject(const char *storeId, const char *logUri, const HttpRequestMethod &amp;aMethod)</div><div class="ttdoc">initialize mem_obj (if needed) and set URIs/method (if missing)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l01589">store.cc:1589</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a35618603cff249c1cc64abf8127f3b7d"><div class="ttname"><a href="classStoreEntry.html#a35618603cff249c1cc64abf8127f3b7d">StoreEntry::unlock</a></div><div class="ttdeci">int unlock(const char *context)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l00469">store.cc:469</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a42dc938e1e2a49b3d4275eabeb8eb699"><div class="ttname"><a href="classStoreEntry.html#a42dc938e1e2a49b3d4275eabeb8eb699">StoreEntry::expires</a></div><div class="ttdeci">time_t expires</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00225">Store.h:225</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a4550da0757f7c3aa6af8e8e9c3bcdb48"><div class="ttname"><a href="classStoreEntry.html#a4550da0757f7c3aa6af8e8e9c3bcdb48">StoreEntry::lastModified</a></div><div class="ttdeci">void lastModified(const time_t when)</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00175">Store.h:175</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a53a607cfbdb22fde40edd2c72bfb6dd3"><div class="ttname"><a href="classStoreEntry.html#a53a607cfbdb22fde40edd2c72bfb6dd3">StoreEntry::lock</a></div><div class="ttdeci">void lock(const char *context)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l00445">store.cc:445</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_ab79c9d3fba14d5c997bae61161d9992f"><div class="ttname"><a href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">StoreEntry::mem_obj</a></div><div class="ttdeci">MemObject * mem_obj</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00220">Store.h:220</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_addfd77d9dd303940e6f323d714da2e89"><div class="ttname"><a href="classStoreEntry.html#addfd77d9dd303940e6f323d714da2e89">StoreEntry::releaseRequest</a></div><div class="ttdeci">void releaseRequest(const bool shareable=false)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l00458">store.cc:458</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html"><div class="ttname"><a href="classStoreIOBuffer.html">StoreIOBuffer</a></div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00015">StoreIOBuffer.h:16</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a08224ebb5a73aa6b18c0e7a60ebf00b5"><div class="ttname"><a href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">StoreIOBuffer::data</a></div><div class="ttdeci">char * data</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00059">StoreIOBuffer.h:59</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a1e3225390c0c4999a67e22a9b503ca16"><div class="ttname"><a href="classStoreIOBuffer.html#a1e3225390c0c4999a67e22a9b503ca16">StoreIOBuffer::error</a></div><div class="ttdeci">unsigned error</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00055">StoreIOBuffer.h:55</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a61c7333c49e943c24964ae030c96b5ec"><div class="ttname"><a href="classStoreIOBuffer.html#a61c7333c49e943c24964ae030c96b5ec">StoreIOBuffer::offset</a></div><div class="ttdeci">int64_t offset</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00058">StoreIOBuffer.h:58</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a97772bf328fe745e1d1fc23ee91cec39"><div class="ttname"><a href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">StoreIOBuffer::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00057">StoreIOBuffer.h:57</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_acb67e9b7fb58fa7b15114bd024533f44"><div class="ttname"><a href="classStoreIOBuffer.html#acb67e9b7fb58fa7b15114bd024533f44">StoreIOBuffer::flags</a></div><div class="ttdeci">struct StoreIOBuffer::@123 flags</div></div>
<div class="ttc" id="aclassSupportOrVeto_html_a89cd12f04613edb8f17087b2ae1e2a3a"><div class="ttname"><a href="classSupportOrVeto.html#a89cd12f04613edb8f17087b2ae1e2a3a">SupportOrVeto::support</a></div><div class="ttdeci">void support()</div><div class="ttdef"><b>Definition</b> <a href="SupportOrVeto_8h_source.html#l00026">SupportOrVeto.h:26</a></div></div>
<div class="ttc" id="aclassVersion_html"><div class="ttname"><a href="classVersion.html">Version</a></div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00017">PeerDigest.h:18</a></div></div>
<div class="ttc" id="aclassVersion_html_a07dc99e0084e42d76acad912e4253ca2"><div class="ttname"><a href="classVersion.html#a07dc99e0084e42d76acad912e4253ca2">Version::required</a></div><div class="ttdeci">short int required</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00021">PeerDigest.h:21</a></div></div>
<div class="ttc" id="aclassVersion_html_a557b59143e1cb0eb4aaddcb3dee455e6"><div class="ttname"><a href="classVersion.html#a557b59143e1cb0eb4aaddcb3dee455e6">Version::current</a></div><div class="ttdeci">short int current</div><div class="ttdef"><b>Definition</b> <a href="PeerDigest_8h_source.html#l00020">PeerDigest.h:20</a></div></div>
<div class="ttc" id="aclassstore__client_html_acfaef784458c7015d7a937e23e23bd32"><div class="ttname"><a href="classstore__client.html#acfaef784458c7015d7a937e23e23bd32">store_client::atEof</a></div><div class="ttdeci">bool atEof() const</div><div class="ttdef"><b>Definition</b> <a href="StoreClient_8h_source.html#l00106">StoreClient.h:106</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_ad1f6f001d275799243ee96d0b1519d3a"><div class="ttname"><a href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a></div><div class="ttdeci">#define DBG_IMPORTANT</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00038">Stream.h:38</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_ad8cd33a7d75c0efd4d3fd369dc6a8f13"><div class="ttname"><a href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a></div><div class="ttdeci">#define debugs(SECTION, LEVEL, CONTENT)</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00192">Stream.h:192</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_af0ecf487aee4d8ff164c0f40e71c5150"><div class="ttname"><a href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a></div><div class="ttdeci">#define DBG_CRITICAL</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00037">Stream.h:37</a></div></div>
<div class="ttc" id="adefines_8h_html_a24eea21c7d960e4fe969fab7acb064d6"><div class="ttname"><a href="defines_8h.html#a24eea21c7d960e4fe969fab7acb064d6">SM_PAGE_SIZE</a></div><div class="ttdeci">#define SM_PAGE_SIZE</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00063">defines.h:63</a></div></div>
<div class="ttc" id="adefines_8h_html_ac1f8e975d5c9f901f8ec9f29db1aca92"><div class="ttname"><a href="defines_8h.html#ac1f8e975d5c9f901f8ec9f29db1aca92">EBIT_TEST</a></div><div class="ttdeci">#define EBIT_TEST(flag, bit)</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00067">defines.h:67</a></div></div>
<div class="ttc" id="aenums_8h_html_a16685eea158879e41b101ca3634de462a6e99a1b0a211e1f4d482be594fe0e19f"><div class="ttname"><a href="enums_8h.html#a16685eea158879e41b101ca3634de462a6e99a1b0a211e1f4d482be594fe0e19f">KEY_PRIVATE</a></div><div class="ttdeci">@ KEY_PRIVATE</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00097">enums.h:97</a></div></div>
<div class="ttc" id="aenums_8h_html_a16685eea158879e41b101ca3634de462af1d0ae16fcfb269505ed3e22bc2e3fe5"><div class="ttname"><a href="enums_8h.html#a16685eea158879e41b101ca3634de462af1d0ae16fcfb269505ed3e22bc2e3fe5">ENTRY_ABORTED</a></div><div class="ttdeci">@ ENTRY_ABORTED</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00110">enums.h:110</a></div></div>
<div class="ttc" id="aenums_8h_html_a1866dfade0e3b17838b807ba8b7aae7e"><div class="ttname"><a href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7e">digest_read_state_t</a></div><div class="ttdeci">digest_read_state_t</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00197">enums.h:197</a></div></div>
<div class="ttc" id="aenums_8h_html_a1866dfade0e3b17838b807ba8b7aae7ea395cd4a56d66faf5fd6bc78c1e96f6ab"><div class="ttname"><a href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea395cd4a56d66faf5fd6bc78c1e96f6ab">DIGEST_READ_NONE</a></div><div class="ttdeci">@ DIGEST_READ_NONE</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00198">enums.h:198</a></div></div>
<div class="ttc" id="aenums_8h_html_a1866dfade0e3b17838b807ba8b7aae7ea42354375080a1355a9eaed4460513f29"><div class="ttname"><a href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea42354375080a1355a9eaed4460513f29">DIGEST_READ_CBLOCK</a></div><div class="ttdeci">@ DIGEST_READ_CBLOCK</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00200">enums.h:200</a></div></div>
<div class="ttc" id="aenums_8h_html_a1866dfade0e3b17838b807ba8b7aae7ea8f81f1c162dd711a1da7a78ec1a2ea93"><div class="ttname"><a href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7ea8f81f1c162dd711a1da7a78ec1a2ea93">DIGEST_READ_REPLY</a></div><div class="ttdeci">@ DIGEST_READ_REPLY</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00199">enums.h:199</a></div></div>
<div class="ttc" id="aenums_8h_html_a1866dfade0e3b17838b807ba8b7aae7eaa2ff1f21931fc22e004ca50b332cc1f5"><div class="ttname"><a href="enums_8h.html#a1866dfade0e3b17838b807ba8b7aae7eaa2ff1f21931fc22e004ca50b332cc1f5">DIGEST_READ_MASK</a></div><div class="ttdeci">@ DIGEST_READ_MASK</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00202">enums.h:201</a></div></div>
<div class="ttc" id="aenums_8h_html_af7404120c842ff6e605306823971959ea28557c32623d21545b6eb07a444c2de5"><div class="ttname"><a href="enums_8h.html#af7404120c842ff6e605306823971959ea28557c32623d21545b6eb07a444c2de5">STORE_OK</a></div><div class="ttdeci">@ STORE_OK</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00045">enums.h:45</a></div></div>
<div class="ttc" id="aevent_8cc_html_a5e368c7b2d3b8bc0e1667ece2c440944"><div class="ttname"><a href="event_8cc.html#a5e368c7b2d3b8bc0e1667ece2c440944">eventFind</a></div><div class="ttdeci">int eventFind(EVH *func, void *arg)</div><div class="ttdef"><b>Definition</b> <a href="event_8cc_source.html#l00145">event.cc:145</a></div></div>
<div class="ttc" id="aevent_8cc_html_ae111818525827ae123def674b61b7770"><div class="ttname"><a href="event_8cc.html#ae111818525827ae123def674b61b7770">eventDelete</a></div><div class="ttdeci">void eventDelete(EVH *func, void *arg)</div><div class="ttdef"><b>Definition</b> <a href="event_8cc_source.html#l00127">event.cc:127</a></div></div>
<div class="ttc" id="aevent_8cc_html_afbfd8e1e91d5ad60e6124aea52a5f006"><div class="ttname"><a href="event_8cc.html#afbfd8e1e91d5ad60e6124aea52a5f006">eventAdd</a></div><div class="ttdeci">void eventAdd(const char *name, EVH *func, void *arg, double when, int weight, bool cbdata)</div><div class="ttdef"><b>Definition</b> <a href="event_8cc_source.html#l00107">event.cc:107</a></div></div>
<div class="ttc" id="aevent_8h_html"><div class="ttname"><a href="event_8h.html">event.h</a></div></div>
<div class="ttc" id="aevent_8h_html_a8408906d26bb4a96322adc2e7b41b3f5"><div class="ttname"><a href="event_8h.html#a8408906d26bb4a96322adc2e7b41b3f5">EVH</a></div><div class="ttdeci">void EVH(void *)</div><div class="ttdef"><b>Definition</b> <a href="event_8h_source.html#l00018">event.h:18</a></div></div>
<div class="ttc" id="afatal_8cc_html_ab64d40563aeeae7c01b72bea4c3ed032"><div class="ttname"><a href="fatal_8cc.html#ab64d40563aeeae7c01b72bea4c3ed032">fatal</a></div><div class="ttdeci">void fatal(const char *message)</div><div class="ttdef"><b>Definition</b> <a href="fatal_8cc_source.html#l00028">fatal.cc:28</a></div></div>
<div class="ttc" id="aglobals_8h_html"><div class="ttname"><a href="globals_8h.html">globals.h</a></div></div>
<div class="ttc" id="aglobals_8h_html_a6094ab7939a6b76534b8496ea58a9f9d"><div class="ttname"><a href="globals_8h.html#a6094ab7939a6b76534b8496ea58a9f9d">CacheDigestHashFuncCount</a></div><div class="ttdeci">int CacheDigestHashFuncCount</div></div>
<div class="ttc" id="aglobals_8h_html_a6210bdd4d1e40a71dce6f39b8a891f94"><div class="ttname"><a href="globals_8h.html#a6210bdd4d1e40a71dce6f39b8a891f94">StoreDigestMimeStr</a></div><div class="ttdeci">const char * StoreDigestMimeStr</div></div>
<div class="ttc" id="aglobals_8h_html_aa8b8f241dcb0dc81ff34222dd5c3edda"><div class="ttname"><a href="globals_8h.html#aa8b8f241dcb0dc81ff34222dd5c3edda">StoreDigestFileName</a></div><div class="ttdeci">const char * StoreDigestFileName</div></div>
<div class="ttc" id="ahttp_2Message_8h_html_adc5c03415efc511e2b62e809310969b6"><div class="ttname"><a href="http_2Message_8h.html#adc5c03415efc511e2b62e809310969b6">HTTPMSGUNLOCK</a></div><div class="ttdeci">void HTTPMSGUNLOCK(M *&amp;a)</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00150">Message.h:150</a></div></div>
<div class="ttc" id="ahttp_2Message_8h_html_afbf13ecd1cc5c007367ae094c1aa19a9"><div class="ttname"><a href="http_2Message_8h.html#afbf13ecd1cc5c007367ae094c1aa19a9">HTTPMSGLOCK</a></div><div class="ttdeci">void HTTPMSGLOCK(Http::Message *a)</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00161">Message.h:161</a></div></div>
<div class="ttc" id="ainternal_8cc_html_a94c438ab838433612ab410d1899c6493"><div class="ttname"><a href="internal_8cc.html#a94c438ab838433612ab410d1899c6493">internalRemoteUri</a></div><div class="ttdeci">char * internalRemoteUri(bool encrypt, const char *host, unsigned short port, const char *dir, const SBuf &amp;name)</div><div class="ttdef"><b>Definition</b> <a href="internal_8cc_source.html#l00095">internal.cc:95</a></div></div>
<div class="ttc" id="ainternal_8h_html"><div class="ttname"><a href="internal_8h.html">internal.h</a></div></div>
<div class="ttc" id="amime__header_8h_html"><div class="ttname"><a href="mime__header_8h.html">mime_header.h</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722aab61d70dce6e121feb658b24ef1cd815"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722aab61d70dce6e121feb658b24ef1cd815">Http::scNone</a></div><div class="ttdeci">@ scNone</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00021">StatusCode.h:21</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722aac99376ecec42f14e89b637dc6286ccf"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722aac99376ecec42f14e89b637dc6286ccf">Http::scNotModified</a></div><div class="ttdeci">@ scNotModified</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00041">StatusCode.h:41</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722aad8d279f381aa192a9f4389158d1b25e"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722aad8d279f381aa192a9f4389158d1b25e">Http::scOkay</a></div><div class="ttdeci">@ scOkay</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00027">StatusCode.h:27</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a2923fc380e340d596af9507645069f49"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a2923fc380e340d596af9507645069f49">Http::ACCEPT</a></div><div class="ttdeci">@ ACCEPT</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00023">RegisteredHeaders.h:23</a></div></div>
<div class="ttc" id="anamespaceStore_html_a0151d620409db8bd3af40e3570a18f8c"><div class="ttname"><a href="namespaceStore.html#a0151d620409db8bd3af40e3570a18f8c">Store::Root</a></div><div class="ttdeci">Controller &amp; Root()</div><div class="ttdoc">safely access controller singleton</div><div class="ttdef"><b>Definition</b> <a href="Controller_8cc_source.html#l00926">Controller.cc:926</a></div></div>
<div class="ttc" id="anegotiate__wrapper_8cc_html_a5eb055ca3b42205cc134b4a438cd9a72"><div class="ttname"><a href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a></div><div class="ttdeci">#define xstrdup</div><div class="ttdef"><b>Definition</b> <a href="negotiate__wrapper_8cc_source.html#l00047">negotiate_wrapper.cc:47</a></div></div>
<div class="ttc" id="aneighbors_8h_html"><div class="ttname"><a href="neighbors_8h.html">neighbors.h</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a0ac3e5d29d436286af90126f25e5ad7e"><div class="ttname"><a href="peer__digest_8cc.html#a0ac3e5d29d436286af90126f25e5ad7e">StoreDigestCBlockSize</a></div><div class="ttdeci">#define StoreDigestCBlockSize</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00053">peer_digest.cc:53</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a0cc84ff398a211b56f0a22cb5d74e423"><div class="ttname"><a href="peer__digest_8cc.html#a0cc84ff398a211b56f0a22cb5d74e423">appendTime</a></div><div class="ttdeci">#define appendTime(tm)</div></div>
<div class="ttc" id="apeer__digest_8cc_html_a0fbc4e6617f6b3380ebe274cac222b2a"><div class="ttname"><a href="peer__digest_8cc.html#a0fbc4e6617f6b3380ebe274cac222b2a">finishAndDeleteFetch</a></div><div class="ttdeci">static void finishAndDeleteFetch(DigestFetchState *, const char *reason, bool sawError)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00638">peer_digest.cc:638</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a16f22e1993b64c3dd36a2aed8356667a"><div class="ttname"><a href="peer__digest_8cc.html#a16f22e1993b64c3dd36a2aed8356667a">peerDigestSwapInCBlock</a></div><div class="ttdeci">int peerDigestSwapInCBlock(void *, char *, ssize_t)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00512">peer_digest.cc:512</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a1dde7943ac07627f181b2d352666613b"><div class="ttname"><a href="peer__digest_8cc.html#a1dde7943ac07627f181b2d352666613b">peerDigestIncDelay</a></div><div class="ttdeci">static time_t peerDigestIncDelay(const PeerDigest *pd)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00143">peer_digest.cc:143</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a2e92a9f6695f604a92e714e53f8da9a2"><div class="ttname"><a href="peer__digest_8cc.html#a2e92a9f6695f604a92e714e53f8da9a2">peerDigestCheck</a></div><div class="ttdeci">static EVH peerDigestCheck</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00038">peer_digest.cc:38</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a304f119d1ae6ee0aa354854ddef8f75e"><div class="ttname"><a href="peer__digest_8cc.html#a304f119d1ae6ee0aa354854ddef8f75e">peerDigestSetCheck</a></div><div class="ttdeci">static void peerDigestSetCheck(PeerDigest *pd, time_t delay)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00166">peer_digest.cc:166</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a33dd444bfbbb30f61fa6ffd3badf63b5"><div class="ttname"><a href="peer__digest_8cc.html#a33dd444bfbbb30f61fa6ffd3badf63b5">peerDigestHandleReply</a></div><div class="ttdeci">static STCB peerDigestHandleReply</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00040">peer_digest.cc:40</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a60e1976e553a117d9db10eb4189c9dd3"><div class="ttname"><a href="peer__digest_8cc.html#a60e1976e553a117d9db10eb4189c9dd3">peerDigestRequest</a></div><div class="ttdeci">static void peerDigestRequest(PeerDigest *pd)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00226">peer_digest.cc:226</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a632a468e3faf8eac39a23d4dcebab3aa"><div class="ttname"><a href="peer__digest_8cc.html#a632a468e3faf8eac39a23d4dcebab3aa">f2s</a></div><div class="ttdeci">#define f2s(flag)</div></div>
<div class="ttc" id="apeer__digest_8cc_html_a64134b370cd7239c0946dc8b2017ec34"><div class="ttname"><a href="peer__digest_8cc.html#a64134b370cd7239c0946dc8b2017ec34">peerDigestStatsReport</a></div><div class="ttdeci">void peerDigestStatsReport(const PeerDigest *pd, StoreEntry *e)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00842">peer_digest.cc:842</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a736990ad18de5290b23cd8f47940a964"><div class="ttname"><a href="peer__digest_8cc.html#a736990ad18de5290b23cd8f47940a964">GlobDigestReqMinGap</a></div><div class="ttdeci">static const time_t GlobDigestReqMinGap</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00058">peer_digest.cc:58</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a73843370a1af215cecd871179900160f"><div class="ttname"><a href="peer__digest_8cc.html#a73843370a1af215cecd871179900160f">peerDigestFetchSetStats</a></div><div class="ttdeci">static void peerDigestFetchSetStats(DigestFetchState *fetch)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00693">peer_digest.cc:693</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a7830b107b719d1c30377d26143e9efd4"><div class="ttname"><a href="peer__digest_8cc.html#a7830b107b719d1c30377d26143e9efd4">peerDigestFetchedEnough</a></div><div class="ttdeci">static int peerDigestFetchedEnough(DigestFetchState *fetch, char *buf, ssize_t size, const char *step_name)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00583">peer_digest.cc:583</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_a7d583c1b6dce1cb450c46120c22699f8"><div class="ttname"><a href="peer__digest_8cc.html#a7d583c1b6dce1cb450c46120c22699f8">peerDigestSetCBlock</a></div><div class="ttdeci">static int peerDigestSetCBlock(PeerDigest *pd, const char *buf)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00729">peer_digest.cc:729</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_ab7e3423151070ce91e9cd0e3dd0978ca"><div class="ttname"><a href="peer__digest_8cc.html#ab7e3423151070ce91e9cd0e3dd0978ca">peerDigestNewDelay</a></div><div class="ttdeci">static time_t peerDigestNewDelay(const StoreEntry *e)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00154">peer_digest.cc:154</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_abf6315d68622d881f89535f88d8a1dca"><div class="ttname"><a href="peer__digest_8cc.html#abf6315d68622d881f89535f88d8a1dca">peerDigestFetchReply</a></div><div class="ttdeci">static int peerDigestFetchReply(void *, char *, ssize_t)</div><div class="ttdoc">handle HTTP response headers in the initial storeClientCopy() response</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00432">peer_digest.cc:432</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_ac02c7896e61987e7f1482f789ae81d09"><div class="ttname"><a href="peer__digest_8cc.html#ac02c7896e61987e7f1482f789ae81d09">peerDigestNeeded</a></div><div class="ttdeci">void peerDigestNeeded(PeerDigest *pd)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00130">peer_digest.cc:130</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_ac11c7a5daca5ee893877fd2b5c94384b"><div class="ttname"><a href="peer__digest_8cc.html#ac11c7a5daca5ee893877fd2b5c94384b">CacheDigestVer</a></div><div class="ttdeci">Version const CacheDigestVer</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00051">peer_digest.cc:51</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_ac6ad5ab90b4b69b4fe8ec36ddc64299a"><div class="ttname"><a href="peer__digest_8cc.html#ac6ad5ab90b4b69b4fe8ec36ddc64299a">saneDiff</a></div><div class="ttdeci">static int saneDiff(time_t diff)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00836">peer_digest.cc:836</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_adc707070a53a4eb35029e1fec217f7eb"><div class="ttname"><a href="peer__digest_8cc.html#adc707070a53a4eb35029e1fec217f7eb">pd_last_req_time</a></div><div class="ttdeci">static time_t pd_last_req_time</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00062">peer_digest.cc:62</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_ae199004959205be451d747bb247d5a89"><div class="ttname"><a href="peer__digest_8cc.html#ae199004959205be451d747bb247d5a89">peerDigestUseful</a></div><div class="ttdeci">static int peerDigestUseful(const PeerDigest *pd)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00821">peer_digest.cc:821</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_ae38a5569d80c5857995d0611d4a6b32a"><div class="ttname"><a href="peer__digest_8cc.html#ae38a5569d80c5857995d0611d4a6b32a">peerDigestSwapInMask</a></div><div class="ttdeci">int peerDigestSwapInMask(void *, char *, ssize_t)</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00550">peer_digest.cc:550</a></div></div>
<div class="ttc" id="apeer__digest_8cc_html_afc6d96adfac1033b3672e534011cd5ba"><div class="ttname"><a href="peer__digest_8cc.html#afc6d96adfac1033b3672e534011cd5ba">PeerDigestReqMinGap</a></div><div class="ttdeci">static const time_t PeerDigestReqMinGap</div><div class="ttdef"><b>Definition</b> <a href="peer__digest_8cc_source.html#l00056">peer_digest.cc:56</a></div></div>
<div class="ttc" id="asquid_8h_html"><div class="ttname"><a href="squid_8h.html">squid.h</a></div></div>
<div class="ttc" id="astore_8cc_html_a270563a6d5ec90328acb0edd0a53b185"><div class="ttname"><a href="store_8cc.html#a270563a6d5ec90328acb0edd0a53b185">storeAppendPrintf</a></div><div class="ttdeci">void storeAppendPrintf(StoreEntry *e, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l00855">store.cc:855</a></div></div>
<div class="ttc" id="astore_8cc_html_a70101e23661f7fe20ce50890c448e92c"><div class="ttname"><a href="store_8cc.html#a70101e23661f7fe20ce50890c448e92c">storeGetPublicByRequest</a></div><div class="ttdeci">StoreEntry * storeGetPublicByRequest(HttpRequest *req, const KeyScope keyScope)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l00516">store.cc:516</a></div></div>
<div class="ttc" id="astore_8cc_html_a872157d7a8c43bb5facb072ce03c4d48"><div class="ttname"><a href="store_8cc.html#a872157d7a8c43bb5facb072ce03c4d48">storeCreateEntry</a></div><div class="ttdeci">StoreEntry * storeCreateEntry(const char *url, const char *logUrl, const RequestFlags &amp;flags, const HttpRequestMethod &amp;method)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l00759">store.cc:759</a></div></div>
<div class="ttc" id="astore__client_8cc_html_a06631df680fe4de46f305a34874175f9"><div class="ttname"><a href="store__client_8cc.html#a06631df680fe4de46f305a34874175f9">storeUnregister</a></div><div class="ttdeci">int storeUnregister(store_client *sc, StoreEntry *e, void *data)</div><div class="ttdef"><b>Definition</b> <a href="store__client_8cc_source.html#l00765">store_client.cc:765</a></div></div>
<div class="ttc" id="astore__client_8cc_html_a1d6f3137e148014416e0812a317f853f"><div class="ttname"><a href="store__client_8cc.html#a1d6f3137e148014416e0812a317f853f">storeClientCopy</a></div><div class="ttdeci">void storeClientCopy(store_client *sc, StoreEntry *e, StoreIOBuffer copyInto, STCB *callback, void *data)</div><div class="ttdef"><b>Definition</b> <a href="store__client_8cc_source.html#l00224">store_client.cc:224</a></div></div>
<div class="ttc" id="astore__client_8cc_html_ae077d286d865af03eb1357a8de9ba75b"><div class="ttname"><a href="store__client_8cc.html#ae077d286d865af03eb1357a8de9ba75b">storeClientListAdd</a></div><div class="ttdeci">store_client * storeClientListAdd(StoreEntry *e, void *data)</div><div class="ttdef"><b>Definition</b> <a href="store__client_8cc_source.html#l00124">store_client.cc:124</a></div></div>
<div class="ttc" id="astore__key__md5_8h_html"><div class="ttname"><a href="store__key__md5_8h.html">store_key_md5.h</a></div></div>
<div class="ttc" id="atools_8h_html"><div class="ttname"><a href="tools_8h.html">tools.h</a></div></div>
<div class="ttc" id="autil_8h_html"><div class="ttname"><a href="util_8h.html">util.h</a></div></div>
<div class="ttc" id="autil_8h_html_ae17f6645fa95b2fac13aa19a2421904e"><div class="ttname"><a href="util_8h.html#ae17f6645fa95b2fac13aa19a2421904e">xpercentInt</a></div><div class="ttdeci">int xpercentInt(double part, double whole)</div><div class="ttdef"><b>Definition</b> <a href="util_8cc_source.html#l00046">util.cc:46</a></div></div>
<div class="ttc" id="axalloc_8h_html_a74ad4c3c3aa58c8fea96eb0dc090fd67"><div class="ttname"><a href="xalloc_8h.html#a74ad4c3c3aa58c8fea96eb0dc090fd67">safe_free</a></div><div class="ttdeci">#define safe_free(x)</div><div class="ttdef"><b>Definition</b> <a href="xalloc_8h_source.html#l00073">xalloc.h:73</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3c69fff7f634b97773a4d39d4565ffb4.html">squid</a></li><li class="navelem"><a class="el" href="dir_27a06220d184fcc3bd2c56b7794ae45b.html">src</a></li><li class="navelem"><a class="el" href="peer__digest_8cc.html">peer_digest.cc</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
