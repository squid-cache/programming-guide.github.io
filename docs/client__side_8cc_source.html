<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squid Web Cache: squid/src/client_side.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Squid Web Cache<span id="projectnumber">&#160;master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('client__side_8cc_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">client_side.cc</div></div>
</div><!--header-->
<div class="contents">
<a href="client__side_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 1996-2025 The Squid Software Foundation and contributors</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Squid software is distributed under GPLv2+ license and includes</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * contributions from numerous individuals and organizations.</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * Please see the COPYING and CONTRIBUTORS files for details.</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> */</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">/* DEBUG: section 33    Client-side Routines */</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="preprocessor">#include &quot;<a class="code" href="squid_8h.html">squid.h</a>&quot;</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="preprocessor">#include &quot;<a class="code" href="FilledChecklist_8h.html">acl/FilledChecklist.h</a>&quot;</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="preprocessor">#include &quot;<a class="code" href="anyp_2Host_8h.html">anyp/Host.h</a>&quot;</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">#include &quot;<a class="code" href="PortCfg_8h.html">anyp/PortCfg.h</a>&quot;</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="preprocessor">#include &quot;<a class="code" href="AsyncCallbacks_8h.html">base/AsyncCallbacks.h</a>&quot;</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="preprocessor">#include &quot;<a class="code" href="Subscription_8h.html">base/Subscription.h</a>&quot;</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="preprocessor">#include &quot;<a class="code" href="TextException_8h.html">base/TextException.h</a>&quot;</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="preprocessor">#include &quot;<a class="code" href="CachePeer_8h.html">CachePeer.h</a>&quot;</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="preprocessor">#include &quot;<a class="code" href="client__db_8h.html">client_db.h</a>&quot;</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor">#include &quot;<a class="code" href="client__side_8h.html">client_side.h</a>&quot;</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="preprocessor">#include &quot;<a class="code" href="client__side__reply_8h.html">client_side_reply.h</a>&quot;</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="preprocessor">#include &quot;<a class="code" href="client__side__request_8h.html">client_side_request.h</a>&quot;</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="preprocessor">#include &quot;<a class="code" href="ClientRequestContext_8h.html">ClientRequestContext.h</a>&quot;</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="preprocessor">#include &quot;<a class="code" href="clientStream_8h.html">clientStream.h</a>&quot;</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#include &quot;<a class="code" href="comm_8h.html">comm.h</a>&quot;</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="preprocessor">#include &quot;<a class="code" href="Connection_8h.html">comm/Connection.h</a>&quot;</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="preprocessor">#include &quot;<a class="code" href="Loops_8h.html">comm/Loops.h</a>&quot;</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="preprocessor">#include &quot;<a class="code" href="Read_8h.html">comm/Read.h</a>&quot;</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="preprocessor">#include &quot;<a class="code" href="TcpAcceptor_8h.html">comm/TcpAcceptor.h</a>&quot;</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="preprocessor">#include &quot;<a class="code" href="Write_8h.html">comm/Write.h</a>&quot;</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="preprocessor">#include &quot;<a class="code" href="CommCalls_8h.html">CommCalls.h</a>&quot;</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="preprocessor">#include &quot;<a class="code" href="socket_8h.html">compat/socket.h</a>&quot;</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="preprocessor">#include &quot;<a class="code" href="debug_2Messages_8h.html">debug/Messages.h</a>&quot;</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="preprocessor">#include &quot;<a class="code" href="ExceptionErrorDetail_8h.html">error/ExceptionErrorDetail.h</a>&quot;</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="preprocessor">#include &quot;<a class="code" href="errorpage_8h.html">errorpage.h</a>&quot;</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="preprocessor">#include &quot;<a class="code" href="fd_8h.html">fd.h</a>&quot;</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="preprocessor">#include &quot;<a class="code" href="fde_8h.html">fde.h</a>&quot;</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="preprocessor">#include &quot;<a class="code" href="fqdncache_8h.html">fqdncache.h</a>&quot;</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="preprocessor">#include &quot;<a class="code" href="FwdState_8h.html">FwdState.h</a>&quot;</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="preprocessor">#include &quot;<a class="code" href="ssl_2helper_8h.html">helper.h</a>&quot;</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="preprocessor">#include &quot;<a class="code" href="Reply_8h.html">helper/Reply.h</a>&quot;</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="preprocessor">#include &quot;<a class="code" href="http_8h.html">http.h</a>&quot;</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="preprocessor">#include &quot;<a class="code" href="RequestParser_8h.html">http/one/RequestParser.h</a>&quot;</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="preprocessor">#include &quot;<a class="code" href="TeChunkedParser_8h.html">http/one/TeChunkedParser.h</a>&quot;</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="preprocessor">#include &quot;<a class="code" href="http_2Stream_8h.html">http/Stream.h</a>&quot;</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="preprocessor">#include &quot;<a class="code" href="HttpHdrContRange_8h.html">HttpHdrContRange.h</a>&quot;</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="preprocessor">#include &quot;<a class="code" href="HttpReply_8h.html">HttpReply.h</a>&quot;</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="preprocessor">#include &quot;<a class="code" href="HttpRequest_8h.html">HttpRequest.h</a>&quot;</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="preprocessor">#include &quot;<a class="code" href="internal_8h.html">internal.h</a>&quot;</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span><span class="preprocessor">#include &quot;<a class="code" href="FdNotes_8h.html">ipc/FdNotes.h</a>&quot;</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="preprocessor">#include &quot;<a class="code" href="StartListening_8h.html">ipc/StartListening.h</a>&quot;</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="preprocessor">#include &quot;<a class="code" href="access__log_8h.html">log/access_log.h</a>&quot;</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span><span class="preprocessor">#include &quot;<a class="code" href="MemBuf_8h.html">MemBuf.h</a>&quot;</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="preprocessor">#include &quot;<a class="code" href="MemObject_8h.html">MemObject.h</a>&quot;</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="preprocessor">#include &quot;<a class="code" href="mime__header_8h.html">mime_header.h</a>&quot;</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="preprocessor">#include &quot;<a class="code" href="parser_2Tokenizer_8h.html">parser/Tokenizer.h</a>&quot;</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="preprocessor">#include &quot;<a class="code" href="Header_8h.html">proxyp/Header.h</a>&quot;</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="preprocessor">#include &quot;<a class="code" href="proxyp_2Parser_8h.html">proxyp/Parser.h</a>&quot;</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="preprocessor">#include &quot;<a class="code" href="sbuf_2Stream_8h.html">sbuf/Stream.h</a>&quot;</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="preprocessor">#include &quot;<a class="code" href="security_2Certificate_8h.html">security/Certificate.h</a>&quot;</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="preprocessor">#include &quot;<a class="code" href="CommunicationSecrets_8h.html">security/CommunicationSecrets.h</a>&quot;</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="preprocessor">#include &quot;<a class="code" href="Io_8h.html">security/Io.h</a>&quot;</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="preprocessor">#include &quot;<a class="code" href="KeyLog_8h.html">security/KeyLog.h</a>&quot;</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="preprocessor">#include &quot;<a class="code" href="NegotiationHistory_8h.html">security/NegotiationHistory.h</a>&quot;</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="preprocessor">#include &quot;<a class="code" href="servers_2forward_8h.html">servers/forward.h</a>&quot;</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="preprocessor">#include &quot;<a class="code" href="SquidConfig_8h.html">SquidConfig.h</a>&quot;</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="preprocessor">#include &quot;<a class="code" href="StatCounters_8h.html">StatCounters.h</a>&quot;</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="preprocessor">#include &quot;<a class="code" href="StatHist_8h.html">StatHist.h</a>&quot;</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="preprocessor">#include &quot;<a class="code" href="Store_8h.html">Store.h</a>&quot;</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="preprocessor">#include &quot;<a class="code" href="TimeOrTag_8h.html">TimeOrTag.h</a>&quot;</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="preprocessor">#include &quot;<a class="code" href="tools_8h.html">tools.h</a>&quot;</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span> </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="preprocessor">#if USE_AUTH</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="preprocessor">#include &quot;<a class="code" href="UserRequest_8h.html">auth/UserRequest.h</a>&quot;</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="preprocessor">#if USE_DELAY_POOLS</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="preprocessor">#include &quot;<a class="code" href="ClientInfo_8h.html">ClientInfo.h</a>&quot;</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="preprocessor">#include &quot;<a class="code" href="MessageDelayPools_8h.html">MessageDelayPools.h</a>&quot;</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="preprocessor">#include &quot;<a class="code" href="bio_8h.html">ssl/bio.h</a>&quot;</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="preprocessor">#include &quot;<a class="code" href="context__storage_8h.html">ssl/context_storage.h</a>&quot;</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="preprocessor">#include &quot;<a class="code" href="ssl_2gadgets_8h.html">ssl/gadgets.h</a>&quot;</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="preprocessor">#include &quot;<a class="code" href="ssl_2helper_8h.html">ssl/helper.h</a>&quot;</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="preprocessor">#include &quot;<a class="code" href="ProxyCerts_8h.html">ssl/ProxyCerts.h</a>&quot;</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="preprocessor">#include &quot;<a class="code" href="ServerBump_8h.html">ssl/ServerBump.h</a>&quot;</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="preprocessor">#include &quot;<a class="code" href="ssl_2support_8h.html">ssl/support.h</a>&quot;</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="preprocessor">#include &lt;climits&gt;</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="preprocessor">#if HAVE_SYSTEMD_SD_DAEMON_H</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="preprocessor">#include &lt;systemd/sd-daemon.h&gt;</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span><span class="comment">// TODO: Remove this custom dialer and simplify by creating the TcpAcceptor</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span><span class="comment">// subscription later, inside clientListenerConnectionOpened() callback, just</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span><span class="comment">// like htcpOpenPorts(), icpOpenPorts(), and snmpPortOpened() do it.</span></div>
<div class="foldopen" id="foldopen00152" data-start="{" data-end="};">
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html">  152</a></span><span class="keyword">class </span><a class="code hl_class" href="classListeningStartedDialer.html">ListeningStartedDialer</a>:</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="keyword">public</span> <a class="code hl_class" href="classCallDialer.html">CallDialer</a>,</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="keyword">public</span> <a class="code hl_class" href="classWithAnswer.html">WithAnswer</a>&lt;Ipc::StartListeningAnswer&gt;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>{</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#aa164476edc5a6f3196a26c7dff9b11d5">  157</a></span>    <span class="keyword">typedef</span> void (*<a class="code hl_typedef" href="classListeningStartedDialer.html#aa164476edc5a6f3196a26c7dff9b11d5">Handler</a>)(<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> &amp;<a class="code hl_variable" href="classListeningStartedDialer.html#a34d75c7a3305ced0fe45d970dfa1fddf">portCfg</a>, <span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a> note, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Subscription::Pointer</a> &amp;<a class="code hl_variable" href="classListeningStartedDialer.html#a08a8a4d4818fcf6ec60d74fe07b44639">sub</a>);</div>
<div class="foldopen" id="foldopen00158" data-start="{" data-end="}">
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#a319c84474dfd15db9722b7ad1a582f79">  158</a></span>    <a class="code hl_function" href="classListeningStartedDialer.html#a319c84474dfd15db9722b7ad1a582f79">ListeningStartedDialer</a>(<a class="code hl_typedef" href="classListeningStartedDialer.html#aa164476edc5a6f3196a26c7dff9b11d5">Handler</a> aHandler, <a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> &amp;aPortCfg, <span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a> note, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Subscription::Pointer</a> &amp;aSub):</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        <a class="code hl_variable" href="classListeningStartedDialer.html#a06e1d91758e776651034abaca8ac6f66">handler</a>(aHandler), <a class="code hl_variable" href="classListeningStartedDialer.html#a34d75c7a3305ced0fe45d970dfa1fddf">portCfg</a>(aPortCfg), <a class="code hl_variable" href="classListeningStartedDialer.html#aa4df33e08bd8063710c8f470a4b5e036">portTypeNote</a>(note), <a class="code hl_variable" href="classListeningStartedDialer.html#a08a8a4d4818fcf6ec60d74fe07b44639">sub</a>(aSub) {}</div>
</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="comment">/* CallDialer API */</span></div>
<div class="foldopen" id="foldopen00162" data-start="{" data-end="}">
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#a839fc1a76be2258ef2871772d955e1ea">  162</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classListeningStartedDialer.html#a839fc1a76be2258ef2871772d955e1ea">print</a>(std::ostream &amp;os)<span class="keyword"> const override </span>{</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        os &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code hl_variable" href="classListeningStartedDialer.html#acdf175a6591ae02faf86bec80a89323c">answer_</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; FdNote(<a class="code hl_variable" href="classListeningStartedDialer.html#aa4df33e08bd8063710c8f470a4b5e036">portTypeNote</a>) &lt;&lt; <span class="stringliteral">&quot; port=&quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;<a class="code hl_variable" href="classListeningStartedDialer.html#a34d75c7a3305ced0fe45d970dfa1fddf">portCfg</a> &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    }</div>
</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#ae9bbb7f856e3667883e347b29f1857a1">  166</a></span>    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classListeningStartedDialer.html#ae9bbb7f856e3667883e347b29f1857a1">canDial</a>(<a class="code hl_class" href="classAsyncCall.html">AsyncCall</a> &amp;)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#a919ddbde35300a051710e02513fc6dfd">  167</a></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classListeningStartedDialer.html#a919ddbde35300a051710e02513fc6dfd">dial</a>(<a class="code hl_class" href="classAsyncCall.html">AsyncCall</a> &amp;) { (<a class="code hl_variable" href="classListeningStartedDialer.html#a06e1d91758e776651034abaca8ac6f66">handler</a>)(<a class="code hl_variable" href="classListeningStartedDialer.html#a34d75c7a3305ced0fe45d970dfa1fddf">portCfg</a>, <a class="code hl_variable" href="classListeningStartedDialer.html#aa4df33e08bd8063710c8f470a4b5e036">portTypeNote</a>, <a class="code hl_variable" href="classListeningStartedDialer.html#a08a8a4d4818fcf6ec60d74fe07b44639">sub</a>); }</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">/* WithAnswer API */</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#a4e7a9049579f091a171ad4def320887c">  170</a></span>    <a class="code hl_class" href="classIpc_1_1StartListeningAnswer.html">Ipc::StartListeningAnswer</a> &amp;<a class="code hl_function" href="classListeningStartedDialer.html#a4e7a9049579f091a171ad4def320887c">answer</a>()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classListeningStartedDialer.html#acdf175a6591ae02faf86bec80a89323c">answer_</a>; }</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#a06e1d91758e776651034abaca8ac6f66">  173</a></span>    <a class="code hl_typedef" href="classListeningStartedDialer.html#aa164476edc5a6f3196a26c7dff9b11d5">Handler</a> <a class="code hl_variable" href="classListeningStartedDialer.html#a06e1d91758e776651034abaca8ac6f66">handler</a>;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="comment">// answer_.conn (set/updated by IPC code) is portCfg.listenConn (used by us)</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#acdf175a6591ae02faf86bec80a89323c">  177</a></span>    <a class="code hl_class" href="classIpc_1_1StartListeningAnswer.html">Ipc::StartListeningAnswer</a> <a class="code hl_variable" href="classListeningStartedDialer.html#acdf175a6591ae02faf86bec80a89323c">answer_</a>; </div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#a34d75c7a3305ced0fe45d970dfa1fddf">  178</a></span>    <a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> <a class="code hl_variable" href="classListeningStartedDialer.html#a34d75c7a3305ced0fe45d970dfa1fddf">portCfg</a>;   </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#aa4df33e08bd8063710c8f470a4b5e036">  179</a></span>    <a class="code hl_enumeration" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a> <a class="code hl_variable" href="classListeningStartedDialer.html#aa4df33e08bd8063710c8f470a4b5e036">portTypeNote</a>;    </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno"><a class="line" href="classListeningStartedDialer.html#a08a8a4d4818fcf6ec60d74fe07b44639">  180</a></span>    <a class="code hl_class" href="classRefCount.html">Subscription::Pointer</a> <a class="code hl_variable" href="classListeningStartedDialer.html#a08a8a4d4818fcf6ec60d74fe07b44639">sub</a>; </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>};</div>
</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="client__side_8cc.html#a00d61405a518ee24f5beedc0a9a8b3b6">clientListenerConnectionOpened</a>(<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> &amp;s, <span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a> portTypeNote, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Subscription::Pointer</a> &amp;sub);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno"><a class="line" href="client__side_8cc.html#af8290b502a5da8718ddd609a1688a2e5">  185</a></span><span class="keyword">static</span> <a class="code hl_typedef" href="CommCalls_8h.html#aacb094d7a8854d685479662a7a925a8f">IOACB</a> <a class="code hl_variable" href="client__side_8cc.html#af8290b502a5da8718ddd609a1688a2e5">httpAccept</a>;</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="client__side_8cc.html#a766113836f4b2ce05e7dfe662c5d161a">clientIsRequestBodyTooLargeForPolicy</a>(int64_t bodyLength);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="client__side_8cc.html#a0ae37ef9173185eeab5a1581363f4925">clientUpdateStatHistCounters</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLogTags.html">LogTags</a> &amp;logType, <span class="keywordtype">int</span> svc_time);</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="client__side_8cc.html#abce78a023899deca91d058bb3a4b44c5">clientUpdateStatCounters</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLogTags.html">LogTags</a> &amp;logType);</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="client__side_8cc.html#aa132546cdd82acdfa0a650943f6d936b">clientUpdateHierCounters</a>(<a class="code hl_class" href="classHierarchyLogEntry.html">HierarchyLogEntry</a> *);</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="client__side_8cc.html#a135b38eb4ef6e03860b1407c774988fa">clientPingHasFinished</a>(<a class="code hl_class" href="classping__data.html">ping_data</a> <span class="keyword">const</span> *aPing);</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="keywordtype">void</span> <a class="code hl_function" href="client__side_8cc.html#a22777922b0ae6451894a83f1ec3614ed">prepareLogWithRequestDetails</a>(<a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">AccessLogEntryPointer</a> &amp;);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="client__side_8cc.html#ab489de204612ef3a359eee05b1556dda">ClientSocketContextPushDeferredIfNeeded</a>(<a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> deferredRequest, <a class="code hl_class" href="classConnStateData.html">ConnStateData</a> * conn);</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="keywordtype">char</span> *<a class="code hl_function" href="client__side_8cc.html#ab9b84c4e1325a12972ccd56432a946a0">skipLeadingSpace</a>(<span class="keywordtype">char</span> *aString);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00198" data-start="{" data-end="}">
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno"><a class="line" href="client__side_8cc.html#abce78a023899deca91d058bb3a4b44c5">  198</a></span><a class="code hl_function" href="client__side_8cc.html#abce78a023899deca91d058bb3a4b44c5">clientUpdateStatCounters</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLogTags.html">LogTags</a> &amp;logType)</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>{</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    ++<a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#a93ee104c406cb7f6cddec42a031f674b">requests</a>;</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="keywordflow">if</span> (logType.<a class="code hl_function" href="classLogTags.html#aea1194c638b43a3273a8280cee485215">isTcpHit</a>())</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>        ++<a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#a521030ab419aab60abd94890fb11771d">hits</a>;</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="keywordflow">if</span> (logType.<a class="code hl_variable" href="classLogTags.html#abed628637be6b214d7860ed402927259">oldType</a> == <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a6b18a17e02ffba088ef54d6c6570a2da">LOG_TCP_HIT</a>)</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        ++<a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#ace4cc867ca19ccefca9caf75a515e4be">disk_hits</a>;</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (logType.<a class="code hl_variable" href="classLogTags.html#abed628637be6b214d7860ed402927259">oldType</a> == <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a75f8d8f24297647ede5f517c1a659fe1">LOG_TCP_MEM_HIT</a>)</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        ++<a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#ad06d5587d2fdde49526194cc4fa5b991">mem_hits</a>;</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>}</div>
</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00212" data-start="{" data-end="}">
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a0ae37ef9173185eeab5a1581363f4925">  212</a></span><a class="code hl_function" href="client__side_8cc.html#a0ae37ef9173185eeab5a1581363f4925">clientUpdateStatHistCounters</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLogTags.html">LogTags</a> &amp;logType, <span class="keywordtype">int</span> svc_time)</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>{</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#a6ea85e50bdac37a196e72285225ec743">allSvcTime</a>.<a class="code hl_function" href="classStatHist.html#ac040b690ee1c593fe3e5e32960abfc53">count</a>(svc_time);</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="keywordflow">switch</span> (logType.<a class="code hl_variable" href="classLogTags.html#abed628637be6b214d7860ed402927259">oldType</a>) {</div>
<div class="foldopen" id="foldopen00223" data-start="{" data-end="}">
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno"><a class="line" href="client__side_8h.html#ac2f34d5f9274a25880ee91f12b2d39e9">  223</a></span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5ab7d48c74f5c9b5611f95f59f40b28488">LOG_TCP_REFRESH_UNMODIFIED</a>:</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#a28aa8251678753402433e583e0bd14bc">nearHitSvcTime</a>.<a class="code hl_function" href="classStatHist.html#ac040b690ee1c593fe3e5e32960abfc53">count</a>(svc_time);</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span> </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5aed35072ed898085622fe3d94b529bce1">LOG_TCP_INM_HIT</a>:</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a8dc5d16057dd49c38a9d848b24f5a9dd">LOG_TCP_IMS_HIT</a>:</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#aa87bb28e8f026dba59d90cee344b6f4a">nearMissSvcTime</a>.<a class="code hl_function" href="classStatHist.html#ac040b690ee1c593fe3e5e32960abfc53">count</a>(svc_time);</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a6b18a17e02ffba088ef54d6c6570a2da">LOG_TCP_HIT</a>:</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a75f8d8f24297647ede5f517c1a659fe1">LOG_TCP_MEM_HIT</a>:</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a426f2351c79f420e8fead9a1ba831be3">LOG_TCP_OFFLINE_HIT</a>:</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#a58fd5a18aeb684f968af469e22c76e56">hitSvcTime</a>.<a class="code hl_function" href="classStatHist.html#ac040b690ee1c593fe3e5e32960abfc53">count</a>(svc_time);</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a73a7b8edaf3bd5b6cfe483e4b9e068a3">LOG_TCP_MISS</a>:</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5ae19fd4a06c3cb6bd8515559ffd304bfd">LOG_TCP_CLIENT_REFRESH_MISS</a>:</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#a46197273c850cec456b5a45072a363b7">missSvcTime</a>.<a class="code hl_function" href="classStatHist.html#ac040b690ee1c593fe3e5e32960abfc53">count</a>(svc_time);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        <span class="comment">/* make compiler warnings go away */</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    }</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>}</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen00254" data-start="{" data-end="}">
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a135b38eb4ef6e03860b1407c774988fa">  254</a></span><a class="code hl_function" href="client__side_8cc.html#a135b38eb4ef6e03860b1407c774988fa">clientPingHasFinished</a>(<a class="code hl_class" href="classping__data.html">ping_data</a> <span class="keyword">const</span> *aPing)</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>{</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="keywordflow">if</span> (0 != aPing-&gt;<a class="code hl_variable" href="classping__data.html#a4eef39d2e9073372d1dce22c6e6c1a43">stop</a>.tv_sec &amp;&amp; 0 != aPing-&gt;<a class="code hl_variable" href="classping__data.html#a06ee5e33529ba7d6b7684b67c44b6eb2">start</a>.tv_sec)</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>}</div>
</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00263" data-start="{" data-end="}">
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno"><a class="line" href="client__side_8cc.html#aa132546cdd82acdfa0a650943f6d936b">  263</a></span><a class="code hl_function" href="client__side_8cc.html#aa132546cdd82acdfa0a650943f6d936b">clientUpdateHierCounters</a>(<a class="code hl_class" href="classHierarchyLogEntry.html">HierarchyLogEntry</a> * someEntry)</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>{</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    <a class="code hl_class" href="classping__data.html">ping_data</a> *i;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="keywordflow">switch</span> (someEntry-&gt;<a class="code hl_variable" href="classHierarchyLogEntry.html#ac79cc06b0d8333ee14e8cc66d3941e6d">code</a>) {</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span><span class="preprocessor">#if USE_CACHE_DIGESTS</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da3c8bcd791a8e2b159b0772eaabb89e9d">CD_PARENT_HIT</a>:</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da21b0ce8be23fceba9d022381ed3e8141">CD_SIBLING_HIT</a>:</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>        ++ <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">cd</a>.<a class="code hl_variable" href="classStatCounters.html#a637679d6acf6ce048ec6299166492d4c">times_used</a>;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da71997b9847150b787d135b5bbe856ce1">SIBLING_HIT</a>:</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da4e414b3bd28bffa1221e417edafdf8bd">PARENT_HIT</a>:</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177daa92079b2127e6cbf155d50b6b5b110f9">FIRST_PARENT_MISS</a>:</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177dac532a9a791bde35f28867d5a87d21897">CLOSEST_PARENT_MISS</a>:</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        ++ <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#acc53db8d01577746bb79d407f889bb19">icp</a>.<a class="code hl_variable" href="classStatCounters.html#a637679d6acf6ce048ec6299166492d4c">times_used</a>;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>        i = &amp;someEntry-&gt;<a class="code hl_variable" href="classHierarchyLogEntry.html#a91f7c81bcfdf9882ff978942c85568f4">ping</a>;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span> </div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="client__side_8cc.html#a135b38eb4ef6e03860b1407c774988fa">clientPingHasFinished</a>(i))</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>            <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#acc53db8d01577746bb79d407f889bb19">icp</a>.<a class="code hl_variable" href="classStatCounters.html#a0c349cdd4b2da5c7c36f4a57ac1fdd85">querySvcTime</a>.<a class="code hl_function" href="classStatHist.html#ac040b690ee1c593fe3e5e32960abfc53">count</a>(<a class="code hl_function" href="time_2gadgets_8cc.html#a305b269a5a22b54bea1a2db923b55cd6">tvSubUsec</a>(i-&gt;<a class="code hl_variable" href="classping__data.html#a06ee5e33529ba7d6b7684b67c44b6eb2">start</a>, i-&gt;<a class="code hl_variable" href="classping__data.html#a4eef39d2e9073372d1dce22c6e6c1a43">stop</a>));</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>        <span class="keywordflow">if</span> (i-&gt;<a class="code hl_variable" href="classping__data.html#a4c6316b5ae6fb68a7fc40588423694f7">timeout</a>)</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>            ++ <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#acc53db8d01577746bb79d407f889bb19">icp</a>.<a class="code hl_variable" href="classStatCounters.html#a865b73b8d290e02c6fb333ddec66ee21">query_timeouts</a>;</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da58b66ca8d18fdd0d52934dad3f0ab386">CLOSEST_PARENT</a>:</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da7f53c781a633950c909c3850a66a785d">CLOSEST_DIRECT</a>:</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        ++ <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#a76bbd29fad3e173cdeb1d8fc87430fc3">netdb</a>.<a class="code hl_variable" href="classStatCounters.html#a637679d6acf6ce048ec6299166492d4c">times_used</a>;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    }</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>}</div>
</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00308" data-start="{" data-end="}">
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno"><a class="line" href="classClientHttpRequest.html#a3b6e866b0c91455fb2f9041911e83e04">  308</a></span><a class="code hl_function" href="classClientHttpRequest.html#a3b6e866b0c91455fb2f9041911e83e04">ClientHttpRequest::updateCounters</a>()</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>{</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <a class="code hl_function" href="client__side_8cc.html#abce78a023899deca91d058bb3a4b44c5">clientUpdateStatCounters</a>(<a class="code hl_function" href="classClientHttpRequest.html#aee8237109aebae9e3711a066ddfa42c0">loggingTags</a>());</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a>)</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        ++ <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#aa9bd802b635bb0f5b9fc404c54bbb565">errors</a>;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <a class="code hl_function" href="client__side_8cc.html#a0ae37ef9173185eeab5a1581363f4925">clientUpdateStatHistCounters</a>(<a class="code hl_function" href="classClientHttpRequest.html#aee8237109aebae9e3711a066ddfa42c0">loggingTags</a>(),</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                                 <a class="code hl_function" href="time_2gadgets_8cc.html#af7a3c9de59180267762f047ffd42e503">tvSubMsec</a>(<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#a17380db1a07c6fa0aa73c3107650a3f6">start_time</a>, <a class="code hl_variable" href="time_2gadgets_8cc.html#a502612b4a32c5902726b120d713d7952">current_time</a>));</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span> </div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <a class="code hl_function" href="client__side_8cc.html#aa132546cdd82acdfa0a650943f6d936b">clientUpdateHierCounters</a>(&amp;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#a5c031f584be4a77277cccd49b0d4cea1">hier</a>);</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>}</div>
</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00322" data-start="{" data-end="}">
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno"><a class="line" href="ModXact_8cc.html#a22777922b0ae6451894a83f1ec3614ed">  322</a></span><a class="code hl_function" href="client__side_8cc.html#a22777922b0ae6451894a83f1ec3614ed">prepareLogWithRequestDetails</a>(<a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">AccessLogEntryPointer</a> &amp;aLogEntry)</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>{</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(request);</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(aLogEntry != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span> </div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a89bec7bc02d66eb2ab65c74c3f6b13ac">onoff</a>.<a class="code hl_variable" href="classSquidConfig.html#a89b927014e22814889b6f23ad9a6e44d">log_mime_hdrs</a>) {</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#ae8065947ee37c85af4d9b98bc9519a98">packInto</a>(&amp;mb);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>        <span class="comment">//This is the request after adaptation or redirection</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>        aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a70767e3d5eee503cd1bbc63594584004">headers</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1Headers.html#a120e1febd0837203a10d79654cdb0884">adapted_request</a> = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a>);</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>        <span class="comment">// the virgin request is saved to aLogEntry-&gt;request</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        <span class="keywordflow">if</span> (aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a>) {</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>            mb.<a class="code hl_function" href="classMemBuf.html#ac0eda16694c0752050a1da95db2be3e6">reset</a>();</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>            aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a>-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#ae8065947ee37c85af4d9b98bc9519a98">packInto</a>(&amp;mb);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a70767e3d5eee503cd1bbc63594584004">headers</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1Headers.html#a2b4a0b6b9f423b94ad0f9de3ca7064fc">request</a> = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a>);</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span> </div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span><span class="preprocessor">#if USE_ADAPTATION</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>        <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Adaptation::History::Pointer</a> ah = request-&gt;<a class="code hl_function" href="classHttpRequest.html#ac42bf8d09e3be5ccc28068c9963c44da">adaptLogHistory</a>();</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        <span class="keywordflow">if</span> (ah != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            mb.<a class="code hl_function" href="classMemBuf.html#ac0eda16694c0752050a1da95db2be3e6">reset</a>();</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>            ah-&gt;<a class="code hl_variable" href="classAdaptation_1_1History.html#ad7a7dac1a5329b364522e2a2e9b93d7e">lastMeta</a>.<a class="code hl_function" href="classHttpHeader.html#ae8065947ee37c85af4d9b98bc9519a98">packInto</a>(&amp;mb);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>            aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#acd2964cc976f54474430752e90b11eb1">adapt</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1AdaptationDetails.html#adafded5cf3b47a661bbbb0f72a721b06">last_meta</a> = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a>);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        }</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        mb.<a class="code hl_function" href="classMemBuf.html#a085688f536a13949b005f7bb59bae333">clean</a>();</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span><span class="preprocessor">#if ICAP_CLIENT</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Adaptation::Icap::History::Pointer</a> ih = request-&gt;<a class="code hl_function" href="classHttpRequest.html#af12cd51466974ad702972c18238ef5a2">icapHistory</a>();</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="keywordflow">if</span> (ih != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        ih-&gt;processingTime(aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a6d0f8f3a0db4d8d3fb1806e7feb3e510">icap</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1IcapLogEntry.html#a39a07b9281212b7538647125b010bf5a">processingTime</a>);</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#aafdb4377ebb6a51a7eefe98f46a7b5d9">method</a> = request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a>;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#ad3e0fec5db99d08a0baed5501209e7a1">version</a> = request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#afcb0c1d278e61a1379032790c427788d">http_ver</a>;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a550f1fb979566c3e705422eeb6d0b66c">hier</a> = request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a5c031f584be4a77277cccd49b0d4cea1">hier</a>;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#afe682e33fa7a03c6421ecd0864924eec">extuser</a> = request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a494fed99df72f89fc219ad8809f22781">extacl_user</a>.<a class="code hl_function" href="classString.html#aba5551ee62c6e82730c0cb1856238c14">termedBuf</a>();</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="comment">// Adapted request, if any, inherits and then collects all the stats, but</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="comment">// the virgin request gets logged instead; copy the stats to log them.</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="comment">// TODO: avoid losses by keeping these stats in a shared history object?</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <span class="keywordflow">if</span> (aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a>) {</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>        aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#a9ad7e32caa679d92c966271dc94032a9">dnsWait</a> = request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a9ad7e32caa679d92c966271dc94032a9">dnsWait</a>;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        aLogEntry-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a> = request-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a>;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    }</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>}</div>
</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span> </div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00374" data-start="{" data-end="}">
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno"><a class="line" href="classClientHttpRequest.html#a479a52ea68d38e907287b7e921d4fd68">  374</a></span><a class="code hl_function" href="classClientHttpRequest.html#a479a52ea68d38e907287b7e921d4fd68">ClientHttpRequest::logRequest</a>()</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>{</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#acbc2aeb0bd5adc0d5a30e22b03532129">size</a> &amp;&amp; <a class="code hl_function" href="classClientHttpRequest.html#aee8237109aebae9e3711a066ddfa42c0">loggingTags</a>().oldType == <a class="code hl_enumvalue" href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5aa5ae6efde2911aca58a1954a66c2aeed">LOG_TAG_NONE</a>)</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;logging half-baked transaction: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classClientHttpRequest.html#a3f6d0f7008f5302283e91937cdc67f75">log_uri</a>);</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#acd361d0cf82d7cd1838960e668347b8d">icp</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1IcpDetails.html#a68c9e88859de7fb2127ac61d8a7de4b8">opcode</a> = <a class="code hl_enumvalue" href="group__ServerProtocolICPAPI.html#gga6d172cc0273c7eb44afd1351198704c6a373bcfac3cc95d63c2fe4043f41dbd94">ICP_INVALID</a>;</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4d0990d0207c3d555a408db2e18b3831">url</a> = <a class="code hl_variable" href="classClientHttpRequest.html#a3f6d0f7008f5302283e91937cdc67f75">log_uri</a>;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 9, <span class="stringliteral">&quot;clientLogRequest: al.url=&#39;&quot;</span> &lt;&lt; <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4d0990d0207c3d555a408db2e18b3831">url</a> &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="keyword">const</span> <span class="keyword">auto</span> findReply = [<span class="keyword">this</span>]() -&gt; <span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> * {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a19bddcabb9a3d2f290c183a171afa4b3">reply</a>)</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a19bddcabb9a3d2f290c183a171afa4b3">reply</a>.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>();</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> le = <a class="code hl_function" href="classClientHttpRequest.html#af52b42fc3f7ed18172aa09d69f856e55">loggingEntry</a>())</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>            <span class="keywordflow">return</span> le-&gt;hasFreshestReply();</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    };</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> reply = findReply()) {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>        <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#afaef5bd16c55d6723beb468d0bc75643">code</a> = reply-&gt;sline.status();</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>        <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#a72835160a2c6cc283c402124c51627e9">content_type</a> = reply-&gt;content_type.termedBuf();</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    }</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 9, <span class="stringliteral">&quot;clientLogRequest: http.code=&#39;&quot;</span> &lt;&lt; <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#afaef5bd16c55d6723beb468d0bc75643">code</a> &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span> </div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classClientHttpRequest.html#af52b42fc3f7ed18172aa09d69f856e55">loggingEntry</a>() &amp;&amp; <a class="code hl_function" href="classClientHttpRequest.html#af52b42fc3f7ed18172aa09d69f856e55">loggingEntry</a>()-&gt;mem_obj &amp;&amp; <a class="code hl_function" href="classClientHttpRequest.html#af52b42fc3f7ed18172aa09d69f856e55">loggingEntry</a>()-&gt;objectLen() &gt;= 0)</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>        <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#a415f4133a8903b3eadb2e76dfc776b9d">objectSize</a> = <a class="code hl_function" href="classClientHttpRequest.html#af52b42fc3f7ed18172aa09d69f856e55">loggingEntry</a>()-&gt;<a class="code hl_function" href="classStoreEntry.html#ae730bbd0568e47c42942cac64ee191e2">contentLen</a>(); <span class="comment">// payload duplicate ?? with or without TE ?</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#abf4b4db4cf8fb6e7bb99d3e44f4e6767">clientRequestSz</a>.<a class="code hl_variable" href="classMessageSizes.html#a7611eec2ef8fd9d6ba17519409cd5762">header</a> = <a class="code hl_variable" href="classClientHttpRequest.html#a88642d6f6a181e20927a9e54cabf3c91">req_sz</a>;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    <span class="comment">// the virgin request is saved to al-&gt;request</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a> &amp;&amp; <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a>-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#ad9f13ecd98f1ef921791a25163226f39">body_pipe</a>)</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#abf4b4db4cf8fb6e7bb99d3e44f4e6767">clientRequestSz</a>.<a class="code hl_variable" href="classMessageSizes.html#a0a1f33259faa7a15a3b38ffe37fe0ced">payloadData</a> = <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">request</a>-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#ad9f13ecd98f1ef921791a25163226f39">body_pipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a0ee59d371163434ddfd9d163ea18b7c6">producedSize</a>();</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#a1fdb429e6cf625450b7e53c216a83e8a">clientReplySz</a>.<a class="code hl_variable" href="classMessageSizes.html#a7611eec2ef8fd9d6ba17519409cd5762">header</a> = <a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#a31bec2ac65476dcbe95fda9ce0bd9385">headers_sz</a>;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="comment">// XXX: calculate without payload encoding or headers !!</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">http</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1HttpDetails.html#a1fdb429e6cf625450b7e53c216a83e8a">clientReplySz</a>.<a class="code hl_variable" href="classMessageSizes.html#a0a1f33259faa7a15a3b38ffe37fe0ced">payloadData</a> = <a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#acbc2aeb0bd5adc0d5a30e22b03532129">size</a> - <a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#a31bec2ac65476dcbe95fda9ce0bd9385">headers_sz</a>; <span class="comment">// pretend its all un-encoded data for now.</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span> </div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#a5210a8077c0fd80a0f51172d4da8a40c">highOffset</a> = <a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#a4d7061fef2fd2cd55f1cc534cb43f040">offset</a>;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <a class="code hl_function" href="time_2gadgets_8cc.html#a2bf2be1c87c9581298c5112d6c07b004">tvSub</a>(<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#a96594724e9c828bbfe14294dcc6fae05">trTime</a>, <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#a17380db1a07c6fa0aa73c3107650a3f6">start_time</a>, <a class="code hl_variable" href="time_2gadgets_8cc.html#a502612b4a32c5902726b120d713d7952">current_time</a>);</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>)</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        <a class="code hl_function" href="ModXact_8cc.html#a22777922b0ae6451894a83f1ec3614ed">prepareLogWithRequestDetails</a>(<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>, <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>);</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="preprocessor">#if USE_OPENSSL &amp;&amp; 0</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    <span class="comment">/* This is broken. Fails if the connection has been closed. Needs</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="comment">     * to snarf the ssl details some place earlier..</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span><span class="comment">     */</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>() != <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#a6df100dc295e5b0cb03773a19a859885">ssluser</a> = <a class="code hl_function" href="group__ServerProtocolSSLAPI.html#gadf059a1837d13958f66199a0b0676aa1">sslGetUserEmail</a>(<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()-&gt;fd].ssl);</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>) {</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        <a class="code hl_class" href="classSBuf.html">SBuf</a> matched;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> h: <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a4888a7cfa1001662e3e3be32d7c544fe">notes</a>) {</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>            <span class="keywordflow">if</span> (h-&gt;match(<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>, <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a19bddcabb9a3d2f290c183a171afa4b3">reply</a>.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>(), <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>, matched)) {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>                <a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_function" href="classHttpRequest.html#a88c3369b97fa30b60dc234b21dda9b91">notes</a>()-&gt;<a class="code hl_function" href="classNotePairs.html#a36b603c72d7682e871987f66d1dceac6">add</a>(h-&gt;key(), matched);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, h-&gt;key() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; matched);</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>            }</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>        }</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        <span class="comment">// The al-&gt;notes and request-&gt;notes must point to the same object.</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_function" href="classAccessLogEntry.html#a551791241b593874d721ffdf04f6b4ed">syncNotes</a>(<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>);</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        <a class="code hl_function" href="http_2Message_8h.html#adc5c03415efc511e2b62e809310969b6">HTTPMSGUNLOCK</a>(<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a830b5959845481ed29ca7dc4ff9cfd27">adapted_request</a>);</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a830b5959845481ed29ca7dc4ff9cfd27">adapted_request</a> = <a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <a class="code hl_function" href="http_2Message_8h.html#afbf13ecd1cc5c007367ae094c1aa19a9">HTTPMSGLOCK</a>(<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a830b5959845481ed29ca7dc4ff9cfd27">adapted_request</a>);</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    }</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span> </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> checklist(<span class="keyword">nullptr</span>, <a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>);</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    checklist.<a class="code hl_function" href="classACLFilledChecklist.html#a53bba78d7127a7707cb956a87ff5914f">updateAle</a>(<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="comment">// no need checklist.syncAle(): already synced</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <a class="code hl_function" href="AccessLogEntry_8h.html#abfbb0b730659ed7153add677242f7d06">accessLogLog</a>(<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>, &amp;checklist);</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <span class="keywordtype">bool</span> updatePerformanceCounters = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#a919d6cc2ff9a2f64b9d8fda58ab86032">stats_collection</a>) {</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> statsCheck(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#a919d6cc2ff9a2f64b9d8fda58ab86032">stats_collection</a>, <a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>);</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        statsCheck.<a class="code hl_function" href="classACLFilledChecklist.html#a53bba78d7127a7707cb956a87ff5914f">updateAle</a>(<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>);</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        updatePerformanceCounters = statsCheck.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>().<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>();</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    }</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordflow">if</span> (updatePerformanceCounters) {</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>)</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>            <a class="code hl_function" href="classClientHttpRequest.html#a3b6e866b0c91455fb2f9041911e83e04">updateCounters</a>();</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>() != <span class="keyword">nullptr</span> &amp;&amp; <a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()-&gt;clientConnection != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            <a class="code hl_function" href="client__db_8cc.html#a44a785ce283010d0e916ae0710dcd7f6">clientdbUpdate</a>(<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()-&gt;clientConnection-&gt;remote, <a class="code hl_function" href="classClientHttpRequest.html#aee8237109aebae9e3711a066ddfa42c0">loggingTags</a>(), <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca62d94ce7433f7892fb4541f72ac4ac7d">AnyP::PROTO_HTTP</a>, <a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#acbc2aeb0bd5adc0d5a30e22b03532129">size</a>);</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    }</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>}</div>
</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span> </div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00463" data-start="{" data-end="}">
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno"><a class="line" href="classClientHttpRequest.html#a52f95c3b38b4cacf5fa0e4d157b6eac6">  463</a></span><a class="code hl_function" href="classClientHttpRequest.html#a52f95c3b38b4cacf5fa0e4d157b6eac6">ClientHttpRequest::freeResources</a>()</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>{</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    <a class="code hl_define" href="xalloc_8h.html#a74ad4c3c3aa58c8fea96eb0dc090fd67">safe_free</a>(<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a>);</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <a class="code hl_define" href="xalloc_8h.html#a74ad4c3c3aa58c8fea96eb0dc090fd67">safe_free</a>(<a class="code hl_variable" href="classClientHttpRequest.html#afc0f851aa12908396cb5457c085a4e6f">redirect</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Redirect.html#a98ac56cf94b890c981797389fba6b520">location</a>);</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    <a class="code hl_variable" href="classClientHttpRequest.html#aa0e86897a7631b6c698f6ca2acb1d1ac">range_iter</a>.<a class="code hl_variable" href="classHttpHdrRangeIter.html#ab6e6dd729f76e0e4a34ac1105af0e715">boundary</a>.<a class="code hl_function" href="classString.html#a60a0fdff84d3470d812b2adbcb2cbf38">clean</a>();</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    <a class="code hl_function" href="classClientHttpRequest.html#a27dbe3e5b15be5edba058de0cfbf9f92">clearRequest</a>();</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span> </div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">client_stream</a>.<a class="code hl_variable" href="classdlink__list.html#a532f15958755b4d0d6356f7a52291d4e">tail</a>)</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>        <a class="code hl_function" href="group__ClientStreamInternal.html#ga20d6859b35ca5de01819e32d92ec775d">clientStreamAbort</a>((<a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *)<a class="code hl_variable" href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">client_stream</a>.<a class="code hl_variable" href="classdlink__list.html#a532f15958755b4d0d6356f7a52291d4e">tail</a>-&gt;<a class="code hl_variable" href="classdlink__node.html#a06bd2bfe93cc751ab5b29b033e6ac65e">data</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>}</div>
</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00475" data-start="{" data-end="}">
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a977550c14579d24c36cc8f663a64dd15">  475</a></span><a class="code hl_function" href="client__side_8cc.html#a977550c14579d24c36cc8f663a64dd15">httpRequestFree</a>(<span class="keywordtype">void</span> *data)</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>{</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = (<a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *)data;</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <span class="keyword">delete</span> http;</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>}</div>
</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span> </div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span><span class="comment">/* This is a handler normally called by comm_close() */</span></div>
<div class="foldopen" id="foldopen00483" data-start="{" data-end="}">
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno"><a class="line" href="classConnStateData.html#afaf0833711797e0b502ce8b4d59df6ab">  483</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classConnStateData.html#afaf0833711797e0b502ce8b4d59df6ab">ConnStateData::connStateClosed</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommCloseCbParams.html">CommCloseCbParams</a> &amp;)</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>{</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>) {</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a93501769b655ff67d8d195df07784df0">noteClosure</a>();</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>        <span class="comment">// keep closed clientConnection for logging, clientdb cleanup, etc.</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    }</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <a class="code hl_function" href="classAsyncJob.html#a83973ca7a7663bb81ce0ba346b8bcd9f">deleteThis</a>(<span class="stringliteral">&quot;ConnStateData::connStateClosed&quot;</span>);</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>}</div>
</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span> </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="preprocessor">#if USE_AUTH</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00494" data-start="{" data-end="}">
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno"><a class="line" href="classConnStateData.html#a365239c8b450a844e46cc7c28d465ba3">  494</a></span><a class="code hl_function" href="classConnStateData.html#a365239c8b450a844e46cc7c28d465ba3">ConnStateData::setAuth</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Auth::UserRequest::Pointer</a> &amp;aur, <span class="keyword">const</span> <span class="keywordtype">char</span> *by)</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>{</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        <span class="keywordflow">if</span> (aur != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;Adding connection-auth to &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; by);</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>            <a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a> = aur;</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>        }</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    }</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    <span class="comment">// clobered with self-pointer</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="comment">// NP: something nasty is going on in Squid, but harmless.</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <span class="keywordflow">if</span> (aur == <a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a>) {</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;WARNING: Ignoring duplicate connection-auth for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; by);</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    }</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="comment">     * Connection-auth relies on a single set of credentials being preserved</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="comment">     * for all requests on a connection once they have been setup.</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="comment">     * There are several things which need to happen to preserve security</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span><span class="comment">     * when connection-auth credentials change unexpectedly or are unset.</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="comment">     *</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="comment">     * 1) auth helper released from any active state</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="comment">     *</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="comment">     * They can only be reserved by a handshake process which this</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">     * connection can now never complete.</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="comment">     * This prevents helpers hanging when their connections close.</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">     *</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="comment">     * 2) pinning is expected to be removed and server conn closed</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="comment">     *</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="comment">     * The upstream link is authenticated with the same credentials.</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="comment">     * Expecting the same level of consistency we should have received.</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="comment">     * This prevents upstream being faced with multiple or missing</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">     * credentials after authentication.</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="comment">     * NP: un-pin is left to the cleanup in ConnStateData::swanSong()</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="comment">     *     we just trigger that cleanup here via comm_reset_close() or</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="comment">     *     ConnStateData::stopReceiving()</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="comment">     *</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="comment">     * 3) the connection needs to close.</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="comment">     *</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="comment">     * This prevents attackers injecting requests into a connection,</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="comment">     * or gateways wrongly multiplexing users into a single connection.</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="comment">     *</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="comment">     * When credentials are missing closure needs to follow an auth</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="comment">     * challenge for best recovery by the client.</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="comment">     *</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="comment">     * When credentials change there is nothing we can do but abort as</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span><span class="comment">     * fast as possible. Sending TCP RST instead of an HTTP response</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="comment">     * is the best-case action.</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span><span class="comment">     */</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="comment">// clobbered with nul-pointer</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="keywordflow">if</span> (aur == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;WARNING: Graceful closure on &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; due to connection-auth erase from &quot;</span> &lt;&lt; by);</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>        <a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a>-&gt;<a class="code hl_function" href="classAuth_1_1UserRequest.html#a4d92682f8dd700e05a57a87cc2e74f0c">releaseAuthServer</a>();</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        <a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        <span class="comment">// XXX: need to test whether the connection re-auth challenge is sent. If not, how to trigger it from here.</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>        <span class="comment">// NP: the current situation seems to fix challenge loops in Safari without visible issues in others.</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        <span class="comment">// we stop receiving more traffic but can leave the Job running to terminate after the error or challenge is delivered.</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        <a class="code hl_function" href="classConnStateData.html#ab0b6b47377ef5853fc9c22e3ae62f1f8">stopReceiving</a>(<span class="stringliteral">&quot;connection-auth removed&quot;</span>);</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    }</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="comment">// clobbered with alternative credentials</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <span class="keywordflow">if</span> (aur != <a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a>) {</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;ERROR: Closing &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; due to change of connection-auth from &quot;</span> &lt;&lt; by);</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        <a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a>-&gt;<a class="code hl_function" href="classAuth_1_1UserRequest.html#a4d92682f8dd700e05a57a87cc2e74f0c">releaseAuthServer</a>();</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        <a class="code hl_variable" href="classConnStateData.html#a80471064340d6433f759488865310b4d">auth_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>        <span class="comment">// this is a fatal type of problem.</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="comment">// Close the connection immediately with TCP RST to abort all traffic flow</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <a class="code hl_function" href="comm_8cc.html#af74f102f673b39ad806aafefdd1e948c">comm_reset_close</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    }</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <span class="comment">/* NOT REACHABLE */</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>}</div>
</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span> </div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00574" data-start="{" data-end="}">
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno"><a class="line" href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">  574</a></span><a class="code hl_function" href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">ConnStateData::resetReadTimeout</a>(<span class="keyword">const</span> time_t timeout)</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>{</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;ConnStateData, CommTimeoutCbParams&gt;</a> TimeoutDialer;</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> callback = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, TimeoutDialer, <span class="keyword">this</span>, <a class="code hl_function" href="classConnStateData.html#ac6d7b7b78efcf4f132f32fc88d96711e">ConnStateData::requestTimeout</a>);</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <a class="code hl_function" href="comm_8cc.html#a1d65b72cb3685143bbc87633b7f53b3e">commSetConnTimeout</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>, timeout, callback);</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>}</div>
</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span> </div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00582" data-start="{" data-end="}">
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno"><a class="line" href="classConnStateData.html#ac21b0b5b9986f9088bcfc68016760454">  582</a></span><a class="code hl_function" href="classConnStateData.html#ac21b0b5b9986f9088bcfc68016760454">ConnStateData::extendLifetime</a>()</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>{</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;ConnStateData, CommTimeoutCbParams&gt;</a> TimeoutDialer;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> callback = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(5, 4, TimeoutDialer, <span class="keyword">this</span>, <a class="code hl_function" href="classConnStateData.html#a77178d9a4cfa208cb5bc71967e62ab79">ConnStateData::lifetimeTimeout</a>);</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <a class="code hl_function" href="comm_8cc.html#a1d65b72cb3685143bbc87633b7f53b3e">commSetConnTimeout</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>, <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">Timeout</a>.<a class="code hl_variable" href="classSquidConfig.html#a628b280b07f322c6cd729a4e129eed98">lifetime</a>, callback);</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>}</div>
</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="comment">// cleans up before destructor is called</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00591" data-start="{" data-end="}">
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno"><a class="line" href="classConnStateData.html#a497c8682cd967de8b087198e08c0dd66">  591</a></span><a class="code hl_function" href="classConnStateData.html#a497c8682cd967de8b087198e08c0dd66">ConnStateData::swanSong</a>()</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>{</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    <a class="code hl_function" href="client__db_8cc.html#a3f1ddfeb929e358b2398430c1b888a2f">clientdbEstablished</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>, -1);  <span class="comment">/* decrement */</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    <a class="code hl_function" href="classConnStateData.html#a66927b5570f7ee51400c0bca0751cee6">terminateAll</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa5203071ca85e00df6bf2526855b6df0d">ERR_NONE</a>, <a class="code hl_class" href="classLogTagsErrors.html">LogTagsErrors</a>());</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <a class="code hl_function" href="classConnStateData.html#ab50872ed0917e572c6191a522e8210b0">checkLogging</a>();</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span> </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <span class="comment">// XXX: Closing pinned conn is too harsh: The Client may want to continue!</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <a class="code hl_function" href="classConnStateData.html#ab538ca8c4b7cf767362cbce8e95a93ce">unpinConnection</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <a class="code hl_function" href="classServer.html#ae6ce5210cefc979791043ae510b77380">Server::swanSong</a>();</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="preprocessor">#if USE_AUTH</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    <span class="comment">// NP: do this bit after closing the connections to avoid side effects from unwanted TCP RST</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <a class="code hl_function" href="classConnStateData.html#a365239c8b450a844e46cc7c28d465ba3">setAuth</a>(<span class="keyword">nullptr</span>, <span class="stringliteral">&quot;ConnStateData::SwanSong cleanup&quot;</span>);</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span> </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.swanSang = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>}</div>
</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00615" data-start="{" data-end="}">
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno"><a class="line" href="classConnStateData.html#a6fff1958cbee2ad5df8e5dc2c7cd1cda">  615</a></span><a class="code hl_function" href="classConnStateData.html#a6fff1958cbee2ad5df8e5dc2c7cd1cda">ConnStateData::callException</a>(<span class="keyword">const</span> std::exception &amp;ex)</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>{</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <a class="code hl_function" href="classAsyncJob.html#aefd101ddca496c1372f282e0f15229b8">Server::callException</a>(ex); <span class="comment">// logs ex and stops the job</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span> </div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    <a class="code hl_class" href="classRefCount.html">ErrorDetail::Pointer</a> errorDetail;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> tex = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code hl_class" href="classTextException.html">TextException</a>*<span class="keyword">&gt;</span>(&amp;ex))</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>        errorDetail = <span class="keyword">new</span> <a class="code hl_class" href="classExceptionErrorDetail.html">ExceptionErrorDetail</a>(tex-&gt;id());</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        errorDetail = <span class="keyword">new</span> <a class="code hl_class" href="classExceptionErrorDetail.html">ExceptionErrorDetail</a>(<a class="code hl_define" href="Here_8h.html#ae4d205e9d525856fbdfd44f7eccb309b">Here</a>().<span class="keywordtype">id</span>());</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa484c5a83c6dddc445cad0243e75d88e1">ERR_GATEWAY_FAILURE</a>, errorDetail);</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>}</div>
</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00628" data-start="{" data-end="}">
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno"><a class="line" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">  628</a></span><a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">ConnStateData::updateError</a>(<span class="keyword">const</span> <a class="code hl_class" href="classError.html">Error</a> &amp;<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>)</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>{</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>()) {</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>        <span class="keyword">const</span> <span class="keyword">auto</span> http = context-&gt;http;</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http);</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        http-&gt;updateError(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>);</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        <a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>.<a class="code hl_function" href="classError.html#a6e163b6a5a08adf7f23ea363d8935ee3">update</a>(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>);</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    }</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>}</div>
</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen00640" data-start="{" data-end="}">
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno"><a class="line" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">  640</a></span><a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">ConnStateData::isOpen</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a>(<span class="keyword">this</span>) &amp;&amp; <span class="comment">// XXX: checking &quot;this&quot; in a method</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>           <a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>) &amp;&amp;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>           !<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].closing();</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>}</div>
</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="foldopen" id="foldopen00647" data-start="{" data-end="}">
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno"><a class="line" href="classConnStateData.html#aa859a8faf2797fcdf46be1e63850b522">  647</a></span><a class="code hl_function" href="classConnStateData.html#aa859a8faf2797fcdf46be1e63850b522">ConnStateData::~ConnStateData</a>()</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>{</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>())</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;ERROR: Squid BUG: ConnStateData did not close &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.swanSang)</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;ERROR: Squid BUG: ConnStateData was not destroyed properly; &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span> </div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <a class="code hl_function" href="classBodyProducer.html#a74c6e12314d91957acc4dbbc610ed8d6">stopProducingFor</a>(<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span> </div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    <span class="keyword">delete</span> <a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>; <span class="comment">// TODO: pool</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span> </div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>    <span class="keyword">delete</span> <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>;</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>}</div>
</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00674" data-start="{" data-end="}">
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno"><a class="line" href="client__side_8cc.html#aa598a3822a54b412815630007ed6982b">  674</a></span><a class="code hl_function" href="client__side_8cc.html#aa598a3822a54b412815630007ed6982b">clientSetKeepaliveFlag</a>(<a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> * http)</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>{</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span> </div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;http_ver = &quot;</span> &lt;&lt; request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#afcb0c1d278e61a1379032790c427788d">http_ver</a>);</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;method = &quot;</span> &lt;&lt; request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a>);</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    <span class="comment">// TODO: move to HttpRequest::hdrCacheInit, just like HttpReply.</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#a8014770f9112fe68a085fc4ecec68680">proxyKeepalive</a> = request-&gt;<a class="code hl_function" href="classHttp_1_1Message.html#a321ae82a5f96da7438f3054d38c8fe5c">persistent</a>();</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>}</div>
</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span> </div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span><span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00686" data-start="{" data-end="}">
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a766113836f4b2ce05e7dfe662c5d161a">  686</a></span><a class="code hl_function" href="client__side_8cc.html#a766113836f4b2ce05e7dfe662c5d161a">clientIsRequestBodyTooLargeForPolicy</a>(int64_t bodyLength)</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>{</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a5b6f79ca04d2c3f0a514bf87890f8472">maxRequestBodySize</a> &amp;&amp;</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>            bodyLength &gt; <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a5b6f79ca04d2c3f0a514bf87890f8472">maxRequestBodySize</a>)</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        <span class="keywordflow">return</span> 1;       <span class="comment">/* too large */</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>}</div>
</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span> </div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen00696" data-start="{" data-end="}">
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno"><a class="line" href="classClientHttpRequest.html#aaccebea2e47cb4f216a2f3bf32590cb9">  696</a></span><a class="code hl_function" href="classClientHttpRequest.html#aaccebea2e47cb4f216a2f3bf32590cb9">ClientHttpRequest::multipartRangeRequest</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_function" href="classHttpRequest.html#a52c61e6b8c61c28ff10381895aa114a9">multipartRangeRequest</a>();</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>}</div>
</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00702" data-start="{" data-end="}">
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno"><a class="line" href="client__side_8cc.html#aabee8b7031277506f399a75979659b38">  702</a></span><a class="code hl_function" href="client__side_8cc.html#aabee8b7031277506f399a75979659b38">clientPackTermBound</a>(<a class="code hl_class" href="classString.html">String</a> boundary, <a class="code hl_class" href="classMemBuf.html">MemBuf</a> *mb)</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>{</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>    mb-&gt;<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;\r\n--&quot;</span> <a class="code hl_define" href="SquidString_8h.html#ac683b536d1e88daafdee1942746c0939">SQUIDSTRINGPH</a> <span class="stringliteral">&quot;--\r\n&quot;</span>, <a class="code hl_define" href="SquidString_8h.html#ad459357d193b2c271d3ee0beab60795c">SQUIDSTRINGPRINT</a>(boundary));</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 6, <span class="stringliteral">&quot;buf offset: &quot;</span> &lt;&lt; mb-&gt;<a class="code hl_variable" href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">size</a>);</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>}</div>
</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span> </div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00709" data-start="{" data-end="}">
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno"><a class="line" href="client__side_8cc.html#af77cbb84079fd464aaf980442dcd8870">  709</a></span><a class="code hl_function" href="client__side_8cc.html#af77cbb84079fd464aaf980442dcd8870">clientPackRangeHdr</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">HttpReplyPointer</a> &amp;rep, <span class="keyword">const</span> <a class="code hl_class" href="classHttpHdrRangeSpec.html">HttpHdrRangeSpec</a> * spec, <a class="code hl_class" href="classString.html">String</a> boundary, <a class="code hl_class" href="classMemBuf.html">MemBuf</a> * mb)</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>{</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <a class="code hl_class" href="classHttpHeader.html">HttpHeader</a> hdr(<a class="code hl_enumvalue" href="HttpHeader_8h.html#a2fd6ecc24bf950965aed06a4c6f70ce0a729c58961184c0ec26c220611020bb00">hoReply</a>);</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(rep);</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(spec);</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>    <span class="comment">/* put boundary */</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;appending boundary: &quot;</span> &lt;&lt; boundary);</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>    <span class="comment">/* rfc2046 requires to _prepend_ boundary with &lt;crlf&gt;! */</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    mb-&gt;<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;\r\n--&quot;</span> <a class="code hl_define" href="SquidString_8h.html#ac683b536d1e88daafdee1942746c0939">SQUIDSTRINGPH</a> <span class="stringliteral">&quot;\r\n&quot;</span>, <a class="code hl_define" href="SquidString_8h.html#ad459357d193b2c271d3ee0beab60795c">SQUIDSTRINGPRINT</a>(boundary));</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> </div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>    <span class="comment">/* stuff the header with required entries and pack it */</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    <span class="keywordflow">if</span> (rep-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4ae6d0191b9e6d18bf8b6821b4505a68c2">Http::HdrType::CONTENT_TYPE</a>))</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>        hdr.<a class="code hl_function" href="classHttpHeader.html#a187949b24278b65f28338947c605b130">putStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4ae6d0191b9e6d18bf8b6821b4505a68c2">Http::HdrType::CONTENT_TYPE</a>, rep-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a89a87680aa68d7143be79793bcbce500">getStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4ae6d0191b9e6d18bf8b6821b4505a68c2">Http::HdrType::CONTENT_TYPE</a>));</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    <a class="code hl_function" href="HttpHdrContRange_8h.html#a5a226308b41749234ec3429f8d064314">httpHeaderAddContRange</a>(&amp;hdr, *spec, rep-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#aa6074e26e4827d7a52e5ae9500c10500">content_length</a>);</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>    hdr.<a class="code hl_function" href="classHttpHeader.html#ae8065947ee37c85af4d9b98bc9519a98">packInto</a>(mb);</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>    hdr.<a class="code hl_function" href="classHttpHeader.html#ac29e77be1230373c0a0d5d3d1dd2d67d">clean</a>();</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span> </div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>    <span class="comment">/* append &lt;crlf&gt; (we packed a header, not a reply) */</span></div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    mb-&gt;<a class="code hl_function" href="classMemBuf.html#a2e7319f5feaf76c1fd43f163a87ddaad">append</a>(<span class="stringliteral">&quot;\r\n&quot;</span>, 2);</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>}</div>
</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>int64_t</div>
<div class="foldopen" id="foldopen00740" data-start="{" data-end="}">
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno"><a class="line" href="classClientHttpRequest.html#a3f3960bd399a7b8e6905d5f95a7e7fdc">  740</a></span><a class="code hl_function" href="classClientHttpRequest.html#a3f3960bd399a7b8e6905d5f95a7e7fdc">ClientHttpRequest::mRangeCLen</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    int64_t clen = 0;</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_function" href="classClientHttpRequest.html#a7b72433c2b94db09d5fa9725a2a189f0">memObject</a>());</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    <a class="code hl_typedef" href="classHttpHdrRange.html#a04631e9268ea83022b6c98179d6960c9">HttpHdrRange::iterator</a> pos = <a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#a0e84a414e1c5857a0d8681f0a9c13317">range</a>-&gt;<a class="code hl_function" href="classHttpHdrRange.html#a4caf5a47b28b4f4e141b98e95914fe95">begin</a>();</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span> </div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>    <span class="keywordflow">while</span> (pos != <a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#a0e84a414e1c5857a0d8681f0a9c13317">range</a>-&gt;<a class="code hl_function" href="classHttpHdrRange.html#a5eefced91bb33dc3f5a518746238de0e">end</a>()) {</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        <span class="comment">/* account for headers for this range */</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        mb.<a class="code hl_function" href="classMemBuf.html#ac0eda16694c0752050a1da95db2be3e6">reset</a>();</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>        <a class="code hl_function" href="client__side_8cc.html#af77cbb84079fd464aaf980442dcd8870">clientPackRangeHdr</a>(&amp;<a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>()-&gt;mem().freshestReply(),</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>                           *pos, <a class="code hl_variable" href="classClientHttpRequest.html#aa0e86897a7631b6c698f6ca2acb1d1ac">range_iter</a>.<a class="code hl_variable" href="classHttpHdrRangeIter.html#ab6e6dd729f76e0e4a34ac1105af0e715">boundary</a>, &amp;mb);</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>        clen += mb.<a class="code hl_variable" href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">size</a>;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span> </div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>        <span class="comment">/* account for range content */</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        clen += (*pos)-&gt;length;</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 6, <span class="stringliteral">&quot;clientMRangeCLen: (clen += &quot;</span> &lt;&lt; mb.<a class="code hl_variable" href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">size</a> &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; (*pos)-&gt;length &lt;&lt; <span class="stringliteral">&quot;) == &quot;</span> &lt;&lt; clen);</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        ++pos;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    }</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span> </div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>    <span class="comment">/* account for the terminating boundary */</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    mb.<a class="code hl_function" href="classMemBuf.html#ac0eda16694c0752050a1da95db2be3e6">reset</a>();</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>    <a class="code hl_function" href="client__side_8cc.html#aabee8b7031277506f399a75979659b38">clientPackTermBound</a>(<a class="code hl_variable" href="classClientHttpRequest.html#aa0e86897a7631b6c698f6ca2acb1d1ac">range_iter</a>.<a class="code hl_variable" href="classHttpHdrRangeIter.html#ab6e6dd729f76e0e4a34ac1105af0e715">boundary</a>, &amp;mb);</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span> </div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>    clen += mb.<a class="code hl_variable" href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">size</a>;</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span> </div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>    mb.<a class="code hl_function" href="classMemBuf.html#a085688f536a13949b005f7bb59bae333">clean</a>();</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    <span class="keywordflow">return</span> clen;</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>}</div>
</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span> </div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span><a class="code hl_class" href="classString.html">String</a></div>
<div class="foldopen" id="foldopen00780" data-start="{" data-end="}">
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno"><a class="line" href="classClientHttpRequest.html#a53f0bfbec60d40769f21aff66eeaaa79">  780</a></span><a class="code hl_function" href="classClientHttpRequest.html#a53f0bfbec60d40769f21aff66eeaaa79">ClientHttpRequest::rangeBoundaryStr</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *key;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>    <a class="code hl_class" href="classString.html">String</a> b(<a class="code hl_variable" href="globals_8h.html#a8532b327d486a5d5e1b01ca7761e9805">visible_appname_string</a>);</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    b.<a class="code hl_function" href="classString.html#abd8b379e2e87081854ed606d9e941c95">append</a>(<span class="stringliteral">&quot;:&quot;</span>,1);</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>    key = <a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>()-&gt;<a class="code hl_function" href="classStoreEntry.html#a88e8fcd41e9d2d0c24ea68daa9a4eb57">getMD5Text</a>();</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    b.<a class="code hl_function" href="classString.html#abd8b379e2e87081854ed606d9e941c95">append</a>(key, strlen(key));</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>    <span class="keywordflow">return</span> b;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>}</div>
</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span> </div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00800" data-start="{" data-end="}">
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno"><a class="line" href="client__side_8cc.html#ab55f1a534ec6e4a1838a74d7720cb666">  800</a></span><a class="code hl_variable" href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a>(<a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> * <a class="code hl_struct" href="structnode.html">node</a>, <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> * http,</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>                      <a class="code hl_class" href="classHttpReply.html">HttpReply</a> * rep, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> receivedData)</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>{</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>    <span class="comment">// do not try to deliver if client already ABORTED</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="keywordflow">if</span> (!http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>() || !<a class="code hl_function" href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a>(http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()) || !<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>))</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span> </div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    <span class="comment">/* Test preconditions */</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_struct" href="structnode.html">node</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>    <span class="comment">/* TODO: handle this rather than asserting</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span><span class="comment">     * - it should only ever happen if we cause an abort and</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span><span class="comment">     * the callback chain loops back to here, so we can simply return.</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span><span class="comment">     * However, that itself shouldn&#39;t happen, so it stays as an assert for now.</span></div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span><span class="comment">     */</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_function" href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a>(<a class="code hl_struct" href="structnode.html">node</a>));</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;node.<a class="code hl_variable" href="structnode.html#aa3e8aa83f864292b5a01210f4453fcc0">next</a> == <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span> </div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>    <span class="comment">/* TODO: check offset is what we asked for */</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span> </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>    <span class="comment">// TODO: enforces HTTP/1 MUST on pipeline order, but is irrelevant to HTTP/2</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    <span class="keywordflow">if</span> (context != http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()-&gt;<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>())</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>        context-&gt;deferRecipientForLater(<a class="code hl_struct" href="structnode.html">node</a>, rep, receivedData);</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()-&gt;<a class="code hl_variable" href="classHttpControlMsgSink.html#a10a891d78d81fd0683ac76c3d3aa7e6e">cbControlMsgSent</a>) <span class="comment">// 1xx to the user is pending</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>        context-&gt;deferRecipientForLater(<a class="code hl_struct" href="structnode.html">node</a>, rep, receivedData);</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>        http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>()-&gt;<a class="code hl_function" href="classConnStateData.html#a353dfcbded7be4eb270547eb11f4b342">handleReply</a>(rep, receivedData);</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>}</div>
</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span> </div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00836" data-start="{" data-end="}">
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a998bd392d486f1385446bc7dca27bd08">  836</a></span><a class="code hl_variable" href="client__side_8h.html#a2800047b5d0d3e31d1739cd35378f4ab">clientSocketDetach</a>(<a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> * <a class="code hl_struct" href="structnode.html">node</a>, <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> * http)</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>{</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="comment">/* Test preconditions */</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_struct" href="structnode.html">node</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    <span class="comment">/* TODO: handle this rather than asserting</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span><span class="comment">     * - it should only ever happen if we cause an abort and</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span><span class="comment">     * the callback chain loops back to here, so we can simply return.</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span><span class="comment">     * However, that itself shouldn&#39;t happen, so it stays as an assert for now.</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span><span class="comment">     */</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_function" href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a>(<a class="code hl_struct" href="structnode.html">node</a>));</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>    <span class="comment">/* Set null by ContextFree */</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;node.<a class="code hl_variable" href="structnode.html#aa3e8aa83f864292b5a01210f4453fcc0">next</a> == <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>    <span class="comment">/* this is the assert discussed above */</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<span class="keyword">nullptr</span> == <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw()));</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <span class="comment">/* We are only called when the client socket shutsdown.</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span><span class="comment">     * Tell the prev pipeline member we&#39;re finished</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span><span class="comment">     */</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    <a class="code hl_function" href="group__ClientStreamInternal.html#gae62c467856741b9fdc6c8b919ea65462">clientStreamDetach</a>(<a class="code hl_struct" href="structnode.html">node</a>, http);</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>}</div>
</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span> </div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00857" data-start="{" data-end="}">
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno"><a class="line" href="classConnStateData.html#a12dfeaee10cae92416b398b102345a4e">  857</a></span><a class="code hl_function" href="classConnStateData.html#a12dfeaee10cae92416b398b102345a4e">ConnStateData::readNextRequest</a>()</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>{</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; reading next req&quot;</span>);</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span> </div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;Idle client: Waiting for next request&quot;</span>);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    <a class="code hl_function" href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">resetReadTimeout</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a50af3f8fe1f64bcaffdbedcf8a83683f">timeLeft</a>(<a class="code hl_function" href="classConnStateData.html#acd87648b0f6ad8b909cb17be57c493b1">idleTimeout</a>()));</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span> </div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    <a class="code hl_function" href="classServer.html#a12cdf2616768902693acb3896283d29b">readSomeData</a>();</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>}</div>
</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span> </div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00872" data-start="{" data-end="}">
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno"><a class="line" href="client__side_8cc.html#ab489de204612ef3a359eee05b1556dda">  872</a></span><a class="code hl_function" href="client__side_8cc.html#ab489de204612ef3a359eee05b1556dda">ClientSocketContextPushDeferredIfNeeded</a>(<a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> deferredRequest, <a class="code hl_class" href="classConnStateData.html">ConnStateData</a> * conn)</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>{</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; Sending next&quot;</span>);</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span> </div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>    <span class="keywordflow">if</span> (deferredRequest-&gt;flags.deferred) {</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(deferredRequest-&gt;http-&gt;out.size == 0);</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>        <a class="code hl_variable" href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a>(deferredRequest-&gt;deferredparams.node,</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                              deferredRequest-&gt;http,</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                              deferredRequest-&gt;deferredparams.rep,</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>                              deferredRequest-&gt;deferredparams.queuedBuffer);</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>    }</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span> </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>}</div>
</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span> </div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00894" data-start="{" data-end="}">
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno"><a class="line" href="classConnStateData.html#a3cb67d29f73c36995e78cc0870235bd9">  894</a></span><a class="code hl_function" href="classConnStateData.html#a3cb67d29f73c36995e78cc0870235bd9">ConnStateData::kick</a>()</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>{</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>)) {</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; Connection was closed&quot;</span>);</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>    }</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span> </div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.pinned &amp;&amp; !<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection)) {</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; Connection was pinned but server side gone. Terminating client connection&quot;</span>);</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>    }</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span> </div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *reason = <a class="code hl_function" href="classConnStateData.html#a30d7e040d87665326b2cd9f63466cde2">stoppedReceiving</a>()) {</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;closing for earlier request error: &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    }</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    <a class="code hl_function" href="classConnStateData.html#a4d4de1cff9d3c5f5d312fee3622e0fa2">parseRequests</a>();</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span> </div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>())</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span> </div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> deferredRequest = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    <span class="keywordflow">if</span> (deferredRequest != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;: calling PushDeferredIfNeeded&quot;</span>);</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>        <a class="code hl_function" href="client__side_8cc.html#ab489de204612ef3a359eee05b1556dda">ClientSocketContextPushDeferredIfNeeded</a>(deferredRequest, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore) {</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;: calling readNextRequest()&quot;</span>);</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>        <a class="code hl_function" href="classConnStateData.html#a12dfeaee10cae92416b398b102345a4e">readNextRequest</a>();</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>        <span class="comment">// XXX: Can this happen? CONNECT tunnels have deferredRequest set.</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <a class="code hl_define" href="debug_2Stream_8h.html#ab7c36646d2082a51e1f8a7c3341d59c7">MYNAME</a> &lt;&lt; <span class="stringliteral">&quot;abandoning &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    }</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>}</div>
</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span> </div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00959" data-start="{" data-end="}">
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno"><a class="line" href="classConnStateData.html#ae8f9e3c4f202d0dace53b434ca29c8c0">  959</a></span><a class="code hl_function" href="classConnStateData.html#ae8f9e3c4f202d0dace53b434ca29c8c0">ConnStateData::stopSending</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>)</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>{</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;sending error (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;): &quot;</span> &lt;&lt; <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a> &lt;&lt;</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>           <span class="stringliteral">&quot;; old receiving error: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>           (<a class="code hl_function" href="classConnStateData.html#a30d7e040d87665326b2cd9f63466cde2">stoppedReceiving</a>() ? <a class="code hl_variable" href="classConnStateData.html#ae37f30536c4a7ab66385bec18d1f02ec">stoppedReceiving_</a> : <span class="stringliteral">&quot;none&quot;</span>));</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span> </div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *oldError = <a class="code hl_function" href="classConnStateData.html#aeff8387932f77bdb4957099a4528f73e">stoppedSending</a>()) {</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;already stopped sending: &quot;</span> &lt;&lt; oldError);</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>        <span class="keywordflow">return</span>; <span class="comment">// nothing has changed as far as this connection is concerned</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    }</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>    <a class="code hl_variable" href="classConnStateData.html#a97dd48eb3cc7bdf5b33053afe7bb7c94">stoppedSending_</a> = <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>;</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span> </div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#a30d7e040d87665326b2cd9f63466cde2">stoppedReceiving</a>()) {</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>        <span class="keywordflow">if</span> (<span class="keyword">const</span> int64_t expecting = <a class="code hl_function" href="classConnStateData.html#aec04ec17951deaf98852074bef3c171b">mayNeedToReadMoreBody</a>()) {</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;must still read &quot;</span> &lt;&lt; expecting &lt;&lt;</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>                   <span class="stringliteral">&quot; request body bytes with &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &lt;&lt; <span class="stringliteral">&quot; unused&quot;</span>);</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>            <span class="keywordflow">return</span>; <span class="comment">// wait for the request receiver to finish reading</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>        }</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>    }</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span> </div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>}</div>
</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span> </div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00983" data-start="{" data-end="}">
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno"><a class="line" href="classConnStateData.html#a6341ca5b4d4ef0913c5008d47a406eae">  983</a></span><a class="code hl_function" href="classConnStateData.html#a6341ca5b4d4ef0913c5008d47a406eae">ConnStateData::afterClientWrite</a>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>{</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>())</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span> </div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <span class="keyword">auto</span> ctx = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>) {</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>        <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#a8cd6e48b996bbdf19dbb6bf4fe5b4431">kbytes_out</a> += <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>        <span class="keywordflow">if</span> (ctx-&gt;http-&gt;loggingTags().isTcpHit())</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>            <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#aadc939133f4aa79c5889a83eaf071d15">hit_kbytes_out</a> += <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    }</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    ctx-&gt;writeComplete(<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>}</div>
</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span> </div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span><a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *</div>
<div class="foldopen" id="foldopen00998" data-start="{" data-end="}">
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno"><a class="line" href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">  998</a></span><a class="code hl_function" href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">ConnStateData::abortRequestParsing</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> uri)</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>{</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = <span class="keyword">new</span> <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>    http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a88642d6f6a181e20927a9e54cabf3c91">req_sz</a> = <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>();</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a9891746d2fe370c2930a7fddb44c1a35">setErrorUri</a>(uri);</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="keyword">auto</span> *context = <span class="keyword">new</span> <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>, http);</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> tempBuffer;</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a> = context-&gt;reqbuf;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> = <a class="code hl_define" href="http_2forward_8h.html#a196f6d12d102aebcc7a2778bea3e6b19">HTTP_REQBUF_SZ</a>;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    <a class="code hl_function" href="group__ClientStreamInternal.html#ga73019262f28c27affc3937cac3441a43">clientStreamInit</a>(&amp;http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">client_stream</a>, <a class="code hl_variable" href="client__side_8h.html#ae73f7b10b6c2bd55c5f96c9d62839e8d">clientGetMoreData</a>, <a class="code hl_variable" href="client__side_8h.html#ab806362f706a7b39732957bb45e3c2df">clientReplyDetach</a>,</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>                     <a class="code hl_variable" href="client__side_8h.html#a3d42a7ece901f14e6ec973a0feb096e1">clientReplyStatus</a>, <span class="keyword">new</span> <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a>(http), <a class="code hl_variable" href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a>,</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>                     <a class="code hl_variable" href="client__side_8h.html#a2800047b5d0d3e31d1739cd35378f4ab">clientSocketDetach</a>, context, tempBuffer);</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="keywordflow">return</span> context;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>}</div>
</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span> </div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01014" data-start="{" data-end="}">
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"><a class="line" href="classConnStateData.html#a5a39c2a4ae492e5914085fca73f73206"> 1014</a></span><a class="code hl_function" href="classConnStateData.html#a5a39c2a4ae492e5914085fca73f73206">ConnStateData::startShutdown</a>()</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>{</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    <span class="comment">// RegisteredRunner API callback - Squid has been shut down</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span> </div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>    <span class="comment">// if connection is idle terminate it now,</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    <span class="comment">// otherwise wait for grace period to end</span></div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>())</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>        <a class="code hl_function" href="classConnStateData.html#a090da3709a1d4e3e0a5c858abc7496e7">endingShutdown</a>();</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>}</div>
</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span> </div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01025" data-start="{" data-end="}">
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"><a class="line" href="classConnStateData.html#a090da3709a1d4e3e0a5c858abc7496e7"> 1025</a></span><a class="code hl_function" href="classConnStateData.html#a090da3709a1d4e3e0a5c858abc7496e7">ConnStateData::endingShutdown</a>()</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>{</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="comment">// RegisteredRunner API callback - Squid shutdown grace period is over</span></div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <span class="comment">// force the client connection to close immediately</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>    <span class="comment">// swanSong() in the close handler will cleanup.</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>))</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>}</div>
</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span> </div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span><span class="keywordtype">char</span> *</div>
<div class="foldopen" id="foldopen01036" data-start="{" data-end="}">
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"><a class="line" href="client__side_8cc.html#ab9b84c4e1325a12972ccd56432a946a0"> 1036</a></span><a class="code hl_function" href="client__side_8cc.html#ab9b84c4e1325a12972ccd56432a946a0">skipLeadingSpace</a>(<span class="keywordtype">char</span> *aString)</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>{</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <span class="keywordtype">char</span> *result = aString;</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <span class="keywordflow">while</span> (<a class="code hl_define" href="xis_8h.html#a1ddc35653ddbcf46386d5c824a83a150">xisspace</a>(*aString))</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>        ++aString;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span> </div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>}</div>
</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span> </div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span><span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="foldopen" id="foldopen01052" data-start="{" data-end="}">
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a132279318afa1e5ec7a73f85754f6535"> 1052</a></span><a class="code hl_function" href="client__side_8cc.html#a132279318afa1e5ec7a73f85754f6535">findTrailingHTTPVersion</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *uriAndHTTPVersion, <span class="keyword">const</span> <span class="keywordtype">char</span> *end)</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>{</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <span class="keywordflow">if</span> (<span class="keyword">nullptr</span> == end) {</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>        end = uriAndHTTPVersion + strcspn(uriAndHTTPVersion, <span class="stringliteral">&quot;\r\n&quot;</span>);</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(end);</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    }</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span> </div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>    <span class="keywordflow">for</span> (; end &gt; uriAndHTTPVersion; --end) {</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>        <span class="keywordflow">if</span> (*end == <span class="charliteral">&#39;\n&#39;</span> || *end == <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span> </div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="xis_8h.html#a1ddc35653ddbcf46386d5c824a83a150">xisspace</a>(*end)) {</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>            <span class="keywordflow">if</span> (strncasecmp(end + 1, <span class="stringliteral">&quot;HTTP/&quot;</span>, 5) == 0)</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>                <span class="keywordflow">return</span> end + 1;</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        }</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    }</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span> </div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>}</div>
</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span> </div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span><span class="keyword">static</span> <span class="keywordtype">char</span> *</div>
<div class="foldopen" id="foldopen01075" data-start="{" data-end="}">
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"><a class="line" href="client__side_8cc.html#aacbb7e426f92f53cf8fe185fd095f4b9"> 1075</a></span><a class="code hl_function" href="client__side_8cc.html#aacbb7e426f92f53cf8fe185fd095f4b9">prepareAcceleratedURL</a>(<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> * conn, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http1::RequestParserPointer</a> &amp;hp)</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>{</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <span class="keywordtype">int</span> vhost = conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;vhost;</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>    <span class="keywordtype">int</span> vport = conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;vport;</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> ipbuf[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>    <span class="comment">/* BUG: Squid cannot deal with &#39;*&#39; URLs (RFC2616 5.1.2) */</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span> </div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    <span class="comment">// XXX: reuse proper URL parser for this</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> url = hp-&gt;requestUri(); <span class="comment">// use full provided URI if we abort</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    <span class="keywordflow">do</span> { <span class="comment">// use a loop so we can break out of it</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>        <a class="code hl_class" href="classParser_1_1Tokenizer.html">::Parser::Tokenizer</a> <a class="code hl_struct" href="structtok.html">tok</a>(url);</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="structtok.html">tok</a>.skip(<span class="charliteral">&#39;/&#39;</span>)) <span class="comment">// origin-form URL already.</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span> </div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;vhost)</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">/* already in good shape */</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        <span class="comment">// skip the URI scheme</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> uriScheme = <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a>(<span class="stringliteral">&quot;URI-scheme&quot;</span>,<span class="stringliteral">&quot;+-.&quot;</span>) + <a class="code hl_variable" href="classCharacterSet.html#a7627410399607914e9bfddfcadd5eeaa">CharacterSet::ALPHA</a> + <a class="code hl_variable" href="classCharacterSet.html#a578edbb48255e9df5e21dabb18cd8ab0">CharacterSet::DIGIT</a>;</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> uriSchemeEnd(<span class="stringliteral">&quot;://&quot;</span>);</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>        <span class="keywordflow">if</span> (!<a class="code hl_struct" href="structtok.html">tok</a>.skipAll(uriScheme) || !<a class="code hl_struct" href="structtok.html">tok</a>.skip(uriSchemeEnd))</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>        <span class="comment">// skip the authority segment</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>        <span class="comment">// RFC 3986 complex nested ABNF for &quot;authority&quot; boils down to this:</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> authority = <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a>(<span class="stringliteral">&quot;authority&quot;</span>,<span class="stringliteral">&quot;-._~%:@[]!$&amp;&#39;()*+,;=&quot;</span>) +</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>                                              <a class="code hl_variable" href="classCharacterSet.html#a8babc6783779a8b1880bea53e7ba5a45">CharacterSet::HEXDIG</a> + <a class="code hl_variable" href="classCharacterSet.html#a7627410399607914e9bfddfcadd5eeaa">CharacterSet::ALPHA</a> + <a class="code hl_variable" href="classCharacterSet.html#a578edbb48255e9df5e21dabb18cd8ab0">CharacterSet::DIGIT</a>;</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>        <span class="keywordflow">if</span> (!<a class="code hl_struct" href="structtok.html">tok</a>.skipAll(authority))</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span> </div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> slashUri(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> t = <a class="code hl_struct" href="structtok.html">tok</a>.remaining();</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>        <span class="keywordflow">if</span> (t.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>            url = slashUri;</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t[0]==<span class="charliteral">&#39;/&#39;</span>) <span class="comment">// looks like path</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            url = t;</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t[0]==<span class="charliteral">&#39;?&#39;</span> || t[0]==<span class="charliteral">&#39;#&#39;</span>) { <span class="comment">// looks like query or fragment. fix &#39;/&#39;</span></div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>            url = slashUri;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>            url.<a class="code hl_function" href="classSBuf.html#aa12ede16b167c60722946fc8fe9292da">append</a>(t);</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        } <span class="comment">// else do nothing. invalid path</span></div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>    } <span class="keywordflow">while</span>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span> </div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span><span class="preprocessor">#if SHOULD_REJECT_UNKNOWN_URLS</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    <span class="comment">// reject URI which are not well-formed even after the processing above</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="keywordflow">if</span> (url.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>() || url[0] != <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>        hp-&gt;parseStatusCode = <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722a74568860e1daf616488c945a9b3d4416">Http::scBadRequest</a>;</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>        <span class="keywordflow">return</span> conn-&gt;<a class="code hl_function" href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">abortRequestParsing</a>(<span class="stringliteral">&quot;error:invalid-request&quot;</span>);</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    }</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span> </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    <span class="keywordflow">if</span> (vport &lt; 0)</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>        vport = conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>();</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span> </div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    <span class="keywordtype">char</span> *receivedHost = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    <span class="keywordflow">if</span> (vhost &amp;&amp; (receivedHost = hp-&gt;getHostHeaderField())) {</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>        <a class="code hl_class" href="classSBuf.html">SBuf</a> host(receivedHost);</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;ACCEL VHOST REWRITE: vhost=&quot;</span> &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot; + vport=&quot;</span> &lt;&lt; vport);</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>        <span class="keywordflow">if</span> (vport &gt; 0) {</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>            <span class="comment">// remove existing :port (if any), cope with IPv6+ without port</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>            <span class="keyword">const</span> <span class="keyword">auto</span> lastColonPos = host.<a class="code hl_function" href="classSBuf.html#a531a0dd882ff1af666b03a8437701013">rfind</a>(<span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>            <span class="keywordflow">if</span> (lastColonPos != <a class="code hl_variable" href="classSBuf.html#a1db91b2f039b38745f7d73b56ac9311f">SBuf::npos</a> &amp;&amp; *host.<a class="code hl_function" href="classSBuf.html#ab489e62b349e678e32103f5e24de28ea">rbegin</a>() != <span class="charliteral">&#39;]&#39;</span>) {</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>                host.<a class="code hl_function" href="classSBuf.html#a2f7b8f1302ad82646cc285927b453b87">chop</a>(0, lastColonPos); <span class="comment">// truncate until the last colon</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>            }</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>            host.<a class="code hl_function" href="classSBuf.html#a511d819cac33f02d5c50352d4a87c963">appendf</a>(<span class="stringliteral">&quot;:%d&quot;</span>, vport);</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>        } <span class="comment">// else nothing to alter port-wise.</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;scheme = <a class="code hl_class" href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a>).<a class="code hl_function" href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">image</a>();</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        <span class="keyword">const</span> <span class="keyword">auto</span> url_sz = scheme.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + host.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + url.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + 32;</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>        <span class="keywordtype">char</span> *uri = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a>(url_sz, 1));</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>        snprintf(uri, url_sz, <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;://&quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a>, <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(scheme), <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(host), <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(url));</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;ACCEL VHOST REWRITE: &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="keywordflow">return</span> uri;</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;defaultsite <span class="comment">/* &amp;&amp; !vhost */</span>) {</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;ACCEL DEFAULTSITE REWRITE: defaultsite=&quot;</span> &lt;&lt; conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;defaultsite &lt;&lt; <span class="stringliteral">&quot; + vport=&quot;</span> &lt;&lt; vport);</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>        <span class="keywordtype">char</span> vportStr[32];</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>        vportStr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>        <span class="keywordflow">if</span> (vport &gt; 0) {</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>            snprintf(vportStr, <span class="keyword">sizeof</span>(vportStr),<span class="stringliteral">&quot;:%d&quot;</span>,vport);</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>        }</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;scheme = <a class="code hl_class" href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a>).<a class="code hl_function" href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">image</a>();</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> url_sz = scheme.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + strlen(conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;defaultsite) + <span class="keyword">sizeof</span>(vportStr) + url.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + 32;</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>        <span class="keywordtype">char</span> *uri = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a>(url_sz, 1));</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>        snprintf(uri, url_sz, <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;://%s%s&quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a>,</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(scheme), conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;defaultsite, vportStr, <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(url));</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;ACCEL DEFAULTSITE REWRITE: &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>        <span class="keywordflow">return</span> uri;</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vport &gt; 0 <span class="comment">/* &amp;&amp; (!vhost || no Host:) */</span>) {</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;ACCEL VPORT REWRITE: *_port IP + vport=&quot;</span> &lt;&lt; vport);</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>        <span class="comment">/* Put the local socket IP address as the hostname, with whatever vport we found  */</span></div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>        conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#a2696806ea5ee1a73dbe87849a7d43539">toHostStr</a>(ipbuf,<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>);</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;scheme = <a class="code hl_class" href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a>).<a class="code hl_function" href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">image</a>();</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> url_sz = scheme.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + <span class="keyword">sizeof</span>(ipbuf) + url.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + 32;</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>        <span class="keywordtype">char</span> *uri = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a>(url_sz, 1));</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>        snprintf(uri, url_sz, <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;://%s:%d&quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a>,</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(scheme), ipbuf, vport, <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(url));</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;ACCEL VPORT REWRITE: &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>        <span class="keywordflow">return</span> uri;</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    }</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span> </div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>}</div>
</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span> </div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="keyword">static</span> <span class="keywordtype">char</span> *</div>
<div class="foldopen" id="foldopen01179" data-start="{" data-end="}">
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a738fe2a8ee19820909d5ba8f7f4ca85d"> 1179</a></span><a class="code hl_function" href="client__side_8cc.html#a738fe2a8ee19820909d5ba8f7f4ca85d">buildUrlFromHost</a>(<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> * conn, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http1::RequestParserPointer</a> &amp;hp)</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>{</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>    <span class="keywordtype">char</span> *uri = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>    <span class="comment">/* BUG: Squid cannot deal with &#39;*&#39; URLs (RFC2616 5.1.2) */</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *host = hp-&gt;getHostHeaderField()) {</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;scheme = <a class="code hl_class" href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a>).<a class="code hl_function" href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">image</a>();</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> url_sz = scheme.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + strlen(host) + hp-&gt;requestUri().length() + 32;</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        uri = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a>(url_sz, 1));</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>        snprintf(uri, url_sz, <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;://%s&quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a>,</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(scheme),</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>                 host,</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(hp-&gt;requestUri()));</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    }</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>    <span class="keywordflow">return</span> uri;</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>}</div>
</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span> </div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span><span class="keywordtype">char</span> *</div>
<div class="foldopen" id="foldopen01196" data-start="{" data-end="}">
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"><a class="line" href="classConnStateData.html#a18114504b3f8a86a67e0dc006e8309b4"> 1196</a></span><a class="code hl_function" href="classConnStateData.html#a18114504b3f8a86a67e0dc006e8309b4">ConnStateData::prepareTlsSwitchingURL</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http1::RequestParserPointer</a> &amp;hp)</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>{</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_function" href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">switchedToHttps</a>());</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>    <span class="keywordflow">if</span> (!hp-&gt;requestUri().isEmpty() &amp;&amp; hp-&gt;requestUri()[0] != <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">/* already in good shape */</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span> </div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>    <span class="keywordtype">char</span> *uri = <a class="code hl_function" href="client__side_8cc.html#a738fe2a8ee19820909d5ba8f7f4ca85d">buildUrlFromHost</a>(<span class="keyword">this</span>, hp);</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="keywordflow">if</span> (!uri) {</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a7f762686d33660c311ee33b8545a9759">tlsConnectPort</a>);</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(!<a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>());</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>        <a class="code hl_class" href="classSBuf.html">SBuf</a> useHost;</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#a3b3e9d2ba84a1a8e42cc1088709b1c4f">tlsClientSni</a>().isEmpty())</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>            useHost = <a class="code hl_function" href="classConnStateData.html#a3b3e9d2ba84a1a8e42cc1088709b1c4f">tlsClientSni</a>();</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>            useHost = <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>;</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span> </div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;scheme = <a class="code hl_class" href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a>(<a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a>).<a class="code hl_function" href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">image</a>();</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> url_sz = scheme.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + useHost.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() + hp-&gt;requestUri().length() + 32;</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>        uri = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a>(url_sz, 1));</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>        snprintf(uri, url_sz, <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;://&quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;:%hu&quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a>,</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(scheme),</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(useHost),</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>                 *<a class="code hl_variable" href="classConnStateData.html#a7f762686d33660c311ee33b8545a9759">tlsConnectPort</a>,</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(hp-&gt;requestUri()));</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    }</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>    <span class="keywordflow">if</span> (uri)</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;TLS switching host rewrite: &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>    <span class="keywordflow">return</span> uri;</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>}</div>
</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span> </div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span><span class="keyword">static</span> <span class="keywordtype">char</span> *</div>
<div class="foldopen" id="foldopen01230" data-start="{" data-end="}">
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a0f7eff99f419b5281561a72ef2635824"> 1230</a></span><a class="code hl_function" href="client__side_8cc.html#a0f7eff99f419b5281561a72ef2635824">prepareTransparentURL</a>(<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> * conn, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http1::RequestParserPointer</a> &amp;hp)</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>{</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <span class="comment">// TODO Must() on URI !empty when the parser supports throw. For now avoid assert().</span></div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="keywordflow">if</span> (!hp-&gt;requestUri().isEmpty() &amp;&amp; hp-&gt;requestUri()[0] != <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">/* already in good shape */</span></div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span> </div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    <span class="keywordtype">char</span> *uri = <a class="code hl_function" href="client__side_8cc.html#a738fe2a8ee19820909d5ba8f7f4ca85d">buildUrlFromHost</a>(conn, hp);</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>    <span class="keywordflow">if</span> (!uri) {</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>        <span class="comment">/* Put the local socket IP address as the hostname.  */</span></div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>        <span class="keyword">static</span> <span class="keywordtype">char</span> ipbuf[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>        conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#a2696806ea5ee1a73dbe87849a7d43539">toHostStr</a>(ipbuf,<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>);</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;scheme = <a class="code hl_class" href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a>).<a class="code hl_function" href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">image</a>();</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> url_sz = <span class="keyword">sizeof</span>(ipbuf) + hp-&gt;requestUri().length() + 32;</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>        uri = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a>(url_sz, 1));</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>        snprintf(uri, url_sz, <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;://%s:%d&quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a>,</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>                 <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(scheme),</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>                 ipbuf, conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>(), <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(hp-&gt;requestUri()));</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>    }</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span> </div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    <span class="keywordflow">if</span> (uri)</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;TRANSPARENT REWRITE: &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>    <span class="keywordflow">return</span> uri;</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>}</div>
</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span> </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span><a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *</div>
<div class="foldopen" id="foldopen01255" data-start="{" data-end="}">
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"><a class="line" href="classConnStateData.html#a25dda3837772dfe4efcec4c88865265c"> 1255</a></span><a class="code hl_function" href="classConnStateData.html#a25dda3837772dfe4efcec4c88865265c">ConnStateData::parseHttpRequest</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http1::RequestParserPointer</a> &amp;hp)</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>{</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>    <span class="comment">/* Attempt to parse the first line; this will define where the method, url, version and header begin */</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>    {</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(hp);</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span> </div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a6c10d6b2f8d50beaf9d32a6790c80a40">preservingClientData_</a>)</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>            <a class="code hl_variable" href="classConnStateData.html#a91a16739a0d5277fb2af4f54f5baf5f5">preservedClientData</a> = <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>;</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span> </div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> parsedOk = hp-&gt;parse(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>);</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span> </div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>        <span class="comment">// sync the buffers after parsing.</span></div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>        <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a> = hp-&gt;remaining();</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span> </div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>        <span class="keywordflow">if</span> (hp-&gt;needsMoreData()) {</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Incomplete request, waiting for end of request line&quot;</span>);</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>        }</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span> </div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>        <span class="keywordflow">if</span> (!parsedOk) {</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> tooBig =</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>                hp-&gt;parseStatusCode == <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722af1ac1084571f6b8e40506939e193de66">Http::scRequestHeaderFieldsTooLarge</a> ||</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>                hp-&gt;parseStatusCode == <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722a108a3f73860c17d6581b0fbddb4d2e1e">Http::scUriTooLong</a>;</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>            <span class="keyword">auto</span> result = <a class="code hl_function" href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">abortRequestParsing</a>(</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>                              tooBig ? <span class="stringliteral">&quot;error:request-too-large&quot;</span> : <span class="stringliteral">&quot;error:invalid-request&quot;</span>);</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>            <span class="comment">// assume that remaining leftovers belong to this bad request</span></div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>                <a class="code hl_function" href="classConnStateData.html#a311713f0ae2a89a60327696b2f1188f4">consumeInput</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>            <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>        }</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>    }</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span> </div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>    <span class="comment">/* We know the whole request is in parser now */</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(11, 2, <span class="stringliteral">&quot;HTTP Client &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(11, 2, <span class="stringliteral">&quot;HTTP Client REQUEST:\n---------\n&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>           hp-&gt;method() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;requestUri() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;messageProtocol() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>           hp-&gt;mimeHeader() &lt;&lt;</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>           <span class="stringliteral">&quot;\n----------&quot;</span>);</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span> </div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>    <span class="comment">/* deny CONNECT via accelerated ports */</span></div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>    <span class="keywordflow">if</span> (hp-&gt;method() == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a8ecea905b7d7b048a979e590cb11b9d7">Http::METHOD_CONNECT</a> &amp;&amp; <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a> != <span class="keyword">nullptr</span> &amp;&amp; <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;flags.accelSurrogate) {</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: CONNECT method received on &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a> &lt;&lt; <span class="stringliteral">&quot; Accelerator port &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;s.port());</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: for request: &quot;</span> &lt;&lt; hp-&gt;method() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;requestUri() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;messageProtocol());</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>        hp-&gt;parseStatusCode = <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722a963543f2bd6f3e4feb67e79b90876597">Http::scMethodNotAllowed</a>;</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">abortRequestParsing</a>(<span class="stringliteral">&quot;error:method-not-allowed&quot;</span>);</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>    }</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span> </div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>    <span class="comment">/* HTTP/2 connection magic prefix starts with &quot;PRI &quot;.</span></div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span><span class="comment">     * Deny &quot;PRI&quot; method if used in HTTP/1.x or 0.9 versions.</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span><span class="comment">     * If seen it signals a broken client or proxy has corrupted the traffic.</span></div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span><span class="comment">     */</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>    <span class="keywordflow">if</span> (hp-&gt;method() == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a555311cec8eb7016770ccd41b4ddc024">Http::METHOD_PRI</a> &amp;&amp; hp-&gt;messageProtocol() &lt; <a class="code hl_function" href="namespaceHttp.html#a8f5de7a6ddd395e9aaf0dffd043c2276">Http::ProtocolVersion</a>(2,0)) {</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: PRI method received on &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a> &lt;&lt; <span class="stringliteral">&quot; port &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;s.port());</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: for request: &quot;</span> &lt;&lt; hp-&gt;method() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;requestUri() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;messageProtocol());</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>        hp-&gt;parseStatusCode = <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722a963543f2bd6f3e4feb67e79b90876597">Http::scMethodNotAllowed</a>;</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">abortRequestParsing</a>(<span class="stringliteral">&quot;error:method-not-allowed&quot;</span>);</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>    }</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span> </div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>    <span class="keywordflow">if</span> (hp-&gt;method() == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a17353570f8312493328aa9ade6ff514a">Http::METHOD_NONE</a>) {</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: Unsupported method: &quot;</span> &lt;&lt; hp-&gt;method() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;requestUri() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hp-&gt;messageProtocol());</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>        hp-&gt;parseStatusCode = <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722a963543f2bd6f3e4feb67e79b90876597">Http::scMethodNotAllowed</a>;</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">abortRequestParsing</a>(<span class="stringliteral">&quot;error:unsupported-request-method&quot;</span>);</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>    }</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span> </div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>    <span class="comment">// Process headers after request line</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;complete request received. &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>           <span class="stringliteral">&quot;prefix_sz = &quot;</span> &lt;&lt; hp-&gt;messageHeaderSize() &lt;&lt;</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>           <span class="stringliteral">&quot;, request-line-size=&quot;</span> &lt;&lt; hp-&gt;firstLineSize() &lt;&lt;</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>           <span class="stringliteral">&quot;, mime-header-size=&quot;</span> &lt;&lt; hp-&gt;headerBlockSize() &lt;&lt;</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>           <span class="stringliteral">&quot;, mime header block:\n&quot;</span> &lt;&lt; hp-&gt;mimeHeader() &lt;&lt; <span class="stringliteral">&quot;\n----------&quot;</span>);</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span> </div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>    <span class="comment">/* Ok, all headers are received */</span></div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = <span class="keyword">new</span> <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span> </div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>    http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a88642d6f6a181e20927a9e54cabf3c91">req_sz</a> = hp-&gt;messageHeaderSize();</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>    <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *result = <span class="keyword">new</span> <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>, http);</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span> </div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>    <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> tempBuffer;</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a> = result-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#aa13355bfcaa6f65caf4b0a64765d5968">reqbuf</a>;</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> = <a class="code hl_define" href="http_2forward_8h.html#a196f6d12d102aebcc7a2778bea3e6b19">HTTP_REQBUF_SZ</a>;</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span> </div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>    <a class="code hl_class" href="classRefCount.html">ClientStreamData</a> newServer = <span class="keyword">new</span> <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a>(http);</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>    <a class="code hl_class" href="classRefCount.html">ClientStreamData</a> newClient = result;</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>    <a class="code hl_function" href="group__ClientStreamInternal.html#ga73019262f28c27affc3937cac3441a43">clientStreamInit</a>(&amp;http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">client_stream</a>, <a class="code hl_variable" href="client__side_8h.html#ae73f7b10b6c2bd55c5f96c9d62839e8d">clientGetMoreData</a>, <a class="code hl_variable" href="client__side_8h.html#ab806362f706a7b39732957bb45e3c2df">clientReplyDetach</a>,</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>                     <a class="code hl_variable" href="client__side_8h.html#a3d42a7ece901f14e6ec973a0feb096e1">clientReplyStatus</a>, newServer, <a class="code hl_variable" href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a>,</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>                     <a class="code hl_variable" href="client__side_8h.html#a2800047b5d0d3e31d1739cd35378f4ab">clientSocketDetach</a>, newClient, tempBuffer);</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span> </div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>    <span class="comment">/* set url */</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33,5, <span class="stringliteral">&quot;Prepare absolute URL from &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>           (<a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>()?<span class="stringliteral">&quot;intercept&quot;</span>:(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;flags.accelSurrogate ? <span class="stringliteral">&quot;accel&quot;</span>:<span class="stringliteral">&quot;&quot;</span>)));</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>    <span class="comment">/* Rewrite the URL in transparent or accelerator mode */</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>    <span class="comment">/* NP: there are several cases to traverse here:</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span><span class="comment">     *  - standard mode (forward proxy)</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span><span class="comment">     *  - transparent mode (TPROXY)</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span><span class="comment">     *  - transparent mode with failures</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span><span class="comment">     *  - intercept mode (NAT)</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span><span class="comment">     *  - intercept mode with failures</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span><span class="comment">     *  - accelerator mode (reverse proxy)</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span><span class="comment">     *  - internal relative-URL</span></div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span><span class="comment">     *  - mixed combos of the above with internal URL</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span><span class="comment">     *  - remote interception with PROXY protocol</span></div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span><span class="comment">     *  - remote reverse-proxy with PROXY protocol</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span><span class="comment">     */</span></div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">switchedToHttps</a>()) {</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>        http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a> = <a class="code hl_function" href="classConnStateData.html#a18114504b3f8a86a67e0dc006e8309b4">prepareTlsSwitchingURL</a>(hp);</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>()) {</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        <span class="comment">/* intercept or transparent mode, properly working with no failures */</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>        http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a> = <a class="code hl_function" href="client__side_8cc.html#a0f7eff99f419b5281561a72ef2635824">prepareTransparentURL</a>(<span class="keyword">this</span>, hp);</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="internal_8cc.html#a76eaf4388b308548216736a932f7ec44">internalCheck</a>(hp-&gt;requestUri())) { <span class="comment">// NP: only matches relative-URI</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>        <span class="comment">/* internal URL mode */</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>        <span class="comment">// XXX: By prepending our name and port, we create an absolute URL</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>        <span class="comment">// that may mismatch the (yet unparsed) Host header in the request.</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>        http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a> = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(<a class="code hl_function" href="internal_8cc.html#a628c7ecf666dc0f0f708f2a37fb4fd7a">internalLocalUri</a>(<span class="keyword">nullptr</span>, hp-&gt;requestUri()));</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span> </div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;flags.accelSurrogate) {</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>        <span class="comment">/* accelerator mode */</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>        http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a> = <a class="code hl_function" href="client__side_8cc.html#aacbb7e426f92f53cf8fe185fd095f4b9">prepareAcceleratedURL</a>(<span class="keyword">this</span>, hp);</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>        http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#aaa05fd2e87baa36553d2039aa92901a3">flags</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Flags.html#a409fd4d5e3b72f06df2921bd417e0a5c">accel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>    }</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span> </div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>    <span class="keywordflow">if</span> (!http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a>) {</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>        <span class="comment">/* No special rewrites have been applied above, use the</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span><span class="comment">         * requested url. may be rewritten later, so make extra room */</span></div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>        <span class="keywordtype">int</span> url_sz = hp-&gt;requestUri().length() + <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a10945ff98ac5fedfaac23c4b8f4f2512">appendDomainLen</a> + 5;</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>        http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a> = (<span class="keywordtype">char</span> *)<a class="code hl_function" href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a>(url_sz, 1);</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>        <a class="code hl_function" href="SBuf_8h.html#a826aafc8068f24cb125e700733cd2bee">SBufToCstring</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a>, hp-&gt;requestUri());</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    }</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span> </div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>    result-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#a720b33b5850e89ebda3011c853c20f9f">flags</a>.<a class="code hl_variable" href="classHttp_1_1Stream.html#a19ce29fe9e19e5a7ea0f5dedc37895c2">parsed_ok</a> = 1;</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>}</div>
</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span> </div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01389" data-start="{" data-end="}">
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"><a class="line" href="classConnStateData.html#ac5a3dd64c021c6dfacdb86af0b3e90a6"> 1389</a></span><a class="code hl_function" href="classConnStateData.html#ac5a3dd64c021c6dfacdb86af0b3e90a6">ConnStateData::shouldCloseOnEof</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>() &amp;&amp; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;yes, without active requests and unparsed input&quot;</span>);</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>    }</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span> </div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a89bec7bc02d66eb2ab65c74c3f6b13ac">onoff</a>.<a class="code hl_variable" href="classSquidConfig.html#aeb41be9b7b69278da79a47837a0db41c">half_closed_clients</a>) {</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;yes, without half_closed_clients&quot;</span>);</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    }</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span> </div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>    <span class="comment">// Squid currently tries to parse (possibly again) a partially received</span></div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>    <span class="comment">// request after an EOF with half_closed_clients. To give that last parse in</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>    <span class="comment">// afterClientRead() a chance, we ignore partially parsed requests here.</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;no, honoring half_closed_clients&quot;</span>);</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>}</div>
</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span> </div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01409" data-start="{" data-end="}">
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"><a class="line" href="classConnStateData.html#a311713f0ae2a89a60327696b2f1188f4"> 1409</a></span><a class="code hl_function" href="classConnStateData.html#a311713f0ae2a89a60327696b2f1188f4">ConnStateData::consumeInput</a>(<span class="keyword">const</span> <span class="keywordtype">size_t</span> byteCount)</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>{</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(byteCount &gt; 0 &amp;&amp; byteCount &lt;= <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>    <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a27c3dd8867d72547428ebb9de5894eeb">consume</a>(byteCount);</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;inBuf has &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &lt;&lt; <span class="stringliteral">&quot; unused bytes&quot;</span>);</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>}</div>
</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span> </div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01417" data-start="{" data-end="}">
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"><a class="line" href="classConnStateData.html#a31ff1f7aab0f5cb374c9d34d848eb7e3"> 1417</a></span><a class="code hl_function" href="classConnStateData.html#a31ff1f7aab0f5cb374c9d34d848eb7e3">ConnStateData::clientAfterReadingRequests</a>()</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>{</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>    <span class="comment">// Were we expecting to read more request body from half-closed connection?</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#aec04ec17951deaf98852074bef3c171b">mayNeedToReadMoreBody</a>() &amp;&amp; <a class="code hl_function" href="comm_8h.html#ad684c6dba13b91c274ad5332508e735b">commIsHalfClosed</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>)) {</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;truncated body: closing half-closed &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>    }</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span> </div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore)</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>        <a class="code hl_function" href="classServer.html#a12cdf2616768902693acb3896283d29b">readSomeData</a>();</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>}</div>
</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span> </div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01431" data-start="{" data-end="}">
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"><a class="line" href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb"> 1431</a></span><a class="code hl_function" href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb">ConnStateData::quitAfterError</a>(<a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request)</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>{</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>    <span class="comment">// From HTTP p.o.v., we do not have to close after every error detected</span></div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>    <span class="comment">// at the client-side, but many such errors do require closure and the</span></div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>    <span class="comment">// client-side code is bad at handling errors so we play it safe.</span></div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>    <span class="keywordflow">if</span> (request)</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>        request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#a8014770f9112fe68a085fc4ecec68680">proxyKeepalive</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>    <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33,4, <span class="stringliteral">&quot;Will close after error: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>}</div>
</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span> </div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="foldopen" id="foldopen01443" data-start="{" data-end="}">
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"><a class="line" href="classConnStateData.html#a8d4968d64111a5355f5cbcd8aaa154c6"> 1443</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classConnStateData.html#a8d4968d64111a5355f5cbcd8aaa154c6">ConnStateData::serveDelayedError</a>(<a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *context)</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>{</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = context-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#afcdcad504145430c704db2efe6b5de17">http</a>;</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span> </div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>)</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span> </div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a51cb62b4cccfa1e6d1e0b9f97bdb76cd">entry</a>);</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>    <span class="comment">// Did we create an error entry while processing CONNECT?</span></div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a51cb62b4cccfa1e6d1e0b9f97bdb76cd">entry</a>-&gt;<a class="code hl_function" href="classStoreEntry.html#ae4dc05b6c5ca398130c0a155156592d2">isEmpty</a>()) {</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>        <a class="code hl_function" href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb">quitAfterError</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>);</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span> </div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>        <span class="comment">// Get the saved error entry and send it to the client by replacing the</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>        <span class="comment">// ClientHttpRequest store entry with it.</span></div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>        <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<a class="code hl_struct" href="structnode.html">node</a> = context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">getClientReplyContext</a>();</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>        <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *repContext = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(repContext);</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Responding with delated error for &quot;</span> &lt;&lt; http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a>);</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>        repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#a54642fc1f8d38e1860d4e945d820889d">setReplyToStoreEntry</a>(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a51cb62b4cccfa1e6d1e0b9f97bdb76cd">entry</a>, <span class="stringliteral">&quot;delayed SslBump error&quot;</span>);</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span> </div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>        <span class="comment">// Get error details from the fake certificate-peeking request.</span></div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>        http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a>.<a class="code hl_function" href="classError.html#a6e163b6a5a08adf7f23ea363d8935ee3">update</a>(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a>);</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>        context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#afcc7ea64a46ddbdddcfb3d58529499ea">pullData</a>();</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>    }</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span> </div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>    <span class="comment">// In bump-server-first mode, we have not necessarily seen the intended</span></div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>    <span class="comment">// server name at certificate-peeking time. Check for domain mismatch now,</span></div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>    <span class="comment">// when we can extract the intended name from the bumped HTTP request.</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code hl_class" href="classSecurity_1_1LockingPointer.html">Security::CertPointer</a> &amp;srvCert = <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#afa21f04f6d7072a8b541732790a0ec18">serverCert</a>) {</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>        <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>        <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_variable" href="classConnStateData.html#aed9e73994565e139000ffcd900575fd9">host</a> = request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#a6be4200ae143482153d6c03a63e2c0e1">parsedHost</a>();</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#aed9e73994565e139000ffcd900575fd9">host</a> &amp;&amp; <a class="code hl_function" href="namespaceSsl.html#a0e1e8752a0a2eea39f2ce2f2b60fde2d">Ssl::HasSubjectName</a>(*srvCert, *<a class="code hl_variable" href="classConnStateData.html#aed9e73994565e139000ffcd900575fd9">host</a>)) {</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;certificate matches requested host: &quot;</span> &lt;&lt; *<a class="code hl_variable" href="classConnStateData.html#aed9e73994565e139000ffcd900575fd9">host</a>);</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;SQUID_X509_V_ERR_DOMAIN_MISMATCH: Certificate &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>                   <span class="stringliteral">&quot;does not match request target &quot;</span> &lt;&lt; <a class="code hl_function" href="IoManip_8h.html#afb10fe715d55bc0f31985b3de7269ce0">RawPointer</a>(<a class="code hl_variable" href="classConnStateData.html#aed9e73994565e139000ffcd900575fd9">host</a>));</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>            <span class="keywordtype">bool</span> allowDomainMismatch = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a0e2640ef960e9c60996095d393cfd9c5">ssl_client</a>.<a class="code hl_variable" href="classSquidConfig.html#a747b46f46f25817607b0a26f00aae709">cert_error</a>) {</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>                <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> check(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a0e2640ef960e9c60996095d393cfd9c5">ssl_client</a>.<a class="code hl_variable" href="classSquidConfig.html#a747b46f46f25817607b0a26f00aae709">cert_error</a>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>                <span class="keyword">const</span> <span class="keyword">auto</span> sslErrors = std::make_unique&lt;Security::CertErrors&gt;(<a class="code hl_class" href="classSecurity_1_1CertError.html">Security::CertError</a>(<a class="code hl_enumvalue" href="security_2forward_8h.html#ad63240694c6dc2a28c24bfc2db90ad7aa32fb3a7ce3b6de31cc7c206438c129ab">SQUID_X509_V_ERR_DOMAIN_MISMATCH</a>, srvCert));</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>                check.<a class="code hl_variable" href="classACLFilledChecklist.html#ab97626f356bacd93806236efcc00f737">sslErrors</a> = sslErrors.get();</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>                <a class="code hl_function" href="client__side_8cc.html#acabcacffff4309ce2ac0aa3252eaf2ba">clientAclChecklistFill</a>(check, http);</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>                allowDomainMismatch = check.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>().<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>();</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>            }</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span> </div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>            <span class="keywordflow">if</span> (!allowDomainMismatch) {</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>                <a class="code hl_function" href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb">quitAfterError</a>(request);</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span> </div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>                <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<a class="code hl_struct" href="structnode.html">node</a> = context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">getClientReplyContext</a>();</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>                <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *repContext = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>                <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a> (repContext);</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span> </div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>                request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a5c031f584be4a77277cccd49b0d4cea1">hier</a> = <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#a5c031f584be4a77277cccd49b0d4cea1">hier</a>;</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span> </div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>                <span class="comment">// Create an error object and fill it</span></div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>                <span class="keyword">const</span> <span class="keyword">auto</span> err = <span class="keyword">new</span> <a class="code hl_class" href="classErrorState.html">ErrorState</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa298ac2b8812fe165e53492b830384bc5">ERR_SECURE_CONNECT_FAIL</a>, <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722afce0b1a37bd52da9d6eeac5a0a37743c">Http::scServiceUnavailable</a>, request, http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>);</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>                err-&gt;src_addr = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>;</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>                <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Security::ErrorDetail::Pointer</a> errDetail = <span class="keyword">new</span> <a class="code hl_class" href="classSecurity_1_1ErrorDetail.html">Security::ErrorDetail</a>(</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>                    <a class="code hl_enumvalue" href="security_2forward_8h.html#ad63240694c6dc2a28c24bfc2db90ad7aa32fb3a7ce3b6de31cc7c206438c129ab">SQUID_X509_V_ERR_DOMAIN_MISMATCH</a>,</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>                    srvCert, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>                <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa298ac2b8812fe165e53492b830384bc5">ERR_SECURE_CONNECT_FAIL</a>, errDetail);</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>                repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#aefdedf444de122be303a2c56dc7ef1a9">setReplyToError</a>(request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a>, err);</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>                <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#afcdcad504145430c704db2efe6b5de17">http</a>-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#a4d7061fef2fd2cd55f1cc534cb43f040">offset</a> == 0);</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>                context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#afcc7ea64a46ddbdddcfb3d58529499ea">pullData</a>();</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>            }</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>        }</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>    }</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span> </div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>}</div>
</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span><span class="preprocessor">#endif </span><span class="comment">// USE_OPENSSL</span></div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span> </div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01521" data-start="{" data-end="}">
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"><a class="line" href="classConnStateData.html#ae85c6fd07a8415d08b9672de277ee24e"> 1521</a></span><a class="code hl_function" href="classConnStateData.html#ae85c6fd07a8415d08b9672de277ee24e">ConnStateData::tunnelOnError</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1a">err_type</a> requestError)</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>{</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#ac5b7d100001f066494a2fa4d6d39d994">on_unsupported_protocol</a>) {</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;disabled; send error: &quot;</span> &lt;&lt; requestError);</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>    }</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span> </div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a6c10d6b2f8d50beaf9d32a6790c80a40">preservingClientData_</a>) {</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;may have forgotten client data; send error: &quot;</span> &lt;&lt; requestError);</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>    }</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span> </div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>    <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> checklist(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#ac5b7d100001f066494a2fa4d6d39d994">on_unsupported_protocol</a>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>    checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#a158f644bfa0d9e67cfd8bee15b6359e9">requestErrorType</a> = requestError;</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>    <a class="code hl_function" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">fillChecklist</a>(checklist);</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;answer = checklist.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>();</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>    <span class="keywordflow">if</span> (answer.allowed() &amp;&amp; answer.kind == 1) {</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;Request will be tunneled to server&quot;</span>);</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>        <span class="keyword">const</span> <span class="keyword">auto</span> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>        <span class="keyword">const</span> <span class="keyword">auto</span> http = context ? context-&gt;http : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>        <span class="keyword">const</span> <span class="keyword">auto</span> request = http ? http-&gt;request : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>        <span class="keywordflow">if</span> (context)</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>            context-&gt;finished(); <span class="comment">// Will remove from pipeline queue</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>        <a class="code hl_function" href="namespaceComm.html#ae3a7e8f0df297346e84f0e9943033a3e">Comm::SetSelect</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <a class="code hl_define" href="defines_8h.html#a0d83ade59d0c0d3c0f71c50bc14e314e">COMM_SELECT_READ</a>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, 0);</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a49651ee9330d4206ff880a3fe93ee726">initiateTunneledRequest</a>(request, <span class="stringliteral">&quot;unknown-protocol&quot;</span>, <a class="code hl_variable" href="classConnStateData.html#a91a16739a0d5277fb2af4f54f5baf5f5">preservedClientData</a>);</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>    }</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;denied; send error: &quot;</span> &lt;&lt; requestError);</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>}</div>
</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span> </div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01552" data-start="{" data-end="}">
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02"> 1552</a></span><a class="code hl_function" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a>(<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *conn, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> &amp;request)</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>{</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span><span class="comment">     * DPW 2007-05-18</span></div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span><span class="comment">     * Moved the TCP_RESET feature from clientReplyContext::sendMoreData</span></div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span><span class="comment">     * to here because calling comm_reset_close() causes http to</span></div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span><span class="comment">     * be freed before accessing.</span></div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span><span class="comment">     */</span></div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>    <span class="keywordflow">if</span> (request != <span class="keyword">nullptr</span> &amp;&amp; request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#abb9e233ddb38e78e34478b9222f0d849">resetTcp</a> &amp;&amp; <a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>)) {</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;Sending TCP RST on &quot;</span> &lt;&lt; conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>        conn-&gt;<a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.<a class="code hl_variable" href="classConnStateData.html#ac049eac9adf044f1310c48e058778f6d">readMore</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>        <a class="code hl_function" href="comm_8cc.html#af74f102f673b39ad806aafefdd1e948c">comm_reset_close</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>    }</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>}</div>
</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span> </div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01568" data-start="{" data-end="}">
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a543c6b42543c68733190d18e2a933a58"> 1568</a></span><a class="code hl_function" href="client__side_8cc.html#a543c6b42543c68733190d18e2a933a58">clientProcessRequest</a>(<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *conn, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http1::RequestParserPointer</a> &amp;hp, <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *context)</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>{</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = context-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#afcdcad504145430c704db2efe6b5de17">http</a>;</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>    <span class="keywordtype">bool</span> mustReplyToOptions = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>    <span class="keywordtype">bool</span> expectBody = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span> </div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>    <span class="comment">// We already have the request parsed and checked, so we</span></div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>    <span class="comment">// only need to go through the final body/conn setup to doCallouts().</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>);</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>    <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span> </div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    <span class="comment">// temporary hack to avoid splitting this huge function with sensitive code</span></div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> isFtp = !hp;</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span> </div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>    <span class="comment">// Some blobs below are still HTTP-specific, but we would have to rewrite</span></div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>    <span class="comment">// this entire function to remove them from the FTP code path. Connection</span></div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>    <span class="comment">// setup and body_pipe preparation blobs are needed for FTP.</span></div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span> </div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>    request-&gt;<a class="code hl_function" href="classHttpRequest.html#afa44c5ce6b6cce602572b33ca6456235">manager</a>(conn, http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>);</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span> </div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#a0e7db730c27abb7eac3b676961773797">accelerated</a> = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#aaa05fd2e87baa36553d2039aa92901a3">flags</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Flags.html#a409fd4d5e3b72f06df2921bd417e0a5c">accel</a>;</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#abbde600374891ccc540eea4812414b69">sslBumped</a>=conn-&gt;<a class="code hl_function" href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">switchedToHttps</a>();</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>    <span class="comment">// TODO: decouple http-&gt;flags.accel from request-&gt;flags.sslBumped</span></div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#af02e789de94255ee89cbfb1f960ccba8">noDirect</a> = (request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#a0e7db730c27abb7eac3b676961773797">accelerated</a> &amp;&amp; !request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#abbde600374891ccc540eea4812414b69">sslBumped</a>) ?</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>                              !conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;allow_direct : 0;</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>    request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a332610b0eddfe955427b9efcafcc80ea">sources</a> |= isFtp ? <a class="code hl_enumvalue" href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9aa950ffb6dbd1a9c7063b6a645803cf05">Http::Message::srcFtp</a> :</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>                        ((request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#abbde600374891ccc540eea4812414b69">sslBumped</a> || conn-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;transport.protocol == <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca0f99ccafd63891be16873f9f2abe94ba">AnyP::PROTO_HTTPS</a>) ? <a class="code hl_enumvalue" href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9a5a794b7b856a3aefb5eb5c1278bc2856">Http::Message::srcHttps</a> : <a class="code hl_enumvalue" href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9a0261d7de1b407ee2d9211e840b05be94">Http::Message::srcHttp</a>);</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span><span class="preprocessor">#if USE_AUTH</span></div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>    <span class="keywordflow">if</span> (request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#abbde600374891ccc540eea4812414b69">sslBumped</a>) {</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>        <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_function" href="classConnStateData.html#a4703123fe8d180f68321411d26ceb736">getAuth</a>() != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>            request-&gt;<a class="code hl_variable" href="classHttpRequest.html#ac498f2030321d6bc845b115a5cabc6d1">auth_user_request</a> = conn-&gt;<a class="code hl_function" href="classConnStateData.html#a4703123fe8d180f68321411d26ceb736">getAuth</a>();</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>    }</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span> </div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>    http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a68e1aa2eaed3852cef68f86d4a1865c2">checkForInternalAccess</a>();</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span> </div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>    <span class="keywordflow">if</span> (!isFtp) {</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>        <span class="comment">// XXX: for non-HTTP messages instantiate a different Http::Message child type</span></div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>        <span class="comment">// for now Squid only supports HTTP requests</span></div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>        <span class="keyword">const</span> <a class="code hl_class" href="classAnyP_1_1ProtocolVersion.html">AnyP::ProtocolVersion</a> &amp;http_ver = hp-&gt;messageProtocol();</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#afcb0c1d278e61a1379032790c427788d">http_ver</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a> == http_ver.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a>);</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>        request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#afcb0c1d278e61a1379032790c427788d">http_ver</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a3df69d890d2069fb76c68f9535e169f5">major</a> = http_ver.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a3df69d890d2069fb76c68f9535e169f5">major</a>;</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#afcb0c1d278e61a1379032790c427788d">http_ver</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#aba0b2b69fdc1345faafffda66a093667">minor</a> = http_ver.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#aba0b2b69fdc1345faafffda66a093667">minor</a>;</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>    }</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span> </div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>    mustReplyToOptions = (request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a> == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a4fbb358ee66d6fe96e79cb8cf49b260a">Http::METHOD_OPTIONS</a>) &amp;&amp;</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>                         (request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#abf9ae83ecee9c6ee5de511131993567b">getInt64</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a78311c3bedd99c69c01b5ada747f1de4">Http::HdrType::MAX_FORWARDS</a>) == 0);</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="Uri_8cc.html#a0aaaea124c22af6f1bc00947934f67f5">urlCheckRequest</a>(request.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>()) || mustReplyToOptions) {</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>        <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<a class="code hl_struct" href="structnode.html">node</a> = context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">getClientReplyContext</a>();</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>        conn-&gt;<a class="code hl_function" href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb">quitAfterError</a>(request.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>        <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *repContext = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a> (repContext);</div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>        repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#aefdedf444de122be303a2c56dc7ef1a9">setReplyToError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa3e1a19ec477c60b1f7cae3af23cfbbfa">ERR_UNSUP_REQ</a>, <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722a3a896c4c837cff6ec3414fcc23adac68">Http::scNotImplemented</a>, <span class="keyword">nullptr</span>,</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>                                    conn, request.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>(), <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#afcdcad504145430c704db2efe6b5de17">http</a>-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#a4d7061fef2fd2cd55f1cc534cb43f040">offset</a> == 0);</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>        context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#afcc7ea64a46ddbdddcfb3d58529499ea">pullData</a>();</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>        <a class="code hl_function" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a>(conn, request);</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>    }</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span> </div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>    <span class="keyword">const</span> <span class="keyword">auto</span> frameStatus = request-&gt;<a class="code hl_function" href="classHttpRequest.html#ad74059f2de350cf5a93ca5acb3909774">checkEntityFraming</a>();</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>    <span class="keywordflow">if</span> (frameStatus != <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722aab61d70dce6e121feb658b24ef1cd815">Http::scNone</a>) {</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>        <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<a class="code hl_struct" href="structnode.html">node</a> = context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">getClientReplyContext</a>();</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>        <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *repContext = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a> (repContext);</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>        conn-&gt;<a class="code hl_function" href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb">quitAfterError</a>(request.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>        repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#aefdedf444de122be303a2c56dc7ef1a9">setReplyToError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aae371804ada2a7013ccba421a120d3fa9">ERR_INVALID_REQ</a>, frameStatus, <span class="keyword">nullptr</span>, conn, request.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>(), <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#afcdcad504145430c704db2efe6b5de17">http</a>-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#a4d7061fef2fd2cd55f1cc534cb43f040">offset</a> == 0);</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>        context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#afcc7ea64a46ddbdddcfb3d58529499ea">pullData</a>();</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>        <a class="code hl_function" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a>(conn, request);</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>    }</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span> </div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>    <a class="code hl_function" href="client__side_8cc.html#aa598a3822a54b412815630007ed6982b">clientSetKeepaliveFlag</a>(http);</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>    <span class="comment">// Let tunneling code be fully responsible for CONNECT requests</span></div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>    <span class="keywordflow">if</span> (http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a> == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a8ecea905b7d7b048a979e590cb11b9d7">Http::METHOD_CONNECT</a>) {</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>        context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#af977ae01fc040b1c42e388726801f749">mayUseConnection</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>        conn-&gt;<a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.<a class="code hl_variable" href="classConnStateData.html#ac049eac9adf044f1310c48e058778f6d">readMore</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>    }</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span> </div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>    <span class="keywordflow">if</span> (conn-&gt;<a class="code hl_function" href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">switchedToHttps</a>() &amp;&amp; conn-&gt;<a class="code hl_function" href="classConnStateData.html#a8d4968d64111a5355f5cbcd8aaa154c6">serveDelayedError</a>(context)) {</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>        <a class="code hl_function" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a>(conn, request);</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>    }</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span> </div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>    <span class="comment">/* Do we expect a request-body? */</span></div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>    <span class="keyword">const</span> <span class="keyword">auto</span> chunked = request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a390f6c5a57abc40cac483a52464a4b8b">chunked</a>();</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>    expectBody = chunked || request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#aa6074e26e4827d7a52e5ae9500c10500">content_length</a> &gt; 0;</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>    <span class="keywordflow">if</span> (!context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#af977ae01fc040b1c42e388726801f749">mayUseConnection</a>() &amp;&amp; expectBody) {</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>        request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#ad9f13ecd98f1ef921791a25163226f39">body_pipe</a> = conn-&gt;<a class="code hl_function" href="classConnStateData.html#aadb0eaf2848509b73859a3bf509efc67">expectRequestBody</a>(</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>                                 chunked ? -1 : request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#aa6074e26e4827d7a52e5ae9500c10500">content_length</a>);</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span> </div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>        <span class="comment">/* Is it too large? */</span></div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>        <span class="keywordflow">if</span> (!chunked &amp;&amp; <span class="comment">// if chunked, we will check as we accumulate</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>                <a class="code hl_function" href="client__side_8cc.html#a766113836f4b2ce05e7dfe662c5d161a">clientIsRequestBodyTooLargeForPolicy</a>(request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#aa6074e26e4827d7a52e5ae9500c10500">content_length</a>)) {</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>            <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<a class="code hl_struct" href="structnode.html">node</a> = context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">getClientReplyContext</a>();</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>            <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *repContext = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a> (repContext);</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>            conn-&gt;<a class="code hl_function" href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb">quitAfterError</a>(request.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>            repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#aefdedf444de122be303a2c56dc7ef1a9">setReplyToError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aab442793281e45c7214a6e3d221b49505">ERR_TOO_BIG</a>,</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>                                        <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722af056fd80f0ad36efe17c794a9ee7a988">Http::scContentTooLarge</a>, <span class="keyword">nullptr</span>,</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>                                        conn, http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#afcdcad504145430c704db2efe6b5de17">http</a>-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">out</a>.<a class="code hl_variable" href="structClientHttpRequest_1_1Out.html#a4d7061fef2fd2cd55f1cc534cb43f040">offset</a> == 0);</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>            context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#afcc7ea64a46ddbdddcfb3d58529499ea">pullData</a>();</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>            <a class="code hl_function" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a>(conn, request);</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>        }</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span> </div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>        <span class="keywordflow">if</span> (!isFtp) {</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>            <span class="comment">// We may stop producing, comm_close, and/or call setReplyToError()</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>            <span class="comment">// below, so quit on errors to avoid http-&gt;doCallouts()</span></div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>            <span class="keywordflow">if</span> (!conn-&gt;<a class="code hl_function" href="classConnStateData.html#ae0ab21b98499a47569207ea2146ebe80">handleRequestBodyData</a>()) {</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>                <a class="code hl_function" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a>(conn, request);</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>            }</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span> </div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>            <span class="keywordflow">if</span> (!request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#ad9f13ecd98f1ef921791a25163226f39">body_pipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#aa50d7774a478d4dfe72dfb8e9644d29a">productionEnded</a>()) {</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;need more request body&quot;</span>);</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>                context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#af977ae01fc040b1c42e388726801f749">mayUseConnection</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>                <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(conn-&gt;<a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.<a class="code hl_variable" href="classConnStateData.html#ac049eac9adf044f1310c48e058778f6d">readMore</a>);</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>            }</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>        }</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>    }</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span> </div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>    http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ae5d3bde3423ebc7185c259a6ae16efc3">calloutContext</a> = <span class="keyword">new</span> <a class="code hl_class" href="classClientRequestContext.html">ClientRequestContext</a>(http);</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span> </div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>    http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ab992ab634582a805bf248e2e311403e1">doCallouts</a>();</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span> </div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>    <a class="code hl_function" href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a>(conn, request);</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>}</div>
</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span> </div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01702" data-start="{" data-end="}">
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"><a class="line" href="classConnStateData.html#afcb7d56815832d278dabcdf5fc601dcb"> 1702</a></span><a class="code hl_function" href="classConnStateData.html#afcb7d56815832d278dabcdf5fc601dcb">ConnStateData::add</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> &amp;context)</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>{</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, context &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a2a570842f872e93817685f1d576e7375">count</a>() &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_variable" href="classPipeline.html#a349118f98c80d65b033429b2faa2b564">nrequests</a>);</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>) {</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;assigning &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>);</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context);</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context-&gt;http);</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>        context-&gt;http-&gt;updateError(<a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>);</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>        <a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>.<a class="code hl_function" href="classError.html#ad7428d246e004f2aeec1590cf501ec74">clear</a>();</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>    }</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>    <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a60b07fdbb2863d4a32325c84cb724cb4">add</a>(context);</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>}</div>
</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span> </div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span><span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen01716" data-start="{" data-end="}">
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"><a class="line" href="classConnStateData.html#a00681c7edc00b7680dc7e63269434128"> 1716</a></span><a class="code hl_function" href="classConnStateData.html#a00681c7edc00b7680dc7e63269434128">ConnStateData::pipelinePrefetchMax</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>    <span class="comment">// TODO: Support pipelined requests through pinned connections.</span></div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.pinned)</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ad94914cc28bee59463dfefdf9fccd93f">pipeline_max_prefetch</a>;</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>}</div>
</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span> </div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01730" data-start="{" data-end="}">
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"><a class="line" href="classConnStateData.html#abdd47e67edfe3760ed0fffea8d45bc25"> 1730</a></span><a class="code hl_function" href="classConnStateData.html#abdd47e67edfe3760ed0fffea8d45bc25">ConnStateData::concurrentRequestQueueFilled</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> existingRequestCount = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a2a570842f872e93817685f1d576e7375">count</a>();</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span> </div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>    <span class="comment">// default to the configured pipeline size.</span></div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>    <span class="comment">// add 1 because the head of pipeline is counted in concurrent requests and not prefetch queue</span></div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> internalRequest = (<a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>() &amp;&amp; <a class="code hl_variable" href="classConnStateData.html#abca96f1a2792ad7128762d1dac280cd6">sslBumpMode</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aaa41037e8896833d425589e945cbb064">Ssl::bumpSplice</a>) ? 1 : 0;</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> internalRequest = 0;</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> concurrentRequestLimit = <a class="code hl_function" href="classConnStateData.html#a00681c7edc00b7680dc7e63269434128">pipelinePrefetchMax</a>() + 1 + internalRequest;</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span> </div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>    <span class="comment">// when queue filled already we can&#39;t add more.</span></div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>    <span class="keywordflow">if</span> (existingRequestCount &gt;= concurrentRequestLimit) {</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; max concurrent requests reached (&quot;</span> &lt;&lt; concurrentRequestLimit &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; deferring new request until one is done&quot;</span>);</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>    }</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span> </div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>}</div>
</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span> </div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01759" data-start="{" data-end="}">
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"><a class="line" href="classConnStateData.html#afb1bfcf4b5632bc9be148767f1b1dedb"> 1759</a></span><a class="code hl_function" href="classConnStateData.html#afb1bfcf4b5632bc9be148767f1b1dedb">ConnStateData::proxyProtocolValidateClient</a>()</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>{</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#adcc196a756093097e03b50d1a796a7ef">proxyProtocol</a>)</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a8cd416724951295b4758f7a5921abfc1">proxyProtocolError</a>(<span class="stringliteral">&quot;PROXY client not permitted by default ACL&quot;</span>);</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span> </div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>    <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> ch(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#adcc196a756093097e03b50d1a796a7ef">proxyProtocol</a>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>    <a class="code hl_function" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">fillChecklist</a>(ch);</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>    <span class="keywordflow">if</span> (!ch.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>().<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>())</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a8cd416724951295b4758f7a5921abfc1">proxyProtocolError</a>(<span class="stringliteral">&quot;PROXY client not permitted by ACLs&quot;</span>);</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span> </div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>}</div>
</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span> </div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01778" data-start="{" data-end="}">
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"><a class="line" href="classConnStateData.html#a8cd416724951295b4758f7a5921abfc1"> 1778</a></span><a class="code hl_function" href="classConnStateData.html#a8cd416724951295b4758f7a5921abfc1">ConnStateData::proxyProtocolError</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>{</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>    <span class="keywordflow">if</span> (msg) {</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>        <span class="comment">// This is important to know, but maybe not so much that flooding the log is okay.</span></div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span><span class="preprocessor">#if QUIET_PROXY_PROTOCOL</span></div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>        <span class="comment">// display the first of every 32 occurrences at level 1, the others at level 2.</span></div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>        <span class="keyword">static</span> uint8_t hide = 0;</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, (hide++ % 32 == 0 ? <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a> : 2), msg &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, msg &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>        <a class="code hl_function" href="classAsyncJob.html#a49969a02734d2cec84725dc683c180aa">mustStop</a>(msg);</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>    }</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>}</div>
</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span> </div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01799" data-start="{" data-end="}">
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"><a class="line" href="classConnStateData.html#adfaf6853b9b2b580e8ba6f45292a07a3"> 1799</a></span><a class="code hl_function" href="classConnStateData.html#adfaf6853b9b2b580e8ba6f45292a07a3">ConnStateData::parseProxyProtocolHeader</a>()</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>{</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>        <span class="keyword">const</span> <span class="keyword">auto</span> parsed = <a class="code hl_function" href="namespaceProxyProtocol.html#a276022b31f1ffa89440172bfcf0285b3">ProxyProtocol::Parse</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>);</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>        <a class="code hl_variable" href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">proxyProtocolHeader_</a> = parsed.header;</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<span class="keywordtype">bool</span>(<a class="code hl_variable" href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">proxyProtocolHeader_</a>));</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>        <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a27c3dd8867d72547428ebb9de5894eeb">consume</a>(parsed.size);</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>        <a class="code hl_variable" href="classConnStateData.html#ae3fb2cba948d6b47e86e6464a96b1191">needProxyProtocolHeader_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">proxyProtocolHeader_</a>-&gt;hasForwardedAddresses()) {</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>            <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a> = <a class="code hl_variable" href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">proxyProtocolHeader_</a>-&gt;destinationAddress;</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>            <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a> = <a class="code hl_variable" href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">proxyProtocolHeader_</a>-&gt;sourceAddress;</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>            <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">flags</a> &amp; <a class="code hl_define" href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a>))</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>                <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">flags</a> ^= <a class="code hl_define" href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a>; <span class="comment">// prevent TPROXY spoofing of this new IP.</span></div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;PROXY/&quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">proxyProtocolHeader_</a>-&gt;version() &lt;&lt; <span class="stringliteral">&quot; upgrade: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>        }</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code hl_class" href="classParser_1_1InsufficientInput.html">Parser::BinaryTokenizer::InsufficientInput</a> &amp;) {</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;PROXY protocol: waiting for more than &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span>);</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a8cd416724951295b4758f7a5921abfc1">proxyProtocolError</a>(e.what());</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>    }</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>}</div>
</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span> </div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01824" data-start="{" data-end="}">
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"><a class="line" href="classConnStateData.html#aa891eb1dafb6ef7c0eefb8b1bf4fa737"> 1824</a></span><a class="code hl_function" href="classConnStateData.html#aa891eb1dafb6ef7c0eefb8b1bf4fa737">ConnStateData::receivedFirstByte</a>()</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>{</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a6101c252f4eaf112503cb9d21d5eb5ce">receivedFirstByte_</a>)</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span> </div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>    <a class="code hl_variable" href="classServer.html#a6101c252f4eaf112503cb9d21d5eb5ce">receivedFirstByte_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>    <a class="code hl_function" href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">resetReadTimeout</a>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">Timeout</a>.<a class="code hl_variable" href="classSquidConfig.html#a57e9c06b9a99354b526a765e5b019c74">request</a>);</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>}</div>
</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span> </div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01836" data-start="{" data-end="}">
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"><a class="line" href="classConnStateData.html#a4d4de1cff9d3c5f5d312fee3622e0fa2"> 1836</a></span><a class="code hl_function" href="classConnStateData.html#a4d4de1cff9d3c5f5d312fee3622e0fa2">ConnStateData::parseRequests</a>()</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>{</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;: attempting to parse&quot;</span>);</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span> </div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>    <span class="comment">// Loop while we have read bytes that are not needed for producing the body</span></div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>    <span class="comment">// On errors, bodyPipe may become nil, but readMore will be cleared</span></div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>    <span class="keywordflow">while</span> (!<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>() &amp;&amp; !<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> &amp;&amp; <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore) {</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span> </div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>        <span class="comment">// Prohibit concurrent requests when using a pinned to-server connection</span></div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>        <span class="comment">// because our Client classes do not support request pipelining.</span></div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.pinned &amp;&amp; !<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler) {</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; waits for busy &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection);</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>        }</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span> </div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>        <span class="comment">/* Limit the number of concurrent requests */</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#abdd47e67edfe3760ed0fffea8d45bc25">concurrentRequestQueueFilled</a>())</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span> </div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>        <span class="comment">// try to parse the PROXY protocol header magic bytes</span></div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae3fb2cba948d6b47e86e6464a96b1191">needProxyProtocolHeader_</a>) {</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#adfaf6853b9b2b580e8ba6f45292a07a3">parseProxyProtocolHeader</a>())</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span> </div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>            <span class="comment">// we have been waiting for PROXY to provide client-IP</span></div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>            <span class="comment">// for some lookups, ie rDNS</span></div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>            <a class="code hl_function" href="classConnStateData.html#ac77da03e4e8e0e9d8365fc84e425bdfa">whenClientIpKnown</a>();</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span> </div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>            <span class="comment">// Done with PROXY protocol which has cleared preservingClientData_.</span></div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>            <span class="comment">// If the next protocol supports on_unsupported_protocol, then its</span></div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>            <span class="comment">// parseOneRequest() must reset preservingClientData_.</span></div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!<a class="code hl_variable" href="classConnStateData.html#a6c10d6b2f8d50beaf9d32a6790c80a40">preservingClientData_</a>);</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>        }</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span> </div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_function" href="classConnStateData.html#a37a1d6332f652d4b3aed9502f97b3fa2">parseOneRequest</a>()) {</div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;: done parsing a request&quot;</span>);</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>            <a class="code hl_function" href="classConnStateData.html#ac21b0b5b9986f9088bcfc68016760454">extendLifetime</a>();</div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>            context-&gt;registerWithConn();</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span> </div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">switchedToHttps</a>())</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>                <a class="code hl_variable" href="classConnStateData.html#aa8e7d3c1f7073ef1bcd21f91d53167a6">parsedBumpedRequestCount</a>++;</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span> </div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>            <a class="code hl_function" href="classConnStateData.html#adaa0bde9ddda622229fb75a904df02d4">processParsedRequest</a>(context);</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span> </div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span>            <span class="keywordflow">if</span> (context-&gt;mayUseConnection()) {</div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;Not parsing new requests, as this request may need the connection&quot;</span>);</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>            }</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;: not enough request data: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>                   <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &lt;&lt; <span class="stringliteral">&quot; &lt; &quot;</span> &lt;&lt; <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a9a5a4aaa278ec44c9807fb2c5433b49b">maxRequestHeaderSize</a>);</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>            <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &lt; <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a9a5a4aaa278ec44c9807fb2c5433b49b">maxRequestHeaderSize</a>);</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>        }</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>    }</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span> </div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;buffered leftovers: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span> </div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>() &amp;&amp; <a class="code hl_function" href="comm_8h.html#ad684c6dba13b91c274ad5332508e735b">commIsHalfClosed</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>)) {</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>()) {</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>            <span class="comment">// we processed what we could parse, and no more data is coming</span></div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;closing half-closed without parsed requests: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>            <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>            <span class="comment">// we parsed what we could, and no more data is coming</span></div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;monitoring half-closed while processing parsed requests: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span>            <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore = <span class="keyword">false</span>; <span class="comment">// may already be false</span></div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span>        }</div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span>    }</div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span>}</div>
</div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span> </div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01910" data-start="{" data-end="}">
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"><a class="line" href="classConnStateData.html#a21c5baeec729cb1b057502a6a0554fb5"> 1910</a></span><a class="code hl_function" href="classConnStateData.html#a21c5baeec729cb1b057502a6a0554fb5">ConnStateData::afterClientRead</a>()</div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>{</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#adbe8b3f0075d4ba6c7a0ac7c62b43a23">parsingTlsHandshake</a>) {</div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span>        <a class="code hl_function" href="classConnStateData.html#a849eb5ad88b43ff7aa44d1b53620ca27">parseTlsHandshake</a>();</div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span>    }</div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span> </div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>    <span class="comment">/* Process next request */</span></div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>())</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>        <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;Reading next request&quot;</span>);</div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span> </div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>    <a class="code hl_function" href="classConnStateData.html#a4d4de1cff9d3c5f5d312fee3622e0fa2">parseRequests</a>();</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span> </div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>())</div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span> </div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>    <a class="code hl_function" href="classConnStateData.html#a31ff1f7aab0f5cb374c9d34d848eb7e3">clientAfterReadingRequests</a>();</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span>}</div>
</div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span> </div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01938" data-start="{" data-end="}">
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"><a class="line" href="classConnStateData.html#a546c60dc348f44b3e75407f737abd849"> 1938</a></span><a class="code hl_function" href="classConnStateData.html#a546c60dc348f44b3e75407f737abd849">ConnStateData::handleReadData</a>()</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>{</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span>    <span class="comment">// if we are reading a body, stuff data into the body pipe</span></div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#ae0ab21b98499a47569207ea2146ebe80">handleRequestBodyData</a>();</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span>}</div>
</div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span> </div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01954" data-start="{" data-end="}">
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"><a class="line" href="classConnStateData.html#ae0ab21b98499a47569207ea2146ebe80"> 1954</a></span><a class="code hl_function" href="classConnStateData.html#ae0ab21b98499a47569207ea2146ebe80">ConnStateData::handleRequestBodyData</a>()</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>{</div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span> </div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>) { <span class="comment">// chunked encoding</span></div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span>        <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code hl_enumeration" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1a">err_type</a> <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a> = <a class="code hl_function" href="classConnStateData.html#a5abc8f5b749b7532794895b37c106153">handleChunkedRequestBody</a>()) {</div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>            <a class="code hl_function" href="classConnStateData.html#a69398fab21143d6e59b3a895caac3b6f">abortChunkedRequestBody</a>(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>);</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>        }</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>    } <span class="keywordflow">else</span> { <span class="comment">// identity encoding</span></div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33,5, <span class="stringliteral">&quot;handling plain request body for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>        <span class="keyword">const</span> <span class="keyword">auto</span> putSize = <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a1211db9a9516395570698aa214ac0411">putMoreData</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a1af20d84cdd1e4f380c74a08d67d0edb">rawContent</a>(), <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span>        <span class="keywordflow">if</span> (putSize &gt; 0)</div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span>            <a class="code hl_function" href="classConnStateData.html#a311713f0ae2a89a60327696b2f1188f4">consumeInput</a>(putSize);</div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span> </div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#aace0a9e8cb0590c0fcc3a812e739765f">mayNeedMoreData</a>()) {</div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>            <span class="comment">// BodyPipe will clear us automagically when we produced everything</span></div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>            <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>        }</div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>    }</div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span> </div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>) {</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33,5, <span class="stringliteral">&quot;produced entire request body for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span> </div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>        <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *reason = <a class="code hl_function" href="classConnStateData.html#aeff8387932f77bdb4957099a4528f73e">stoppedSending</a>()) {</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>            <span class="comment">/* we&#39;ve finished reading like good clients,</span></div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span><span class="comment">             * now do the close that initiateClose initiated.</span></div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span><span class="comment">             */</span></div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;closing for earlier sending error: &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>            <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>        }</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>    }</div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span> </div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>}</div>
</div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span> </div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span><a class="code hl_enumeration" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1a">err_type</a></div>
<div class="foldopen" id="foldopen01993" data-start="{" data-end="}">
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"><a class="line" href="classConnStateData.html#a5abc8f5b749b7532794895b37c106153"> 1993</a></span><a class="code hl_function" href="classConnStateData.html#a5abc8f5b749b7532794895b37c106153">ConnStateData::handleChunkedRequestBody</a>()</div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>{</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;chunked from &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span> </div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span>    <span class="keywordflow">try</span> { <span class="comment">// the parser will throw on errors</span></div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span> </div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) <span class="comment">// nothing to do</span></div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa5203071ca85e00df6bf2526855b6df0d">ERR_NONE</a>;</div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span> </div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>        <a class="code hl_class" href="classBodyPipeCheckout.html">BodyPipeCheckout</a> bpc(*<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>);</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>        <a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>-&gt;<a class="code hl_function" href="classHttp_1_1One_1_1TeChunkedParser.html#ad97d8216e4d5b3e76b60639ea1fbd2b5">setPayloadBuffer</a>(&amp;bpc.<a class="code hl_variable" href="classBodyPipeCheckout.html#af5cabb26c71cf3560c5fa06d4858f003">buf</a>);</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> parsed = <a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>-&gt;<a class="code hl_function" href="classHttp_1_1One_1_1TeChunkedParser.html#a1ef246170720fa36d1a06d20f8728b56">parse</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>);</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>        <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a> = <a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>-&gt;<a class="code hl_function" href="classHttp_1_1One_1_1Parser.html#a8a61ca899c082efeb9fe7d0203ece39e">remaining</a>(); <span class="comment">// sync buffers</span></div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>        bpc.<a class="code hl_function" href="classBodyPipeCheckout.html#a62723d6305175d8cc0933d64ec0e6701">checkIn</a>();</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span> </div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>        <span class="comment">// dechunk then check: the size limit applies to _dechunked_ content</span></div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="client__side_8cc.html#a766113836f4b2ce05e7dfe662c5d161a">clientIsRequestBodyTooLargeForPolicy</a>(<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a0ee59d371163434ddfd9d163ea18b7c6">producedSize</a>()))</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aab442793281e45c7214a6e3d221b49505">ERR_TOO_BIG</a>;</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span> </div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>        <span class="keywordflow">if</span> (parsed) {</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span>            <a class="code hl_function" href="classConnStateData.html#ad424e6c4c64842378e58b154b8ff7a7c">finishDechunkingRequest</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>            <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(!<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>);</div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa5203071ca85e00df6bf2526855b6df0d">ERR_NONE</a>; <span class="comment">// nil bodyPipe implies body end for the caller</span></div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>        }</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span> </div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>        <span class="comment">// if chunk parser needs data, then the body pipe must need it too</span></div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(!<a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>-&gt;<a class="code hl_function" href="classHttp_1_1One_1_1Parser.html#af1e818c3f5caf4a375eedf31a99f88d8">needsMoreData</a>() || <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#aace0a9e8cb0590c0fcc3a812e739765f">mayNeedMoreData</a>());</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span> </div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>        <span class="comment">// if parser needs more space and we can consume nothing, we will stall</span></div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(!<a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>-&gt;<a class="code hl_function" href="classHttp_1_1One_1_1TeChunkedParser.html#acb09f5b320fe3ccf41bff35b5945bb51">needsMoreSpace</a>() || <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a1c2a49617812bb676c1d92296ce897fc">buf</a>().<a class="code hl_function" href="classMemBuf.html#acd16af1c1ce00158c868f6b378b59c8c">hasContent</a>());</div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>    } <span class="keywordflow">catch</span> (...) { <span class="comment">// TODO: be more specific</span></div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;malformed chunks&quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a86a7bad07711a162dccad979af7d4a20">status</a>());</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aae371804ada2a7013ccba421a120d3fa9">ERR_INVALID_REQ</a>;</div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>    }</div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span> </div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;need more chunked data&quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a86a7bad07711a162dccad979af7d4a20">status</a>());</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa5203071ca85e00df6bf2526855b6df0d">ERR_NONE</a>;</div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>}</div>
</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span> </div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02034" data-start="{" data-end="}">
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"><a class="line" href="classConnStateData.html#a69398fab21143d6e59b3a895caac3b6f"> 2034</a></span><a class="code hl_function" href="classConnStateData.html#a69398fab21143d6e59b3a895caac3b6f">ConnStateData::abortChunkedRequestBody</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1a">err_type</a> <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>)</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>{</div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>    <a class="code hl_function" href="classConnStateData.html#ad424e6c4c64842378e58b154b8ff7a7c">finishDechunkingRequest</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span> </div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>    <span class="comment">// XXX: The code below works if we fail during initial request parsing,</span></div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>    <span class="comment">// but if we fail when the server connection is used already, the server may send</span></div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>    <span class="comment">// us its response too, causing various assertions. How to prevent that?</span></div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span><span class="preprocessor">#if WE_KNOW_HOW_TO_SEND_ERRORS</span></div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>    <span class="keywordflow">if</span> (context != <a class="code hl_define" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; !context-&gt;http-&gt;out.offset) { <span class="comment">// output nothing yet</span></div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>        <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<a class="code hl_struct" href="structnode.html">node</a> = context-&gt;getClientReplyContext();</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span>        <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *repContext = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a>*<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(repContext);</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>        <span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceHttp.html#a432f881deb187c726161d6435daec722">Http::StatusCode</a> scode = (<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a> == <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aab442793281e45c7214a6e3d221b49505">ERR_TOO_BIG</a>) ?</div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>                                       <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722af056fd80f0ad36efe17c794a9ee7a988">Http::scContentTooLarge</a> : HTTP_BAD_REQUEST;</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>        repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#aefdedf444de122be303a2c56dc7ef1a9">setReplyToError</a>(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>, scode,</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>                                    repContext-&gt;<a class="code hl_variable" href="classclientReplyContext.html#ababe13d071231c0cf2a4956ff911bd5f">http</a>-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a>,</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>                                    <a class="code hl_class" href="classCachePeer.html">CachePeer</a>,</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span>                                    repContext-&gt;<a class="code hl_variable" href="classclientReplyContext.html#ababe13d071231c0cf2a4956ff911bd5f">http</a>-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>,</div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>                                    <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>        context-&gt;pullData();</div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>        <span class="comment">// close or otherwise we may get stuck as nobody will notice the error?</span></div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>        <a class="code hl_function" href="comm_8cc.html#af74f102f673b39ad806aafefdd1e948c">comm_reset_close</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>    }</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;aborting chunked request without error &quot;</span> &lt;&lt; <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>);</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>    <a class="code hl_function" href="comm_8cc.html#af74f102f673b39ad806aafefdd1e948c">comm_reset_close</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>    <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>}</div>
</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span> </div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02067" data-start="{" data-end="}">
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"><a class="line" href="classConnStateData.html#ae41a2f60162e48d848dcb535fa1ab2ff"> 2067</a></span><a class="code hl_function" href="classConnStateData.html#ae41a2f60162e48d848dcb535fa1ab2ff">ConnStateData::noteBodyConsumerAborted</a>(<a class="code hl_class" href="classRefCount.html">BodyPipe::Pointer</a> )</div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>{</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>    <span class="comment">// request reader may get stuck waiting for space if nobody consumes body</span></div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>        <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#acfdac140a6c4b099c2ba12de5daa649f">enableAutoConsumption</a>();</div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span> </div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>    <span class="comment">// kids extend</span></div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>}</div>
</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span> </div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02078" data-start="{" data-end="}">
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"><a class="line" href="classConnStateData.html#ac6d7b7b78efcf4f132f32fc88d96711e"> 2078</a></span><a class="code hl_function" href="classConnStateData.html#ac6d7b7b78efcf4f132f32fc88d96711e">ConnStateData::requestTimeout</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommTimeoutCbParams.html">CommTimeoutCbParams</a> &amp;io)</div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>{</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>))</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span> </div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1a">err_type</a> <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a> = <a class="code hl_variable" href="classServer.html#a6101c252f4eaf112503cb9d21d5eb5ce">receivedFirstByte_</a> ? <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa60842fd3916ff9e8fc8bebc607b94470">ERR_REQUEST_PARSE_TIMEOUT</a> : <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa7d3e07fde16dcbe18a924fc6d8331708">ERR_REQUEST_START_TIMEOUT</a>;</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span>    <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>);</div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#ae85c6fd07a8415d08b9672de277ee24e">tunnelOnError</a>(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>))</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span> </div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span><span class="comment">    * Just close the connection to not confuse browsers</span></div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span><span class="comment">    * using persistent connections. Some browsers open</span></div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span><span class="comment">    * a connection and then do not use it until much</span></div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span><span class="comment">    * later (presumably because the request triggering</span></div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span><span class="comment">    * the open has already been completed on another</span></div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span><span class="comment">    * connection)</span></div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span><span class="comment">    */</span></div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;requestTimeout: FD &quot;</span> &lt;&lt; io.<a class="code hl_variable" href="classCommCommonCbParams.html#a6a391b2345409642778d85f241c5facb">fd</a> &lt;&lt; <span class="stringliteral">&quot;: lifetime is expired.&quot;</span>);</div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>    io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>}</div>
</div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span> </div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02101" data-start="{" data-end="}">
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"><a class="line" href="classConnStateData.html#a77178d9a4cfa208cb5bc71967e62ab79"> 2101</a></span><a class="code hl_function" href="classConnStateData.html#a77178d9a4cfa208cb5bc71967e62ab79">ConnStateData::lifetimeTimeout</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommTimeoutCbParams.html">CommTimeoutCbParams</a> &amp;io)</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>{</div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: Closing client connection due to lifetime timeout&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>           <a class="code hl_function" href="classDebug.html#a469eccf6573cacd9bc0682d3fc0eaf11">Debug::Extra</a> &lt;&lt; <span class="stringliteral">&quot;connection: &quot;</span> &lt;&lt; io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>);</div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span> </div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>    <a class="code hl_class" href="classLogTagsErrors.html">LogTagsErrors</a> lte;</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>    lte.<a class="code hl_variable" href="classLogTagsErrors.html#a50bf712f141a85310cd37c162634bb0b">timedout</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>    <a class="code hl_function" href="classConnStateData.html#a66927b5570f7ee51400c0bca0751cee6">terminateAll</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa06df3911c86a3b9032b302d21b43e060">ERR_LIFETIME_EXP</a>, lte);</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span>}</div>
</div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span> </div>
<div class="foldopen" id="foldopen02111" data-start="{" data-end="}">
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"><a class="line" href="classConnStateData.html#ac17896e9d6f07308b7e75f49bec92810"> 2111</a></span><a class="code hl_function" href="classConnStateData.html#ac17896e9d6f07308b7e75f49bec92810">ConnStateData::ConnStateData</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">MasterXaction::Pointer</a> &amp;xact) :</div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>    <a class="code hl_class" href="classAsyncJob.html">AsyncJob</a>(<span class="stringliteral">&quot;ConnStateData&quot;</span>), <span class="comment">// kids overwrite</span></div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>    <a class="code hl_class" href="classServer.html">Server</a>(xact)</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>#if <a class="code hl_define" href="autoconf_8h.html#a9960d83cf790f3296034632f5f27f830">USE_OPENSSL</a></div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>    , tlsParser(<a class="code hl_namespace" href="namespaceSecurity.html">Security</a>::HandshakeParser::fromClient)</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>#endif</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>{</div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>    <span class="comment">// store the details required for creating more MasterXaction objects as new requests come in</span></div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>    <a class="code hl_variable" href="classConnStateData.html#ab4bed752a0b6a81679cdb594f98e7022">log_addr</a> = xact-&gt;<a class="code hl_variable" href="classMasterXaction.html#a6face8463c6b8abc85820ca7e63497f4">tcpClient</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>;</div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>    <a class="code hl_variable" href="classConnStateData.html#ab4bed752a0b6a81679cdb594f98e7022">log_addr</a>.<a class="code hl_function" href="classIp_1_1Address.html#a5c88542f8e90d3b49f743e079b9383bb">applyClientMask</a>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a7359b8e7d76021bb050a0399c1516e94">Addrs</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7381aa2d2a2298ff02d01faa10c1dcd">client_netmask</a>);</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span> </div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>    <span class="comment">// register to receive notice of Squid signal events</span></div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>    <span class="comment">// which may affect long persisting client connections</span></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>    <a class="code hl_function" href="classIndependentRunner.html#af3c2f4f2ff88ff65d6089fa77025de95">registerRunner</a>();</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span>}</div>
</div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span> </div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02128" data-start="{" data-end="}">
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"><a class="line" href="classConnStateData.html#a4cbbc46289185d9b973594b11f7649fa"> 2128</a></span><a class="code hl_function" href="classConnStateData.html#a4cbbc46289185d9b973594b11f7649fa">ConnStateData::start</a>()</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span>{</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>    <a class="code hl_function" href="classAsyncJob.html#a2d48992e9b3e9c3af60c1058d0d79782">BodyProducer::start</a>();</div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span>    <a class="code hl_function" href="classAsyncJob.html#a2d48992e9b3e9c3af60c1058d0d79782">HttpControlMsgSink::start</a>();</div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span> </div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;disable_pmtu_discovery != <a class="code hl_enumvalue" href="enums_8h.html#a84627a72058502328269676b81780f89acd9d155761fdd879cc51cd809b976dd9">DISABLE_PMTU_OFF</a> &amp;&amp;</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span>            (<a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>() || <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;disable_pmtu_discovery == <a class="code hl_enumvalue" href="enums_8h.html#a84627a72058502328269676b81780f89a0d6100f1b0cf2c5aff81194a2cf07713">DISABLE_PMTU_ALWAYS</a>)) {</div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span><span class="preprocessor">#if defined(IP_MTU_DISCOVER) &amp;&amp; defined(IP_PMTUDISC_DONT)</span></div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>        <span class="keywordtype">int</span> i = IP_PMTUDISC_DONT;</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="socket_8h.html#a712fdb6a1f96f6ba746ef8da018bb216">xsetsockopt</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, SOL_IP, IP_MTU_DISCOVER, &amp;i, <span class="keyword">sizeof</span>(i)) &lt; 0) {</div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span>            <span class="keywordtype">int</span> xerrno = errno;</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;WARNING: Path MTU discovery disabling failed on &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(xerrno));</div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span>        }</div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>        <span class="keyword">static</span> <span class="keywordtype">bool</span> reported = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span> </div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>        <span class="keywordflow">if</span> (!reported) {</div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: Path MTU discovery disabling is not supported on your platform.&quot;</span>);</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>            reported = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>        }</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>    }</div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span> </div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;ConnStateData, CommCloseCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classConnStateData.html#afaf0833711797e0b502ce8b4d59df6ab">ConnStateData::connStateClosed</a>);</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>    <a class="code hl_function" href="comm_8cc.html#a12f74ce8bc526212a2ba72cecab4ac2b">comm_add_close_handler</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, call);</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span> </div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>    <a class="code hl_variable" href="classConnStateData.html#ae3fb2cba948d6b47e86e6464a96b1191">needProxyProtocolHeader_</a> = <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;flags.proxySurrogate;</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae3fb2cba948d6b47e86e6464a96b1191">needProxyProtocolHeader_</a>) {</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#afb1bfcf4b5632bc9be148767f1b1dedb">proxyProtocolValidateClient</a>()) <span class="comment">// will close the connection on failure</span></div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span>    } <span class="keywordflow">else</span></div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>        <a class="code hl_function" href="classConnStateData.html#ac77da03e4e8e0e9d8365fc84e425bdfa">whenClientIpKnown</a>();</div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span> </div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>    <span class="comment">// requires needProxyProtocolHeader_ which is initialized above</span></div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span>    <a class="code hl_variable" href="classConnStateData.html#a6c10d6b2f8d50beaf9d32a6790c80a40">preservingClientData_</a> = <a class="code hl_function" href="classConnStateData.html#a847fd8d20965e6c7dd56c1cdab67ea90">shouldPreserveClientData</a>();</div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span>}</div>
</div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span> </div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02167" data-start="{" data-end="}">
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"><a class="line" href="classConnStateData.html#ac77da03e4e8e0e9d8365fc84e425bdfa"> 2167</a></span><a class="code hl_function" href="classConnStateData.html#ac77da03e4e8e0e9d8365fc84e425bdfa">ConnStateData::whenClientIpKnown</a>()</div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span>{</div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>);</div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceDns.html#a2cd038103702e02a3dbb5f4c55fe1302">Dns::ResolveClientAddressesAsap</a>)</div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span>        <a class="code hl_function" href="group__FQDNCacheAPI.html#ga8075670505bd7c7ff30bbeaa0d835c4b">fqdncache_gethostbyaddr</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>, <a class="code hl_define" href="defines_8h.html#a346c1caf1aa0b2062a853c4f6f67b459">FQDN_LOOKUP_IF_MISS</a>);</div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span> </div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span>    <a class="code hl_function" href="client__db_8cc.html#a3f1ddfeb929e358b2398430c1b888a2f">clientdbEstablished</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>, 1);</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span> </div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span><span class="preprocessor">#if USE_DELAY_POOLS</span></div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>    <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].clientInfo = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span> </div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a89bec7bc02d66eb2ab65c74c3f6b13ac">onoff</a>.<a class="code hl_variable" href="classSquidConfig.html#a562d3b9f30cf9f07f338acaf055f14dc">client_db</a>)</div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span>        <span class="keywordflow">return</span>; <span class="comment">// client delay pools require client_db</span></div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span> </div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;pools = <a class="code hl_function" href="classClientDelayPools.html#ad922b6f4db246843a79a4c96628328bc">ClientDelayPools::Instance</a>()-&gt;<a class="code hl_variable" href="classClientDelayPools.html#a4be351bae53c16ae8c1f686a793efd9e">pools</a>;</div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>    <span class="keywordflow">if</span> (pools.size()) {</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span>        <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> ch(<span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>        <a class="code hl_function" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">fillChecklist</a>(ch);</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span>        <span class="comment">// TODO: we check early to limit error response bandwidth but we</span></div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span>        <span class="comment">// should recheck when we can honor delay_pool_uses_indirect</span></div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span>        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pool = 0; pool &lt; pools.size(); ++pool) {</div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span> </div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span>            <span class="comment">/* pools require explicit &#39;allow&#39; to assign a client into them */</span></div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span>            <span class="keywordflow">if</span> (pools[pool]-&gt;access) {</div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span>                ch.<a class="code hl_function" href="classACLChecklist.html#a6bea590fc67c7a9f7b90bb4590c9864d">changeAcl</a>(pools[pool]-&gt;access);</div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span>                <span class="keyword">const</span> <span class="keyword">auto</span> &amp;answer = ch.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>();</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span>                <span class="keywordflow">if</span> (answer.allowed()) {</div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span> </div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>                    <span class="comment">/*  request client information from db after we did all checks</span></div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span><span class="comment">                        this will save hash lookup if client failed checks */</span></div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span>                    <a class="code hl_class" href="classClientInfo.html">ClientInfo</a> * cli = <a class="code hl_function" href="client__db_8cc.html#ad7454f361eaba3ee92bbe4403255edf2">clientdbGetInfo</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>);</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span>                    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(cli);</div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span> </div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>                    <span class="comment">/* put client info in FDE */</span></div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>                    <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].clientInfo = cli;</div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span> </div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>                    <span class="comment">/* setup write limiter for this request */</span></div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>                    <span class="keyword">const</span> <span class="keywordtype">double</span> burst = floor(0.5 +</div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>                                               (pools[pool]-&gt;highwatermark * <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a477cbe078174efa10f1e6cdc6d65d461">ClientDelay</a>.<a class="code hl_variable" href="classClientDelayConfig.html#a13f675439815b14729fdc9c78a5ef7a9">initial</a>)/100.0);</div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span>                    cli-&gt;<a class="code hl_function" href="classClientInfo.html#a6248c51b1e77e613cb4277823ccbf731">setWriteLimiter</a>(pools[pool]-&gt;rate, burst, pools[pool]-&gt;highwatermark);</div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span>                    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 4, <span class="stringliteral">&quot;Delay pool &quot;</span> &lt;&lt; pool &lt;&lt; <span class="stringliteral">&quot; skipped because ACL &quot;</span> &lt;&lt; answer);</div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>                }</div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span>            }</div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>        }</div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>    }</div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span> </div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>    <span class="comment">// kids must extend to actually start doing something (e.g., reading)</span></div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>}</div>
</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span> </div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span><a class="code hl_class" href="classSecurity_1_1IoResult.html">Security::IoResult</a></div>
<div class="foldopen" id="foldopen02220" data-start="{" data-end="}">
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"><a class="line" href="classConnStateData.html#aac6c6dfba90e4a817ad4f27204174a9c"> 2220</a></span><a class="code hl_function" href="classConnStateData.html#aac6c6dfba90e4a817ad4f27204174a9c">ConnStateData::acceptTls</a>()</div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>{</div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>    <span class="keyword">const</span> <span class="keyword">auto</span> handshakeResult = <a class="code hl_function" href="namespaceSecurity.html#a5184cf80d640561cc955883a77ccbf88">Security::Accept</a>(*<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span> </div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span>    <span class="comment">// log ASAP, even if the handshake has not completed (or failed)</span></div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>    <span class="keyword">const</span> <span class="keyword">auto</span> fd = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>;</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(fd &gt;= 0);</div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>    <a class="code hl_variable" href="classConnStateData.html#a18b9505239a47bf8922633f4cd7b0e1f">keyLogger</a>.<a class="code hl_function" href="classSecurity_1_1KeyLogger.html#a4fb01a38846a91cff9fd8c4913e429f1">checkpoint</a>(*<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[fd].ssl, *<span class="keyword">this</span>);</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span>    <span class="comment">// TODO: Support fd_table[fd].ssl dereference in other builds.</span></div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span> </div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span>    <span class="keywordflow">return</span> handshakeResult;</div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span>}</div>
</div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span> </div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02238" data-start="{" data-end="}">
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a2dcf5278f655c8ebde39451a3de67a7a"> 2238</a></span><a class="code hl_variable" href="client__side_8cc.html#af8290b502a5da8718ddd609a1688a2e5">httpAccept</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommAcceptCbParams.html">CommAcceptCbParams</a> &amp;params)</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>{</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>    <a class="code hl_define" href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a>(params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>);</div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span> </div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span>    <span class="comment">// NP: it is possible the port was reconfigured when the call or accept() was queued.</span></div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span> </div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span>    <span class="keywordflow">if</span> (params.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span>        <span class="comment">// Its possible the call was still queued when the client disconnected</span></div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>-&gt;listenConn &lt;&lt; <span class="stringliteral">&quot;: accept failure: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">xerrno</a>));</div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span>    }</div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span> </div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a> &lt;&lt; <span class="stringliteral">&quot;: accepted&quot;</span>);</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>    <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;client http connect&quot;</span>);</div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>    <span class="keyword">const</span> <span class="keyword">auto</span> xact = <a class="code hl_function" href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a>(params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>);</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>    xact-&gt;tcpClient = params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>;</div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span> </div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>    <span class="comment">// Socket is ready, setup the connection manager to start using it</span></div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>    <span class="keyword">auto</span> *srv = <a class="code hl_function" href="namespaceHttp.html#a4400a96a7d5790f5a9b5591296de84a8">Http::NewServer</a>(xact);</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>    <span class="comment">// XXX: do not abandon the MasterXaction object</span></div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span>    <a class="code hl_function" href="classAsyncJob.html#a1dd42e9842d751193268966d4e0de2fa">AsyncJob::Start</a>(srv); <span class="comment">// usually async-calls readSomeData()</span></div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>}</div>
</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span> </div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen02263" data-start="{" data-end="}">
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a596a46d13b2e131ece4f5d986a1e30ac"> 2263</a></span><a class="code hl_function" href="client__side_8cc.html#a596a46d13b2e131ece4f5d986a1e30ac">httpsCreate</a>(<span class="keyword">const</span> <a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *connState, <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> &amp;ctx)</div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>{</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>    <span class="keyword">const</span> <span class="keyword">auto</span> conn = connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>;</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceSecurity.html#a488f9ba5dcc69f185102178fc510fb73">Security::CreateServerSession</a>(ctx, conn, connState-&gt;<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure, <span class="stringliteral">&quot;client https start&quot;</span>)) {</div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;will negotiate TLS on &quot;</span> &lt;&lt; conn);</div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>    }</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span> </div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;ERROR: could not create TLS server context for &quot;</span> &lt;&lt; conn);</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>    conn-&gt;close();</div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span>}</div>
</div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span> </div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02278" data-start="{" data-end="}">
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38"> 2278</a></span><a class="code hl_function" href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38">clientNegotiateSSL</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *data)</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span>{</div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>    <a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *conn = (<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *)data;</div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span> </div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span>    <span class="keyword">const</span> <span class="keyword">auto</span> handshakeResult = conn-&gt;<a class="code hl_function" href="classConnStateData.html#aac6c6dfba90e4a817ad4f27204174a9c">acceptTls</a>();</div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span>    <span class="keywordflow">switch</span> (handshakeResult.category) {</div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317a6351c5537fff92ccae5284a623de9fb7">Security::IoResult::ioSuccess</a>:</div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span> </div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317af17e1855920ff08d4245c92730762b99">Security::IoResult::ioWantRead</a>:</div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span>        <a class="code hl_function" href="namespaceComm.html#ae3a7e8f0df297346e84f0e9943033a3e">Comm::SetSelect</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <a class="code hl_define" href="defines_8h.html#a0d83ade59d0c0d3c0f71c50bc14e314e">COMM_SELECT_READ</a>, <a class="code hl_function" href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38">clientNegotiateSSL</a>, conn, 0);</div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span> </div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317ae3a476a231aa75bc7764fe1644cfac1b">Security::IoResult::ioWantWrite</a>:</div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span>        <a class="code hl_function" href="namespaceComm.html#ae3a7e8f0df297346e84f0e9943033a3e">Comm::SetSelect</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <a class="code hl_define" href="defines_8h.html#a466a4c545dd6c5d996d8ab8f1d0d2270">COMM_SELECT_WRITE</a>, <a class="code hl_function" href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38">clientNegotiateSSL</a>, conn, 0);</div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span> </div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317a1eafdd2f000f06b7396b040f19e92386">Security::IoResult::ioError</a>:</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, (handshakeResult.important ? <a class="code hl_define" href="debug_2Messages_8h.html#a3627f132658efd674ba366496239d303">Important</a>(62) : 2), <span class="stringliteral">&quot;ERROR: Cannot accept a TLS connection&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>               <a class="code hl_function" href="classDebug.html#a469eccf6573cacd9bc0682d3fc0eaf11">Debug::Extra</a> &lt;&lt; <span class="stringliteral">&quot;problem: &quot;</span> &lt;&lt; <a class="code hl_class" href="classWithExtras.html">WithExtras</a>(handshakeResult));</div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>        <span class="comment">// TODO: No ConnStateData::tunnelOnError() on this forward-proxy code</span></div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span>        <span class="comment">// path because we cannot know the intended connection target?</span></div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>        conn-&gt;<a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa06dbb9679d23daac15bfa00176c68222">ERR_SECURE_ACCEPT_FAIL</a>, handshakeResult.errorDetail);</div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>        conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span>    }</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span> </div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>    <a class="code hl_typedef" href="namespaceSecurity.html#a682c638417cc45a4452a76db4eb1780b">Security::SessionPointer</a> session(<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[fd].ssl);</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span> </div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceSecurity.html#a79f403b4ae232250d95e98f8184070b3">Security::SessionIsResumed</a>(session)) {</div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <span class="stringliteral">&quot;Session &quot;</span> &lt;&lt; SSL_get_session(session.get()) &lt;&lt;</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>               <span class="stringliteral">&quot; reused on FD &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[fd].ipaddr &lt;&lt;</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span>               <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; (<span class="keywordtype">int</span>)<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[fd].remote_port &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classDebug.html#a44b82c996aedfa84dd8b61427f393e42">Debug::Enabled</a>(83, 4)) {</div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>            <span class="comment">/* Write out the SSL session details.. actually the call below, but</span></div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span><span class="comment">             * OpenSSL headers do strange typecasts confusing GCC.. */</span></div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>            <span class="comment">/* PEM_write_SSL_SESSION(DebugStream(), SSL_get_session(ssl)); */</span></div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span><span class="preprocessor">#if defined(OPENSSL_VERSION_NUMBER) &amp;&amp; OPENSSL_VERSION_NUMBER &gt;= 0x00908000L</span></div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>            PEM_ASN1_write(<span class="keyword">reinterpret_cast&lt;</span>i2d_of_void *<span class="keyword">&gt;</span>(i2d_SSL_SESSION),</div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>                           PEM_STRING_SSL_SESSION, <a class="code hl_function" href="src_2debug_2debug_8cc.html#a0d2107ed0503ce532330be150c12906b">DebugStream</a>(),</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span>                           <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(SSL_get_session(session.get())),</div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>                           <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, 0, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span> </div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span><span class="preprocessor">#elif (ALLOW_ALWAYS_SSL_SESSION_DETAIL == 1)</span></div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span> </div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>            <span class="comment">/* When using gcc 3.3.x and OpenSSL 0.9.7x sometimes a compile error can occur here.</span></div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span><span class="comment">            * This is caused by an unpredictable gcc behaviour on a cast of the first argument</span></div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span><span class="comment">            * of PEM_ASN1_write(). For this reason this code section is disabled. To enable it,</span></div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span><span class="comment">            * define ALLOW_ALWAYS_SSL_SESSION_DETAIL=1.</span></div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span><span class="comment">            * Because there are two possible usable cast, if you get an error here, try the other</span></div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span><span class="comment">            * commented line. */</span></div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span> </div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>            PEM_ASN1_write((<span class="keywordtype">int</span>(*)())i2d_SSL_SESSION, PEM_STRING_SSL_SESSION,</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>                           <a class="code hl_function" href="src_2debug_2debug_8cc.html#a0d2107ed0503ce532330be150c12906b">DebugStream</a>(),</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span>                           <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(SSL_get_session(session.get())),</div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>                           <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, 0, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span>            <span class="comment">/* PEM_ASN1_write((int(*)(...))i2d_SSL_SESSION, PEM_STRING_SSL_SESSION,</span></div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span><span class="comment">                           DebugStream(),</span></div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span><span class="comment">                           reinterpret_cast&lt;char *&gt;(SSL_get_session(session.get())),</span></div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span><span class="comment">                           nullptr, nullptr, 0, nullptr, nullptr);</span></div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span><span class="comment">             */</span></div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 4, <span class="stringliteral">&quot;With &quot;</span> OPENSSL_VERSION_TEXT <span class="stringliteral">&quot;, session details are available only defining ALLOW_ALWAYS_SSL_SESSION_DETAIL=1 in the source.&quot;</span>);</div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span> </div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>            <span class="comment">/* Note: This does not automatically fflush the log file.. */</span></div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>        }</div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span> </div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <span class="stringliteral">&quot;New session &quot;</span> &lt;&lt; SSL_get_session(session.get()) &lt;&lt;</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>               <span class="stringliteral">&quot; on FD &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[fd].ipaddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>               <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[fd].remote_port &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span>    }</div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <span class="stringliteral">&quot;TLS session reuse not yet implemented.&quot;</span>);</div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span> </div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>    <span class="comment">// Connection established. Retrieve TLS connection parameters for logging.</span></div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>    conn-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#ad896c0e8f260771b0d5d229357ef8acc">tlsNegotiations</a>()-&gt;<a class="code hl_function" href="classSecurity_1_1NegotiationHistory.html#adfd1ceb3a60ef74c1af08a3c2e7836ff">retrieveNegotiatedInfo</a>(session);</div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span> </div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>    X509 *client_cert = SSL_get_peer_certificate(session.get());</div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span> </div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span>    <span class="keywordflow">if</span> (client_cert) {</div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 3, <span class="stringliteral">&quot;FD &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot; client certificate: subject: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>               <a class="code hl_function" href="namespaceSecurity.html#ab4dfe29d04dc3880668fd3b41a5595aa">Security::SubjectName</a>(*client_cert));</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span> </div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 3, <span class="stringliteral">&quot;FD &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot; client certificate: issuer: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>               <a class="code hl_function" href="namespaceSecurity.html#a22a6ec2bd7340b66fe60a5e0cb9b179e">Security::IssuerName</a>(*client_cert));</div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span> </div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span>        X509_free(client_cert);</div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 5, <span class="stringliteral">&quot;FD &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot; has no client certificate.&quot;</span>);</div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span>    }</div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <span class="stringliteral">&quot;Client certificate requesting not yet implemented.&quot;</span>);</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span> </div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span>    <span class="comment">// If we are called, then bumped CONNECT has succeeded. Finalize it.</span></div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> xact = conn-&gt;<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>()) {</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>        <span class="keywordflow">if</span> (xact-&gt;http &amp;&amp; xact-&gt;http-&gt;request &amp;&amp; xact-&gt;http-&gt;request-&gt;method == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a8ecea905b7d7b048a979e590cb11b9d7">Http::METHOD_CONNECT</a>)</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>            xact-&gt;finished();</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span>        <span class="comment">// cannot proceed with encryption if requests wait for plain responses</span></div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(conn-&gt;<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>());</div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>    }</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span>    <span class="comment">/* careful: finished() above frees request, host, etc. */</span></div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span> </div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span>    conn-&gt;<a class="code hl_function" href="classServer.html#a12cdf2616768902693acb3896283d29b">readSomeData</a>();</div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span>}</div>
</div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span> </div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02394" data-start="{" data-end="}">
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a172a2bb05c54e4da9bad9bbcdf9c8ad0"> 2394</a></span><a class="code hl_function" href="client__side_8cc.html#a172a2bb05c54e4da9bad9bbcdf9c8ad0">httpsEstablish</a>(<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *connState, <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> &amp;ctx)</div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span>{</div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(connState);</div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span>    <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> &amp;details = connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>;</div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span> </div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span>    <span class="keywordflow">if</span> (!ctx || !<a class="code hl_function" href="client__side_8cc.html#a596a46d13b2e131ece4f5d986a1e30ac">httpsCreate</a>(connState, ctx))</div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span> </div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span>    connState-&gt;<a class="code hl_function" href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">resetReadTimeout</a>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">Timeout</a>.<a class="code hl_variable" href="classSquidConfig.html#a57e9c06b9a99354b526a765e5b019c74">request</a>);</div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span> </div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>    <a class="code hl_function" href="namespaceComm.html#ae3a7e8f0df297346e84f0e9943033a3e">Comm::SetSelect</a>(details-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <a class="code hl_define" href="defines_8h.html#a0d83ade59d0c0d3c0f71c50bc14e314e">COMM_SELECT_READ</a>, <a class="code hl_function" href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38">clientNegotiateSSL</a>, connState, 0);</div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span>}</div>
</div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span> </div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02412" data-start="{" data-end="}">
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a3367b6cc488434bdbffe8eed828b055b"> 2412</a></span><a class="code hl_function" href="client__side_8cc.html#a3367b6cc488434bdbffe8eed828b055b">httpsSslBumpAccessCheckDone</a>(<a class="code hl_class" href="classAcl_1_1Answer.html">Acl::Answer</a> answer, <span class="keywordtype">void</span> *data)</div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span>{</div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span>    <a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *connState = (<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *) data;</div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span> </div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span>    <span class="comment">// if the connection is closed or closing, just return.</span></div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span>    <span class="keywordflow">if</span> (!connState-&gt;<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>())</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span> </div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span>    <span class="keywordflow">if</span> (answer.<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>()) {</div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;sslBump action &quot;</span> &lt;&lt; <a class="code hl_function" href="group__ServerProtocolSSLAPI.html#ga326212e49d2774b730d08ae598a11e30">Ssl::bumpMode</a>(answer.<a class="code hl_variable" href="classAcl_1_1Answer.html#a2c742f67e11b7b92c02b286f91339298">kind</a>) &lt;&lt; <span class="stringliteral">&quot;needed for &quot;</span> &lt;&lt; connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span>        connState-&gt;<a class="code hl_variable" href="classConnStateData.html#abca96f1a2792ad7128762d1dac280cd6">sslBumpMode</a> = <span class="keyword">static_cast&lt;</span><a class="code hl_enumeration" href="group__ServerProtocolSSLAPI.html#gae6b7865118af149a83cc4569060c1af9">Ssl::BumpMode</a><span class="keyword">&gt;</span>(answer.<a class="code hl_variable" href="classAcl_1_1Answer.html#a2c742f67e11b7b92c02b286f91339298">kind</a>);</div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;sslBump not needed for &quot;</span> &lt;&lt; connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span>        connState-&gt;<a class="code hl_variable" href="classConnStateData.html#abca96f1a2792ad7128762d1dac280cd6">sslBumpMode</a> = <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aaa41037e8896833d425589e945cbb064">Ssl::bumpSplice</a>;</div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span>    }</div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span> </div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span>    <span class="keywordflow">if</span> (connState-&gt;<a class="code hl_variable" href="classConnStateData.html#abca96f1a2792ad7128762d1dac280cd6">sslBumpMode</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a0048f5b977ec8cb08f3afa8f9554876a">Ssl::bumpTerminate</a>) {</div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span>        connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span>    }</div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span> </div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span>    <span class="keywordflow">if</span> (!connState-&gt;<a class="code hl_function" href="classConnStateData.html#a1130109009a83806a8c4f37f03d33388">fakeAConnectRequest</a>(<span class="stringliteral">&quot;ssl-bump&quot;</span>, connState-&gt;<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>))</div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span>        connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span>}</div>
</div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span> </div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02440" data-start="{" data-end="}">
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a99e22f88fd50b4f1daa837e39f18ab04"> 2440</a></span><a class="code hl_function" href="client__side_8cc.html#a99e22f88fd50b4f1daa837e39f18ab04">httpsAccept</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommAcceptCbParams.html">CommAcceptCbParams</a> &amp;params)</div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span>{</div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span>    <a class="code hl_define" href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a>(params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>);</div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span> </div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span>    <span class="comment">// NP: it is possible the port was reconfigured when the call or accept() was queued.</span></div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span> </div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>    <span class="keywordflow">if</span> (params.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span>        <span class="comment">// Its possible the call was still queued when the client disconnected</span></div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;httpsAccept: &quot;</span> &lt;&lt; params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>-&gt;listenConn &lt;&lt; <span class="stringliteral">&quot;: accept failure: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">xerrno</a>));</div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span>    }</div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span> </div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span>    <span class="keyword">const</span> <span class="keyword">auto</span> xact = <a class="code hl_function" href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a>(params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>);</div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span>    xact-&gt;tcpClient = params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>;</div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span> </div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a> &lt;&lt; <span class="stringliteral">&quot; accepted, starting SSL negotiation.&quot;</span>);</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span>    <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;client https connect&quot;</span>);</div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span> </div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span>    <span class="comment">// Socket is ready, setup the connection manager to start using it</span></div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span>    <span class="keyword">auto</span> *srv = <a class="code hl_function" href="namespaceHttps.html#a9dc3dda85de6a0ad4cc79a24e4a330bb">Https::NewServer</a>(xact);</div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span>    <span class="comment">// XXX: do not abandon the MasterXaction object</span></div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span>    <a class="code hl_function" href="classAsyncJob.html#a1dd42e9842d751193268966d4e0de2fa">AsyncJob::Start</a>(srv); <span class="comment">// usually async-calls postHttpsAccept()</span></div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span>}</div>
</div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span> </div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02465" data-start="{" data-end="}">
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"><a class="line" href="classConnStateData.html#a03599e863786928346e70b03b3d30031"> 2465</a></span><a class="code hl_function" href="classConnStateData.html#a03599e863786928346e70b03b3d30031">ConnStateData::postHttpsAccept</a>()</div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span>{</div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;flags.tunnelSslBumping) {</div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;accept transparent connection: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span> </div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#aa6bcbad5359c0b290dffff6716171c55">ssl_bump</a>) {</div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span>            <a class="code hl_function" href="client__side_8cc.html#a3367b6cc488434bdbffe8eed828b055b">httpsSslBumpAccessCheckDone</a>(<a class="code hl_enumvalue" href="group__ACLAPI.html#gga449cde9b9fa7a3ddb6d83d61080c1df5a9c57583ad491217a69a63fdabf336c8e">ACCESS_DENIED</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span>        }</div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"> 2475</span> </div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span>        <span class="keyword">const</span> <span class="keyword">auto</span> mx = <a class="code hl_function" href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>);</div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span>        mx-&gt;tcpClient = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>;</div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span>        <span class="comment">// Create a fake HTTP request and ALE for the ssl_bump ACL check,</span></div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span>        <span class="comment">// using tproxy/intercept provided destination IP and port.</span></div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span>        <span class="comment">// XXX: Merge with subsequent fakeAConnectRequest(), buildFakeRequest().</span></div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span>        <span class="comment">// XXX: Do this earlier (e.g., in Http[s]::One::Server constructor).</span></div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span>        <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request = <span class="keyword">new</span> <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a>(mx);</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span>        <span class="keyword">static</span> <span class="keywordtype">char</span> ip[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">flags</a> &amp; (<a class="code hl_define" href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a> | <a class="code hl_define" href="Connection_8h.html#a8e482a7d3919ec1fefad794c35a4c81e">COMM_INTERCEPTION</a>));</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span>        request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aab379cecc273683d9744197a8a2efe3f">host</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#a00a47f51e0c2b78115495af295924aee">toStr</a>(ip, <span class="keyword">sizeof</span>(ip)));</div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span>        request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aa09ef977328523ec48e7440c83d728d3">port</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>());</div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span>        request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a222ed70d81b4f8846d6512d3e6da69e8">myportname</a> = <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;name;</div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span>        <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">AccessLogEntry::Pointer</a> connectAle = <span class="keyword">new</span> <a class="code hl_class" href="classAccessLogEntry.html">AccessLogEntry</a>;</div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span>        <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(connectAle);</div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span>        <span class="comment">// TODO: Use these request/ALE when waiting for new bumped transactions.</span></div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span> </div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span>        <span class="keyword">auto</span> acl_checklist = <a class="code hl_function" href="classACLFilledChecklist.html#a0d62153af717fa13fd4dd8b2e509556b">ACLFilledChecklist::Make</a>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#aa6bcbad5359c0b290dffff6716171c55">ssl_bump</a>, request);</div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span>        <a class="code hl_function" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">fillChecklist</a>(*acl_checklist);</div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span>        <span class="comment">// Build a local AccessLogEntry to allow requiresAle() acls work</span></div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span>        acl_checklist-&gt;al = connectAle;</div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span>        acl_checklist-&gt;al-&gt;<a class="code hl_variable" href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">cache</a>.<a class="code hl_variable" href="classAccessLogEntry_1_1CacheDetails.html#a17380db1a07c6fa0aa73c3107650a3f6">start_time</a> = <a class="code hl_variable" href="time_2gadgets_8cc.html#a502612b4a32c5902726b120d713d7952">current_time</a>;</div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span>        acl_checklist-&gt;al-&gt;tcpClient = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>;</div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span>        acl_checklist-&gt;al-&gt;cache.port = <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>;</div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span>        acl_checklist-&gt;al-&gt;cache.caddr = <a class="code hl_variable" href="classConnStateData.html#ab4bed752a0b6a81679cdb594f98e7022">log_addr</a>;</div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span>        acl_checklist-&gt;al-&gt;proxyProtocolHeader = <a class="code hl_variable" href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">proxyProtocolHeader_</a>;</div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span>        acl_checklist-&gt;al-&gt;updateError(<a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>);</div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span>        <a class="code hl_function" href="http_2Message_8h.html#adc5c03415efc511e2b62e809310969b6">HTTPMSGUNLOCK</a>(acl_checklist-&gt;al-&gt;request);</div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span>        acl_checklist-&gt;al-&gt;request = request;</div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>        <a class="code hl_function" href="http_2Message_8h.html#afbf13ecd1cc5c007367ae094c1aa19a9">HTTPMSGLOCK</a>(acl_checklist-&gt;al-&gt;request);</div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span>        <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span>        <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = context ? context-&gt;http : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *log_uri = http ? http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a3f6d0f7008f5302283e91937cdc67f75">log_uri</a> : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span>        acl_checklist-&gt;syncAle(request, log_uri);</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>        <a class="code hl_function" href="classACLFilledChecklist.html#a5521f60eda45233a9424f46161cf8809">ACLFilledChecklist::NonBlockingCheck</a>(std::move(acl_checklist), <a class="code hl_function" href="client__side_8cc.html#a3367b6cc488434bdbffe8eed828b055b">httpsSslBumpAccessCheckDone</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span>        <a class="code hl_function" href="fatal_8cc.html#ab64d40563aeeae7c01b72bea4c3ed032">fatal</a>(<span class="stringliteral">&quot;FATAL: SSL-Bump requires --with-openssl&quot;</span>);</div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>        <a class="code hl_function" href="client__side_8cc.html#a172a2bb05c54e4da9bad9bbcdf9c8ad0">httpsEstablish</a>(<span class="keyword">this</span>, <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.staticContext);</div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>    }</div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span>}</div>
</div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span> </div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02521" data-start="{" data-end="}">
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"><a class="line" href="classConnStateData.html#a76db475761b01f59c02714670741fc90"> 2521</a></span><a class="code hl_function" href="classConnStateData.html#a76db475761b01f59c02714670741fc90">ConnStateData::sslCrtdHandleReplyWrapper</a>(<span class="keywordtype">void</span> *data, <span class="keyword">const</span> <a class="code hl_class" href="classHelper_1_1Reply.html">Helper::Reply</a> &amp;reply)</div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span>{</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span>    <a class="code hl_class" href="classConnStateData.html">ConnStateData</a> * state_data = (<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *)(data);</div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span>    state_data-&gt;<a class="code hl_function" href="classConnStateData.html#a5a4dc94676ec0b6f8cfcb1f906eed6d4">sslCrtdHandleReply</a>(reply);</div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span>}</div>
</div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span> </div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02528" data-start="{" data-end="}">
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"><a class="line" href="classConnStateData.html#a5a4dc94676ec0b6f8cfcb1f906eed6d4"> 2528</a></span><a class="code hl_function" href="classConnStateData.html#a5a4dc94676ec0b6f8cfcb1f906eed6d4">ConnStateData::sslCrtdHandleReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHelper_1_1Reply.html">Helper::Reply</a> &amp;reply)</div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span>{</div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>()) {</div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;Connection gone while waiting for ssl_crtd helper reply; helper reply:&quot;</span> &lt;&lt; reply);</div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"> 2533</span>    }</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span> </div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span>    <span class="keywordflow">if</span> (reply.<a class="code hl_variable" href="classHelper_1_1Reply.html#a9c644b392f1fea31662c2532c25ebaa4">result</a> == <a class="code hl_enumvalue" href="namespaceHelper.html#a35b330f6ec77649f82ba735d7b19a984a69cdbb4d469ada5a0f13681d9ab8940e">Helper::BrokenHelper</a>) {</div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Certificate for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a> &lt;&lt; <span class="stringliteral">&quot; cannot be generated. ssl_crtd response: &quot;</span> &lt;&lt; reply);</div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!reply.<a class="code hl_function" href="classHelper_1_1Reply.html#aa229360b4f0721acd012d1014547d8cc">other</a>().<a class="code hl_function" href="classMemBuf.html#acd16af1c1ce00158c868f6b378b59c8c">hasContent</a>()) {</div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;\&quot;ssl_crtd\&quot; helper returned &lt;NULL&gt; reply.&quot;</span>);</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span>        <a class="code hl_class" href="classSsl_1_1CrtdMessage.html">Ssl::CrtdMessage</a> reply_message(<a class="code hl_enumvalue" href="classSsl_1_1CrtdMessage.html#ae2482f04c31d57ad2ae8866eed8eb1eaad1007523c42a6ffab464059141e9163c">Ssl::CrtdMessage::REPLY</a>);</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span>        <span class="keywordflow">if</span> (reply_message.<a class="code hl_function" href="classSsl_1_1CrtdMessage.html#ab16a925e365a7d69bf83aa7b06a0ef40">parse</a>(reply.<a class="code hl_function" href="classHelper_1_1Reply.html#aa229360b4f0721acd012d1014547d8cc">other</a>().<a class="code hl_function" href="classMemBuf.html#a7a189b679e374a2cca1d01f9ba4e195f">content</a>(), reply.<a class="code hl_function" href="classHelper_1_1Reply.html#aa229360b4f0721acd012d1014547d8cc">other</a>().<a class="code hl_function" href="classMemBuf.html#aaaf0cc30487417b07680613bcf518dca">contentSize</a>()) != <a class="code hl_enumvalue" href="classSsl_1_1CrtdMessage.html#a7d6be0d52d128f19fd067af35b04caacac37d4fc22240e516c2e438929aef8f4b">Ssl::CrtdMessage::OK</a>) {</div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Reply from ssl_crtd for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a> &lt;&lt; <span class="stringliteral">&quot; is incorrect&quot;</span>);</div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span>            <span class="keywordflow">if</span> (reply.<a class="code hl_variable" href="classHelper_1_1Reply.html#a9c644b392f1fea31662c2532c25ebaa4">result</a> != <a class="code hl_enumvalue" href="namespaceHelper.html#a35b330f6ec77649f82ba735d7b19a984af5ab78a4aaa17e6dbcf76c28a2f6d198">Helper::Okay</a>) {</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Certificate for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a> &lt;&lt; <span class="stringliteral">&quot; cannot be generated. ssl_crtd response: &quot;</span> &lt;&lt; reply_message.<a class="code hl_function" href="classSsl_1_1CrtdMessage.html#a6ec98cd6eddf405988732d64ed3efeb5">getBody</a>());</div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Certificate for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a> &lt;&lt; <span class="stringliteral">&quot; was successfully received from ssl_crtd&quot;</span>);</div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> &amp;&amp; (<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a3520bffc77077f787821da0081ede771">Ssl::bumpPeek</a> || <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aa4067f0eef0c928826c7865f55c8057c">Ssl::bumpStare</a>)) {</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span>                    <a class="code hl_function" href="classConnStateData.html#ae33befbd46050504b12953d75a807231">doPeekAndSpliceStep</a>();</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span>                    <span class="keyword">auto</span> ssl = <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl.get();</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span>                    <span class="keywordtype">bool</span> ret = <a class="code hl_function" href="group__ServerProtocolSSLAPI.html#gaa637f8ee27c5c83e8c1264ff57ab91b0">Ssl::configureSSLUsingPkeyAndCertFromMemory</a>(ssl, reply_message.<a class="code hl_function" href="classSsl_1_1CrtdMessage.html#a6ec98cd6eddf405988732d64ed3efeb5">getBody</a>().c_str(), *<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>);</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span>                    <span class="keywordflow">if</span> (!ret)</div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span>                        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Failed to set certificates to ssl object for PeekAndSplice mode&quot;</span>);</div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span> </div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span>                    <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> ctx(<a class="code hl_function" href="namespaceSecurity.html#ad2e4c897d0d9fc3d8716915860ca5426">Security::GetFrom</a>(<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl));</div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span>                    <a class="code hl_function" href="group__ServerProtocolSSLAPI.html#gacba2b8658a052836ea33238f9d55470a">Ssl::configureUnconfiguredSslContext</a>(ctx, <a class="code hl_variable" href="classConnStateData.html#a7941639cfdec70f4e4cec38abee800f1">signAlgorithm</a>, *<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>);</div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span>                    <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> ctx(<a class="code hl_function" href="group__ServerProtocolSSLAPI.html#gab2033cd047ea4081e8f383815753ed39">Ssl::GenerateSslContextUsingPkeyAndCertFromMemory</a>(reply_message.<a class="code hl_function" href="classSsl_1_1CrtdMessage.html#a6ec98cd6eddf405988732d64ed3efeb5">getBody</a>().c_str(), <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure, (<a class="code hl_variable" href="classConnStateData.html#a7941639cfdec70f4e4cec38abee800f1">signAlgorithm</a> == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba3b2f7ad911a421046bc60691daac32d5">Ssl::algSignTrusted</a>)));</div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span>                    <span class="keywordflow">if</span> (ctx &amp;&amp; !<a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span>                        <a class="code hl_function" href="classConnStateData.html#aeeff473d4b7444f702f1402292c48d42">storeTlsContextToCache</a>(<a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>, ctx);</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span>                    <a class="code hl_function" href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4">getSslContextDone</a>(ctx);</div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span>                }</div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span>            }</div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span>        }</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span>    }</div>
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"> 2567</span>    <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> nil;</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span>    <a class="code hl_function" href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4">getSslContextDone</a>(nil);</div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span>}</div>
</div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span> </div>
<div class="foldopen" id="foldopen02571" data-start="{" data-end="}">
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"><a class="line" href="classConnStateData.html#afdc562359cb07fafe88a73eaf9ec6e6a"> 2571</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classConnStateData.html#afdc562359cb07fafe88a73eaf9ec6e6a">ConnStateData::buildSslCertGenerationParams</a>(<a class="code hl_class" href="classSsl_1_1CertificateProperties.html">Ssl::CertificateProperties</a> &amp;certProperties)</div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span>{</div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span>    certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">commonName</a> = <a class="code hl_variable" href="classConnStateData.html#a5d7e0e5953fa47b1f66af94ff1e11e43">sslCommonName_</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>() ? <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>.<a class="code hl_function" href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">c_str</a>() : <a class="code hl_variable" href="classConnStateData.html#a5d7e0e5953fa47b1f66af94ff1e11e43">sslCommonName_</a>.<a class="code hl_function" href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">c_str</a>();</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span> </div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> connectedOk = <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> &amp;&amp; <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_function" href="classSsl_1_1ServerBump.html#ade4dbe5af4cec14e5416a75f51a1c6c7">connectedOk</a>();</div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span>    <span class="keywordflow">if</span> (connectedOk) {</div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span>        <span class="keywordflow">if</span> (X509 *mimicCert = <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#afa21f04f6d7072a8b541732790a0ec18">serverCert</a>.<a class="code hl_function" href="classSecurity_1_1LockingPointer.html#abd5883cbae01116de745ff8496a65664">get</a>())</div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>            certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#abe15b8d355343b1fa18bab6060f1d0bd">mimicCert</a>.<a class="code hl_function" href="classSecurity_1_1LockingPointer.html#ab599b2876300635a15afee3bc7e7af4f">resetAndLock</a>(mimicCert);</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span> </div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span>        <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> checklist(<span class="keyword">nullptr</span>, <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">request</a>.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span>        <a class="code hl_function" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">fillChecklist</a>(checklist);</div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span> </div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span>        <span class="keywordflow">for</span> (<a class="code hl_class" href="classsslproxy__cert__adapt.html">sslproxy_cert_adapt</a> *ca = <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a0e2640ef960e9c60996095d393cfd9c5">ssl_client</a>.<a class="code hl_variable" href="classSquidConfig.html#a192f969ecf6d3604b1e91a8497f0f8a5">cert_adapt</a>; ca != <span class="keyword">nullptr</span>; ca = ca-&gt;next) {</div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span>            <span class="comment">// If the algorithm already set, then ignore it.</span></div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span>            <span class="keywordflow">if</span> ((ca-&gt;alg == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518a6f265ebdf1256dfce0086aa5285af383">Ssl::algSetCommonName</a> &amp;&amp; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a7f540a634da4dc1393dc853a427fb18e">setCommonName</a>) ||</div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span>                    (ca-&gt;alg == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518a33fa176796aac85f607a0e7dc18cb544">Ssl::algSetValidAfter</a> &amp;&amp; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a936ed7b81a65aa2bc1f6c707a53722e5">setValidAfter</a>) ||</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span>                    (ca-&gt;alg == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518ae7a427498f9a8d4b2be6d116bb232696">Ssl::algSetValidBefore</a> &amp;&amp; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#aae49c04db7ded1e07a8f78be8f620db7">setValidBefore</a>) )</div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span> </div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span>            <span class="keywordflow">if</span> (ca-&gt;aclList &amp;&amp; checklist.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>(ca-&gt;aclList).<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>()) {</div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>                <span class="keyword">const</span> <span class="keywordtype">char</span> *alg = <a class="code hl_variable" href="group__SslCrtdSslAPI.html#gaf188fc5926a4a522eef378f7a6e97cf6">Ssl::CertAdaptAlgorithmStr</a>[ca-&gt;alg];</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span>                <span class="keyword">const</span> <span class="keywordtype">char</span> *param = ca-&gt;param;</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span> </div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span>                <span class="comment">// For parameterless CN adaptation, use hostname from the</span></div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span>                <span class="comment">// CONNECT request.</span></div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span>                <span class="keywordflow">if</span> (ca-&gt;alg == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518a6f265ebdf1256dfce0086aa5285af383">Ssl::algSetCommonName</a>) {</div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span>                    <span class="keywordflow">if</span> (!param)</div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span>                        param = <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>.<a class="code hl_function" href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">c_str</a>();</div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span>                    certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">commonName</a> = param;</div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span>                    certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a7f540a634da4dc1393dc853a427fb18e">setCommonName</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ca-&gt;alg == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518a33fa176796aac85f607a0e7dc18cb544">Ssl::algSetValidAfter</a>)</div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span>                    certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a936ed7b81a65aa2bc1f6c707a53722e5">setValidAfter</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ca-&gt;alg == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518ae7a427498f9a8d4b2be6d116bb232696">Ssl::algSetValidBefore</a>)</div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span>                    certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#aae49c04db7ded1e07a8f78be8f620db7">setValidBefore</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span> </div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Matches certificate adaptation algorithm: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span>                       alg &lt;&lt; <span class="stringliteral">&quot; param: &quot;</span> &lt;&lt; (param ? param : <span class="stringliteral">&quot;-&quot;</span>));</div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span>            }</div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span>        }</div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span> </div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span>        certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">signAlgorithm</a> = <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba11c2a5f79f56c3580ea6fb6178cfd570">Ssl::algSignEnd</a>;</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span>        <span class="keywordflow">for</span> (<a class="code hl_class" href="classsslproxy__cert__sign.html">sslproxy_cert_sign</a> *sg = <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a0e2640ef960e9c60996095d393cfd9c5">ssl_client</a>.<a class="code hl_variable" href="classSquidConfig.html#a68726bf1c38ae6752d24c53355e5177e">cert_sign</a>; sg != <span class="keyword">nullptr</span>; sg = sg-&gt;next) {</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span>            <span class="keywordflow">if</span> (sg-&gt;aclList &amp;&amp; checklist.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>(sg-&gt;aclList).<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>()) {</div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span>                certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">signAlgorithm</a> = (<a class="code hl_enumeration" href="group__SslCrtdSslAPI.html#ga87ed0e1c2b78fa6575e2c0c16cff01ab">Ssl::CertSignAlgorithm</a>)sg-&gt;alg;</div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span>            }</div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span>        }</div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span>    } <span class="keywordflow">else</span> {<span class="comment">// did not try to connect (e.g. client-first) or failed to connect</span></div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span>        <span class="comment">// In case of an error while connecting to the secure server, use a</span></div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>        <span class="comment">// trusted certificate, with no mimicked fields and no adaptation</span></div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span>        <span class="comment">// algorithms. There is nothing we can mimic, so we want to minimize the</span></div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span>        <span class="comment">// number of warnings the user will have to see to get to the error page.</span></div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>        <span class="comment">// We will close the connection, so that the trust is not extended to</span></div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>        <span class="comment">// non-Squid content.</span></div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span>        certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">signAlgorithm</a> = <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba3b2f7ad911a421046bc60691daac32d5">Ssl::algSignTrusted</a>;</div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span>    }</div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span> </div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">signAlgorithm</a> != <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba11c2a5f79f56c3580ea6fb6178cfd570">Ssl::algSignEnd</a>);</div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span> </div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span>    <span class="keywordflow">if</span> (certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">signAlgorithm</a> == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba8490e7915099e125cc3004b50c058266">Ssl::algSignUntrusted</a>) {</div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.untrustedSigningCa.cert);</div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span>        certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a696da8f4b3c1a1f1429135bb9759280b">signWithX509</a>.<a class="code hl_function" href="classSecurity_1_1LockingPointer.html#ab599b2876300635a15afee3bc7e7af4f">resetAndLock</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.untrustedSigningCa.cert.get());</div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span>        certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a02801c0f57427909bdc1bd3f25fc05d9">signWithPkey</a>.resetAndLock(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.untrustedSigningCa.pkey.get());</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.signingCa.cert.get());</div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span>        certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a696da8f4b3c1a1f1429135bb9759280b">signWithX509</a>.<a class="code hl_function" href="classSecurity_1_1LockingPointer.html#ab599b2876300635a15afee3bc7e7af4f">resetAndLock</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.signingCa.cert.get());</div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span> </div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.signingCa.pkey)</div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>            certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a02801c0f57427909bdc1bd3f25fc05d9">signWithPkey</a>.resetAndLock(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.signingCa.pkey.get());</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span>    }</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span>    <a class="code hl_variable" href="classConnStateData.html#a7941639cfdec70f4e4cec38abee800f1">signAlgorithm</a> = certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">signAlgorithm</a>;</div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span> </div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span>    certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#af6250b526cf6b3df279810de9544d06f">signHash</a> = <a class="code hl_variable" href="namespaceSsl.html#a77a0059e4dc01bedd3b91f89230574ad">Ssl::DefaultSignHash</a>;</div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span>}</div>
</div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span> </div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span><a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a></div>
<div class="foldopen" id="foldopen02647" data-start="{" data-end="}">
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"><a class="line" href="classConnStateData.html#a7d732f536835dc59e3f85e635e76598c"> 2647</a></span><a class="code hl_function" href="classConnStateData.html#a7d732f536835dc59e3f85e635e76598c">ConnStateData::getTlsContextFromCache</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;cacheKey, <span class="keyword">const</span> <a class="code hl_class" href="classSsl_1_1CertificateProperties.html">Ssl::CertificateProperties</a> &amp;certProperties)</div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span>{</div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Finding SSL certificate for &quot;</span> &lt;&lt; cacheKey &lt;&lt; <span class="stringliteral">&quot; in cache&quot;</span>);</div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span>    <span class="keyword">const</span> <span class="keyword">auto</span> ssl_ctx_cache = <a class="code hl_function" href="namespaceSsl.html#a120da00096164ddaf09963fb45aa2dc7">Ssl::TheGlobalContextStorage</a>().<a class="code hl_function" href="classSsl_1_1GlobalContextStorage.html#a72a41bca276f8d614552bbe2d5d83e93">getLocalStorage</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;s);</div>
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"> 2651</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> ctx = ssl_ctx_cache ? ssl_ctx_cache-&gt;get(cacheKey) : <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="group__ServerProtocolSSLAPI.html#ga8f33496b41afebbd6d8c3191d3d8917a">Ssl::verifySslCertificate</a>(*ctx, certProperties)) {</div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Cached SSL certificate for &quot;</span> &lt;&lt; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">commonName</a> &lt;&lt; <span class="stringliteral">&quot; is valid&quot;</span>);</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span>            <span class="keywordflow">return</span> *ctx;</div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Cached SSL certificate for &quot;</span> &lt;&lt; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">commonName</a> &lt;&lt; <span class="stringliteral">&quot; is out of date. Delete this certificate from cache&quot;</span>);</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span>            <span class="keywordflow">if</span> (ssl_ctx_cache)</div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span>                ssl_ctx_cache-&gt;del(cacheKey);</div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span>        }</div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span>    }</div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span>    <span class="keywordflow">return</span> <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a>(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span>}</div>
</div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span> </div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02665" data-start="{" data-end="}">
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"><a class="line" href="classConnStateData.html#aeeff473d4b7444f702f1402292c48d42"> 2665</a></span><a class="code hl_function" href="classConnStateData.html#aeeff473d4b7444f702f1402292c48d42">ConnStateData::storeTlsContextToCache</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;cacheKey, <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> &amp;ctx)</div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span>{</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span>    <span class="keyword">const</span> <span class="keyword">auto</span> ssl_ctx_cache = <a class="code hl_function" href="namespaceSsl.html#a120da00096164ddaf09963fb45aa2dc7">Ssl::TheGlobalContextStorage</a>().<a class="code hl_function" href="classSsl_1_1GlobalContextStorage.html#a72a41bca276f8d614552bbe2d5d83e93">getLocalStorage</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;s);</div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span>    <span class="keywordflow">if</span> (!ssl_ctx_cache || !ssl_ctx_cache-&gt;add(cacheKey, ctx)) {</div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span>        <span class="comment">// If it is not in storage delete after using. Else storage deleted it.</span></div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span>        <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].dynamicTlsContext = ctx;</div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span>    }</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span>}</div>
</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span> </div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02675" data-start="{" data-end="}">
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"><a class="line" href="classConnStateData.html#a47c605492c85e115ccef1b66bca58a54"> 2675</a></span><a class="code hl_function" href="classConnStateData.html#a47c605492c85e115ccef1b66bca58a54">ConnStateData::getSslContextStart</a>()</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span>{</div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.generateHostCertificates) {</div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>        <a class="code hl_class" href="classSsl_1_1CertificateProperties.html">Ssl::CertificateProperties</a> certProperties;</div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span>        <a class="code hl_function" href="classConnStateData.html#afdc562359cb07fafe88a73eaf9ec6e6a">buildSslCertGenerationParams</a>(certProperties);</div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span> </div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span>        <span class="comment">// Disable caching for bumpPeekAndSplice mode</span></div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span>        <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> &amp;&amp; (<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a3520bffc77077f787821da0081ede771">Ssl::bumpPeek</a> || <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aa4067f0eef0c928826c7865f55c8057c">Ssl::bumpStare</a>))) {</div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span>            <a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>.<a class="code hl_function" href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">clear</a>();</div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span>            <a class="code hl_function" href="group__ServerProtocolSSLAPI.html#ga68b9e5cdd919c6ba8a90c35d16b24203">Ssl::InRamCertificateDbKey</a>(certProperties, <a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>);</div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!<a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>());</div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span> </div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span>            <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> ctx(<a class="code hl_function" href="classConnStateData.html#a7d732f536835dc59e3f85e635e76598c">getTlsContextFromCache</a>(<a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>, certProperties));</div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span>            <span class="keywordflow">if</span> (ctx) {</div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span>                <a class="code hl_function" href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4">getSslContextDone</a>(ctx);</div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span>            }</div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span>        }</div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span> </div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span><span class="preprocessor">#if USE_SSL_CRTD</span></div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Generating SSL certificate for &quot;</span> &lt;&lt; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">commonName</a> &lt;&lt; <span class="stringliteral">&quot; using ssl_crtd.&quot;</span>);</div>
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"> 2697</span>            <a class="code hl_class" href="classSsl_1_1CrtdMessage.html">Ssl::CrtdMessage</a> request_message(<a class="code hl_enumvalue" href="classSsl_1_1CrtdMessage.html#ae2482f04c31d57ad2ae8866eed8eb1eaa7711b142529800543cfcceecb46b1ee9">Ssl::CrtdMessage::REQUEST</a>);</div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span>            request_message.<a class="code hl_function" href="classSsl_1_1CrtdMessage.html#a0d95b965f4020a923ff9779934d98e3c">setCode</a>(<a class="code hl_variable" href="classSsl_1_1CrtdMessage.html#a6388eb57cea29b950604e15b6d529170">Ssl::CrtdMessage::code_new_certificate</a>);</div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span>            request_message.<a class="code hl_function" href="classSsl_1_1CrtdMessage.html#adb501b854f90fc863a05be9d99de4721">composeRequest</a>(certProperties);</div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;SSL crtd request: &quot;</span> &lt;&lt; request_message.<a class="code hl_function" href="classSsl_1_1CrtdMessage.html#afa09c41a96caaeb96dd15aa26da9d4a6">compose</a>().c_str());</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span>            <a class="code hl_function" href="classSsl_1_1Helper.html#a3f523a393ebebc53dffd8bed67043e3e">Ssl::Helper::Submit</a>(request_message, <a class="code hl_function" href="classConnStateData.html#a76db475761b01f59c02714670741fc90">sslCrtdHandleReplyWrapper</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span>        } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;ERROR: Failed to compose ssl_crtd &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span>                   <span class="stringliteral">&quot;request for &quot;</span> &lt;&lt; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">commonName</a> &lt;&lt;</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span>                   <span class="stringliteral">&quot; certificate: &quot;</span> &lt;&lt; e.what() &lt;&lt; <span class="stringliteral">&quot;; will now block to &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span>                   <span class="stringliteral">&quot;generate that certificate.&quot;</span>);</div>
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"> 2708</span>            <span class="comment">// fall through to do blocking in-process generation.</span></div>
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"> 2709</span>        }</div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span><span class="preprocessor">#endif </span><span class="comment">// USE_SSL_CRTD</span></div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span> </div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Generating SSL certificate for &quot;</span> &lt;&lt; certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">commonName</a>);</div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> &amp;&amp; (<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a3520bffc77077f787821da0081ede771">Ssl::bumpPeek</a> || <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aa4067f0eef0c928826c7865f55c8057c">Ssl::bumpStare</a>)) {</div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span>            <a class="code hl_function" href="classConnStateData.html#ae33befbd46050504b12953d75a807231">doPeekAndSpliceStep</a>();</div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span>            <span class="keyword">auto</span> ssl = <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl.get();</div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="group__ServerProtocolSSLAPI.html#ga3a5dd7968318545fa2556ec4df78ca87">Ssl::configureSSL</a>(ssl, certProperties, *<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>))</div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Failed to set certificates to ssl object for PeekAndSplice mode&quot;</span>);</div>
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"> 2718</span> </div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"> 2719</span>            <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> ctx(<a class="code hl_function" href="namespaceSecurity.html#ad2e4c897d0d9fc3d8716915860ca5426">Security::GetFrom</a>(<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl));</div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span>            <a class="code hl_function" href="group__ServerProtocolSSLAPI.html#gacba2b8658a052836ea33238f9d55470a">Ssl::configureUnconfiguredSslContext</a>(ctx, certProperties.<a class="code hl_variable" href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">signAlgorithm</a>, *<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>);</div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span>            <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> dynCtx(<a class="code hl_function" href="group__ServerProtocolSSLAPI.html#ga2e10b88f6a651cc2f1027241c19dbad4">Ssl::GenerateSslContext</a>(certProperties, <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure, (<a class="code hl_variable" href="classConnStateData.html#a7941639cfdec70f4e4cec38abee800f1">signAlgorithm</a> == <a class="code hl_enumvalue" href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba3b2f7ad911a421046bc60691daac32d5">Ssl::algSignTrusted</a>)));</div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span>            <span class="keywordflow">if</span> (dynCtx &amp;&amp; !<a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"> 2724</span>                <a class="code hl_function" href="classConnStateData.html#aeeff473d4b7444f702f1402292c48d42">storeTlsContextToCache</a>(<a class="code hl_variable" href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">sslBumpCertKey</a>, dynCtx);</div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span>            <a class="code hl_function" href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4">getSslContextDone</a>(dynCtx);</div>
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"> 2726</span>        }</div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span>    }</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span> </div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span>    <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> nil;</div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span>    <a class="code hl_function" href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4">getSslContextDone</a>(nil);</div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span>}</div>
</div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span> </div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02735" data-start="{" data-end="}">
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"><a class="line" href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4"> 2735</a></span><a class="code hl_function" href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4">ConnStateData::getSslContextDone</a>(<a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> &amp;ctx)</div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span>{</div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.generateHostCertificates &amp;&amp; !ctx) {</div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;Failed to generate TLS context for &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>);</div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span>    }</div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span> </div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span>    <span class="comment">// If generated ssl context = nullptr, try to use static ssl context.</span></div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span>    <span class="keywordflow">if</span> (!ctx) {</div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.staticContext) {</div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;Closing &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a> &lt;&lt; <span class="stringliteral">&quot; as lacking TLS context&quot;</span>);</div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span>            <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"> 2747</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Using static TLS context.&quot;</span>);</div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span>            ctx = <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.staticContext;</div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span>        }</div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span>    }</div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span> </div>
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"> 2753</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="client__side_8cc.html#a596a46d13b2e131ece4f5d986a1e30ac">httpsCreate</a>(<span class="keyword">this</span>, ctx))</div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span> </div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span>    <span class="comment">// bumped intercepted conns should already have Config.Timeout.request set</span></div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span>    <span class="comment">// but forwarded connections may only have Config.Timeout.lifetime. [Re]set</span></div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span>    <span class="comment">// to make sure the connection does not get stuck on non-SSL clients.</span></div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span>    <a class="code hl_function" href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">resetReadTimeout</a>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">Timeout</a>.<a class="code hl_variable" href="classSquidConfig.html#a57e9c06b9a99354b526a765e5b019c74">request</a>);</div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span> </div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span>    <a class="code hl_variable" href="classConnStateData.html#aae4adb4bf5a824a62fed25c284b56a8b">switchedToHttps_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span> </div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span>    <span class="keyword">auto</span> ssl = <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl.get();</div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span>    BIO *b = SSL_get_rbio(ssl);</div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span>    <a class="code hl_class" href="classSsl_1_1ClientBio.html">Ssl::ClientBio</a> *bio = <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="classSsl_1_1ClientBio.html">Ssl::ClientBio</a> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="openssl_8h.html#a2c4abfe8977f1984d98b5987d315e21c">BIO_get_data</a>(b));</div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span>    bio-&gt;<a class="code hl_function" href="classSsl_1_1ClientBio.html#a48f9b318ad34451b9c1a8976bf133486">setReadBufData</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>);</div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span>    <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">clear</a>();</div>
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"> 2768</span>    <a class="code hl_function" href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38">clientNegotiateSSL</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span>}</div>
</div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span> </div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02772" data-start="{" data-end="}">
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"><a class="line" href="classConnStateData.html#a2d458e5d1aecb62f7a9568e34467262c"> 2772</a></span><a class="code hl_function" href="classConnStateData.html#a2d458e5d1aecb62f7a9568e34467262c">ConnStateData::switchToHttps</a>(<a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http, <a class="code hl_enumeration" href="group__ServerProtocolSSLAPI.html#gae6b7865118af149a83cc4569060c1af9">Ssl::BumpMode</a> bumpServerMode)</div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span>{</div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!<a class="code hl_variable" href="classConnStateData.html#aae4adb4bf5a824a62fed25c284b56a8b">switchedToHttps_</a>);</div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>);</div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"> 2776</span>    <span class="keyword">auto</span> &amp;request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span> </div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span>    <span class="comment">// Depending on receivedFirstByte_, we are at the start of either an</span></div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span>    <span class="comment">// established CONNECT tunnel with the client or an intercepted TCP (and</span></div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span>    <span class="comment">// presumably TLS) connection from the client. Expect TLS Client Hello.</span></div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"> 2781</span>    <span class="keyword">const</span> <span class="keyword">auto</span> insideConnectTunnel = <a class="code hl_variable" href="classServer.html#a6101c252f4eaf112503cb9d21d5eb5ce">receivedFirstByte_</a>;</div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, (insideConnectTunnel ? <span class="stringliteral">&quot;post-CONNECT &quot;</span> : <span class="stringliteral">&quot;raw TLS &quot;</span>) &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span> </div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span>    <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a> = request-&gt;url.hostOrIp();</div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span>    <a class="code hl_variable" href="classConnStateData.html#a7f762686d33660c311ee33b8545a9759">tlsConnectPort</a> = request-&gt;url.port();</div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span>    <a class="code hl_function" href="classConnStateData.html#a619aca0ed2a6bc79fc247b427c02c56b">resetSslCommonName</a>(request-&gt;url.host());</div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span> </div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span>    <span class="comment">// We are going to read new request</span></div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span>    <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span> </div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"> 2791</span>    <span class="comment">// keep version major.minor details the same.</span></div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span>    <span class="comment">// but we are now performing the HTTPS handshake traffic</span></div>
<div class="line"><a id="l02793" name="l02793"></a><span class="lineno"> 2793</span>    <a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a>.<a class="code hl_variable" href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">protocol</a> = <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca0f99ccafd63891be16873f9f2abe94ba">AnyP::PROTO_HTTPS</a>;</div>
<div class="line"><a id="l02794" name="l02794"></a><span class="lineno"> 2794</span> </div>
<div class="line"><a id="l02795" name="l02795"></a><span class="lineno"> 2795</span>    <span class="comment">// If sslServerBump is set, then we have decided to deny CONNECT</span></div>
<div class="line"><a id="l02796" name="l02796"></a><span class="lineno"> 2796</span>    <span class="comment">// and now want to switch to SSL to send the error to the client</span></div>
<div class="line"><a id="l02797" name="l02797"></a><span class="lineno"> 2797</span>    <span class="comment">// without even peeking at the origin server certificate.</span></div>
<div class="line"><a id="l02798" name="l02798"></a><span class="lineno"> 2798</span>    <span class="keywordflow">if</span> (bumpServerMode == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9ac82a0f09e800f147573716d281aad690">Ssl::bumpServerFirst</a> &amp;&amp; !<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>) {</div>
<div class="line"><a id="l02799" name="l02799"></a><span class="lineno"> 2799</span>        request-&gt;flags.sslPeek = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02800" name="l02800"></a><span class="lineno"> 2800</span>        <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> = <span class="keyword">new</span> <a class="code hl_class" href="classSsl_1_1ServerBump.html">Ssl::ServerBump</a>(http);</div>
<div class="line"><a id="l02801" name="l02801"></a><span class="lineno"> 2801</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bumpServerMode == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a3520bffc77077f787821da0081ede771">Ssl::bumpPeek</a> || bumpServerMode == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aa4067f0eef0c928826c7865f55c8057c">Ssl::bumpStare</a>) {</div>
<div class="line"><a id="l02802" name="l02802"></a><span class="lineno"> 2802</span>        request-&gt;flags.sslPeek = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02803" name="l02803"></a><span class="lineno"> 2803</span>        <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> = <span class="keyword">new</span> <a class="code hl_class" href="classSsl_1_1ServerBump.html">Ssl::ServerBump</a>(http, <span class="keyword">nullptr</span>, bumpServerMode);</div>
<div class="line"><a id="l02804" name="l02804"></a><span class="lineno"> 2804</span>    }</div>
<div class="line"><a id="l02805" name="l02805"></a><span class="lineno"> 2805</span> </div>
<div class="line"><a id="l02806" name="l02806"></a><span class="lineno"> 2806</span>    <span class="comment">// commSetConnTimeout() was called for this request before we switched.</span></div>
<div class="line"><a id="l02807" name="l02807"></a><span class="lineno"> 2807</span>    <span class="comment">// Fix timeout to request_start_timeout</span></div>
<div class="line"><a id="l02808" name="l02808"></a><span class="lineno"> 2808</span>    <a class="code hl_function" href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">resetReadTimeout</a>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">Timeout</a>.<a class="code hl_variable" href="classSquidConfig.html#a0b1074aa43f2a83f9c26ede921fab749">request_start_timeout</a>);</div>
<div class="line"><a id="l02809" name="l02809"></a><span class="lineno"> 2809</span>    <span class="comment">// Also reset receivedFirstByte_ flag to allow this timeout work in the case we have</span></div>
<div class="line"><a id="l02810" name="l02810"></a><span class="lineno"> 2810</span>    <span class="comment">// a bumped &quot;connect&quot; request on non transparent port.</span></div>
<div class="line"><a id="l02811" name="l02811"></a><span class="lineno"> 2811</span>    <a class="code hl_variable" href="classServer.html#a6101c252f4eaf112503cb9d21d5eb5ce">receivedFirstByte_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02812" name="l02812"></a><span class="lineno"> 2812</span>    <span class="comment">// Get more data to peek at Tls</span></div>
<div class="line"><a id="l02813" name="l02813"></a><span class="lineno"> 2813</span>    <a class="code hl_variable" href="classConnStateData.html#adbe8b3f0075d4ba6c7a0ac7c62b43a23">parsingTlsHandshake</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02814" name="l02814"></a><span class="lineno"> 2814</span> </div>
<div class="line"><a id="l02815" name="l02815"></a><span class="lineno"> 2815</span>    <span class="comment">// If the protocol has changed, then reset preservingClientData_.</span></div>
<div class="line"><a id="l02816" name="l02816"></a><span class="lineno"> 2816</span>    <span class="comment">// Otherwise, its value initially set in start() is still valid/fresh.</span></div>
<div class="line"><a id="l02817" name="l02817"></a><span class="lineno"> 2817</span>    <span class="comment">// shouldPreserveClientData() uses parsingTlsHandshake which is reset above.</span></div>
<div class="line"><a id="l02818" name="l02818"></a><span class="lineno"> 2818</span>    <span class="keywordflow">if</span> (insideConnectTunnel)</div>
<div class="line"><a id="l02819" name="l02819"></a><span class="lineno"> 2819</span>        <a class="code hl_variable" href="classConnStateData.html#a6c10d6b2f8d50beaf9d32a6790c80a40">preservingClientData_</a> = <a class="code hl_function" href="classConnStateData.html#a847fd8d20965e6c7dd56c1cdab67ea90">shouldPreserveClientData</a>();</div>
<div class="line"><a id="l02820" name="l02820"></a><span class="lineno"> 2820</span> </div>
<div class="line"><a id="l02821" name="l02821"></a><span class="lineno"> 2821</span>    <a class="code hl_function" href="classServer.html#a12cdf2616768902693acb3896283d29b">readSomeData</a>();</div>
<div class="line"><a id="l02822" name="l02822"></a><span class="lineno"> 2822</span>}</div>
</div>
<div class="line"><a id="l02823" name="l02823"></a><span class="lineno"> 2823</span> </div>
<div class="line"><a id="l02824" name="l02824"></a><span class="lineno"> 2824</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02825" data-start="{" data-end="}">
<div class="line"><a id="l02825" name="l02825"></a><span class="lineno"><a class="line" href="classConnStateData.html#a849eb5ad88b43ff7aa44d1b53620ca27"> 2825</a></span><a class="code hl_function" href="classConnStateData.html#a849eb5ad88b43ff7aa44d1b53620ca27">ConnStateData::parseTlsHandshake</a>()</div>
<div class="line"><a id="l02826" name="l02826"></a><span class="lineno"> 2826</span>{</div>
<div class="line"><a id="l02827" name="l02827"></a><span class="lineno"> 2827</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#adbe8b3f0075d4ba6c7a0ac7c62b43a23">parsingTlsHandshake</a>);</div>
<div class="line"><a id="l02828" name="l02828"></a><span class="lineno"> 2828</span> </div>
<div class="line"><a id="l02829" name="l02829"></a><span class="lineno"> 2829</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>());</div>
<div class="line"><a id="l02830" name="l02830"></a><span class="lineno"> 2830</span>    <a class="code hl_function" href="classConnStateData.html#aa891eb1dafb6ef7c0eefb8b1bf4fa737">receivedFirstByte</a>();</div>
<div class="line"><a id="l02831" name="l02831"></a><span class="lineno"> 2831</span>    <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;Parsing TLS handshake&quot;</span>);</div>
<div class="line"><a id="l02832" name="l02832"></a><span class="lineno"> 2832</span> </div>
<div class="line"><a id="l02833" name="l02833"></a><span class="lineno"> 2833</span>    <span class="comment">// stops being nil if we fail to parse the handshake</span></div>
<div class="line"><a id="l02834" name="l02834"></a><span class="lineno"> 2834</span>    <a class="code hl_class" href="classRefCount.html">ErrorDetail::Pointer</a> parseErrorDetails;</div>
<div class="line"><a id="l02835" name="l02835"></a><span class="lineno"> 2835</span> </div>
<div class="line"><a id="l02836" name="l02836"></a><span class="lineno"> 2836</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l02837" name="l02837"></a><span class="lineno"> 2837</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#aedb54ea087dba0ed0294345997c8f4d6">tlsParser</a>.<a class="code hl_function" href="classSecurity_1_1HandshakeParser.html#a8d67c95e311df6afd49d7a790d0eb085">parseHello</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>)) {</div>
<div class="line"><a id="l02838" name="l02838"></a><span class="lineno"> 2838</span>            <span class="comment">// need more data to finish parsing</span></div>
<div class="line"><a id="l02839" name="l02839"></a><span class="lineno"> 2839</span>            <a class="code hl_function" href="classServer.html#a12cdf2616768902693acb3896283d29b">readSomeData</a>();</div>
<div class="line"><a id="l02840" name="l02840"></a><span class="lineno"> 2840</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02841" name="l02841"></a><span class="lineno"> 2841</span>        }</div>
<div class="line"><a id="l02842" name="l02842"></a><span class="lineno"> 2842</span>    }</div>
<div class="line"><a id="l02843" name="l02843"></a><span class="lineno"> 2843</span>    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code hl_class" href="classTextException.html">TextException</a> &amp;ex) {</div>
<div class="line"><a id="l02844" name="l02844"></a><span class="lineno"> 2844</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <span class="stringliteral">&quot;exception: &quot;</span> &lt;&lt; ex);</div>
<div class="line"><a id="l02845" name="l02845"></a><span class="lineno"> 2845</span>        parseErrorDetails = <span class="keyword">new</span> <a class="code hl_class" href="classExceptionErrorDetail.html">ExceptionErrorDetail</a>(ex.<a class="code hl_function" href="classTextException.html#abfea83f3cf2b694b5c9d8ab98fe9b6d0">id</a>());</div>
<div class="line"><a id="l02846" name="l02846"></a><span class="lineno"> 2846</span>    }</div>
<div class="line"><a id="l02847" name="l02847"></a><span class="lineno"> 2847</span>    <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><a id="l02848" name="l02848"></a><span class="lineno"> 2848</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <span class="stringliteral">&quot;exception: &quot;</span> &lt;&lt; <a class="code hl_function" href="TextException_8cc.html#aa73ff10b84f321d18602cf47b8695dd5">CurrentException</a>);</div>
<div class="line"><a id="l02849" name="l02849"></a><span class="lineno"> 2849</span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> d = <a class="code hl_function" href="Detail_8cc.html#a3daf1a4d3c9feca00e60712558a94558">MakeNamedErrorDetail</a>(<span class="stringliteral">&quot;TLS_ACCEPT_PARSE&quot;</span>);</div>
<div class="line"><a id="l02850" name="l02850"></a><span class="lineno"> 2850</span>        parseErrorDetails = d;</div>
<div class="line"><a id="l02851" name="l02851"></a><span class="lineno"> 2851</span>    }</div>
<div class="line"><a id="l02852" name="l02852"></a><span class="lineno"> 2852</span> </div>
<div class="line"><a id="l02853" name="l02853"></a><span class="lineno"> 2853</span>    <a class="code hl_variable" href="classConnStateData.html#adbe8b3f0075d4ba6c7a0ac7c62b43a23">parsingTlsHandshake</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02854" name="l02854"></a><span class="lineno"> 2854</span> </div>
<div class="line"><a id="l02855" name="l02855"></a><span class="lineno"> 2855</span>    <span class="comment">// client data may be needed for splicing and for</span></div>
<div class="line"><a id="l02856" name="l02856"></a><span class="lineno"> 2856</span>    <span class="comment">// tunneling unsupportedProtocol after an error</span></div>
<div class="line"><a id="l02857" name="l02857"></a><span class="lineno"> 2857</span>    <a class="code hl_variable" href="classConnStateData.html#a91a16739a0d5277fb2af4f54f5baf5f5">preservedClientData</a> = <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>;</div>
<div class="line"><a id="l02858" name="l02858"></a><span class="lineno"> 2858</span> </div>
<div class="line"><a id="l02859" name="l02859"></a><span class="lineno"> 2859</span>    <span class="comment">// Even if the parser failed, each TLS detail should either be set</span></div>
<div class="line"><a id="l02860" name="l02860"></a><span class="lineno"> 2860</span>    <span class="comment">// correctly or still be &quot;unknown&quot;; copying unknown detail is a no-op.</span></div>
<div class="line"><a id="l02861" name="l02861"></a><span class="lineno"> 2861</span>    <a class="code hl_class" href="classRefCount.html">Security::TlsDetails::Pointer</a> <span class="keyword">const</span> &amp;details = <a class="code hl_variable" href="classConnStateData.html#aedb54ea087dba0ed0294345997c8f4d6">tlsParser</a>.<a class="code hl_variable" href="classSecurity_1_1HandshakeParser.html#a50569cdaf13012704027c283b5d47e31">details</a>;</div>
<div class="line"><a id="l02862" name="l02862"></a><span class="lineno"> 2862</span>    <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#ad896c0e8f260771b0d5d229357ef8acc">tlsNegotiations</a>()-&gt;<a class="code hl_function" href="classSecurity_1_1NegotiationHistory.html#a49368783be183f00d1da3fdabb559844">retrieveParsedInfo</a>(details);</div>
<div class="line"><a id="l02863" name="l02863"></a><span class="lineno"> 2863</span>    <span class="keywordflow">if</span> (details &amp;&amp; !details-&gt;serverName.isEmpty()) {</div>
<div class="line"><a id="l02864" name="l02864"></a><span class="lineno"> 2864</span>        <a class="code hl_function" href="classConnStateData.html#a619aca0ed2a6bc79fc247b427c02c56b">resetSslCommonName</a>(details-&gt;serverName.c_str());</div>
<div class="line"><a id="l02865" name="l02865"></a><span class="lineno"> 2865</span>        <a class="code hl_variable" href="classConnStateData.html#a4dcb7a1c309024f3032f7d70b8827a96">tlsClientSni_</a> = details-&gt;serverName;</div>
<div class="line"><a id="l02866" name="l02866"></a><span class="lineno"> 2866</span>    }</div>
<div class="line"><a id="l02867" name="l02867"></a><span class="lineno"> 2867</span> </div>
<div class="line"><a id="l02868" name="l02868"></a><span class="lineno"> 2868</span>    <span class="comment">// We should disable read/write handlers</span></div>
<div class="line"><a id="l02869" name="l02869"></a><span class="lineno"> 2869</span>    <a class="code hl_function" href="namespaceComm.html#a4bfe8d9fd94f42d950099a60be308b17">Comm::ResetSelect</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>);</div>
<div class="line"><a id="l02870" name="l02870"></a><span class="lineno"> 2870</span> </div>
<div class="line"><a id="l02871" name="l02871"></a><span class="lineno"> 2871</span>    <span class="keywordflow">if</span> (parseErrorDetails) {</div>
<div class="line"><a id="l02872" name="l02872"></a><span class="lineno"> 2872</span>        <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l02873" name="l02873"></a><span class="lineno"> 2873</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(context &amp;&amp; context-&gt;http);</div>
<div class="line"><a id="l02874" name="l02874"></a><span class="lineno"> 2874</span>        <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> request = context-&gt;http-&gt;request;</div>
<div class="line"><a id="l02875" name="l02875"></a><span class="lineno"> 2875</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 5, <span class="stringliteral">&quot;Got something other than TLS Client Hello. Cannot SslBump.&quot;</span>);</div>
<div class="line"><a id="l02876" name="l02876"></a><span class="lineno"> 2876</span>        <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa1771725fc43b0def5b6bdafaf014ab92">ERR_PROTOCOL_UNKNOWN</a>, parseErrorDetails);</div>
<div class="line"><a id="l02877" name="l02877"></a><span class="lineno"> 2877</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#ae85c6fd07a8415d08b9672de277ee24e">tunnelOnError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa1771725fc43b0def5b6bdafaf014ab92">ERR_PROTOCOL_UNKNOWN</a>))</div>
<div class="line"><a id="l02878" name="l02878"></a><span class="lineno"> 2878</span>            <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02879" name="l02879"></a><span class="lineno"> 2879</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02880" name="l02880"></a><span class="lineno"> 2880</span>    }</div>
<div class="line"><a id="l02881" name="l02881"></a><span class="lineno"> 2881</span> </div>
<div class="line"><a id="l02882" name="l02882"></a><span class="lineno"> 2882</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> || <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a63dd03e830a0746569e5635a3dfa28dc">Ssl::bumpClientFirst</a>) { <span class="comment">// Either means client-first.</span></div>
<div class="line"><a id="l02883" name="l02883"></a><span class="lineno"> 2883</span>        <a class="code hl_function" href="classConnStateData.html#a47c605492c85e115ccef1b66bca58a54">getSslContextStart</a>();</div>
<div class="line"><a id="l02884" name="l02884"></a><span class="lineno"> 2884</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02885" name="l02885"></a><span class="lineno"> 2885</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9ac82a0f09e800f147573716d281aad690">Ssl::bumpServerFirst</a>) {</div>
<div class="line"><a id="l02886" name="l02886"></a><span class="lineno"> 2886</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 5, <span class="stringliteral">&quot;server-first skips step2; start forwarding the request&quot;</span>);</div>
<div class="line"><a id="l02887" name="l02887"></a><span class="lineno"> 2887</span>        <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#aaa318ba6ee683f0db877f2d3f34fea52">step</a> = <a class="code hl_enumvalue" href="XactionStep_8h.html#aaaaea1f6a486ef01fc1b35f92f6a81eeae2e942186ef7a2e4cb3b91412e241889">XactionStep::tlsBump3</a>;</div>
<div class="line"><a id="l02888" name="l02888"></a><span class="lineno"> 2888</span>        <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l02889" name="l02889"></a><span class="lineno"> 2889</span>        <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = context ? context-&gt;http : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02890" name="l02890"></a><span class="lineno"> 2890</span>        <span class="comment">// will call httpsPeeked() with certificate and connection, eventually</span></div>
<div class="line"><a id="l02891" name="l02891"></a><span class="lineno"> 2891</span>        <a class="code hl_function" href="classFwdState.html#a391d66921577e62e543723f978062e97">FwdState::Start</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>, <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a51cb62b4cccfa1e6d1e0b9f97bdb76cd">entry</a>, <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">request</a>.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>(), http ? http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a> : <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l02892" name="l02892"></a><span class="lineno"> 2892</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02893" name="l02893"></a><span class="lineno"> 2893</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a3520bffc77077f787821da0081ede771">Ssl::bumpPeek</a> || <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">step1</a> == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aa4067f0eef0c928826c7865f55c8057c">Ssl::bumpStare</a>);</div>
<div class="line"><a id="l02894" name="l02894"></a><span class="lineno"> 2894</span>        <a class="code hl_function" href="classConnStateData.html#abbfb5c2cf9071ecb5e439cb26de14218">startPeekAndSplice</a>();</div>
<div class="line"><a id="l02895" name="l02895"></a><span class="lineno"> 2895</span>    }</div>
<div class="line"><a id="l02896" name="l02896"></a><span class="lineno"> 2896</span>}</div>
</div>
<div class="line"><a id="l02897" name="l02897"></a><span class="lineno"> 2897</span> </div>
<div class="line"><a id="l02898" name="l02898"></a><span class="lineno"> 2898</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02899" data-start="{" data-end="}">
<div class="line"><a id="l02899" name="l02899"></a><span class="lineno"><a class="line" href="client__side_8cc.html#acb06d6b31feae712eada0ba24c2c009f"> 2899</a></span><a class="code hl_function" href="client__side_8cc.html#acb06d6b31feae712eada0ba24c2c009f">httpsSslBumpStep2AccessCheckDone</a>(<a class="code hl_class" href="classAcl_1_1Answer.html">Acl::Answer</a> answer, <span class="keywordtype">void</span> *data)</div>
<div class="line"><a id="l02900" name="l02900"></a><span class="lineno"> 2900</span>{</div>
<div class="line"><a id="l02901" name="l02901"></a><span class="lineno"> 2901</span>    <a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *connState = (<a class="code hl_class" href="classConnStateData.html">ConnStateData</a> *) data;</div>
<div class="line"><a id="l02902" name="l02902"></a><span class="lineno"> 2902</span> </div>
<div class="line"><a id="l02903" name="l02903"></a><span class="lineno"> 2903</span>    <span class="comment">// if the connection is closed or closing, just return.</span></div>
<div class="line"><a id="l02904" name="l02904"></a><span class="lineno"> 2904</span>    <span class="keywordflow">if</span> (!connState-&gt;<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>())</div>
<div class="line"><a id="l02905" name="l02905"></a><span class="lineno"> 2905</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02906" name="l02906"></a><span class="lineno"> 2906</span> </div>
<div class="line"><a id="l02907" name="l02907"></a><span class="lineno"> 2907</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Answer: &quot;</span> &lt;&lt; answer &lt;&lt; <span class="stringliteral">&quot; kind:&quot;</span> &lt;&lt; answer.<a class="code hl_variable" href="classAcl_1_1Answer.html#a2c742f67e11b7b92c02b286f91339298">kind</a>);</div>
<div class="line"><a id="l02908" name="l02908"></a><span class="lineno"> 2908</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(connState-&gt;<a class="code hl_function" href="classConnStateData.html#a0452329238b5201c25f125bfd39ebd5f">serverBump</a>());</div>
<div class="line"><a id="l02909" name="l02909"></a><span class="lineno"> 2909</span>    <a class="code hl_enumeration" href="group__ServerProtocolSSLAPI.html#gae6b7865118af149a83cc4569060c1af9">Ssl::BumpMode</a> bumpAction;</div>
<div class="line"><a id="l02910" name="l02910"></a><span class="lineno"> 2910</span>    <span class="keywordflow">if</span> (answer.<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>()) {</div>
<div class="line"><a id="l02911" name="l02911"></a><span class="lineno"> 2911</span>        bumpAction = (<a class="code hl_enumeration" href="group__ServerProtocolSSLAPI.html#gae6b7865118af149a83cc4569060c1af9">Ssl::BumpMode</a>)answer.<a class="code hl_variable" href="classAcl_1_1Answer.html#a2c742f67e11b7b92c02b286f91339298">kind</a>;</div>
<div class="line"><a id="l02912" name="l02912"></a><span class="lineno"> 2912</span>    } <span class="keywordflow">else</span></div>
<div class="line"><a id="l02913" name="l02913"></a><span class="lineno"> 2913</span>        bumpAction = <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aaa41037e8896833d425589e945cbb064">Ssl::bumpSplice</a>;</div>
<div class="line"><a id="l02914" name="l02914"></a><span class="lineno"> 2914</span> </div>
<div class="line"><a id="l02915" name="l02915"></a><span class="lineno"> 2915</span>    connState-&gt;<a class="code hl_function" href="classConnStateData.html#a0452329238b5201c25f125bfd39ebd5f">serverBump</a>()-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">act</a>.<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a83a1623a479040e0badfcc858c1b034c">step2</a> = bumpAction;</div>
<div class="line"><a id="l02916" name="l02916"></a><span class="lineno"> 2916</span>    connState-&gt;<a class="code hl_variable" href="classConnStateData.html#abca96f1a2792ad7128762d1dac280cd6">sslBumpMode</a> = bumpAction;</div>
<div class="line"><a id="l02917" name="l02917"></a><span class="lineno"> 2917</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = connState-&gt;<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l02918" name="l02918"></a><span class="lineno"> 2918</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = (context ? context-&gt;http : <span class="keyword">nullptr</span>))</div>
<div class="line"><a id="l02919" name="l02919"></a><span class="lineno"> 2919</span>        http-&gt;al-&gt;ssl.bumpMode = bumpAction;</div>
<div class="line"><a id="l02920" name="l02920"></a><span class="lineno"> 2920</span> </div>
<div class="line"><a id="l02921" name="l02921"></a><span class="lineno"> 2921</span>    <span class="keywordflow">if</span> (bumpAction == <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a0048f5b977ec8cb08f3afa8f9554876a">Ssl::bumpTerminate</a>) {</div>
<div class="line"><a id="l02922" name="l02922"></a><span class="lineno"> 2922</span>        connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02923" name="l02923"></a><span class="lineno"> 2923</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bumpAction != <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aaa41037e8896833d425589e945cbb064">Ssl::bumpSplice</a>) {</div>
<div class="line"><a id="l02924" name="l02924"></a><span class="lineno"> 2924</span>        connState-&gt;<a class="code hl_function" href="classConnStateData.html#abbfb5c2cf9071ecb5e439cb26de14218">startPeekAndSplice</a>();</div>
<div class="line"><a id="l02925" name="l02925"></a><span class="lineno"> 2925</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!connState-&gt;<a class="code hl_function" href="classConnStateData.html#a49bf6c56e934b45073feea54e341c76d">splice</a>())</div>
<div class="line"><a id="l02926" name="l02926"></a><span class="lineno"> 2926</span>        connState-&gt;<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l02927" name="l02927"></a><span class="lineno"> 2927</span>}</div>
</div>
<div class="line"><a id="l02928" name="l02928"></a><span class="lineno"> 2928</span> </div>
<div class="line"><a id="l02929" name="l02929"></a><span class="lineno"> 2929</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen02930" data-start="{" data-end="}">
<div class="line"><a id="l02930" name="l02930"></a><span class="lineno"><a class="line" href="classConnStateData.html#a49bf6c56e934b45073feea54e341c76d"> 2930</a></span><a class="code hl_function" href="classConnStateData.html#a49bf6c56e934b45073feea54e341c76d">ConnStateData::splice</a>()</div>
<div class="line"><a id="l02931" name="l02931"></a><span class="lineno"> 2931</span>{</div>
<div class="line"><a id="l02932" name="l02932"></a><span class="lineno"> 2932</span>    <span class="comment">// normally we can splice here, because we just got client hello message</span></div>
<div class="line"><a id="l02933" name="l02933"></a><span class="lineno"> 2933</span> </div>
<div class="line"><a id="l02934" name="l02934"></a><span class="lineno"> 2934</span>    <span class="comment">// fde::ssl/tls_read_method() probably reads from our own inBuf. If so, then</span></div>
<div class="line"><a id="l02935" name="l02935"></a><span class="lineno"> 2935</span>    <span class="comment">// we should not lose any raw bytes when switching to raw I/O here.</span></div>
<div class="line"><a id="l02936" name="l02936"></a><span class="lineno"> 2936</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl.get())</div>
<div class="line"><a id="l02937" name="l02937"></a><span class="lineno"> 2937</span>        <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].useDefaultIo();</div>
<div class="line"><a id="l02938" name="l02938"></a><span class="lineno"> 2938</span> </div>
<div class="line"><a id="l02939" name="l02939"></a><span class="lineno"> 2939</span>    <span class="comment">// XXX: assuming that there was an HTTP/1.1 CONNECT to begin with...</span></div>
<div class="line"><a id="l02940" name="l02940"></a><span class="lineno"> 2940</span>    <span class="comment">// reset the current protocol to HTTP/1.1 (was &quot;HTTPS&quot; for the bumping process)</span></div>
<div class="line"><a id="l02941" name="l02941"></a><span class="lineno"> 2941</span>    <a class="code hl_variable" href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">transferProtocol</a> = <a class="code hl_function" href="namespaceHttp.html#a8f5de7a6ddd395e9aaf0dffd043c2276">Http::ProtocolVersion</a>();</div>
<div class="line"><a id="l02942" name="l02942"></a><span class="lineno"> 2942</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>());</div>
<div class="line"><a id="l02943" name="l02943"></a><span class="lineno"> 2943</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l02944" name="l02944"></a><span class="lineno"> 2944</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(context);</div>
<div class="line"><a id="l02945" name="l02945"></a><span class="lineno"> 2945</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(context-&gt;http);</div>
<div class="line"><a id="l02946" name="l02946"></a><span class="lineno"> 2946</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = context-&gt;http;</div>
<div class="line"><a id="l02947" name="l02947"></a><span class="lineno"> 2947</span>    <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l02948" name="l02948"></a><span class="lineno"> 2948</span>    context-&gt;finished();</div>
<div class="line"><a id="l02949" name="l02949"></a><span class="lineno"> 2949</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>()) {</div>
<div class="line"><a id="l02950" name="l02950"></a><span class="lineno"> 2950</span>        <span class="comment">// For transparent connections, make a new fake CONNECT request, now</span></div>
<div class="line"><a id="l02951" name="l02951"></a><span class="lineno"> 2951</span>        <span class="comment">// with SNI as target. doCallout() checks, adaptations may need that.</span></div>
<div class="line"><a id="l02952" name="l02952"></a><span class="lineno"> 2952</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a1130109009a83806a8c4f37f03d33388">fakeAConnectRequest</a>(<span class="stringliteral">&quot;splice&quot;</span>, <a class="code hl_variable" href="classConnStateData.html#a91a16739a0d5277fb2af4f54f5baf5f5">preservedClientData</a>);</div>
<div class="line"><a id="l02953" name="l02953"></a><span class="lineno"> 2953</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02954" name="l02954"></a><span class="lineno"> 2954</span>        <span class="comment">// For non transparent connections  make a new tunneled CONNECT, which</span></div>
<div class="line"><a id="l02955" name="l02955"></a><span class="lineno"> 2955</span>        <span class="comment">// also sets the HttpRequest::flags::forceTunnel flag to avoid</span></div>
<div class="line"><a id="l02956" name="l02956"></a><span class="lineno"> 2956</span>        <span class="comment">// respond with &quot;Connection Established&quot; to the client.</span></div>
<div class="line"><a id="l02957" name="l02957"></a><span class="lineno"> 2957</span>        <span class="comment">// This fake CONNECT request required to allow use of SNI in</span></div>
<div class="line"><a id="l02958" name="l02958"></a><span class="lineno"> 2958</span>        <span class="comment">// doCallout() checks and adaptations.</span></div>
<div class="line"><a id="l02959" name="l02959"></a><span class="lineno"> 2959</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#a49651ee9330d4206ff880a3fe93ee726">initiateTunneledRequest</a>(request, <span class="stringliteral">&quot;splice&quot;</span>, <a class="code hl_variable" href="classConnStateData.html#a91a16739a0d5277fb2af4f54f5baf5f5">preservedClientData</a>);</div>
<div class="line"><a id="l02960" name="l02960"></a><span class="lineno"> 2960</span>    }</div>
<div class="line"><a id="l02961" name="l02961"></a><span class="lineno"> 2961</span>}</div>
</div>
<div class="line"><a id="l02962" name="l02962"></a><span class="lineno"> 2962</span> </div>
<div class="line"><a id="l02963" name="l02963"></a><span class="lineno"> 2963</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen02964" data-start="{" data-end="}">
<div class="line"><a id="l02964" name="l02964"></a><span class="lineno"><a class="line" href="classConnStateData.html#abbfb5c2cf9071ecb5e439cb26de14218"> 2964</a></span><a class="code hl_function" href="classConnStateData.html#abbfb5c2cf9071ecb5e439cb26de14218">ConnStateData::startPeekAndSplice</a>()</div>
<div class="line"><a id="l02965" name="l02965"></a><span class="lineno"> 2965</span>{</div>
<div class="line"><a id="l02966" name="l02966"></a><span class="lineno"> 2966</span>    <span class="comment">// This is the Step2 of the SSL bumping</span></div>
<div class="line"><a id="l02967" name="l02967"></a><span class="lineno"> 2967</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>);</div>
<div class="line"><a id="l02968" name="l02968"></a><span class="lineno"> 2968</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l02969" name="l02969"></a><span class="lineno"> 2969</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = context ? context-&gt;http : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02970" name="l02970"></a><span class="lineno"> 2970</span> </div>
<div class="line"><a id="l02971" name="l02971"></a><span class="lineno"> 2971</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_function" href="classSsl_1_1ServerBump.html#a65f6edc9928c6e1f7a494e12a48a9af1">at</a>(<a class="code hl_enumvalue" href="XactionStep_8h.html#aaaaea1f6a486ef01fc1b35f92f6a81eea2da83aeb88de72bf1e8fdf166f300f26">XactionStep::tlsBump1</a>)) {</div>
<div class="line"><a id="l02972" name="l02972"></a><span class="lineno"> 2972</span>        <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#aaa318ba6ee683f0db877f2d3f34fea52">step</a> = <a class="code hl_enumvalue" href="XactionStep_8h.html#aaaaea1f6a486ef01fc1b35f92f6a81eea7cf59ba890540dcb831984a8aa7f0d9b">XactionStep::tlsBump2</a>;</div>
<div class="line"><a id="l02973" name="l02973"></a><span class="lineno"> 2973</span>        <span class="comment">// Run a accessList check to check if want to splice or continue bumping</span></div>
<div class="line"><a id="l02974" name="l02974"></a><span class="lineno"> 2974</span> </div>
<div class="line"><a id="l02975" name="l02975"></a><span class="lineno"> 2975</span>        <span class="keyword">auto</span> acl_checklist = <a class="code hl_function" href="classACLFilledChecklist.html#a0d62153af717fa13fd4dd8b2e509556b">ACLFilledChecklist::Make</a>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#aa6bcbad5359c0b290dffff6716171c55">ssl_bump</a>, <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">request</a>.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l02976" name="l02976"></a><span class="lineno"> 2976</span>        acl_checklist-&gt;banAction(<a class="code hl_class" href="classAcl_1_1Answer.html">Acl::Answer</a>(<a class="code hl_enumvalue" href="group__ACLAPI.html#gga449cde9b9fa7a3ddb6d83d61080c1df5aa3d37d87d9b3887abc5466afb368cb8a">ACCESS_ALLOWED</a>, <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a6ff031aa135572a0f8f968b29fda9f72">Ssl::bumpNone</a>));</div>
<div class="line"><a id="l02977" name="l02977"></a><span class="lineno"> 2977</span>        acl_checklist-&gt;banAction(<a class="code hl_class" href="classAcl_1_1Answer.html">Acl::Answer</a>(<a class="code hl_enumvalue" href="group__ACLAPI.html#gga449cde9b9fa7a3ddb6d83d61080c1df5aa3d37d87d9b3887abc5466afb368cb8a">ACCESS_ALLOWED</a>, <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a63dd03e830a0746569e5635a3dfa28dc">Ssl::bumpClientFirst</a>));</div>
<div class="line"><a id="l02978" name="l02978"></a><span class="lineno"> 2978</span>        acl_checklist-&gt;banAction(<a class="code hl_class" href="classAcl_1_1Answer.html">Acl::Answer</a>(<a class="code hl_enumvalue" href="group__ACLAPI.html#gga449cde9b9fa7a3ddb6d83d61080c1df5aa3d37d87d9b3887abc5466afb368cb8a">ACCESS_ALLOWED</a>, <a class="code hl_enumvalue" href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9ac82a0f09e800f147573716d281aad690">Ssl::bumpServerFirst</a>));</div>
<div class="line"><a id="l02979" name="l02979"></a><span class="lineno"> 2979</span>        <a class="code hl_function" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">fillChecklist</a>(*acl_checklist);</div>
<div class="line"><a id="l02980" name="l02980"></a><span class="lineno"> 2980</span>        <a class="code hl_function" href="classACLFilledChecklist.html#a5521f60eda45233a9424f46161cf8809">ACLFilledChecklist::NonBlockingCheck</a>(std::move(acl_checklist), <a class="code hl_function" href="client__side_8cc.html#acb06d6b31feae712eada0ba24c2c009f">httpsSslBumpStep2AccessCheckDone</a>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l02981" name="l02981"></a><span class="lineno"> 2981</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02982" name="l02982"></a><span class="lineno"> 2982</span>    }</div>
<div class="line"><a id="l02983" name="l02983"></a><span class="lineno"> 2983</span> </div>
<div class="line"><a id="l02984" name="l02984"></a><span class="lineno"> 2984</span>    <span class="comment">// will call httpsPeeked() with certificate and connection, eventually</span></div>
<div class="line"><a id="l02985" name="l02985"></a><span class="lineno"> 2985</span>    <a class="code hl_typedef" href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a> unConfiguredCTX(<a class="code hl_function" href="group__ServerProtocolSSLAPI.html#ga8b646bfba6b409e0acef284766f80da3">Ssl::createSSLContext</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.signingCa.cert, <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure.signingCa.pkey, <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;secure));</div>
<div class="line"><a id="l02986" name="l02986"></a><span class="lineno"> 2986</span>    <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].dynamicTlsContext = unConfiguredCTX;</div>
<div class="line"><a id="l02987" name="l02987"></a><span class="lineno"> 2987</span> </div>
<div class="line"><a id="l02988" name="l02988"></a><span class="lineno"> 2988</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="client__side_8cc.html#a596a46d13b2e131ece4f5d986a1e30ac">httpsCreate</a>(<span class="keyword">this</span>, unConfiguredCTX))</div>
<div class="line"><a id="l02989" name="l02989"></a><span class="lineno"> 2989</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02990" name="l02990"></a><span class="lineno"> 2990</span> </div>
<div class="line"><a id="l02991" name="l02991"></a><span class="lineno"> 2991</span>    <a class="code hl_variable" href="classConnStateData.html#aae4adb4bf5a824a62fed25c284b56a8b">switchedToHttps_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02992" name="l02992"></a><span class="lineno"> 2992</span> </div>
<div class="line"><a id="l02993" name="l02993"></a><span class="lineno"> 2993</span>    <span class="keyword">auto</span> ssl = <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl.get();</div>
<div class="line"><a id="l02994" name="l02994"></a><span class="lineno"> 2994</span>    BIO *b = SSL_get_rbio(ssl);</div>
<div class="line"><a id="l02995" name="l02995"></a><span class="lineno"> 2995</span>    <a class="code hl_class" href="classSsl_1_1ClientBio.html">Ssl::ClientBio</a> *bio = <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="classSsl_1_1ClientBio.html">Ssl::ClientBio</a> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="openssl_8h.html#a2c4abfe8977f1984d98b5987d315e21c">BIO_get_data</a>(b));</div>
<div class="line"><a id="l02996" name="l02996"></a><span class="lineno"> 2996</span>    bio-&gt;<a class="code hl_function" href="classSsl_1_1ClientBio.html#a48f9b318ad34451b9c1a8976bf133486">setReadBufData</a>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>);</div>
<div class="line"><a id="l02997" name="l02997"></a><span class="lineno"> 2997</span>    bio-&gt;<a class="code hl_function" href="classSsl_1_1ClientBio.html#a9693b62e7d5bc66337b1db3c8f065557">hold</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l02998" name="l02998"></a><span class="lineno"> 2998</span> </div>
<div class="line"><a id="l02999" name="l02999"></a><span class="lineno"> 2999</span>    <span class="comment">// We have successfully parsed client Hello, but our TLS handshake parser is</span></div>
<div class="line"><a id="l03000" name="l03000"></a><span class="lineno"> 3000</span>    <span class="comment">// forgiving. Now we use a TLS library to parse the same bytes, so that we</span></div>
<div class="line"><a id="l03001" name="l03001"></a><span class="lineno"> 3001</span>    <span class="comment">// can honor on_unsupported_protocol if needed. If there are no errors, we</span></div>
<div class="line"><a id="l03002" name="l03002"></a><span class="lineno"> 3002</span>    <span class="comment">// expect Security::Accept() to ask us to write (our) TLS server Hello. We</span></div>
<div class="line"><a id="l03003" name="l03003"></a><span class="lineno"> 3003</span>    <span class="comment">// also allow an ioWantRead result in case some fancy TLS extension that</span></div>
<div class="line"><a id="l03004" name="l03004"></a><span class="lineno"> 3004</span>    <span class="comment">// Squid does not yet understand requires reading post-Hello client bytes.</span></div>
<div class="line"><a id="l03005" name="l03005"></a><span class="lineno"> 3005</span>    <span class="keyword">const</span> <span class="keyword">auto</span> handshakeResult = <a class="code hl_function" href="classConnStateData.html#aac6c6dfba90e4a817ad4f27204174a9c">acceptTls</a>();</div>
<div class="line"><a id="l03006" name="l03006"></a><span class="lineno"> 3006</span>    <span class="keywordflow">if</span> (!handshakeResult.wantsIo())</div>
<div class="line"><a id="l03007" name="l03007"></a><span class="lineno"> 3007</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classConnStateData.html#abad0e63a39973dc6b6e6db437a68e697">handleSslBumpHandshakeError</a>(handshakeResult);</div>
<div class="line"><a id="l03008" name="l03008"></a><span class="lineno"> 3008</span> </div>
<div class="line"><a id="l03009" name="l03009"></a><span class="lineno"> 3009</span>    <span class="comment">// We need to reset inBuf here, to be used by incoming requests in the case</span></div>
<div class="line"><a id="l03010" name="l03010"></a><span class="lineno"> 3010</span>    <span class="comment">// of SSL bump</span></div>
<div class="line"><a id="l03011" name="l03011"></a><span class="lineno"> 3011</span>    <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">clear</a>();</div>
<div class="line"><a id="l03012" name="l03012"></a><span class="lineno"> 3012</span> </div>
<div class="line"><a id="l03013" name="l03013"></a><span class="lineno"> 3013</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 5, <span class="stringliteral">&quot;Peek and splice at step2 done. Start forwarding the request!!! &quot;</span>);</div>
<div class="line"><a id="l03014" name="l03014"></a><span class="lineno"> 3014</span>    <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#aaa318ba6ee683f0db877f2d3f34fea52">step</a> = <a class="code hl_enumvalue" href="XactionStep_8h.html#aaaaea1f6a486ef01fc1b35f92f6a81eeae2e942186ef7a2e4cb3b91412e241889">XactionStep::tlsBump3</a>;</div>
<div class="line"><a id="l03015" name="l03015"></a><span class="lineno"> 3015</span>    <a class="code hl_function" href="classFwdState.html#a391d66921577e62e543723f978062e97">FwdState::Start</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>, <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#a51cb62b4cccfa1e6d1e0b9f97bdb76cd">entry</a>, <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">request</a>.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>(), http ? http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a> : <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03016" name="l03016"></a><span class="lineno"> 3016</span>}</div>
</div>
<div class="line"><a id="l03017" name="l03017"></a><span class="lineno"> 3017</span> </div>
<div class="line"><a id="l03019" name="l03019"></a><span class="lineno"> 3019</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03020" data-start="{" data-end="}">
<div class="line"><a id="l03020" name="l03020"></a><span class="lineno"><a class="line" href="classConnStateData.html#abad0e63a39973dc6b6e6db437a68e697"> 3020</a></span><a class="code hl_function" href="classConnStateData.html#abad0e63a39973dc6b6e6db437a68e697">ConnStateData::handleSslBumpHandshakeError</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSecurity_1_1IoResult.html">Security::IoResult</a> &amp;handshakeResult)</div>
<div class="line"><a id="l03021" name="l03021"></a><span class="lineno"> 3021</span>{</div>
<div class="line"><a id="l03022" name="l03022"></a><span class="lineno"> 3022</span>    <span class="keyword">auto</span> errCategory = <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa5203071ca85e00df6bf2526855b6df0d">ERR_NONE</a>;</div>
<div class="line"><a id="l03023" name="l03023"></a><span class="lineno"> 3023</span> </div>
<div class="line"><a id="l03024" name="l03024"></a><span class="lineno"> 3024</span>    <span class="keywordflow">switch</span> (handshakeResult.<a class="code hl_variable" href="classSecurity_1_1IoResult.html#a495a10433284e17473d4e2116662287d">category</a>) {</div>
<div class="line"><a id="l03025" name="l03025"></a><span class="lineno"> 3025</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317a6351c5537fff92ccae5284a623de9fb7">Security::IoResult::ioSuccess</a>: {</div>
<div class="line"><a id="l03026" name="l03026"></a><span class="lineno"> 3026</span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> d = <a class="code hl_function" href="Detail_8cc.html#a3daf1a4d3c9feca00e60712558a94558">MakeNamedErrorDetail</a>(<span class="stringliteral">&quot;TLS_ACCEPT_UNEXPECTED_SUCCESS&quot;</span>);</div>
<div class="line"><a id="l03027" name="l03027"></a><span class="lineno"> 3027</span>        <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(errCategory = <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa484c5a83c6dddc445cad0243e75d88e1">ERR_GATEWAY_FAILURE</a>, d);</div>
<div class="line"><a id="l03028" name="l03028"></a><span class="lineno"> 3028</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03029" name="l03029"></a><span class="lineno"> 3029</span>    }</div>
<div class="line"><a id="l03030" name="l03030"></a><span class="lineno"> 3030</span> </div>
<div class="line"><a id="l03031" name="l03031"></a><span class="lineno"> 3031</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317af17e1855920ff08d4245c92730762b99">Security::IoResult::ioWantRead</a>: {</div>
<div class="line"><a id="l03032" name="l03032"></a><span class="lineno"> 3032</span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> d = <a class="code hl_function" href="Detail_8cc.html#a3daf1a4d3c9feca00e60712558a94558">MakeNamedErrorDetail</a>(<span class="stringliteral">&quot;TLS_ACCEPT_UNEXPECTED_READ&quot;</span>);</div>
<div class="line"><a id="l03033" name="l03033"></a><span class="lineno"> 3033</span>        <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(errCategory = <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa484c5a83c6dddc445cad0243e75d88e1">ERR_GATEWAY_FAILURE</a>, d);</div>
<div class="line"><a id="l03034" name="l03034"></a><span class="lineno"> 3034</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03035" name="l03035"></a><span class="lineno"> 3035</span>    }</div>
<div class="line"><a id="l03036" name="l03036"></a><span class="lineno"> 3036</span> </div>
<div class="line"><a id="l03037" name="l03037"></a><span class="lineno"> 3037</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317ae3a476a231aa75bc7764fe1644cfac1b">Security::IoResult::ioWantWrite</a>: {</div>
<div class="line"><a id="l03038" name="l03038"></a><span class="lineno"> 3038</span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> d = <a class="code hl_function" href="Detail_8cc.html#a3daf1a4d3c9feca00e60712558a94558">MakeNamedErrorDetail</a>(<span class="stringliteral">&quot;TLS_ACCEPT_UNEXPECTED_WRITE&quot;</span>);</div>
<div class="line"><a id="l03039" name="l03039"></a><span class="lineno"> 3039</span>        <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(errCategory = <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa484c5a83c6dddc445cad0243e75d88e1">ERR_GATEWAY_FAILURE</a>, d);</div>
<div class="line"><a id="l03040" name="l03040"></a><span class="lineno"> 3040</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03041" name="l03041"></a><span class="lineno"> 3041</span>    }</div>
<div class="line"><a id="l03042" name="l03042"></a><span class="lineno"> 3042</span> </div>
<div class="line"><a id="l03043" name="l03043"></a><span class="lineno"> 3043</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317a1eafdd2f000f06b7396b040f19e92386">Security::IoResult::ioError</a>:</div>
<div class="line"><a id="l03044" name="l03044"></a><span class="lineno"> 3044</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, (handshakeResult.<a class="code hl_variable" href="classSecurity_1_1IoResult.html#a7a1767d793710b3859a65b536493f584">important</a> ? <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a> : 2), <span class="stringliteral">&quot;ERROR: Cannot SslBump-accept a TLS connection&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03045" name="l03045"></a><span class="lineno"> 3045</span>               <a class="code hl_function" href="classDebug.html#a469eccf6573cacd9bc0682d3fc0eaf11">Debug::Extra</a> &lt;&lt; <span class="stringliteral">&quot;problem: &quot;</span> &lt;&lt; <a class="code hl_class" href="classWithExtras.html">WithExtras</a>(handshakeResult));</div>
<div class="line"><a id="l03046" name="l03046"></a><span class="lineno"> 3046</span>        <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(errCategory = <a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa06dbb9679d23daac15bfa00176c68222">ERR_SECURE_ACCEPT_FAIL</a>, handshakeResult.<a class="code hl_variable" href="classSecurity_1_1IoResult.html#a0c916adba5475a6fc020af70e1e091cc">errorDetail</a>);</div>
<div class="line"><a id="l03047" name="l03047"></a><span class="lineno"> 3047</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03048" name="l03048"></a><span class="lineno"> 3048</span> </div>
<div class="line"><a id="l03049" name="l03049"></a><span class="lineno"> 3049</span>    }</div>
<div class="line"><a id="l03050" name="l03050"></a><span class="lineno"> 3050</span> </div>
<div class="line"><a id="l03051" name="l03051"></a><span class="lineno"> 3051</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#ae85c6fd07a8415d08b9672de277ee24e">tunnelOnError</a>(errCategory))</div>
<div class="line"><a id="l03052" name="l03052"></a><span class="lineno"> 3052</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l03053" name="l03053"></a><span class="lineno"> 3053</span>}</div>
</div>
<div class="line"><a id="l03054" name="l03054"></a><span class="lineno"> 3054</span> </div>
<div class="line"><a id="l03055" name="l03055"></a><span class="lineno"> 3055</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03056" data-start="{" data-end="}">
<div class="line"><a id="l03056" name="l03056"></a><span class="lineno"><a class="line" href="classConnStateData.html#ae33befbd46050504b12953d75a807231"> 3056</a></span><a class="code hl_function" href="classConnStateData.html#ae33befbd46050504b12953d75a807231">ConnStateData::doPeekAndSpliceStep</a>()</div>
<div class="line"><a id="l03057" name="l03057"></a><span class="lineno"> 3057</span>{</div>
<div class="line"><a id="l03058" name="l03058"></a><span class="lineno"> 3058</span>    <span class="keyword">auto</span> ssl = <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>].ssl.get();</div>
<div class="line"><a id="l03059" name="l03059"></a><span class="lineno"> 3059</span>    BIO *b = SSL_get_rbio(ssl);</div>
<div class="line"><a id="l03060" name="l03060"></a><span class="lineno"> 3060</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(b);</div>
<div class="line"><a id="l03061" name="l03061"></a><span class="lineno"> 3061</span>    <a class="code hl_class" href="classSsl_1_1ClientBio.html">Ssl::ClientBio</a> *bio = <span class="keyword">static_cast&lt;</span><a class="code hl_class" href="classSsl_1_1ClientBio.html">Ssl::ClientBio</a> *<span class="keyword">&gt;</span>(<a class="code hl_function" href="openssl_8h.html#a2c4abfe8977f1984d98b5987d315e21c">BIO_get_data</a>(b));</div>
<div class="line"><a id="l03062" name="l03062"></a><span class="lineno"> 3062</span> </div>
<div class="line"><a id="l03063" name="l03063"></a><span class="lineno"> 3063</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;PeekAndSplice mode, proceed with client negotiation. Current state:&quot;</span> &lt;&lt; SSL_state_string_long(ssl));</div>
<div class="line"><a id="l03064" name="l03064"></a><span class="lineno"> 3064</span>    bio-&gt;<a class="code hl_function" href="classSsl_1_1ClientBio.html#a9693b62e7d5bc66337b1db3c8f065557">hold</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l03065" name="l03065"></a><span class="lineno"> 3065</span> </div>
<div class="line"><a id="l03066" name="l03066"></a><span class="lineno"> 3066</span>    <a class="code hl_function" href="namespaceComm.html#ae3a7e8f0df297346e84f0e9943033a3e">Comm::SetSelect</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <a class="code hl_define" href="defines_8h.html#a466a4c545dd6c5d996d8ab8f1d0d2270">COMM_SELECT_WRITE</a>, <a class="code hl_function" href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38">clientNegotiateSSL</a>, <span class="keyword">this</span>, 0);</div>
<div class="line"><a id="l03067" name="l03067"></a><span class="lineno"> 3067</span>    <a class="code hl_variable" href="classConnStateData.html#aae4adb4bf5a824a62fed25c284b56a8b">switchedToHttps_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03068" name="l03068"></a><span class="lineno"> 3068</span>}</div>
</div>
<div class="line"><a id="l03069" name="l03069"></a><span class="lineno"> 3069</span> </div>
<div class="line"><a id="l03070" name="l03070"></a><span class="lineno"> 3070</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03071" data-start="{" data-end="}">
<div class="line"><a id="l03071" name="l03071"></a><span class="lineno"><a class="line" href="classConnStateData.html#a47fe99b93fb1bd926b43d19da19f1773"> 3071</a></span><a class="code hl_function" href="classConnStateData.html#a47fe99b93fb1bd926b43d19da19f1773">ConnStateData::httpsPeeked</a>(<a class="code hl_class" href="classConnStateData_1_1PinnedIdleContext.html">PinnedIdleContext</a> pic)</div>
<div class="line"><a id="l03072" name="l03072"></a><span class="lineno"> 3072</span>{</div>
<div class="line"><a id="l03073" name="l03073"></a><span class="lineno"> 3073</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03074" name="l03074"></a><span class="lineno"> 3074</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_variable" href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">request</a> == pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#addadc081ff7543e5d6dd5d7becf1888e">request</a>);</div>
<div class="line"><a id="l03075" name="l03075"></a><span class="lineno"> 3075</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>() || <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>()-&gt;http == <span class="keyword">nullptr</span> || <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>()-&gt;http-&gt;request == pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#addadc081ff7543e5d6dd5d7becf1888e">request</a>.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l03076" name="l03076"></a><span class="lineno"> 3076</span> </div>
<div class="line"><a id="l03077" name="l03077"></a><span class="lineno"> 3077</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#ad07351f67935319498317d281beffdf7">connection</a>)) {</div>
<div class="line"><a id="l03078" name="l03078"></a><span class="lineno"> 3078</span>        <a class="code hl_function" href="classConnStateData.html#a89c4a9371afb6c0a45be3c0c1b0cb4f6">notePinnedConnectionBecameIdle</a>(pic);</div>
<div class="line"><a id="l03079" name="l03079"></a><span class="lineno"> 3079</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;bumped HTTPS server: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>);</div>
<div class="line"><a id="l03080" name="l03080"></a><span class="lineno"> 3080</span>    } <span class="keywordflow">else</span></div>
<div class="line"><a id="l03081" name="l03081"></a><span class="lineno"> 3081</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Error while bumping: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>);</div>
<div class="line"><a id="l03082" name="l03082"></a><span class="lineno"> 3082</span> </div>
<div class="line"><a id="l03083" name="l03083"></a><span class="lineno"> 3083</span>    <a class="code hl_function" href="classConnStateData.html#a47c605492c85e115ccef1b66bca58a54">getSslContextStart</a>();</div>
<div class="line"><a id="l03084" name="l03084"></a><span class="lineno"> 3084</span>}</div>
</div>
<div class="line"><a id="l03085" name="l03085"></a><span class="lineno"> 3085</span> </div>
<div class="line"><a id="l03086" name="l03086"></a><span class="lineno"> 3086</span><span class="preprocessor">#endif </span><span class="comment">/* USE_OPENSSL */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l03087" name="l03087"></a><span class="lineno"> 3087</span> </div>
<div class="line"><a id="l03088" name="l03088"></a><span class="lineno"> 3088</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen03089" data-start="{" data-end="}">
<div class="line"><a id="l03089" name="l03089"></a><span class="lineno"><a class="line" href="classConnStateData.html#a49651ee9330d4206ff880a3fe93ee726"> 3089</a></span><a class="code hl_function" href="classConnStateData.html#a49651ee9330d4206ff880a3fe93ee726">ConnStateData::initiateTunneledRequest</a>(<a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> <span class="keyword">const</span> &amp;cause, <span class="keyword">const</span> <span class="keywordtype">char</span> *reason, <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;payload)</div>
<div class="line"><a id="l03090" name="l03090"></a><span class="lineno"> 3090</span>{</div>
<div class="line"><a id="l03091" name="l03091"></a><span class="lineno"> 3091</span>    <span class="comment">// fake a CONNECT request to force connState to tunnel</span></div>
<div class="line"><a id="l03092" name="l03092"></a><span class="lineno"> 3092</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> connectHost;</div>
<div class="line"><a id="l03093" name="l03093"></a><span class="lineno"> 3093</span>    <a class="code hl_typedef" href="namespaceAnyP.html#a091f10181394fdbe707c17c91f250793">AnyP::Port</a> connectPort;</div>
<div class="line"><a id="l03094" name="l03094"></a><span class="lineno"> 3094</span> </div>
<div class="line"><a id="l03095" name="l03095"></a><span class="lineno"> 3095</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03096" name="l03096"></a><span class="lineno"> 3096</span>        <span class="keyword">static</span> <span class="keywordtype">char</span> ip[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l03097" name="l03097"></a><span class="lineno"> 3097</span>        connectHost = <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;remote.toStr(ip, <span class="keyword">sizeof</span>(ip));</div>
<div class="line"><a id="l03098" name="l03098"></a><span class="lineno"> 3098</span>        <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> remotePort = <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;remote.port())</div>
<div class="line"><a id="l03099" name="l03099"></a><span class="lineno"> 3099</span>            connectPort = remotePort;</div>
<div class="line"><a id="l03100" name="l03100"></a><span class="lineno"> 3100</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cause) {</div>
<div class="line"><a id="l03101" name="l03101"></a><span class="lineno"> 3101</span>        connectHost = cause-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#ae4525a8b4e9835c24f43e2e7b1995a31">hostOrIp</a>();</div>
<div class="line"><a id="l03102" name="l03102"></a><span class="lineno"> 3102</span>        connectPort = cause-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aa09ef977328523ec48e7440c83d728d3">port</a>();</div>
<div class="line"><a id="l03103" name="l03103"></a><span class="lineno"> 3103</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03104" name="l03104"></a><span class="lineno"> 3104</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l03105" name="l03105"></a><span class="lineno"> 3105</span>        connectHost = <a class="code hl_variable" href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">tlsConnectHostOrIp</a>;</div>
<div class="line"><a id="l03106" name="l03106"></a><span class="lineno"> 3106</span>        connectPort = <a class="code hl_variable" href="classConnStateData.html#a7f762686d33660c311ee33b8545a9759">tlsConnectPort</a>;</div>
<div class="line"><a id="l03107" name="l03107"></a><span class="lineno"> 3107</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03108" name="l03108"></a><span class="lineno"> 3108</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>()) {</div>
<div class="line"><a id="l03109" name="l03109"></a><span class="lineno"> 3109</span>        <span class="keyword">static</span> <span class="keywordtype">char</span> ip[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l03110" name="l03110"></a><span class="lineno"> 3110</span>        connectHost = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#a00a47f51e0c2b78115495af295924aee">toStr</a>(ip, <span class="keyword">sizeof</span>(ip));</div>
<div class="line"><a id="l03111" name="l03111"></a><span class="lineno"> 3111</span>        connectPort = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>();</div>
<div class="line"><a id="l03112" name="l03112"></a><span class="lineno"> 3112</span>    }</div>
<div class="line"><a id="l03113" name="l03113"></a><span class="lineno"> 3113</span> </div>
<div class="line"><a id="l03114" name="l03114"></a><span class="lineno"> 3114</span>    <span class="keywordflow">if</span> (!connectPort) {</div>
<div class="line"><a id="l03115" name="l03115"></a><span class="lineno"> 3115</span>        <span class="comment">// Typical cases are malformed HTTP requests on http_port and malformed</span></div>
<div class="line"><a id="l03116" name="l03116"></a><span class="lineno"> 3116</span>        <span class="comment">// TLS handshakes on non-bumping https_port. TODO: Discover these</span></div>
<div class="line"><a id="l03117" name="l03117"></a><span class="lineno"> 3117</span>        <span class="comment">// problems earlier so that they can be classified/detailed better.</span></div>
<div class="line"><a id="l03118" name="l03118"></a><span class="lineno"> 3118</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;Not able to compute URL, abort request tunneling for &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l03119" name="l03119"></a><span class="lineno"> 3119</span>        <span class="comment">// TODO: throw when NonBlockingCheck() callbacks gain job protections</span></div>
<div class="line"><a id="l03120" name="l03120"></a><span class="lineno"> 3120</span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> d = <a class="code hl_function" href="Detail_8cc.html#a3daf1a4d3c9feca00e60712558a94558">MakeNamedErrorDetail</a>(<span class="stringliteral">&quot;TUNNEL_TARGET&quot;</span>);</div>
<div class="line"><a id="l03121" name="l03121"></a><span class="lineno"> 3121</span>        <a class="code hl_function" href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">updateError</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aae371804ada2a7013ccba421a120d3fa9">ERR_INVALID_REQ</a>, d);</div>
<div class="line"><a id="l03122" name="l03122"></a><span class="lineno"> 3122</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03123" name="l03123"></a><span class="lineno"> 3123</span>    }</div>
<div class="line"><a id="l03124" name="l03124"></a><span class="lineno"> 3124</span> </div>
<div class="line"><a id="l03125" name="l03125"></a><span class="lineno"> 3125</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;Request tunneling for &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l03126" name="l03126"></a><span class="lineno"> 3126</span>    <span class="keyword">const</span> <span class="keyword">auto</span> http = <a class="code hl_function" href="classConnStateData.html#a3282e887b7304282cd1cc35f37844df9">buildFakeRequest</a>(connectHost, *connectPort, payload);</div>
<div class="line"><a id="l03127" name="l03127"></a><span class="lineno"> 3127</span>    <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> request = http-&gt;request;</div>
<div class="line"><a id="l03128" name="l03128"></a><span class="lineno"> 3128</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#a1ec3ec0b8c3d8f8cd603180e8312885b">forceTunnel</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03129" name="l03129"></a><span class="lineno"> 3129</span>    http-&gt;calloutContext = <span class="keyword">new</span> <a class="code hl_class" href="classClientRequestContext.html">ClientRequestContext</a>(http);</div>
<div class="line"><a id="l03130" name="l03130"></a><span class="lineno"> 3130</span>    http-&gt;doCallouts();</div>
<div class="line"><a id="l03131" name="l03131"></a><span class="lineno"> 3131</span>    <a class="code hl_function" href="client__side_8h.html#a2e46b3ff86603b779741bcc021809a50">clientProcessRequestFinished</a>(<span class="keyword">this</span>, request);</div>
<div class="line"><a id="l03132" name="l03132"></a><span class="lineno"> 3132</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03133" name="l03133"></a><span class="lineno"> 3133</span>}</div>
</div>
<div class="line"><a id="l03134" name="l03134"></a><span class="lineno"> 3134</span> </div>
<div class="line"><a id="l03135" name="l03135"></a><span class="lineno"> 3135</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen03136" data-start="{" data-end="}">
<div class="line"><a id="l03136" name="l03136"></a><span class="lineno"><a class="line" href="classConnStateData.html#a1130109009a83806a8c4f37f03d33388"> 3136</a></span><a class="code hl_function" href="classConnStateData.html#a1130109009a83806a8c4f37f03d33388">ConnStateData::fakeAConnectRequest</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *reason, <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;payload)</div>
<div class="line"><a id="l03137" name="l03137"></a><span class="lineno"> 3137</span>{</div>
<div class="line"><a id="l03138" name="l03138"></a><span class="lineno"> 3138</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;fake a CONNECT request to force connState to tunnel for &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l03139" name="l03139"></a><span class="lineno"> 3139</span> </div>
<div class="line"><a id="l03140" name="l03140"></a><span class="lineno"> 3140</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> connectHost;</div>
<div class="line"><a id="l03141" name="l03141"></a><span class="lineno"> 3141</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>());</div>
<div class="line"><a id="l03142" name="l03142"></a><span class="lineno"> 3142</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> connectPort = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>();</div>
<div class="line"><a id="l03143" name="l03143"></a><span class="lineno"> 3143</span> </div>
<div class="line"><a id="l03144" name="l03144"></a><span class="lineno"> 3144</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03145" name="l03145"></a><span class="lineno"> 3145</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a4dcb7a1c309024f3032f7d70b8827a96">tlsClientSni_</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l03146" name="l03146"></a><span class="lineno"> 3146</span>        connectHost.<a class="code hl_function" href="classSBuf.html#aeba82ab78d0c4038a35d52e06f3cfd75">assign</a>(<a class="code hl_variable" href="classConnStateData.html#a4dcb7a1c309024f3032f7d70b8827a96">tlsClientSni_</a>);</div>
<div class="line"><a id="l03147" name="l03147"></a><span class="lineno"> 3147</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l03148" name="l03148"></a><span class="lineno"> 3148</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03149" name="l03149"></a><span class="lineno"> 3149</span>    {</div>
<div class="line"><a id="l03150" name="l03150"></a><span class="lineno"> 3150</span>        <span class="keyword">static</span> <span class="keywordtype">char</span> ip[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l03151" name="l03151"></a><span class="lineno"> 3151</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#a2696806ea5ee1a73dbe87849a7d43539">toHostStr</a>(ip, <span class="keyword">sizeof</span>(ip));</div>
<div class="line"><a id="l03152" name="l03152"></a><span class="lineno"> 3152</span>        connectHost.<a class="code hl_function" href="classSBuf.html#aeba82ab78d0c4038a35d52e06f3cfd75">assign</a>(ip);</div>
<div class="line"><a id="l03153" name="l03153"></a><span class="lineno"> 3153</span>    }</div>
<div class="line"><a id="l03154" name="l03154"></a><span class="lineno"> 3154</span> </div>
<div class="line"><a id="l03155" name="l03155"></a><span class="lineno"> 3155</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = <a class="code hl_function" href="classConnStateData.html#a3282e887b7304282cd1cc35f37844df9">buildFakeRequest</a>(connectHost, connectPort, payload);</div>
<div class="line"><a id="l03156" name="l03156"></a><span class="lineno"> 3156</span> </div>
<div class="line"><a id="l03157" name="l03157"></a><span class="lineno"> 3157</span>    http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ae5d3bde3423ebc7185c259a6ae16efc3">calloutContext</a> = <span class="keyword">new</span> <a class="code hl_class" href="classClientRequestContext.html">ClientRequestContext</a>(http);</div>
<div class="line"><a id="l03158" name="l03158"></a><span class="lineno"> 3158</span>    <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l03159" name="l03159"></a><span class="lineno"> 3159</span>    http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ab992ab634582a805bf248e2e311403e1">doCallouts</a>();</div>
<div class="line"><a id="l03160" name="l03160"></a><span class="lineno"> 3160</span>    <a class="code hl_function" href="client__side_8h.html#a2e46b3ff86603b779741bcc021809a50">clientProcessRequestFinished</a>(<span class="keyword">this</span>, request);</div>
<div class="line"><a id="l03161" name="l03161"></a><span class="lineno"> 3161</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03162" name="l03162"></a><span class="lineno"> 3162</span>}</div>
</div>
<div class="line"><a id="l03163" name="l03163"></a><span class="lineno"> 3163</span> </div>
<div class="line"><a id="l03164" name="l03164"></a><span class="lineno"> 3164</span><a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *</div>
<div class="foldopen" id="foldopen03165" data-start="{" data-end="}">
<div class="line"><a id="l03165" name="l03165"></a><span class="lineno"><a class="line" href="classConnStateData.html#a3282e887b7304282cd1cc35f37844df9"> 3165</a></span><a class="code hl_function" href="classConnStateData.html#a3282e887b7304282cd1cc35f37844df9">ConnStateData::buildFakeRequest</a>(<a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;useHost, <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceAnyP.html#ab24b85a8b8fc74bc945707195c85d228">AnyP::KnownPort</a> usePort, <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;payload)</div>
<div class="line"><a id="l03166" name="l03166"></a><span class="lineno"> 3166</span>{</div>
<div class="line"><a id="l03167" name="l03167"></a><span class="lineno"> 3167</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = <span class="keyword">new</span> <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l03168" name="l03168"></a><span class="lineno"> 3168</span>    <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *stream = <span class="keyword">new</span> <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>, http);</div>
<div class="line"><a id="l03169" name="l03169"></a><span class="lineno"> 3169</span> </div>
<div class="line"><a id="l03170" name="l03170"></a><span class="lineno"> 3170</span>    <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> tempBuffer;</div>
<div class="line"><a id="l03171" name="l03171"></a><span class="lineno"> 3171</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a> = stream-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#aa13355bfcaa6f65caf4b0a64765d5968">reqbuf</a>;</div>
<div class="line"><a id="l03172" name="l03172"></a><span class="lineno"> 3172</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> = <a class="code hl_define" href="http_2forward_8h.html#a196f6d12d102aebcc7a2778bea3e6b19">HTTP_REQBUF_SZ</a>;</div>
<div class="line"><a id="l03173" name="l03173"></a><span class="lineno"> 3173</span> </div>
<div class="line"><a id="l03174" name="l03174"></a><span class="lineno"> 3174</span>    <a class="code hl_class" href="classRefCount.html">ClientStreamData</a> newServer = <span class="keyword">new</span> <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a>(http);</div>
<div class="line"><a id="l03175" name="l03175"></a><span class="lineno"> 3175</span>    <a class="code hl_class" href="classRefCount.html">ClientStreamData</a> newClient = stream;</div>
<div class="line"><a id="l03176" name="l03176"></a><span class="lineno"> 3176</span>    <a class="code hl_function" href="group__ClientStreamInternal.html#ga73019262f28c27affc3937cac3441a43">clientStreamInit</a>(&amp;http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">client_stream</a>, <a class="code hl_variable" href="client__side_8h.html#ae73f7b10b6c2bd55c5f96c9d62839e8d">clientGetMoreData</a>, <a class="code hl_variable" href="client__side_8h.html#ab806362f706a7b39732957bb45e3c2df">clientReplyDetach</a>,</div>
<div class="line"><a id="l03177" name="l03177"></a><span class="lineno"> 3177</span>                     <a class="code hl_variable" href="client__side_8h.html#a3d42a7ece901f14e6ec973a0feb096e1">clientReplyStatus</a>, newServer, <a class="code hl_variable" href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a>,</div>
<div class="line"><a id="l03178" name="l03178"></a><span class="lineno"> 3178</span>                     <a class="code hl_variable" href="client__side_8h.html#a2800047b5d0d3e31d1739cd35378f4ab">clientSocketDetach</a>, newClient, tempBuffer);</div>
<div class="line"><a id="l03179" name="l03179"></a><span class="lineno"> 3179</span> </div>
<div class="line"><a id="l03180" name="l03180"></a><span class="lineno"> 3180</span>    stream-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#a720b33b5850e89ebda3011c853c20f9f">flags</a>.<a class="code hl_variable" href="classHttp_1_1Stream.html#a19ce29fe9e19e5a7ea0f5dedc37895c2">parsed_ok</a> = 1; <span class="comment">// Do we need it?</span></div>
<div class="line"><a id="l03181" name="l03181"></a><span class="lineno"> 3181</span>    stream-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#af977ae01fc040b1c42e388726801f749">mayUseConnection</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l03182" name="l03182"></a><span class="lineno"> 3182</span>    <a class="code hl_function" href="classConnStateData.html#ac21b0b5b9986f9088bcfc68016760454">extendLifetime</a>();</div>
<div class="line"><a id="l03183" name="l03183"></a><span class="lineno"> 3183</span>    stream-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#a522a8b7cab8e595188b6354a65a41613">registerWithConn</a>();</div>
<div class="line"><a id="l03184" name="l03184"></a><span class="lineno"> 3184</span> </div>
<div class="line"><a id="l03185" name="l03185"></a><span class="lineno"> 3185</span>    <span class="keyword">const</span> <span class="keyword">auto</span> mx = <a class="code hl_function" href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a>(<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>);</div>
<div class="line"><a id="l03186" name="l03186"></a><span class="lineno"> 3186</span>    mx-&gt;tcpClient = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>;</div>
<div class="line"><a id="l03187" name="l03187"></a><span class="lineno"> 3187</span>    <span class="comment">// Setup Http::Request object. Maybe should be replaced by a call to (modified)</span></div>
<div class="line"><a id="l03188" name="l03188"></a><span class="lineno"> 3188</span>    <span class="comment">// clientProcessRequest</span></div>
<div class="line"><a id="l03189" name="l03189"></a><span class="lineno"> 3189</span>    <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> request = <span class="keyword">new</span> <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a>(mx);</div>
<div class="line"><a id="l03190" name="l03190"></a><span class="lineno"> 3190</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#a446037a0d5240188b96983e256dfe48b">setScheme</a>(<a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca2cb2b78051771087034e23c3882999dd">AnyP::PROTO_AUTHORITY_FORM</a>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03191" name="l03191"></a><span class="lineno"> 3191</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a> = <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a8ecea905b7d7b048a979e590cb11b9d7">Http::METHOD_CONNECT</a>;</div>
<div class="line"><a id="l03192" name="l03192"></a><span class="lineno"> 3192</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aab379cecc273683d9744197a8a2efe3f">host</a>(useHost.<a class="code hl_function" href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">c_str</a>());</div>
<div class="line"><a id="l03193" name="l03193"></a><span class="lineno"> 3193</span>    request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aa09ef977328523ec48e7440c83d728d3">port</a>(usePort);</div>
<div class="line"><a id="l03194" name="l03194"></a><span class="lineno"> 3194</span> </div>
<div class="line"><a id="l03195" name="l03195"></a><span class="lineno"> 3195</span>    http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a> = <a class="code hl_function" href="SBuf_8h.html#a826aafc8068f24cb125e700733cd2bee">SBufToCstring</a>(request-&gt;<a class="code hl_function" href="classHttpRequest.html#afc7b4dd61a4232033c8b06826f02ae29">effectiveRequestUri</a>());</div>
<div class="line"><a id="l03196" name="l03196"></a><span class="lineno"> 3196</span>    http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a5912c3e9af285d3f77ec815c719b8105">initRequest</a>(request.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l03197" name="l03197"></a><span class="lineno"> 3197</span> </div>
<div class="line"><a id="l03198" name="l03198"></a><span class="lineno"> 3198</span>    request-&gt;<a class="code hl_function" href="classHttpRequest.html#afa44c5ce6b6cce602572b33ca6456235">manager</a>(<span class="keyword">this</span>, http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>);</div>
<div class="line"><a id="l03199" name="l03199"></a><span class="lineno"> 3199</span> </div>
<div class="line"><a id="l03200" name="l03200"></a><span class="lineno"> 3200</span>    request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a187949b24278b65f28338947c605b130">putStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a304355a5f731e2a76ba795ebe1ffd247">Http::HOST</a>, useHost.<a class="code hl_function" href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">c_str</a>());</div>
<div class="line"><a id="l03201" name="l03201"></a><span class="lineno"> 3201</span> </div>
<div class="line"><a id="l03202" name="l03202"></a><span class="lineno"> 3202</span>    request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a332610b0eddfe955427b9efcafcc80ea">sources</a> |= ((<a class="code hl_function" href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">switchedToHttps</a>() || <a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;transport.protocol == <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca0f99ccafd63891be16873f9f2abe94ba">AnyP::PROTO_HTTPS</a>) ? <a class="code hl_enumvalue" href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9a5a794b7b856a3aefb5eb5c1278bc2856">Http::Message::srcHttps</a> : <a class="code hl_enumvalue" href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9a0261d7de1b407ee2d9211e840b05be94">Http::Message::srcHttp</a>);</div>
<div class="line"><a id="l03203" name="l03203"></a><span class="lineno"> 3203</span><span class="preprocessor">#if USE_AUTH</span></div>
<div class="line"><a id="l03204" name="l03204"></a><span class="lineno"> 3204</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#a4703123fe8d180f68321411d26ceb736">getAuth</a>())</div>
<div class="line"><a id="l03205" name="l03205"></a><span class="lineno"> 3205</span>        request-&gt;<a class="code hl_variable" href="classHttpRequest.html#ac498f2030321d6bc845b115a5cabc6d1">auth_user_request</a> = <a class="code hl_function" href="classConnStateData.html#a4703123fe8d180f68321411d26ceb736">getAuth</a>();</div>
<div class="line"><a id="l03206" name="l03206"></a><span class="lineno"> 3206</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03207" name="l03207"></a><span class="lineno"> 3207</span> </div>
<div class="line"><a id="l03208" name="l03208"></a><span class="lineno"> 3208</span>    <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a> = payload;</div>
<div class="line"><a id="l03209" name="l03209"></a><span class="lineno"> 3209</span>    <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.readMore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03210" name="l03210"></a><span class="lineno"> 3210</span> </div>
<div class="line"><a id="l03211" name="l03211"></a><span class="lineno"> 3211</span>    <span class="keywordflow">return</span> http;</div>
<div class="line"><a id="l03212" name="l03212"></a><span class="lineno"> 3212</span>}</div>
</div>
<div class="line"><a id="l03213" name="l03213"></a><span class="lineno"> 3213</span> </div>
<div class="line"><a id="l03215" name="l03215"></a><span class="lineno"> 3215</span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen03216" data-start="{" data-end="}">
<div class="line"><a id="l03216" name="l03216"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a5a4f905ea37316b8a11b79df1faa99db"> 3216</a></span><a class="code hl_function" href="client__side_8cc.html#a5a4f905ea37316b8a11b79df1faa99db">OpenedHttpSocket</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> &amp;c, <span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a> portType)</div>
<div class="line"><a id="l03217" name="l03217"></a><span class="lineno"> 3217</span>{</div>
<div class="line"><a id="l03218" name="l03218"></a><span class="lineno"> 3218</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(c)) {</div>
<div class="line"><a id="l03219" name="l03219"></a><span class="lineno"> 3219</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a> &gt; 0); <span class="comment">// we tried to open some</span></div>
<div class="line"><a id="l03220" name="l03220"></a><span class="lineno"> 3220</span>        --<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>; <span class="comment">// there will be fewer sockets than planned</span></div>
<div class="line"><a id="l03221" name="l03221"></a><span class="lineno"> 3221</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="PortCfg_8cc.html#a8337e06015e8e25e86d184dabe575018">HttpSockets</a>[<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>] &lt; 0); <span class="comment">// no extra fds received</span></div>
<div class="line"><a id="l03222" name="l03222"></a><span class="lineno"> 3222</span> </div>
<div class="line"><a id="l03223" name="l03223"></a><span class="lineno"> 3223</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>) <span class="comment">// we could not open any listen sockets at all</span></div>
<div class="line"><a id="l03224" name="l03224"></a><span class="lineno"> 3224</span>            <a class="code hl_function" href="fatal_8cc.html#ae0269dd75e50d469da2f2416e0cfb7cf">fatalf</a>(<span class="stringliteral">&quot;Unable to open %s&quot;</span>,FdNote(portType));</div>
<div class="line"><a id="l03225" name="l03225"></a><span class="lineno"> 3225</span> </div>
<div class="line"><a id="l03226" name="l03226"></a><span class="lineno"> 3226</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03227" name="l03227"></a><span class="lineno"> 3227</span>    }</div>
<div class="line"><a id="l03228" name="l03228"></a><span class="lineno"> 3228</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03229" name="l03229"></a><span class="lineno"> 3229</span>}</div>
</div>
<div class="line"><a id="l03230" name="l03230"></a><span class="lineno"> 3230</span> </div>
<div class="line"><a id="l03232" name="l03232"></a><span class="lineno"> 3232</span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen03233" data-start="{" data-end="}">
<div class="line"><a id="l03233" name="l03233"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a97924d6b6b7c2ddc072fe0caecbcfe1d"> 3233</a></span><a class="code hl_function" href="client__side_8cc.html#a97924d6b6b7c2ddc072fe0caecbcfe1d">AddOpenedHttpSocket</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> &amp;conn)</div>
<div class="line"><a id="l03234" name="l03234"></a><span class="lineno"> 3234</span>{</div>
<div class="line"><a id="l03235" name="l03235"></a><span class="lineno"> 3235</span>    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03236" name="l03236"></a><span class="lineno"> 3236</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a> &amp;&amp; !found; ++i) {</div>
<div class="line"><a id="l03237" name="l03237"></a><span class="lineno"> 3237</span>        <span class="keywordflow">if</span> ((found = <a class="code hl_variable" href="PortCfg_8cc.html#a8337e06015e8e25e86d184dabe575018">HttpSockets</a>[i] &lt; 0))</div>
<div class="line"><a id="l03238" name="l03238"></a><span class="lineno"> 3238</span>            <a class="code hl_variable" href="PortCfg_8cc.html#a8337e06015e8e25e86d184dabe575018">HttpSockets</a>[i] = conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>;</div>
<div class="line"><a id="l03239" name="l03239"></a><span class="lineno"> 3239</span>    }</div>
<div class="line"><a id="l03240" name="l03240"></a><span class="lineno"> 3240</span>    <span class="keywordflow">return</span> found;</div>
<div class="line"><a id="l03241" name="l03241"></a><span class="lineno"> 3241</span>}</div>
</div>
<div class="line"><a id="l03242" name="l03242"></a><span class="lineno"> 3242</span> </div>
<div class="line"><a id="l03243" name="l03243"></a><span class="lineno"> 3243</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03244" data-start="{" data-end="}">
<div class="line"><a id="l03244" name="l03244"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a11791d48b590d9dc9185647d5bdb5d30"> 3244</a></span><a class="code hl_function" href="client__side_8cc.html#a11791d48b590d9dc9185647d5bdb5d30">clientHttpConnectionsOpen</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l03245" name="l03245"></a><span class="lineno"> 3245</span>{</div>
<div class="line"><a id="l03246" name="l03246"></a><span class="lineno"> 3246</span>    <span class="keyword">const</span> <span class="keyword">auto</span> savedContext = <a class="code hl_function" href="classCodeContext.html#a13251c00d03b5a9cb9f3b164f0154969">CodeContext::Current</a>();</div>
<div class="line"><a id="l03247" name="l03247"></a><span class="lineno"> 3247</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> s = <a class="code hl_variable" href="PortCfg_8cc.html#ab5fc0d5e05159674db133b2f17786721">HttpPortList</a>; s != <span class="keyword">nullptr</span>; s = s-&gt;next) {</div>
<div class="line"><a id="l03248" name="l03248"></a><span class="lineno"> 3248</span>        <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(s);</div>
<div class="line"><a id="l03249" name="l03249"></a><span class="lineno"> 3249</span>        <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;scheme = <a class="code hl_class" href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a>(s-&gt;transport.protocol).<a class="code hl_function" href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">image</a>();</div>
<div class="line"><a id="l03250" name="l03250"></a><span class="lineno"> 3250</span> </div>
<div class="line"><a id="l03251" name="l03251"></a><span class="lineno"> 3251</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="PortCfg_8h.html#ad26669cbef20c833f401d0c236dfa54b">MAXTCPLISTENPORTS</a> == <a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>) {</div>
<div class="line"><a id="l03252" name="l03252"></a><span class="lineno"> 3252</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: You have too many &#39;&quot;</span> &lt;&lt; scheme &lt;&lt; <span class="stringliteral">&quot;_port&#39; lines.&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03253" name="l03253"></a><span class="lineno"> 3253</span>                   <a class="code hl_function" href="classDebug.html#a469eccf6573cacd9bc0682d3fc0eaf11">Debug::Extra</a> &lt;&lt; <span class="stringliteral">&quot;The limit is &quot;</span> &lt;&lt; <a class="code hl_define" href="PortCfg_8h.html#ad26669cbef20c833f401d0c236dfa54b">MAXTCPLISTENPORTS</a> &lt;&lt; <span class="stringliteral">&quot; HTTP ports.&quot;</span>);</div>
<div class="line"><a id="l03254" name="l03254"></a><span class="lineno"> 3254</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03255" name="l03255"></a><span class="lineno"> 3255</span>        }</div>
<div class="line"><a id="l03256" name="l03256"></a><span class="lineno"> 3256</span> </div>
<div class="line"><a id="l03257" name="l03257"></a><span class="lineno"> 3257</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03258" name="l03258"></a><span class="lineno"> 3258</span>        <span class="keywordflow">if</span> (s-&gt;flags.tunnelSslBumping) {</div>
<div class="line"><a id="l03259" name="l03259"></a><span class="lineno"> 3259</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#aa6bcbad5359c0b290dffff6716171c55">ssl_bump</a>) {</div>
<div class="line"><a id="l03260" name="l03260"></a><span class="lineno"> 3260</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: No ssl_bump configured. Disabling ssl-bump on &quot;</span> &lt;&lt; scheme &lt;&lt; <span class="stringliteral">&quot;_port &quot;</span> &lt;&lt; s-&gt;s);</div>
<div class="line"><a id="l03261" name="l03261"></a><span class="lineno"> 3261</span>                s-&gt;flags.tunnelSslBumping = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03262" name="l03262"></a><span class="lineno"> 3262</span>            }</div>
<div class="line"><a id="l03263" name="l03263"></a><span class="lineno"> 3263</span>            <span class="keywordflow">if</span> (!s-&gt;secure.staticContext &amp;&amp; !s-&gt;secure.generateHostCertificates) {</div>
<div class="line"><a id="l03264" name="l03264"></a><span class="lineno"> 3264</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;Will not bump SSL at &quot;</span> &lt;&lt; scheme &lt;&lt; <span class="stringliteral">&quot;_port &quot;</span> &lt;&lt; s-&gt;s &lt;&lt; <span class="stringliteral">&quot; due to TLS initialization failure.&quot;</span>);</div>
<div class="line"><a id="l03265" name="l03265"></a><span class="lineno"> 3265</span>                s-&gt;flags.tunnelSslBumping = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03266" name="l03266"></a><span class="lineno"> 3266</span>                <span class="keywordflow">if</span> (s-&gt;transport.protocol == <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca62d94ce7433f7892fb4541f72ac4ac7d">AnyP::PROTO_HTTP</a>)</div>
<div class="line"><a id="l03267" name="l03267"></a><span class="lineno"> 3267</span>                    s-&gt;secure.encryptTransport = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03268" name="l03268"></a><span class="lineno"> 3268</span>            }</div>
<div class="line"><a id="l03269" name="l03269"></a><span class="lineno"> 3269</span>            <span class="keywordflow">if</span> (s-&gt;flags.tunnelSslBumping) {</div>
<div class="line"><a id="l03270" name="l03270"></a><span class="lineno"> 3270</span>                <span class="comment">// Create ssl_ctx cache for this port.</span></div>
<div class="line"><a id="l03271" name="l03271"></a><span class="lineno"> 3271</span>                <a class="code hl_function" href="namespaceSsl.html#a120da00096164ddaf09963fb45aa2dc7">Ssl::TheGlobalContextStorage</a>().<a class="code hl_function" href="classSsl_1_1GlobalContextStorage.html#a171a2add4e1703bf383af5fb0c6fec01">addLocalStorage</a>(s-&gt;s, s-&gt;secure.dynamicCertMemCacheSize);</div>
<div class="line"><a id="l03272" name="l03272"></a><span class="lineno"> 3272</span>            }</div>
<div class="line"><a id="l03273" name="l03273"></a><span class="lineno"> 3273</span>        }</div>
<div class="line"><a id="l03274" name="l03274"></a><span class="lineno"> 3274</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03275" name="l03275"></a><span class="lineno"> 3275</span> </div>
<div class="line"><a id="l03276" name="l03276"></a><span class="lineno"> 3276</span>        <span class="keywordflow">if</span> (s-&gt;secure.encryptTransport &amp;&amp; !s-&gt;secure.staticContext) {</div>
<div class="line"><a id="l03277" name="l03277"></a><span class="lineno"> 3277</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a>, <span class="stringliteral">&quot;ERROR: Ignoring &quot;</span> &lt;&lt; scheme &lt;&lt; <span class="stringliteral">&quot;_port &quot;</span> &lt;&lt; s-&gt;s &lt;&lt; <span class="stringliteral">&quot; due to TLS context initialization failure.&quot;</span>);</div>
<div class="line"><a id="l03278" name="l03278"></a><span class="lineno"> 3278</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03279" name="l03279"></a><span class="lineno"> 3279</span>        }</div>
<div class="line"><a id="l03280" name="l03280"></a><span class="lineno"> 3280</span> </div>
<div class="line"><a id="l03281" name="l03281"></a><span class="lineno"> 3281</span>        <span class="keyword">const</span> <span class="keyword">auto</span> protocol = s-&gt;transport.protocol;</div>
<div class="line"><a id="l03282" name="l03282"></a><span class="lineno"> 3282</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(protocol == <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca62d94ce7433f7892fb4541f72ac4ac7d">AnyP::PROTO_HTTP</a> || protocol == <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca0f99ccafd63891be16873f9f2abe94ba">AnyP::PROTO_HTTPS</a>);</div>
<div class="line"><a id="l03283" name="l03283"></a><span class="lineno"> 3283</span>        <span class="keyword">const</span> <span class="keyword">auto</span> isHttps = protocol == <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca0f99ccafd63891be16873f9f2abe94ba">AnyP::PROTO_HTTPS</a>;</div>
<div class="line"><a id="l03284" name="l03284"></a><span class="lineno"> 3284</span>        <span class="keyword">using </span>AcceptCall = <a class="code hl_class" href="classCommCbFunPtrCallT.html">CommCbFunPtrCallT&lt;CommAcceptCbPtrFun&gt;</a>;</div>
<div class="line"><a id="l03285" name="l03285"></a><span class="lineno"> 3285</span>        <a class="code hl_class" href="classRefCount.html">RefCount&lt;AcceptCall&gt;</a> subCall = <a class="code hl_function" href="CommCalls_8h.html#a7e143fa246c3e54c90fa8d20b390b88d">commCbCall</a>(5, 5, isHttps ? <span class="stringliteral">&quot;httpsAccept&quot;</span> : <span class="stringliteral">&quot;httpAccept&quot;</span>,</div>
<div class="line"><a id="l03286" name="l03286"></a><span class="lineno"> 3286</span>                                       <a class="code hl_class" href="classCommAcceptCbPtrFun.html">CommAcceptCbPtrFun</a>(isHttps ? <a class="code hl_function" href="client__side_8cc.html#a99e22f88fd50b4f1daa837e39f18ab04">httpsAccept</a> : <a class="code hl_variable" href="client__side_8cc.html#af8290b502a5da8718ddd609a1688a2e5">httpAccept</a>, <a class="code hl_class" href="classCommAcceptCbParams.html">CommAcceptCbParams</a>(<span class="keyword">nullptr</span>)));</div>
<div class="line"><a id="l03287" name="l03287"></a><span class="lineno"> 3287</span>        <a class="code hl_function" href="client__side_8cc.html#ad4b535b12e4c55b5763c6644d0e40a6e">clientStartListeningOn</a>(s, subCall, isHttps ? <a class="code hl_enumvalue" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7aaf8453e105f4660ed3f0309065f347c7">Ipc::fdnHttpsSocket</a> : <a class="code hl_enumvalue" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7a19490345a33230e8042a46aaa352d8e3">Ipc::fdnHttpSocket</a>);</div>
<div class="line"><a id="l03288" name="l03288"></a><span class="lineno"> 3288</span>    }</div>
<div class="line"><a id="l03289" name="l03289"></a><span class="lineno"> 3289</span>    <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(savedContext);</div>
<div class="line"><a id="l03290" name="l03290"></a><span class="lineno"> 3290</span>}</div>
</div>
<div class="line"><a id="l03291" name="l03291"></a><span class="lineno"> 3291</span> </div>
<div class="line"><a id="l03292" name="l03292"></a><span class="lineno"> 3292</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03293" data-start="{" data-end="}">
<div class="line"><a id="l03293" name="l03293"></a><span class="lineno"><a class="line" href="client__side_8cc.html#ad4b535b12e4c55b5763c6644d0e40a6e"> 3293</a></span><a class="code hl_function" href="client__side_8cc.html#ad4b535b12e4c55b5763c6644d0e40a6e">clientStartListeningOn</a>(<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> &amp;<a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">RefCount</a>&lt; <a class="code hl_class" href="classCommCbFunPtrCallT.html">CommCbFunPtrCallT&lt;CommAcceptCbPtrFun&gt;</a> &gt; &amp;subCall, <span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a> fdNote)</div>
<div class="line"><a id="l03294" name="l03294"></a><span class="lineno"> 3294</span>{</div>
<div class="line"><a id="l03295" name="l03295"></a><span class="lineno"> 3295</span>    <span class="comment">// Fill out a Comm::Connection which IPC will open as a listener for us</span></div>
<div class="line"><a id="l03296" name="l03296"></a><span class="lineno"> 3296</span>    <a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;listenConn = <span class="keyword">new</span> <a class="code hl_class" href="classComm_1_1Connection.html">Comm::Connection</a>;</div>
<div class="line"><a id="l03297" name="l03297"></a><span class="lineno"> 3297</span>    <a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;listenConn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a> = <a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;s;</div>
<div class="line"><a id="l03298" name="l03298"></a><span class="lineno"> 3298</span>    <a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;listenConn-&gt;flags =</div>
<div class="line"><a id="l03299" name="l03299"></a><span class="lineno"> 3299</span>        <a class="code hl_define" href="Connection_8h.html#aadad9238e4d0e913034b3dfc22f8ba44">COMM_NONBLOCKING</a> |</div>
<div class="line"><a id="l03300" name="l03300"></a><span class="lineno"> 3300</span>        (<a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;flags.tproxyIntercept ? <a class="code hl_define" href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a> : 0) |</div>
<div class="line"><a id="l03301" name="l03301"></a><span class="lineno"> 3301</span>        (<a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;flags.natIntercept ? <a class="code hl_define" href="Connection_8h.html#a8e482a7d3919ec1fefad794c35a4c81e">COMM_INTERCEPTION</a> : 0) |</div>
<div class="line"><a id="l03302" name="l03302"></a><span class="lineno"> 3302</span>        (<a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;workerQueues ? <a class="code hl_define" href="Connection_8h.html#a88a0705e6cacb385c3d25aaff2eb2326">COMM_REUSEPORT</a> : 0);</div>
<div class="line"><a id="l03303" name="l03303"></a><span class="lineno"> 3303</span> </div>
<div class="line"><a id="l03304" name="l03304"></a><span class="lineno"> 3304</span>    <span class="comment">// route new connections to subCall</span></div>
<div class="line"><a id="l03305" name="l03305"></a><span class="lineno"> 3305</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbFunPtrCallT.html">CommCbFunPtrCallT&lt;CommAcceptCbPtrFun&gt;</a> AcceptCall;</div>
<div class="line"><a id="l03306" name="l03306"></a><span class="lineno"> 3306</span>    <a class="code hl_class" href="classRefCount.html">Subscription::Pointer</a> sub = <span class="keyword">new</span> <a class="code hl_class" href="classCallSubscription.html">CallSubscription&lt;AcceptCall&gt;</a>(subCall);</div>
<div class="line"><a id="l03307" name="l03307"></a><span class="lineno"> 3307</span>    <span class="keyword">const</span> <span class="keyword">auto</span> listenCall =</div>
<div class="line"><a id="l03308" name="l03308"></a><span class="lineno"> 3308</span>        <a class="code hl_function" href="AsyncCall_8h.html#ab4ed1188674ac6e234bc4e37b384035b">asyncCall</a>(33, 2, <span class="stringliteral">&quot;clientListenerConnectionOpened&quot;</span>,</div>
<div class="line"><a id="l03309" name="l03309"></a><span class="lineno"> 3309</span>                  <a class="code hl_class" href="classListeningStartedDialer.html">ListeningStartedDialer</a>(&amp;<a class="code hl_function" href="client__side_8cc.html#a00d61405a518ee24f5beedc0a9a8b3b6">clientListenerConnectionOpened</a>,</div>
<div class="line"><a id="l03310" name="l03310"></a><span class="lineno"> 3310</span>                                         <a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>, fdNote, sub));</div>
<div class="line"><a id="l03311" name="l03311"></a><span class="lineno"> 3311</span>    <a class="code hl_class" href="classAsyncCallback.html">AsyncCallback&lt;Ipc::StartListeningAnswer&gt;</a> callback(listenCall);</div>
<div class="line"><a id="l03312" name="l03312"></a><span class="lineno"> 3312</span>    <a class="code hl_function" href="namespaceIpc.html#a37dd3ff45a0f99fdf2f730e4125110ce">Ipc::StartListening</a>(SOCK_STREAM, IPPROTO_TCP, <a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;listenConn, fdNote, callback);</div>
<div class="line"><a id="l03313" name="l03313"></a><span class="lineno"> 3313</span> </div>
<div class="line"><a id="l03314" name="l03314"></a><span class="lineno"> 3314</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a> &lt; <a class="code hl_define" href="PortCfg_8h.html#ad26669cbef20c833f401d0c236dfa54b">MAXTCPLISTENPORTS</a>);</div>
<div class="line"><a id="l03315" name="l03315"></a><span class="lineno"> 3315</span>    <a class="code hl_variable" href="PortCfg_8cc.html#a8337e06015e8e25e86d184dabe575018">HttpSockets</a>[<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>] = -1;</div>
<div class="line"><a id="l03316" name="l03316"></a><span class="lineno"> 3316</span>    ++<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>;</div>
<div class="line"><a id="l03317" name="l03317"></a><span class="lineno"> 3317</span>}</div>
</div>
<div class="line"><a id="l03318" name="l03318"></a><span class="lineno"> 3318</span> </div>
<div class="line"><a id="l03320" name="l03320"></a><span class="lineno"> 3320</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03321" data-start="{" data-end="}">
<div class="line"><a id="l03321" name="l03321"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a00d61405a518ee24f5beedc0a9a8b3b6"> 3321</a></span><a class="code hl_function" href="client__side_8cc.html#a00d61405a518ee24f5beedc0a9a8b3b6">clientListenerConnectionOpened</a>(<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> &amp;s, <span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a> portTypeNote, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Subscription::Pointer</a> &amp;sub)</div>
<div class="line"><a id="l03322" name="l03322"></a><span class="lineno"> 3322</span>{</div>
<div class="line"><a id="l03323" name="l03323"></a><span class="lineno"> 3323</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(s != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03324" name="l03324"></a><span class="lineno"> 3324</span> </div>
<div class="line"><a id="l03325" name="l03325"></a><span class="lineno"> 3325</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="client__side_8cc.html#a5a4f905ea37316b8a11b79df1faa99db">OpenedHttpSocket</a>(s-&gt;listenConn, portTypeNote))</div>
<div class="line"><a id="l03326" name="l03326"></a><span class="lineno"> 3326</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03327" name="l03327"></a><span class="lineno"> 3327</span> </div>
<div class="line"><a id="l03328" name="l03328"></a><span class="lineno"> 3328</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(s-&gt;listenConn));</div>
<div class="line"><a id="l03329" name="l03329"></a><span class="lineno"> 3329</span> </div>
<div class="line"><a id="l03330" name="l03330"></a><span class="lineno"> 3330</span>    <span class="comment">// TCP: setup a job to handle accept() with subscribed handler</span></div>
<div class="line"><a id="l03331" name="l03331"></a><span class="lineno"> 3331</span>    <a class="code hl_function" href="classAsyncJob.html#a1dd42e9842d751193268966d4e0de2fa">AsyncJob::Start</a>(<span class="keyword">new</span> <a class="code hl_class" href="classComm_1_1TcpAcceptor.html">Comm::TcpAcceptor</a>(s, FdNote(portTypeNote), sub));</div>
<div class="line"><a id="l03332" name="l03332"></a><span class="lineno"> 3332</span> </div>
<div class="line"><a id="l03333" name="l03333"></a><span class="lineno"> 3333</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Messages_8h.html#a3627f132658efd674ba366496239d303">Important</a>(13), <span class="stringliteral">&quot;Accepting &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03334" name="l03334"></a><span class="lineno"> 3334</span>           (s-&gt;flags.natIntercept ? <span class="stringliteral">&quot;NAT intercepted &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) &lt;&lt;</div>
<div class="line"><a id="l03335" name="l03335"></a><span class="lineno"> 3335</span>           (s-&gt;flags.tproxyIntercept ? <span class="stringliteral">&quot;TPROXY intercepted &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) &lt;&lt;</div>
<div class="line"><a id="l03336" name="l03336"></a><span class="lineno"> 3336</span>           (s-&gt;flags.tunnelSslBumping ? <span class="stringliteral">&quot;SSL bumped &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) &lt;&lt;</div>
<div class="line"><a id="l03337" name="l03337"></a><span class="lineno"> 3337</span>           (s-&gt;flags.accelSurrogate ? <span class="stringliteral">&quot;reverse-proxy &quot;</span> : <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a id="l03338" name="l03338"></a><span class="lineno"> 3338</span>           &lt;&lt; FdNote(portTypeNote) &lt;&lt; <span class="stringliteral">&quot; connections at &quot;</span></div>
<div class="line"><a id="l03339" name="l03339"></a><span class="lineno"> 3339</span>           &lt;&lt; s-&gt;listenConn);</div>
<div class="line"><a id="l03340" name="l03340"></a><span class="lineno"> 3340</span> </div>
<div class="line"><a id="l03341" name="l03341"></a><span class="lineno"> 3341</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_function" href="client__side_8cc.html#a97924d6b6b7c2ddc072fe0caecbcfe1d">AddOpenedHttpSocket</a>(s-&gt;listenConn)); <span class="comment">// otherwise, we have received a fd we did not ask for</span></div>
<div class="line"><a id="l03342" name="l03342"></a><span class="lineno"> 3342</span> </div>
<div class="line"><a id="l03343" name="l03343"></a><span class="lineno"> 3343</span><span class="preprocessor">#if HAVE_LIBSYSTEMD</span></div>
<div class="line"><a id="l03344" name="l03344"></a><span class="lineno"> 3344</span>    <span class="comment">// When the very first port opens, tell systemd we are able to serve connections.</span></div>
<div class="line"><a id="l03345" name="l03345"></a><span class="lineno"> 3345</span>    <span class="comment">// Subsequent sd_notify() calls, including calls during reconfiguration,</span></div>
<div class="line"><a id="l03346" name="l03346"></a><span class="lineno"> 3346</span>    <span class="comment">// do nothing because the first call parameter is 1.</span></div>
<div class="line"><a id="l03347" name="l03347"></a><span class="lineno"> 3347</span>    <span class="comment">// XXX: Send the notification only after opening all configured ports.</span></div>
<div class="line"><a id="l03348" name="l03348"></a><span class="lineno"> 3348</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="globals_8h.html#a53aa0ddf7c75914f127ffbf47dcf53e3">opt_foreground</a> || <a class="code hl_variable" href="globals_8h.html#a506a078460793d09337c2ef6455e3600">opt_no_daemon</a>) {</div>
<div class="line"><a id="l03349" name="l03349"></a><span class="lineno"> 3349</span>        <span class="keyword">const</span> <span class="keyword">auto</span> result = sd_notify(1, <span class="stringliteral">&quot;READY=1&quot;</span>);</div>
<div class="line"><a id="l03350" name="l03350"></a><span class="lineno"> 3350</span>        <span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line"><a id="l03351" name="l03351"></a><span class="lineno"> 3351</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;WARNING: failed to send start-up notification to systemd&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03352" name="l03352"></a><span class="lineno"> 3352</span>                   <a class="code hl_function" href="classDebug.html#a469eccf6573cacd9bc0682d3fc0eaf11">Debug::Extra</a> &lt;&lt; <span class="stringliteral">&quot;sd_notify() error: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(-result));</div>
<div class="line"><a id="l03353" name="l03353"></a><span class="lineno"> 3353</span>        }</div>
<div class="line"><a id="l03354" name="l03354"></a><span class="lineno"> 3354</span>    }</div>
<div class="line"><a id="l03355" name="l03355"></a><span class="lineno"> 3355</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03356" name="l03356"></a><span class="lineno"> 3356</span>}</div>
</div>
<div class="line"><a id="l03357" name="l03357"></a><span class="lineno"> 3357</span> </div>
<div class="line"><a id="l03358" name="l03358"></a><span class="lineno"> 3358</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03359" data-start="{" data-end="}">
<div class="line"><a id="l03359" name="l03359"></a><span class="lineno"><a class="line" href="client__side_8cc.html#a347fa37628f399b885a509417a7aa493"> 3359</a></span><a class="code hl_function" href="client__side_8cc.html#a347fa37628f399b885a509417a7aa493">clientOpenListenSockets</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l03360" name="l03360"></a><span class="lineno"> 3360</span>{</div>
<div class="line"><a id="l03361" name="l03361"></a><span class="lineno"> 3361</span>    <a class="code hl_function" href="client__side_8cc.html#a11791d48b590d9dc9185647d5bdb5d30">clientHttpConnectionsOpen</a>();</div>
<div class="line"><a id="l03362" name="l03362"></a><span class="lineno"> 3362</span>    <a class="code hl_function" href="namespaceFtp.html#ae2b3b88ec5c7af470746a1658d7434f3">Ftp::StartListening</a>();</div>
<div class="line"><a id="l03363" name="l03363"></a><span class="lineno"> 3363</span> </div>
<div class="line"><a id="l03364" name="l03364"></a><span class="lineno"> 3364</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a> &lt; 1)</div>
<div class="line"><a id="l03365" name="l03365"></a><span class="lineno"> 3365</span>        <a class="code hl_function" href="fatal_8cc.html#ab64d40563aeeae7c01b72bea4c3ed032">fatal</a>(<span class="stringliteral">&quot;No HTTP, HTTPS, or FTP ports configured&quot;</span>);</div>
<div class="line"><a id="l03366" name="l03366"></a><span class="lineno"> 3366</span>}</div>
</div>
<div class="line"><a id="l03367" name="l03367"></a><span class="lineno"> 3367</span> </div>
<div class="line"><a id="l03368" name="l03368"></a><span class="lineno"> 3368</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03369" data-start="{" data-end="}">
<div class="line"><a id="l03369" name="l03369"></a><span class="lineno"><a class="line" href="client__side_8cc.html#ae29c88c073239e35ef8f8a82e9d5f689"> 3369</a></span><a class="code hl_function" href="client__side_8cc.html#ae29c88c073239e35ef8f8a82e9d5f689">clientConnectionsClose</a>()</div>
<div class="line"><a id="l03370" name="l03370"></a><span class="lineno"> 3370</span>{</div>
<div class="line"><a id="l03371" name="l03371"></a><span class="lineno"> 3371</span>    <span class="keyword">const</span> <span class="keyword">auto</span> savedContext = <a class="code hl_function" href="classCodeContext.html#a13251c00d03b5a9cb9f3b164f0154969">CodeContext::Current</a>();</div>
<div class="line"><a id="l03372" name="l03372"></a><span class="lineno"> 3372</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> s = <a class="code hl_variable" href="PortCfg_8cc.html#ab5fc0d5e05159674db133b2f17786721">HttpPortList</a>; s != <span class="keyword">nullptr</span>; s = s-&gt;next) {</div>
<div class="line"><a id="l03373" name="l03373"></a><span class="lineno"> 3373</span>        <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(s);</div>
<div class="line"><a id="l03374" name="l03374"></a><span class="lineno"> 3374</span>        <span class="keywordflow">if</span> (s-&gt;listenConn != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03375" name="l03375"></a><span class="lineno"> 3375</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Messages_8h.html#a3627f132658efd674ba366496239d303">Important</a>(14), <span class="stringliteral">&quot;Closing HTTP(S) port &quot;</span> &lt;&lt; s-&gt;listenConn-&gt;local);</div>
<div class="line"><a id="l03376" name="l03376"></a><span class="lineno"> 3376</span>            s-&gt;listenConn-&gt;close();</div>
<div class="line"><a id="l03377" name="l03377"></a><span class="lineno"> 3377</span>            s-&gt;listenConn = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03378" name="l03378"></a><span class="lineno"> 3378</span>        }</div>
<div class="line"><a id="l03379" name="l03379"></a><span class="lineno"> 3379</span>    }</div>
<div class="line"><a id="l03380" name="l03380"></a><span class="lineno"> 3380</span>    <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(savedContext);</div>
<div class="line"><a id="l03381" name="l03381"></a><span class="lineno"> 3381</span> </div>
<div class="line"><a id="l03382" name="l03382"></a><span class="lineno"> 3382</span>    <a class="code hl_function" href="namespaceFtp.html#adf377404cef36010cd7e17ec7b5a8a87">Ftp::StopListening</a>();</div>
<div class="line"><a id="l03383" name="l03383"></a><span class="lineno"> 3383</span> </div>
<div class="line"><a id="l03384" name="l03384"></a><span class="lineno"> 3384</span>    <span class="comment">// TODO see if we can drop HttpSockets array entirely */</span></div>
<div class="line"><a id="l03385" name="l03385"></a><span class="lineno"> 3385</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>; ++i) {</div>
<div class="line"><a id="l03386" name="l03386"></a><span class="lineno"> 3386</span>        <a class="code hl_variable" href="PortCfg_8cc.html#a8337e06015e8e25e86d184dabe575018">HttpSockets</a>[i] = -1;</div>
<div class="line"><a id="l03387" name="l03387"></a><span class="lineno"> 3387</span>    }</div>
<div class="line"><a id="l03388" name="l03388"></a><span class="lineno"> 3388</span> </div>
<div class="line"><a id="l03389" name="l03389"></a><span class="lineno"> 3389</span>    <a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a> = 0;</div>
<div class="line"><a id="l03390" name="l03390"></a><span class="lineno"> 3390</span>}</div>
</div>
<div class="line"><a id="l03391" name="l03391"></a><span class="lineno"> 3391</span> </div>
<div class="line"><a id="l03392" name="l03392"></a><span class="lineno"> 3392</span><span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen03393" data-start="{" data-end="}">
<div class="line"><a id="l03393" name="l03393"></a><span class="lineno"><a class="line" href="client__side_8cc.html#abc48bb93b6bb570b3ffee98f883c7f79"> 3393</a></span><a class="code hl_function" href="client__side_8cc.html#abc48bb93b6bb570b3ffee98f883c7f79">varyEvaluateMatch</a>(<a class="code hl_class" href="classStoreEntry.html">StoreEntry</a> * entry, <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> * request)</div>
<div class="line"><a id="l03394" name="l03394"></a><span class="lineno"> 3394</span>{</div>
<div class="line"><a id="l03395" name="l03395"></a><span class="lineno"> 3395</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> vary(request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a8b90084ccd19905f1fc8eebc9ff3a60e">vary_headers</a>);</div>
<div class="line"><a id="l03396" name="l03396"></a><span class="lineno"> 3396</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;reply = entry-&gt;<a class="code hl_function" href="classStoreEntry.html#a19fd5af89e99c467c29f7bd951ac901d">mem</a>().<a class="code hl_function" href="classMemObject.html#a89697947bc40cdbe591b9e26951b59ba">freshestReply</a>();</div>
<div class="line"><a id="l03397" name="l03397"></a><span class="lineno"> 3397</span>    <span class="keyword">auto</span> has_vary = reply.<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a3ae0960cb7589909b60ec5958769568f">Http::HdrType::VARY</a>);</div>
<div class="line"><a id="l03398" name="l03398"></a><span class="lineno"> 3398</span><span class="preprocessor">#if X_ACCELERATOR_VARY</span></div>
<div class="line"><a id="l03399" name="l03399"></a><span class="lineno"> 3399</span> </div>
<div class="line"><a id="l03400" name="l03400"></a><span class="lineno"> 3400</span>    has_vary |=</div>
<div class="line"><a id="l03401" name="l03401"></a><span class="lineno"> 3401</span>        reply.header.has(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4ad15c8839ee936e050b9d9f6d438076b2">Http::HdrType::HDR_X_ACCELERATOR_VARY</a>);</div>
<div class="line"><a id="l03402" name="l03402"></a><span class="lineno"> 3402</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03403" name="l03403"></a><span class="lineno"> 3403</span> </div>
<div class="line"><a id="l03404" name="l03404"></a><span class="lineno"> 3404</span>    <span class="keywordflow">if</span> (!has_vary || entry-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_variable" href="classMemObject.html#a66e95211cec7250b591bd1eaf9fe4f08">vary_headers</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l03405" name="l03405"></a><span class="lineno"> 3405</span>        <span class="keywordflow">if</span> (!vary.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l03406" name="l03406"></a><span class="lineno"> 3406</span>            <span class="comment">/* Oops... something odd is going on here.. */</span></div>
<div class="line"><a id="l03407" name="l03407"></a><span class="lineno"> 3407</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;varyEvaluateMatch: Oops. Not a Vary object on second attempt, &#39;&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03408" name="l03408"></a><span class="lineno"> 3408</span>                   entry-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_function" href="classMemObject.html#a226d829dcd5f4008a5f31028891bfac8">urlXXX</a>() &lt;&lt; <span class="stringliteral">&quot;&#39; &#39;&quot;</span> &lt;&lt; vary &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a id="l03409" name="l03409"></a><span class="lineno"> 3409</span>            request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a8b90084ccd19905f1fc8eebc9ff3a60e">vary_headers</a>.<a class="code hl_function" href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">clear</a>();</div>
<div class="line"><a id="l03410" name="l03410"></a><span class="lineno"> 3410</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a5dec4f1a3a983ae7827f08367330b4ab">VARY_CANCEL</a>;</div>
<div class="line"><a id="l03411" name="l03411"></a><span class="lineno"> 3411</span>        }</div>
<div class="line"><a id="l03412" name="l03412"></a><span class="lineno"> 3412</span> </div>
<div class="line"><a id="l03413" name="l03413"></a><span class="lineno"> 3413</span>        <span class="keywordflow">if</span> (!has_vary) {</div>
<div class="line"><a id="l03414" name="l03414"></a><span class="lineno"> 3414</span>            <span class="comment">/* This is not a varying object */</span></div>
<div class="line"><a id="l03415" name="l03415"></a><span class="lineno"> 3415</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a23c487ebaabba2cc8dcd41323b136aa9">VARY_NONE</a>;</div>
<div class="line"><a id="l03416" name="l03416"></a><span class="lineno"> 3416</span>        }</div>
<div class="line"><a id="l03417" name="l03417"></a><span class="lineno"> 3417</span> </div>
<div class="line"><a id="l03418" name="l03418"></a><span class="lineno"> 3418</span>        <span class="comment">/* virtual &quot;vary&quot; object found. Calculate the vary key and</span></div>
<div class="line"><a id="l03419" name="l03419"></a><span class="lineno"> 3419</span><span class="comment">         * continue the search</span></div>
<div class="line"><a id="l03420" name="l03420"></a><span class="lineno"> 3420</span><span class="comment">         */</span></div>
<div class="line"><a id="l03421" name="l03421"></a><span class="lineno"> 3421</span>        vary = <a class="code hl_function" href="http_8cc.html#a8a42723675f705f8c391373dc1578c0b">httpMakeVaryMark</a>(request, &amp;reply);</div>
<div class="line"><a id="l03422" name="l03422"></a><span class="lineno"> 3422</span> </div>
<div class="line"><a id="l03423" name="l03423"></a><span class="lineno"> 3423</span>        <span class="keywordflow">if</span> (!vary.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l03424" name="l03424"></a><span class="lineno"> 3424</span>            request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a8b90084ccd19905f1fc8eebc9ff3a60e">vary_headers</a> = vary;</div>
<div class="line"><a id="l03425" name="l03425"></a><span class="lineno"> 3425</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a117633d22d4a5338627c410f0289f627">VARY_OTHER</a>;</div>
<div class="line"><a id="l03426" name="l03426"></a><span class="lineno"> 3426</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03427" name="l03427"></a><span class="lineno"> 3427</span>            <span class="comment">/* Ouch.. we cannot handle this kind of variance */</span></div>
<div class="line"><a id="l03428" name="l03428"></a><span class="lineno"> 3428</span>            <span class="comment">/* XXX This cannot really happen, but just to be complete */</span></div>
<div class="line"><a id="l03429" name="l03429"></a><span class="lineno"> 3429</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a5dec4f1a3a983ae7827f08367330b4ab">VARY_CANCEL</a>;</div>
<div class="line"><a id="l03430" name="l03430"></a><span class="lineno"> 3430</span>        }</div>
<div class="line"><a id="l03431" name="l03431"></a><span class="lineno"> 3431</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03432" name="l03432"></a><span class="lineno"> 3432</span>        <span class="keywordflow">if</span> (vary.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l03433" name="l03433"></a><span class="lineno"> 3433</span>            vary = <a class="code hl_function" href="http_8cc.html#a8a42723675f705f8c391373dc1578c0b">httpMakeVaryMark</a>(request, &amp;reply);</div>
<div class="line"><a id="l03434" name="l03434"></a><span class="lineno"> 3434</span> </div>
<div class="line"><a id="l03435" name="l03435"></a><span class="lineno"> 3435</span>            <span class="keywordflow">if</span> (!vary.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l03436" name="l03436"></a><span class="lineno"> 3436</span>                request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a8b90084ccd19905f1fc8eebc9ff3a60e">vary_headers</a> = vary;</div>
<div class="line"><a id="l03437" name="l03437"></a><span class="lineno"> 3437</span>        }</div>
<div class="line"><a id="l03438" name="l03438"></a><span class="lineno"> 3438</span> </div>
<div class="line"><a id="l03439" name="l03439"></a><span class="lineno"> 3439</span>        <span class="keywordflow">if</span> (vary.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l03440" name="l03440"></a><span class="lineno"> 3440</span>            <span class="comment">/* Ouch.. we cannot handle this kind of variance */</span></div>
<div class="line"><a id="l03441" name="l03441"></a><span class="lineno"> 3441</span>            <span class="comment">/* XXX This cannot really happen, but just to be complete */</span></div>
<div class="line"><a id="l03442" name="l03442"></a><span class="lineno"> 3442</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a5dec4f1a3a983ae7827f08367330b4ab">VARY_CANCEL</a>;</div>
<div class="line"><a id="l03443" name="l03443"></a><span class="lineno"> 3443</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vary.<a class="code hl_function" href="classSBuf.html#a5ec49865cc982a78e48245f546a38ea4">cmp</a>(entry-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_variable" href="classMemObject.html#a66e95211cec7250b591bd1eaf9fe4f08">vary_headers</a>) == 0) {</div>
<div class="line"><a id="l03444" name="l03444"></a><span class="lineno"> 3444</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122ae9e4dfb086bac9073f90a3b614cc6c6d">VARY_MATCH</a>;</div>
<div class="line"><a id="l03445" name="l03445"></a><span class="lineno"> 3445</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03446" name="l03446"></a><span class="lineno"> 3446</span>            <span class="comment">/* Oops.. we have already been here and still haven&#39;t</span></div>
<div class="line"><a id="l03447" name="l03447"></a><span class="lineno"> 3447</span><span class="comment">             * found the requested variant. Bail out</span></div>
<div class="line"><a id="l03448" name="l03448"></a><span class="lineno"> 3448</span><span class="comment">             */</span></div>
<div class="line"><a id="l03449" name="l03449"></a><span class="lineno"> 3449</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;varyEvaluateMatch: Oops. Not a Vary match on second attempt, &#39;&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03450" name="l03450"></a><span class="lineno"> 3450</span>                   entry-&gt;<a class="code hl_variable" href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">mem_obj</a>-&gt;<a class="code hl_function" href="classMemObject.html#a226d829dcd5f4008a5f31028891bfac8">urlXXX</a>() &lt;&lt; <span class="stringliteral">&quot;&#39; &#39;&quot;</span> &lt;&lt; vary &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a id="l03451" name="l03451"></a><span class="lineno"> 3451</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a5dec4f1a3a983ae7827f08367330b4ab">VARY_CANCEL</a>;</div>
<div class="line"><a id="l03452" name="l03452"></a><span class="lineno"> 3452</span>        }</div>
<div class="line"><a id="l03453" name="l03453"></a><span class="lineno"> 3453</span>    }</div>
<div class="line"><a id="l03454" name="l03454"></a><span class="lineno"> 3454</span>}</div>
</div>
<div class="line"><a id="l03455" name="l03455"></a><span class="lineno"> 3455</span> </div>
<div class="line"><a id="l03456" name="l03456"></a><span class="lineno"> 3456</span><a class="code hl_typedef" href="classACLFilledChecklist.html#a1a7f36b9e8a65cd5486bcf76c31ff88c">ACLFilledChecklist::MakingPointer</a></div>
<div class="foldopen" id="foldopen03457" data-start="{" data-end="}">
<div class="line"><a id="l03457" name="l03457"></a><span class="lineno"><a class="line" href="client__side_8cc.html#aa43c942879dd80b024c465afa58f85aa"> 3457</a></span><a class="code hl_function" href="client__side_8cc.html#aa43c942879dd80b024c465afa58f85aa">clientAclChecklistCreate</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">acl_access</a> * acl, <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> * http)</div>
<div class="line"><a id="l03458" name="l03458"></a><span class="lineno"> 3458</span>{</div>
<div class="line"><a id="l03459" name="l03459"></a><span class="lineno"> 3459</span>    <span class="keyword">auto</span> checklist = <a class="code hl_function" href="classACLFilledChecklist.html#a0d62153af717fa13fd4dd8b2e509556b">ACLFilledChecklist::Make</a>(acl, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03460" name="l03460"></a><span class="lineno"> 3460</span>    <a class="code hl_function" href="client__side_8cc.html#acabcacffff4309ce2ac0aa3252eaf2ba">clientAclChecklistFill</a>(*checklist, http);</div>
<div class="line"><a id="l03461" name="l03461"></a><span class="lineno"> 3461</span>    <span class="keywordflow">return</span> checklist;</div>
<div class="line"><a id="l03462" name="l03462"></a><span class="lineno"> 3462</span>}</div>
</div>
<div class="line"><a id="l03463" name="l03463"></a><span class="lineno"> 3463</span> </div>
<div class="line"><a id="l03464" name="l03464"></a><span class="lineno"> 3464</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03465" data-start="{" data-end="}">
<div class="line"><a id="l03465" name="l03465"></a><span class="lineno"><a class="line" href="client__side_8cc.html#acabcacffff4309ce2ac0aa3252eaf2ba"> 3465</a></span><a class="code hl_function" href="client__side_8cc.html#acabcacffff4309ce2ac0aa3252eaf2ba">clientAclChecklistFill</a>(<a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> &amp;checklist, <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http)</div>
<div class="line"><a id="l03466" name="l03466"></a><span class="lineno"> 3466</span>{</div>
<div class="line"><a id="l03467" name="l03467"></a><span class="lineno"> 3467</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http);</div>
<div class="line"><a id="l03468" name="l03468"></a><span class="lineno"> 3468</span> </div>
<div class="line"><a id="l03469" name="l03469"></a><span class="lineno"> 3469</span>    <span class="keywordflow">if</span> (!checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#af7036126263e056df92f668a6c9aae03">request</a> &amp;&amp; http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>)</div>
<div class="line"><a id="l03470" name="l03470"></a><span class="lineno"> 3470</span>        checklist.<a class="code hl_function" href="classACLFilledChecklist.html#a3a4cc947a6e13258f602ad640e931e59">setRequest</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>);</div>
<div class="line"><a id="l03471" name="l03471"></a><span class="lineno"> 3471</span> </div>
<div class="line"><a id="l03472" name="l03472"></a><span class="lineno"> 3472</span>    <span class="keywordflow">if</span> (!checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#ac9fc7ac3b0ef5a2a0d2811aa762dbeab">al</a> &amp;&amp; http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>) {</div>
<div class="line"><a id="l03473" name="l03473"></a><span class="lineno"> 3473</span>        checklist.<a class="code hl_function" href="classACLFilledChecklist.html#a53bba78d7127a7707cb956a87ff5914f">updateAle</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>);</div>
<div class="line"><a id="l03474" name="l03474"></a><span class="lineno"> 3474</span>        checklist.<a class="code hl_function" href="classACLFilledChecklist.html#ae77611904901fa5f796cdd54ff5be235">syncAle</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>, http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a3f6d0f7008f5302283e91937cdc67f75">log_uri</a>);</div>
<div class="line"><a id="l03475" name="l03475"></a><span class="lineno"> 3475</span>    }</div>
<div class="line"><a id="l03476" name="l03476"></a><span class="lineno"> 3476</span> </div>
<div class="line"><a id="l03477" name="l03477"></a><span class="lineno"> 3477</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> conn = http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">getConn</a>())</div>
<div class="line"><a id="l03478" name="l03478"></a><span class="lineno"> 3478</span>        checklist.<a class="code hl_function" href="classACLFilledChecklist.html#a4812be1882c53f8732bfb7838ae061d8">setConn</a>(conn); <span class="comment">// may already be set</span></div>
<div class="line"><a id="l03479" name="l03479"></a><span class="lineno"> 3479</span>}</div>
</div>
<div class="line"><a id="l03480" name="l03480"></a><span class="lineno"> 3480</span> </div>
<div class="line"><a id="l03481" name="l03481"></a><span class="lineno"> 3481</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03482" data-start="{" data-end="}">
<div class="line"><a id="l03482" name="l03482"></a><span class="lineno"><a class="line" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a"> 3482</a></span><a class="code hl_function" href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">ConnStateData::fillChecklist</a>(<a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> &amp;checklist)<span class="keyword"> const</span></div>
<div class="line"><a id="l03483" name="l03483"></a><span class="lineno"> 3483</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03484" name="l03484"></a><span class="lineno"> 3484</span>    <span class="keyword">const</span> <span class="keyword">auto</span> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l03485" name="l03485"></a><span class="lineno"> 3485</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> http = context ? context-&gt;http : <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l03486" name="l03486"></a><span class="lineno"> 3486</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="client__side_8cc.html#acabcacffff4309ce2ac0aa3252eaf2ba">clientAclChecklistFill</a>(checklist, http); <span class="comment">// calls checklist.setConn()</span></div>
<div class="line"><a id="l03487" name="l03487"></a><span class="lineno"> 3487</span> </div>
<div class="line"><a id="l03488" name="l03488"></a><span class="lineno"> 3488</span>    <span class="comment">// no requests, but we always have connection-level details</span></div>
<div class="line"><a id="l03489" name="l03489"></a><span class="lineno"> 3489</span>    <span class="comment">// TODO: ACL checks should not require a mutable ConnStateData. Adjust the</span></div>
<div class="line"><a id="l03490" name="l03490"></a><span class="lineno"> 3490</span>    <span class="comment">// code that accidentally violates that principle to remove this const_cast!</span></div>
<div class="line"><a id="l03491" name="l03491"></a><span class="lineno"> 3491</span>    checklist.<a class="code hl_function" href="classACLFilledChecklist.html#a4812be1882c53f8732bfb7838ae061d8">setConn</a>(<span class="keyword">const_cast&lt;</span><a class="code hl_class" href="classConnStateData.html">ConnStateData</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>));</div>
<div class="line"><a id="l03492" name="l03492"></a><span class="lineno"> 3492</span> </div>
<div class="line"><a id="l03493" name="l03493"></a><span class="lineno"> 3493</span>    <span class="comment">// Set other checklist fields inside our fillConnectionLevelDetails() rather</span></div>
<div class="line"><a id="l03494" name="l03494"></a><span class="lineno"> 3494</span>    <span class="comment">// than here because clientAclChecklistFill() code path calls that method</span></div>
<div class="line"><a id="l03495" name="l03495"></a><span class="lineno"> 3495</span>    <span class="comment">// (via ACLFilledChecklist::setConn()) rather than calling us directly.</span></div>
<div class="line"><a id="l03496" name="l03496"></a><span class="lineno"> 3496</span>}</div>
</div>
<div class="line"><a id="l03497" name="l03497"></a><span class="lineno"> 3497</span> </div>
<div class="line"><a id="l03498" name="l03498"></a><span class="lineno"> 3498</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03499" data-start="{" data-end="}">
<div class="line"><a id="l03499" name="l03499"></a><span class="lineno"><a class="line" href="classConnStateData.html#af8d67b3cbbe0c7b9b61afbd59070ca93"> 3499</a></span><a class="code hl_function" href="classConnStateData.html#af8d67b3cbbe0c7b9b61afbd59070ca93">ConnStateData::fillConnectionLevelDetails</a>(<a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> &amp;checklist)<span class="keyword"> const</span></div>
<div class="line"><a id="l03500" name="l03500"></a><span class="lineno"> 3500</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03501" name="l03501"></a><span class="lineno"> 3501</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(checklist.<a class="code hl_function" href="classACLFilledChecklist.html#a37d4c2cb7c1e90cb1af02d054b90268c">conn</a>() == <span class="keyword">this</span>);</div>
<div class="line"><a id="l03502" name="l03502"></a><span class="lineno"> 3502</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>);</div>
<div class="line"><a id="l03503" name="l03503"></a><span class="lineno"> 3503</span> </div>
<div class="line"><a id="l03504" name="l03504"></a><span class="lineno"> 3504</span>    <span class="keywordflow">if</span> (!checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#af7036126263e056df92f668a6c9aae03">request</a>) { <span class="comment">// preserve (better) addresses supplied by setRequest()</span></div>
<div class="line"><a id="l03505" name="l03505"></a><span class="lineno"> 3505</span>        checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#aa75a941c2634f5faa0eef864c4153b93">src_addr</a> = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>;</div>
<div class="line"><a id="l03506" name="l03506"></a><span class="lineno"> 3506</span>        checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#a5eede657a1f9b1bfe54ac2ee58af9d2e">my_addr</a> = <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>; <span class="comment">// TODO: or port-&gt;s?</span></div>
<div class="line"><a id="l03507" name="l03507"></a><span class="lineno"> 3507</span>    }</div>
<div class="line"><a id="l03508" name="l03508"></a><span class="lineno"> 3508</span> </div>
<div class="line"><a id="l03509" name="l03509"></a><span class="lineno"> 3509</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03510" name="l03510"></a><span class="lineno"> 3510</span>    <span class="keywordflow">if</span> (!checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#ab97626f356bacd93806236efcc00f737">sslErrors</a> &amp;&amp; <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>)</div>
<div class="line"><a id="l03511" name="l03511"></a><span class="lineno"> 3511</span>        checklist.<a class="code hl_variable" href="classACLFilledChecklist.html#ab97626f356bacd93806236efcc00f737">sslErrors</a> = <a class="code hl_variable" href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">sslServerBump</a>-&gt;<a class="code hl_function" href="classSsl_1_1ServerBump.html#a77506da609c0ee1e8af131e408af9ca2">sslErrors</a>();</div>
<div class="line"><a id="l03512" name="l03512"></a><span class="lineno"> 3512</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03513" name="l03513"></a><span class="lineno"> 3513</span>}</div>
</div>
<div class="line"><a id="l03514" name="l03514"></a><span class="lineno"> 3514</span> </div>
<div class="line"><a id="l03515" name="l03515"></a><span class="lineno"> 3515</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen03516" data-start="{" data-end="}">
<div class="line"><a id="l03516" name="l03516"></a><span class="lineno"><a class="line" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa"> 3516</a></span><a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">ConnStateData::transparent</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03517" name="l03517"></a><span class="lineno"> 3517</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03518" name="l03518"></a><span class="lineno"> 3518</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> != <span class="keyword">nullptr</span> &amp;&amp; (<a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">flags</a> &amp; (<a class="code hl_define" href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a>|<a class="code hl_define" href="Connection_8h.html#a8e482a7d3919ec1fefad794c35a4c81e">COMM_INTERCEPTION</a>));</div>
<div class="line"><a id="l03519" name="l03519"></a><span class="lineno"> 3519</span>}</div>
</div>
<div class="line"><a id="l03520" name="l03520"></a><span class="lineno"> 3520</span> </div>
<div class="line"><a id="l03521" name="l03521"></a><span class="lineno"> 3521</span><a class="code hl_class" href="classRefCount.html">BodyPipe::Pointer</a></div>
<div class="foldopen" id="foldopen03522" data-start="{" data-end="}">
<div class="line"><a id="l03522" name="l03522"></a><span class="lineno"><a class="line" href="classConnStateData.html#aadb0eaf2848509b73859a3bf509efc67"> 3522</a></span><a class="code hl_function" href="classConnStateData.html#aadb0eaf2848509b73859a3bf509efc67">ConnStateData::expectRequestBody</a>(int64_t <a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</div>
<div class="line"><a id="l03523" name="l03523"></a><span class="lineno"> 3523</span>{</div>
<div class="line"><a id="l03524" name="l03524"></a><span class="lineno"> 3524</span>    <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> = <span class="keyword">new</span> <a class="code hl_class" href="classBodyPipe.html">BodyPipe</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l03525" name="l03525"></a><span class="lineno"> 3525</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> &gt;= 0)</div>
<div class="line"><a id="l03526" name="l03526"></a><span class="lineno"> 3526</span>        <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a542c050b846dba14c679156e7ae9f08d">setBodySize</a>(<a class="code hl_variable" href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);</div>
<div class="line"><a id="l03527" name="l03527"></a><span class="lineno"> 3527</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l03528" name="l03528"></a><span class="lineno"> 3528</span>        <a class="code hl_function" href="classConnStateData.html#abb884f3561ead905fcfd7f47e463ad8e">startDechunkingRequest</a>();</div>
<div class="line"><a id="l03529" name="l03529"></a><span class="lineno"> 3529</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>;</div>
<div class="line"><a id="l03530" name="l03530"></a><span class="lineno"> 3530</span>}</div>
</div>
<div class="line"><a id="l03531" name="l03531"></a><span class="lineno"> 3531</span> </div>
<div class="line"><a id="l03532" name="l03532"></a><span class="lineno"> 3532</span>int64_t</div>
<div class="foldopen" id="foldopen03533" data-start="{" data-end="}">
<div class="line"><a id="l03533" name="l03533"></a><span class="lineno"><a class="line" href="classConnStateData.html#aec04ec17951deaf98852074bef3c171b"> 3533</a></span><a class="code hl_function" href="classConnStateData.html#aec04ec17951deaf98852074bef3c171b">ConnStateData::mayNeedToReadMoreBody</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03534" name="l03534"></a><span class="lineno"> 3534</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03535" name="l03535"></a><span class="lineno"> 3535</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>)</div>
<div class="line"><a id="l03536" name="l03536"></a><span class="lineno"> 3536</span>        <span class="keywordflow">return</span> 0; <span class="comment">// request without a body or read/produced all body bytes</span></div>
<div class="line"><a id="l03537" name="l03537"></a><span class="lineno"> 3537</span> </div>
<div class="line"><a id="l03538" name="l03538"></a><span class="lineno"> 3538</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a50b998e50726e22e7fb46f35038597ad">bodySizeKnown</a>())</div>
<div class="line"><a id="l03539" name="l03539"></a><span class="lineno"> 3539</span>        <span class="keywordflow">return</span> -1; <span class="comment">// probably need to read more, but we cannot be sure</span></div>
<div class="line"><a id="l03540" name="l03540"></a><span class="lineno"> 3540</span> </div>
<div class="line"><a id="l03541" name="l03541"></a><span class="lineno"> 3541</span>    <span class="keyword">const</span> int64_t needToProduce = <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a5413d63a6d1dcda5e2050970dd8dc0ba">unproducedSize</a>();</div>
<div class="line"><a id="l03542" name="l03542"></a><span class="lineno"> 3542</span>    <span class="keyword">const</span> int64_t haveAvailable = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l03543" name="l03543"></a><span class="lineno"> 3543</span> </div>
<div class="line"><a id="l03544" name="l03544"></a><span class="lineno"> 3544</span>    <span class="keywordflow">if</span> (needToProduce &lt;= haveAvailable)</div>
<div class="line"><a id="l03545" name="l03545"></a><span class="lineno"> 3545</span>        <span class="keywordflow">return</span> 0; <span class="comment">// we have read what we need (but are waiting for pipe space)</span></div>
<div class="line"><a id="l03546" name="l03546"></a><span class="lineno"> 3546</span> </div>
<div class="line"><a id="l03547" name="l03547"></a><span class="lineno"> 3547</span>    <span class="keywordflow">return</span> needToProduce - haveAvailable;</div>
<div class="line"><a id="l03548" name="l03548"></a><span class="lineno"> 3548</span>}</div>
</div>
<div class="line"><a id="l03549" name="l03549"></a><span class="lineno"> 3549</span> </div>
<div class="line"><a id="l03550" name="l03550"></a><span class="lineno"> 3550</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03551" data-start="{" data-end="}">
<div class="line"><a id="l03551" name="l03551"></a><span class="lineno"><a class="line" href="classConnStateData.html#ab0b6b47377ef5853fc9c22e3ae62f1f8"> 3551</a></span><a class="code hl_function" href="classConnStateData.html#ab0b6b47377ef5853fc9c22e3ae62f1f8">ConnStateData::stopReceiving</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>)</div>
<div class="line"><a id="l03552" name="l03552"></a><span class="lineno"> 3552</span>{</div>
<div class="line"><a id="l03553" name="l03553"></a><span class="lineno"> 3553</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;receiving error (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;): &quot;</span> &lt;&lt; <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a> &lt;&lt;</div>
<div class="line"><a id="l03554" name="l03554"></a><span class="lineno"> 3554</span>           <span class="stringliteral">&quot;; old sending error: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03555" name="l03555"></a><span class="lineno"> 3555</span>           (<a class="code hl_function" href="classConnStateData.html#aeff8387932f77bdb4957099a4528f73e">stoppedSending</a>() ? <a class="code hl_variable" href="classConnStateData.html#a97dd48eb3cc7bdf5b33053afe7bb7c94">stoppedSending_</a> : <span class="stringliteral">&quot;none&quot;</span>));</div>
<div class="line"><a id="l03556" name="l03556"></a><span class="lineno"> 3556</span> </div>
<div class="line"><a id="l03557" name="l03557"></a><span class="lineno"> 3557</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *oldError = <a class="code hl_function" href="classConnStateData.html#a30d7e040d87665326b2cd9f63466cde2">stoppedReceiving</a>()) {</div>
<div class="line"><a id="l03558" name="l03558"></a><span class="lineno"> 3558</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;already stopped receiving: &quot;</span> &lt;&lt; oldError);</div>
<div class="line"><a id="l03559" name="l03559"></a><span class="lineno"> 3559</span>        <span class="keywordflow">return</span>; <span class="comment">// nothing has changed as far as this connection is concerned</span></div>
<div class="line"><a id="l03560" name="l03560"></a><span class="lineno"> 3560</span>    }</div>
<div class="line"><a id="l03561" name="l03561"></a><span class="lineno"> 3561</span> </div>
<div class="line"><a id="l03562" name="l03562"></a><span class="lineno"> 3562</span>    <a class="code hl_variable" href="classConnStateData.html#ae37f30536c4a7ab66385bec18d1f02ec">stoppedReceiving_</a> = <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>;</div>
<div class="line"><a id="l03563" name="l03563"></a><span class="lineno"> 3563</span> </div>
<div class="line"><a id="l03564" name="l03564"></a><span class="lineno"> 3564</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *sendError = <a class="code hl_function" href="classConnStateData.html#aeff8387932f77bdb4957099a4528f73e">stoppedSending</a>()) {</div>
<div class="line"><a id="l03565" name="l03565"></a><span class="lineno"> 3565</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;closing because also stopped sending: &quot;</span> &lt;&lt; sendError);</div>
<div class="line"><a id="l03566" name="l03566"></a><span class="lineno"> 3566</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l03567" name="l03567"></a><span class="lineno"> 3567</span>    }</div>
<div class="line"><a id="l03568" name="l03568"></a><span class="lineno"> 3568</span>}</div>
</div>
<div class="line"><a id="l03569" name="l03569"></a><span class="lineno"> 3569</span> </div>
<div class="line"><a id="l03570" name="l03570"></a><span class="lineno"> 3570</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03571" data-start="{" data-end="}">
<div class="line"><a id="l03571" name="l03571"></a><span class="lineno"><a class="line" href="classConnStateData.html#a56c3ce7c30a3ab5ac9a83489ee862e20"> 3571</a></span><a class="code hl_function" href="classConnStateData.html#a56c3ce7c30a3ab5ac9a83489ee862e20">ConnStateData::expectNoForwarding</a>()</div>
<div class="line"><a id="l03572" name="l03572"></a><span class="lineno"> 3572</span>{</div>
<div class="line"><a id="l03573" name="l03573"></a><span class="lineno"> 3573</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03574" name="l03574"></a><span class="lineno"> 3574</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;no consumer for virgin body &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a86a7bad07711a162dccad979af7d4a20">status</a>());</div>
<div class="line"><a id="l03575" name="l03575"></a><span class="lineno"> 3575</span>        <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a0efa9af26ca9da7e778483b69be10898">expectNoConsumption</a>();</div>
<div class="line"><a id="l03576" name="l03576"></a><span class="lineno"> 3576</span>    }</div>
<div class="line"><a id="l03577" name="l03577"></a><span class="lineno"> 3577</span>}</div>
</div>
<div class="line"><a id="l03578" name="l03578"></a><span class="lineno"> 3578</span> </div>
<div class="line"><a id="l03580" name="l03580"></a><span class="lineno"> 3580</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03581" data-start="{" data-end="}">
<div class="line"><a id="l03581" name="l03581"></a><span class="lineno"><a class="line" href="classConnStateData.html#abb884f3561ead905fcfd7f47e463ad8e"> 3581</a></span><a class="code hl_function" href="classConnStateData.html#abb884f3561ead905fcfd7f47e463ad8e">ConnStateData::startDechunkingRequest</a>()</div>
<div class="line"><a id="l03582" name="l03582"></a><span class="lineno"> 3582</span>{</div>
<div class="line"><a id="l03583" name="l03583"></a><span class="lineno"> 3583</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03584" name="l03584"></a><span class="lineno"> 3584</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;start dechunking&quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a86a7bad07711a162dccad979af7d4a20">status</a>());</div>
<div class="line"><a id="l03585" name="l03585"></a><span class="lineno"> 3585</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!<a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>);</div>
<div class="line"><a id="l03586" name="l03586"></a><span class="lineno"> 3586</span>    <a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a> = <span class="keyword">new</span> <a class="code hl_class" href="classHttp_1_1One_1_1TeChunkedParser.html">Http1::TeChunkedParser</a>;</div>
<div class="line"><a id="l03587" name="l03587"></a><span class="lineno"> 3587</span>}</div>
</div>
<div class="line"><a id="l03588" name="l03588"></a><span class="lineno"> 3588</span> </div>
<div class="line"><a id="l03590" name="l03590"></a><span class="lineno"> 3590</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03591" data-start="{" data-end="}">
<div class="line"><a id="l03591" name="l03591"></a><span class="lineno"><a class="line" href="classConnStateData.html#ad424e6c4c64842378e58b154b8ff7a7c"> 3591</a></span><a class="code hl_function" href="classConnStateData.html#ad424e6c4c64842378e58b154b8ff7a7c">ConnStateData::finishDechunkingRequest</a>(<span class="keywordtype">bool</span> withSuccess)</div>
<div class="line"><a id="l03592" name="l03592"></a><span class="lineno"> 3592</span>{</div>
<div class="line"><a id="l03593" name="l03593"></a><span class="lineno"> 3593</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;finish dechunking: &quot;</span> &lt;&lt; withSuccess);</div>
<div class="line"><a id="l03594" name="l03594"></a><span class="lineno"> 3594</span> </div>
<div class="line"><a id="l03595" name="l03595"></a><span class="lineno"> 3595</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03596" name="l03596"></a><span class="lineno"> 3596</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;dechunked tail: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>-&gt;<a class="code hl_function" href="classBodyPipe.html#a86a7bad07711a162dccad979af7d4a20">status</a>());</div>
<div class="line"><a id="l03597" name="l03597"></a><span class="lineno"> 3597</span>        <a class="code hl_class" href="classRefCount.html">BodyPipe::Pointer</a> myPipe = <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>;</div>
<div class="line"><a id="l03598" name="l03598"></a><span class="lineno"> 3598</span>        <a class="code hl_function" href="classBodyProducer.html#a74c6e12314d91957acc4dbbc610ed8d6">stopProducingFor</a>(<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>, withSuccess); <span class="comment">// sets bodyPipe-&gt;bodySize()</span></div>
<div class="line"><a id="l03599" name="l03599"></a><span class="lineno"> 3599</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(!<a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a>); <span class="comment">// we rely on it being nil after we are done with body</span></div>
<div class="line"><a id="l03600" name="l03600"></a><span class="lineno"> 3600</span>        <span class="keywordflow">if</span> (withSuccess) {</div>
<div class="line"><a id="l03601" name="l03601"></a><span class="lineno"> 3601</span>            <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(myPipe-&gt;<a class="code hl_function" href="classBodyPipe.html#a50b998e50726e22e7fb46f35038597ad">bodySizeKnown</a>());</div>
<div class="line"><a id="l03602" name="l03602"></a><span class="lineno"> 3602</span>            <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>();</div>
<div class="line"><a id="l03603" name="l03603"></a><span class="lineno"> 3603</span>            <span class="keywordflow">if</span> (context != <span class="keyword">nullptr</span> &amp;&amp; context-&gt;http &amp;&amp; context-&gt;http-&gt;request)</div>
<div class="line"><a id="l03604" name="l03604"></a><span class="lineno"> 3604</span>                context-&gt;http-&gt;request-&gt;setContentLength(myPipe-&gt;<a class="code hl_function" href="classBodyPipe.html#ab0fa925752b586541d3a3414ef1474c6">bodySize</a>());</div>
<div class="line"><a id="l03605" name="l03605"></a><span class="lineno"> 3605</span>        }</div>
<div class="line"><a id="l03606" name="l03606"></a><span class="lineno"> 3606</span>    }</div>
<div class="line"><a id="l03607" name="l03607"></a><span class="lineno"> 3607</span> </div>
<div class="line"><a id="l03608" name="l03608"></a><span class="lineno"> 3608</span>    <span class="keyword">delete</span> <a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a>;</div>
<div class="line"><a id="l03609" name="l03609"></a><span class="lineno"> 3609</span>    <a class="code hl_variable" href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">bodyParser</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03610" name="l03610"></a><span class="lineno"> 3610</span>}</div>
</div>
<div class="line"><a id="l03611" name="l03611"></a><span class="lineno"> 3611</span> </div>
<div class="line"><a id="l03612" name="l03612"></a><span class="lineno"> 3612</span><span class="comment">// XXX: this is an HTTP/1-only operation</span></div>
<div class="line"><a id="l03613" name="l03613"></a><span class="lineno"> 3613</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03614" data-start="{" data-end="}">
<div class="line"><a id="l03614" name="l03614"></a><span class="lineno"><a class="line" href="classConnStateData.html#a3b89321dd8a2fe3e28137e1562f157ff"> 3614</a></span><a class="code hl_function" href="classConnStateData.html#a3b89321dd8a2fe3e28137e1562f157ff">ConnStateData::sendControlMsg</a>(<a class="code hl_class" href="classHttpControlMsg.html">HttpControlMsg</a> msg)</div>
<div class="line"><a id="l03615" name="l03615"></a><span class="lineno"> 3615</span>{</div>
<div class="line"><a id="l03616" name="l03616"></a><span class="lineno"> 3616</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>()) {</div>
<div class="line"><a id="l03617" name="l03617"></a><span class="lineno"> 3617</span>        <span class="keywordflow">if</span> (context-&gt;http)</div>
<div class="line"><a id="l03618" name="l03618"></a><span class="lineno"> 3618</span>            context-&gt;http-&gt;al-&gt;reply = msg.<a class="code hl_variable" href="classHttpControlMsg.html#a59062ff487258eb32b6f1081db160988">reply</a>;</div>
<div class="line"><a id="l03619" name="l03619"></a><span class="lineno"> 3619</span>    }</div>
<div class="line"><a id="l03620" name="l03620"></a><span class="lineno"> 3620</span> </div>
<div class="line"><a id="l03621" name="l03621"></a><span class="lineno"> 3621</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">isOpen</a>()) {</div>
<div class="line"><a id="l03622" name="l03622"></a><span class="lineno"> 3622</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;ignoring 1xx due to earlier closure&quot;</span>);</div>
<div class="line"><a id="l03623" name="l03623"></a><span class="lineno"> 3623</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03624" name="l03624"></a><span class="lineno"> 3624</span>    }</div>
<div class="line"><a id="l03625" name="l03625"></a><span class="lineno"> 3625</span> </div>
<div class="line"><a id="l03626" name="l03626"></a><span class="lineno"> 3626</span>    <span class="comment">// HTTP/1 1xx status messages are only valid when there is a transaction to trigger them</span></div>
<div class="line"><a id="l03627" name="l03627"></a><span class="lineno"> 3627</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>()) {</div>
<div class="line"><a id="l03628" name="l03628"></a><span class="lineno"> 3628</span>        <a class="code hl_class" href="classRefCount.html">HttpReply::Pointer</a> rep(msg.<a class="code hl_variable" href="classHttpControlMsg.html#a59062ff487258eb32b6f1081db160988">reply</a>);</div>
<div class="line"><a id="l03629" name="l03629"></a><span class="lineno"> 3629</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(rep);</div>
<div class="line"><a id="l03630" name="l03630"></a><span class="lineno"> 3630</span>        <span class="comment">// remember the callback</span></div>
<div class="line"><a id="l03631" name="l03631"></a><span class="lineno"> 3631</span>        <a class="code hl_variable" href="classHttpControlMsgSink.html#a10a891d78d81fd0683ac76c3d3aa7e6e">cbControlMsgSent</a> = msg.<a class="code hl_variable" href="classHttpControlMsg.html#a41e5b0b9fadc256124dc226669893ce8">cbSuccess</a>;</div>
<div class="line"><a id="l03632" name="l03632"></a><span class="lineno"> 3632</span> </div>
<div class="line"><a id="l03633" name="l03633"></a><span class="lineno"> 3633</span>        <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;HttpControlMsgSink, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l03634" name="l03634"></a><span class="lineno"> 3634</span>        <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classHttpControlMsgSink.html#a4a0ae86dd606efd90dee861258cb3081">HttpControlMsgSink::wroteControlMsg</a>);</div>
<div class="line"><a id="l03635" name="l03635"></a><span class="lineno"> 3635</span> </div>
<div class="line"><a id="l03636" name="l03636"></a><span class="lineno"> 3636</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classConnStateData.html#a2756cdd773238b531b34df1566a2ae58">writeControlMsgAndCall</a>(rep.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>(), call)) {</div>
<div class="line"><a id="l03637" name="l03637"></a><span class="lineno"> 3637</span>            <span class="comment">// but still inform the caller (so it may resume its operation)</span></div>
<div class="line"><a id="l03638" name="l03638"></a><span class="lineno"> 3638</span>            <a class="code hl_function" href="classConnStateData.html#a6364a30db9acc7c576c99fcdc52ba8b7">doneWithControlMsg</a>();</div>
<div class="line"><a id="l03639" name="l03639"></a><span class="lineno"> 3639</span>        }</div>
<div class="line"><a id="l03640" name="l03640"></a><span class="lineno"> 3640</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03641" name="l03641"></a><span class="lineno"> 3641</span>    }</div>
<div class="line"><a id="l03642" name="l03642"></a><span class="lineno"> 3642</span> </div>
<div class="line"><a id="l03643" name="l03643"></a><span class="lineno"> 3643</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot; closing due to missing context for 1xx&quot;</span>);</div>
<div class="line"><a id="l03644" name="l03644"></a><span class="lineno"> 3644</span>    <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l03645" name="l03645"></a><span class="lineno"> 3645</span>}</div>
</div>
<div class="line"><a id="l03646" name="l03646"></a><span class="lineno"> 3646</span> </div>
<div class="line"><a id="l03647" name="l03647"></a><span class="lineno"> 3647</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03648" data-start="{" data-end="}">
<div class="line"><a id="l03648" name="l03648"></a><span class="lineno"><a class="line" href="classConnStateData.html#a6364a30db9acc7c576c99fcdc52ba8b7"> 3648</a></span><a class="code hl_function" href="classConnStateData.html#a6364a30db9acc7c576c99fcdc52ba8b7">ConnStateData::doneWithControlMsg</a>()</div>
<div class="line"><a id="l03649" name="l03649"></a><span class="lineno"> 3649</span>{</div>
<div class="line"><a id="l03650" name="l03650"></a><span class="lineno"> 3650</span>    <a class="code hl_function" href="classHttpControlMsgSink.html#adecf27e052bf565c42ba459ff38b0247">HttpControlMsgSink::doneWithControlMsg</a>();</div>
<div class="line"><a id="l03651" name="l03651"></a><span class="lineno"> 3651</span> </div>
<div class="line"><a id="l03652" name="l03652"></a><span class="lineno"> 3652</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> deferredRequest = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>()) {</div>
<div class="line"><a id="l03653" name="l03653"></a><span class="lineno"> 3653</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> &lt;&lt; <span class="stringliteral">&quot;: calling PushDeferredIfNeeded after control msg wrote&quot;</span>);</div>
<div class="line"><a id="l03654" name="l03654"></a><span class="lineno"> 3654</span>        <a class="code hl_function" href="client__side_8cc.html#ab489de204612ef3a359eee05b1556dda">ClientSocketContextPushDeferredIfNeeded</a>(deferredRequest, <span class="keyword">this</span>);</div>
<div class="line"><a id="l03655" name="l03655"></a><span class="lineno"> 3655</span>    }</div>
<div class="line"><a id="l03656" name="l03656"></a><span class="lineno"> 3656</span>}</div>
</div>
<div class="line"><a id="l03657" name="l03657"></a><span class="lineno"> 3657</span> </div>
<div class="line"><a id="l03659" name="l03659"></a><span class="lineno"> 3659</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03660" data-start="{" data-end="}">
<div class="line"><a id="l03660" name="l03660"></a><span class="lineno"><a class="line" href="classConnStateData.html#a17f5c3c2de993a7edcf465054e08d8de"> 3660</a></span><a class="code hl_function" href="classConnStateData.html#a17f5c3c2de993a7edcf465054e08d8de">ConnStateData::clientPinnedConnectionClosed</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommCloseCbParams.html">CommCloseCbParams</a> &amp;io)</div>
<div class="line"><a id="l03661" name="l03661"></a><span class="lineno"> 3661</span>{</div>
<div class="line"><a id="l03662" name="l03662"></a><span class="lineno"> 3662</span>    <span class="comment">// FwdState might repin a failed connection sooner than this close</span></div>
<div class="line"><a id="l03663" name="l03663"></a><span class="lineno"> 3663</span>    <span class="comment">// callback is called for the failed connection.</span></div>
<div class="line"><a id="l03664" name="l03664"></a><span class="lineno"> 3664</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection == io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>);</div>
<div class="line"><a id="l03665" name="l03665"></a><span class="lineno"> 3665</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.closeHandler = <span class="keyword">nullptr</span>; <span class="comment">// Comm unregisters handlers before calling</span></div>
<div class="line"><a id="l03666" name="l03666"></a><span class="lineno"> 3666</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> sawZeroReply = <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.zeroReply; <span class="comment">// reset when unpinning</span></div>
<div class="line"><a id="l03667" name="l03667"></a><span class="lineno"> 3667</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;noteClosure();</div>
<div class="line"><a id="l03668" name="l03668"></a><span class="lineno"> 3668</span>    <a class="code hl_function" href="classConnStateData.html#ab538ca8c4b7cf767362cbce8e95a93ce">unpinConnection</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l03669" name="l03669"></a><span class="lineno"> 3669</span> </div>
<div class="line"><a id="l03670" name="l03670"></a><span class="lineno"> 3670</span>    <span class="keywordflow">if</span> (sawZeroReply &amp;&amp; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03671" name="l03671"></a><span class="lineno"> 3671</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;Closing client connection on pinned zero reply.&quot;</span>);</div>
<div class="line"><a id="l03672" name="l03672"></a><span class="lineno"> 3672</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l03673" name="l03673"></a><span class="lineno"> 3673</span>    }</div>
<div class="line"><a id="l03674" name="l03674"></a><span class="lineno"> 3674</span> </div>
<div class="line"><a id="l03675" name="l03675"></a><span class="lineno"> 3675</span>}</div>
</div>
<div class="line"><a id="l03676" name="l03676"></a><span class="lineno"> 3676</span> </div>
<div class="line"><a id="l03677" name="l03677"></a><span class="lineno"> 3677</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03678" data-start="{" data-end="}">
<div class="line"><a id="l03678" name="l03678"></a><span class="lineno"><a class="line" href="classConnStateData.html#a8a118895aaccb8b055f9d9b907475a6d"> 3678</a></span><a class="code hl_function" href="classConnStateData.html#a8a118895aaccb8b055f9d9b907475a6d">ConnStateData::pinBusyConnection</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> &amp;pinServer, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">HttpRequest::Pointer</a> &amp;request)</div>
<div class="line"><a id="l03679" name="l03679"></a><span class="lineno"> 3679</span>{</div>
<div class="line"><a id="l03680" name="l03680"></a><span class="lineno"> 3680</span>    <a class="code hl_function" href="classConnStateData.html#a694a73187eca3df02a099e60deff2b52">pinConnection</a>(pinServer, *request);</div>
<div class="line"><a id="l03681" name="l03681"></a><span class="lineno"> 3681</span>}</div>
</div>
<div class="line"><a id="l03682" name="l03682"></a><span class="lineno"> 3682</span> </div>
<div class="line"><a id="l03683" name="l03683"></a><span class="lineno"> 3683</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03684" data-start="{" data-end="}">
<div class="line"><a id="l03684" name="l03684"></a><span class="lineno"><a class="line" href="classConnStateData.html#a89c4a9371afb6c0a45be3c0c1b0cb4f6"> 3684</a></span><a class="code hl_function" href="classConnStateData.html#a89c4a9371afb6c0a45be3c0c1b0cb4f6">ConnStateData::notePinnedConnectionBecameIdle</a>(<a class="code hl_class" href="classConnStateData_1_1PinnedIdleContext.html">PinnedIdleContext</a> pic)</div>
<div class="line"><a id="l03685" name="l03685"></a><span class="lineno"> 3685</span>{</div>
<div class="line"><a id="l03686" name="l03686"></a><span class="lineno"> 3686</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#ad07351f67935319498317d281beffdf7">connection</a>);</div>
<div class="line"><a id="l03687" name="l03687"></a><span class="lineno"> 3687</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#addadc081ff7543e5d6dd5d7becf1888e">request</a>);</div>
<div class="line"><a id="l03688" name="l03688"></a><span class="lineno"> 3688</span>    <a class="code hl_function" href="classConnStateData.html#a694a73187eca3df02a099e60deff2b52">pinConnection</a>(pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#ad07351f67935319498317d281beffdf7">connection</a>, *pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#addadc081ff7543e5d6dd5d7becf1888e">request</a>);</div>
<div class="line"><a id="l03689" name="l03689"></a><span class="lineno"> 3689</span> </div>
<div class="line"><a id="l03690" name="l03690"></a><span class="lineno"> 3690</span>    <span class="comment">// monitor pinned server connection for remote-end closures.</span></div>
<div class="line"><a id="l03691" name="l03691"></a><span class="lineno"> 3691</span>    <a class="code hl_function" href="classConnStateData.html#a2d787d1d6f3b575d1515887213e2172c">startPinnedConnectionMonitoring</a>();</div>
<div class="line"><a id="l03692" name="l03692"></a><span class="lineno"> 3692</span> </div>
<div class="line"><a id="l03693" name="l03693"></a><span class="lineno"> 3693</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>())</div>
<div class="line"><a id="l03694" name="l03694"></a><span class="lineno"> 3694</span>        <a class="code hl_function" href="classConnStateData.html#a3cb67d29f73c36995e78cc0870235bd9">kick</a>(); <span class="comment">// in case parseRequests() was blocked by a busy pic.connection</span></div>
<div class="line"><a id="l03695" name="l03695"></a><span class="lineno"> 3695</span>}</div>
</div>
<div class="line"><a id="l03696" name="l03696"></a><span class="lineno"> 3696</span> </div>
<div class="line"><a id="l03698" name="l03698"></a><span class="lineno"> 3698</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03699" data-start="{" data-end="}">
<div class="line"><a id="l03699" name="l03699"></a><span class="lineno"><a class="line" href="classConnStateData.html#a694a73187eca3df02a099e60deff2b52"> 3699</a></span><a class="code hl_function" href="classConnStateData.html#a694a73187eca3df02a099e60deff2b52">ConnStateData::pinConnection</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> &amp;pinServer, <span class="keyword">const</span> <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> &amp;request)</div>
<div class="line"><a id="l03700" name="l03700"></a><span class="lineno"> 3700</span>{</div>
<div class="line"><a id="l03701" name="l03701"></a><span class="lineno"> 3701</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection) &amp;&amp;</div>
<div class="line"><a id="l03702" name="l03702"></a><span class="lineno"> 3702</span>            <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;fd == pinServer-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>) {</div>
<div class="line"><a id="l03703" name="l03703"></a><span class="lineno"> 3703</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;already pinned&quot;</span> &lt;&lt; pinServer);</div>
<div class="line"><a id="l03704" name="l03704"></a><span class="lineno"> 3704</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span>    }</div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span> </div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span>    <a class="code hl_function" href="classConnStateData.html#ab538ca8c4b7cf767362cbce8e95a93ce">unpinConnection</a>(<span class="keyword">true</span>); <span class="comment">// closes pinned connection, if any, and resets fields</span></div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span> </div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection = pinServer;</div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span> </div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection);</div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span> </div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span> </div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *pinnedHost = <span class="stringliteral">&quot;[unknown]&quot;</span>;</div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.host = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(request.<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aab379cecc273683d9744197a8a2efe3f">host</a>());</div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.port = request.<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aa09ef977328523ec48e7440c83d728d3">port</a>();</div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span>    pinnedHost = <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.host;</div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.pinned = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.auth = request.<a class="code hl_variable" href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">flags</a>.<a class="code hl_variable" href="classRequestFlags.html#a1cb8c962b36f5ebd3f897fede719dd43">connectionAuth</a>;</div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span>    <span class="keywordtype">char</span> stmp[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span>    <span class="keywordtype">char</span> desc[<a class="code hl_define" href="defines_8h.html#afe066d3a9be213351016ccfad3dd374c">FD_DESC_SZ</a>];</div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>    <span class="keyword">const</span> <span class="keyword">auto</span> peer = <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.peer();</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>    snprintf(desc, <a class="code hl_define" href="defines_8h.html#afe066d3a9be213351016ccfad3dd374c">FD_DESC_SZ</a>, <span class="stringliteral">&quot;%s pinned connection for %s (%d)&quot;</span>,</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span>             (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.auth || !peer) ? pinnedHost : peer-&gt;name,</div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span>             <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>.<a class="code hl_function" href="classIp_1_1Address.html#ac22c561fa1b3873a204feb18dd9a16b1">toUrl</a>(stmp,<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>),</div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span>             <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>);</div>
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"> 3728</span>    <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;fd, desc);</div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span> </div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;ConnStateData, CommCloseCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.closeHandler = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5,</div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span>                                       Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classConnStateData.html#a17f5c3c2de993a7edcf465054e08d8de">ConnStateData::clientPinnedConnectionClosed</a>);</div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span>    <span class="comment">// remember the pinned connection so that cb does not unpin a fresher one</span></div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCloseCbParams.html">CommCloseCbParams</a> Params;</div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span>    Params &amp;params = GetCommParams&lt;Params&gt;(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.closeHandler);</div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span>    params.conn = <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection;</div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>    <a class="code hl_function" href="comm_8cc.html#a12f74ce8bc526212a2ba72cecab4ac2b">comm_add_close_handler</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;fd, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.closeHandler);</div>
<div class="line"><a id="l03738" name="l03738"></a><span class="lineno"> 3738</span>}</div>
</div>
<div class="line"><a id="l03739" name="l03739"></a><span class="lineno"> 3739</span> </div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03743" data-start="{" data-end="}">
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"><a class="line" href="classConnStateData.html#a2d787d1d6f3b575d1515887213e2172c"> 3743</a></span><a class="code hl_function" href="classConnStateData.html#a2d787d1d6f3b575d1515887213e2172c">ConnStateData::startPinnedConnectionMonitoring</a>()</div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span>{</div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>        <span class="keywordflow">return</span>; <span class="comment">// already monitoring</span></div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span> </div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;ConnStateData, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 3,</div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span>                                      Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classConnStateData.html#ab07ada10d17a89e0df7bf85e78229925">ConnStateData::clientPinnedConnectionRead</a>);</div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span>    <a class="code hl_function" href="namespaceComm.html#a77060c1b076eaeab719e81a92a5c6589">Comm::Read</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler);</div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span>}</div>
</div>
<div class="line"><a id="l03753" name="l03753"></a><span class="lineno"> 3753</span> </div>
<div class="line"><a id="l03754" name="l03754"></a><span class="lineno"> 3754</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03755" data-start="{" data-end="}">
<div class="line"><a id="l03755" name="l03755"></a><span class="lineno"><a class="line" href="classConnStateData.html#a89ec5bbe58098706c5b5219432c33aef"> 3755</a></span><a class="code hl_function" href="classConnStateData.html#a89ec5bbe58098706c5b5219432c33aef">ConnStateData::stopPinnedConnectionMonitoring</a>()</div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>{</div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span>        <a class="code hl_function" href="namespaceComm.html#a24de01312960dba5c38466509cadb831">Comm::ReadCancel</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;fd, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler);</div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span>        <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span>    }</div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>}</div>
</div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span> </div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen03765" data-start="{" data-end="}">
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"><a class="line" href="classConnStateData.html#a8c49dcd65230f89186098014ad03ebeb"> 3765</a></span><a class="code hl_function" href="classConnStateData.html#a8c49dcd65230f89186098014ad03ebeb">ConnStateData::handleIdleClientPinnedTlsRead</a>()</div>
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"> 3766</span>{</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span>    <span class="comment">// A ready-for-reading connection means that the TLS server either closed</span></div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span>    <span class="comment">// the connection, sent us some unexpected HTTP data, or started TLS</span></div>
<div class="line"><a id="l03769" name="l03769"></a><span class="lineno"> 3769</span>    <span class="comment">// renegotiations. We should close the connection except for the last case.</span></div>
<div class="line"><a id="l03770" name="l03770"></a><span class="lineno"> 3770</span> </div>
<div class="line"><a id="l03771" name="l03771"></a><span class="lineno"> 3771</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03772" name="l03772"></a><span class="lineno"> 3772</span>    <span class="keyword">auto</span> ssl = <a class="code hl_define" href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a>[<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;fd].ssl.get();</div>
<div class="line"><a id="l03773" name="l03773"></a><span class="lineno"> 3773</span>    <span class="keywordflow">if</span> (!ssl)</div>
<div class="line"><a id="l03774" name="l03774"></a><span class="lineno"> 3774</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03775" name="l03775"></a><span class="lineno"> 3775</span> </div>
<div class="line"><a id="l03776" name="l03776"></a><span class="lineno"> 3776</span>    <span class="keywordtype">char</span> buf[1];</div>
<div class="line"><a id="l03777" name="l03777"></a><span class="lineno"> 3777</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> readResult = SSL_read(ssl, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><a id="l03778" name="l03778"></a><span class="lineno"> 3778</span> </div>
<div class="line"><a id="l03779" name="l03779"></a><span class="lineno"> 3779</span>    <span class="keywordflow">if</span> (readResult &gt; 0 || SSL_pending(ssl) &gt; 0) {</div>
<div class="line"><a id="l03780" name="l03780"></a><span class="lineno"> 3780</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection &lt;&lt; <span class="stringliteral">&quot; TLS application data read&quot;</span>);</div>
<div class="line"><a id="l03781" name="l03781"></a><span class="lineno"> 3781</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03782" name="l03782"></a><span class="lineno"> 3782</span>    }</div>
<div class="line"><a id="l03783" name="l03783"></a><span class="lineno"> 3783</span> </div>
<div class="line"><a id="l03784" name="l03784"></a><span class="lineno"> 3784</span>    <span class="keywordflow">switch</span>(<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a> = SSL_get_error(ssl, readResult)) {</div>
<div class="line"><a id="l03785" name="l03785"></a><span class="lineno"> 3785</span>    <span class="keywordflow">case</span> SSL_ERROR_WANT_WRITE:</div>
<div class="line"><a id="l03786" name="l03786"></a><span class="lineno"> 3786</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection &lt;&lt; <span class="stringliteral">&quot; TLS SSL_ERROR_WANT_WRITE request for idle pinned connection&quot;</span>);</div>
<div class="line"><a id="l03787" name="l03787"></a><span class="lineno"> 3787</span>        [[fallthrough]]; <span class="comment">// to restart monitoring, for now</span></div>
<div class="line"><a id="l03788" name="l03788"></a><span class="lineno"> 3788</span> </div>
<div class="line"><a id="l03789" name="l03789"></a><span class="lineno"> 3789</span>    <span class="keywordflow">case</span> SSL_ERROR_NONE:</div>
<div class="line"><a id="l03790" name="l03790"></a><span class="lineno"> 3790</span>    <span class="keywordflow">case</span> SSL_ERROR_WANT_READ:</div>
<div class="line"><a id="l03791" name="l03791"></a><span class="lineno"> 3791</span>        <a class="code hl_function" href="classConnStateData.html#a2d787d1d6f3b575d1515887213e2172c">startPinnedConnectionMonitoring</a>();</div>
<div class="line"><a id="l03792" name="l03792"></a><span class="lineno"> 3792</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03793" name="l03793"></a><span class="lineno"> 3793</span> </div>
<div class="line"><a id="l03794" name="l03794"></a><span class="lineno"> 3794</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l03795" name="l03795"></a><span class="lineno"> 3795</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 2, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection &lt;&lt; <span class="stringliteral">&quot; TLS error: &quot;</span> &lt;&lt; <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>);</div>
<div class="line"><a id="l03796" name="l03796"></a><span class="lineno"> 3796</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03797" name="l03797"></a><span class="lineno"> 3797</span>    }</div>
<div class="line"><a id="l03798" name="l03798"></a><span class="lineno"> 3798</span> </div>
<div class="line"><a id="l03799" name="l03799"></a><span class="lineno"> 3799</span>    <span class="comment">// not reached</span></div>
<div class="line"><a id="l03800" name="l03800"></a><span class="lineno"> 3800</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03801" name="l03801"></a><span class="lineno"> 3801</span>}</div>
</div>
<div class="line"><a id="l03802" name="l03802"></a><span class="lineno"> 3802</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03803" name="l03803"></a><span class="lineno"> 3803</span> </div>
<div class="line"><a id="l03806" name="l03806"></a><span class="lineno"> 3806</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03807" data-start="{" data-end="}">
<div class="line"><a id="l03807" name="l03807"></a><span class="lineno"><a class="line" href="classConnStateData.html#ab07ada10d17a89e0df7bf85e78229925"> 3807</a></span><a class="code hl_function" href="classConnStateData.html#ab07ada10d17a89e0df7bf85e78229925">ConnStateData::clientPinnedConnectionRead</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommIoCbParams.html">CommIoCbParams</a> &amp;io)</div>
<div class="line"><a id="l03808" name="l03808"></a><span class="lineno"> 3808</span>{</div>
<div class="line"><a id="l03809" name="l03809"></a><span class="lineno"> 3809</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.readHandler = <span class="keyword">nullptr</span>; <span class="comment">// Comm unregisters handlers before calling</span></div>
<div class="line"><a id="l03810" name="l03810"></a><span class="lineno"> 3810</span> </div>
<div class="line"><a id="l03811" name="l03811"></a><span class="lineno"> 3811</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> == <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c">Comm::ERR_CLOSING</a>)</div>
<div class="line"><a id="l03812" name="l03812"></a><span class="lineno"> 3812</span>        <span class="keywordflow">return</span>; <span class="comment">// close handler will clean up</span></div>
<div class="line"><a id="l03813" name="l03813"></a><span class="lineno"> 3813</span> </div>
<div class="line"><a id="l03814" name="l03814"></a><span class="lineno"> 3814</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection == io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>);</div>
<div class="line"><a id="l03815" name="l03815"></a><span class="lineno"> 3815</span> </div>
<div class="line"><a id="l03816" name="l03816"></a><span class="lineno"> 3816</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03817" name="l03817"></a><span class="lineno"> 3817</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classConnStateData.html#a8c49dcd65230f89186098014ad03ebeb">handleIdleClientPinnedTlsRead</a>())</div>
<div class="line"><a id="l03818" name="l03818"></a><span class="lineno"> 3818</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03819" name="l03819"></a><span class="lineno"> 3819</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03820" name="l03820"></a><span class="lineno"> 3820</span> </div>
<div class="line"><a id="l03821" name="l03821"></a><span class="lineno"> 3821</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> clientIsIdle = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>();</div>
<div class="line"><a id="l03822" name="l03822"></a><span class="lineno"> 3822</span> </div>
<div class="line"><a id="l03823" name="l03823"></a><span class="lineno"> 3823</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;idle pinned &quot;</span> &lt;&lt; <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection &lt;&lt; <span class="stringliteral">&quot; read &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l03824" name="l03824"></a><span class="lineno"> 3824</span>           io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a> &lt;&lt; (clientIsIdle ? <span class="stringliteral">&quot; with idle client&quot;</span> : <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a id="l03825" name="l03825"></a><span class="lineno"> 3825</span> </div>
<div class="line"><a id="l03826" name="l03826"></a><span class="lineno"> 3826</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;close();</div>
<div class="line"><a id="l03827" name="l03827"></a><span class="lineno"> 3827</span> </div>
<div class="line"><a id="l03828" name="l03828"></a><span class="lineno"> 3828</span>    <span class="comment">// If we are still sending data to the client, do not close now. When we are done sending,</span></div>
<div class="line"><a id="l03829" name="l03829"></a><span class="lineno"> 3829</span>    <span class="comment">// ConnStateData::kick() checks pinning.serverConnection and will close.</span></div>
<div class="line"><a id="l03830" name="l03830"></a><span class="lineno"> 3830</span>    <span class="comment">// However, if we are idle, then we must close to inform the idle client and minimize races.</span></div>
<div class="line"><a id="l03831" name="l03831"></a><span class="lineno"> 3831</span>    <span class="keywordflow">if</span> (clientIsIdle &amp;&amp; <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l03832" name="l03832"></a><span class="lineno"> 3832</span>        <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l03833" name="l03833"></a><span class="lineno"> 3833</span>}</div>
</div>
<div class="line"><a id="l03834" name="l03834"></a><span class="lineno"> 3834</span> </div>
<div class="line"><a id="l03835" name="l03835"></a><span class="lineno"> 3835</span><a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a></div>
<div class="foldopen" id="foldopen03836" data-start="{" data-end="}">
<div class="line"><a id="l03836" name="l03836"></a><span class="lineno"><a class="line" href="classConnStateData.html#a8051bf5fae85b96135b3e1e9bb767690"> 3836</a></span><a class="code hl_function" href="classConnStateData.html#a8051bf5fae85b96135b3e1e9bb767690">ConnStateData::borrowPinnedConnection</a>(<a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">AccessLogEntryPointer</a> &amp;ale)</div>
<div class="line"><a id="l03837" name="l03837"></a><span class="lineno"> 3837</span>{</div>
<div class="line"><a id="l03838" name="l03838"></a><span class="lineno"> 3838</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection);</div>
<div class="line"><a id="l03839" name="l03839"></a><span class="lineno"> 3839</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(request);</div>
<div class="line"><a id="l03840" name="l03840"></a><span class="lineno"> 3840</span> </div>
<div class="line"><a id="l03841" name="l03841"></a><span class="lineno"> 3841</span>    <span class="keyword">const</span> <span class="keyword">auto</span> pinningError = [&amp;](<span class="keyword">const</span> <a class="code hl_enumeration" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1a">err_type</a> type) {</div>
<div class="line"><a id="l03842" name="l03842"></a><span class="lineno"> 3842</span>        <a class="code hl_function" href="classConnStateData.html#ab538ca8c4b7cf767362cbce8e95a93ce">unpinConnection</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l03843" name="l03843"></a><span class="lineno"> 3843</span>        <a class="code hl_class" href="classRefCount.html">HttpRequestPointer</a> requestPointer = request;</div>
<div class="line"><a id="l03844" name="l03844"></a><span class="lineno"> 3844</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classErrorState.html#a04f86c86cccfd0cd52bda8075fc90ae4">ErrorState::NewForwarding</a>(type, requestPointer, ale);</div>
<div class="line"><a id="l03845" name="l03845"></a><span class="lineno"> 3845</span>    };</div>
<div class="line"><a id="l03846" name="l03846"></a><span class="lineno"> 3846</span> </div>
<div class="line"><a id="l03847" name="l03847"></a><span class="lineno"> 3847</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection))</div>
<div class="line"><a id="l03848" name="l03848"></a><span class="lineno"> 3848</span>        <span class="keywordflow">throw</span> pinningError(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aac10a09448de9d88d00da6cb19d2c965b">ERR_ZERO_SIZE_OBJECT</a>);</div>
<div class="line"><a id="l03849" name="l03849"></a><span class="lineno"> 3849</span> </div>
<div class="line"><a id="l03850" name="l03850"></a><span class="lineno"> 3850</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.auth &amp;&amp; <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.host &amp;&amp; strcasecmp(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.host, request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aab379cecc273683d9744197a8a2efe3f">host</a>()) != 0)</div>
<div class="line"><a id="l03851" name="l03851"></a><span class="lineno"> 3851</span>        <span class="keywordflow">throw</span> pinningError(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aadeac22da21d5e129eba8311e18baa0ac">ERR_CANNOT_FORWARD</a>); <span class="comment">// or generalize ERR_CONFLICT_HOST</span></div>
<div class="line"><a id="l03852" name="l03852"></a><span class="lineno"> 3852</span> </div>
<div class="line"><a id="l03853" name="l03853"></a><span class="lineno"> 3853</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.port != request-&gt;<a class="code hl_variable" href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">url</a>.<a class="code hl_function" href="classAnyP_1_1Uri.html#aa09ef977328523ec48e7440c83d728d3">port</a>())</div>
<div class="line"><a id="l03854" name="l03854"></a><span class="lineno"> 3854</span>        <span class="keywordflow">throw</span> pinningError(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aadeac22da21d5e129eba8311e18baa0ac">ERR_CANNOT_FORWARD</a>); <span class="comment">// or generalize ERR_CONFLICT_HOST</span></div>
<div class="line"><a id="l03855" name="l03855"></a><span class="lineno"> 3855</span> </div>
<div class="line"><a id="l03856" name="l03856"></a><span class="lineno"> 3856</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;toGoneCachePeer())</div>
<div class="line"><a id="l03857" name="l03857"></a><span class="lineno"> 3857</span>        <span class="keywordflow">throw</span> pinningError(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aac10a09448de9d88d00da6cb19d2c965b">ERR_ZERO_SIZE_OBJECT</a>);</div>
<div class="line"><a id="l03858" name="l03858"></a><span class="lineno"> 3858</span> </div>
<div class="line"><a id="l03859" name="l03859"></a><span class="lineno"> 3859</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.peerAccessDenied)</div>
<div class="line"><a id="l03860" name="l03860"></a><span class="lineno"> 3860</span>        <span class="keywordflow">throw</span> pinningError(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aadeac22da21d5e129eba8311e18baa0ac">ERR_CANNOT_FORWARD</a>); <span class="comment">// or generalize ERR_FORWARDING_DENIED</span></div>
<div class="line"><a id="l03861" name="l03861"></a><span class="lineno"> 3861</span> </div>
<div class="line"><a id="l03862" name="l03862"></a><span class="lineno"> 3862</span>    <a class="code hl_function" href="classConnStateData.html#a89ec5bbe58098706c5b5219432c33aef">stopPinnedConnectionMonitoring</a>();</div>
<div class="line"><a id="l03863" name="l03863"></a><span class="lineno"> 3863</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection;</div>
<div class="line"><a id="l03864" name="l03864"></a><span class="lineno"> 3864</span>}</div>
</div>
<div class="line"><a id="l03865" name="l03865"></a><span class="lineno"> 3865</span> </div>
<div class="line"><a id="l03866" name="l03866"></a><span class="lineno"> 3866</span><a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a></div>
<div class="foldopen" id="foldopen03867" data-start="{" data-end="}">
<div class="line"><a id="l03867" name="l03867"></a><span class="lineno"><a class="line" href="classConnStateData.html#ab0a284b84d7ffec03db178d67bb810d8"> 3867</a></span><a class="code hl_function" href="classConnStateData.html#ab0a284b84d7ffec03db178d67bb810d8">ConnStateData::BorrowPinnedConnection</a>(<a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request, <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">AccessLogEntryPointer</a> &amp;ale)</div>
<div class="line"><a id="l03868" name="l03868"></a><span class="lineno"> 3868</span>{</div>
<div class="line"><a id="l03869" name="l03869"></a><span class="lineno"> 3869</span>    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> connManager = request ? request-&gt;<a class="code hl_function" href="classHttpRequest.html#a98624db05b1d0e020b1178042857038b">pinnedConnection</a>() : <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l03870" name="l03870"></a><span class="lineno"> 3870</span>        <span class="keywordflow">return</span> connManager-&gt;borrowPinnedConnection(request, ale);</div>
<div class="line"><a id="l03871" name="l03871"></a><span class="lineno"> 3871</span> </div>
<div class="line"><a id="l03872" name="l03872"></a><span class="lineno"> 3872</span>    <span class="comment">// ERR_CANNOT_FORWARD is somewhat misleading here; we can still forward, but</span></div>
<div class="line"><a id="l03873" name="l03873"></a><span class="lineno"> 3873</span>    <span class="comment">// there is no point since the client connection is now gone</span></div>
<div class="line"><a id="l03874" name="l03874"></a><span class="lineno"> 3874</span>    <a class="code hl_class" href="classRefCount.html">HttpRequestPointer</a> requestPointer = request;</div>
<div class="line"><a id="l03875" name="l03875"></a><span class="lineno"> 3875</span>    <span class="keywordflow">throw</span> <a class="code hl_function" href="classErrorState.html#a04f86c86cccfd0cd52bda8075fc90ae4">ErrorState::NewForwarding</a>(<a class="code hl_enumvalue" href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aadeac22da21d5e129eba8311e18baa0ac">ERR_CANNOT_FORWARD</a>, requestPointer, ale);</div>
<div class="line"><a id="l03876" name="l03876"></a><span class="lineno"> 3876</span>}</div>
</div>
<div class="line"><a id="l03877" name="l03877"></a><span class="lineno"> 3877</span> </div>
<div class="line"><a id="l03878" name="l03878"></a><span class="lineno"> 3878</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03879" data-start="{" data-end="}">
<div class="line"><a id="l03879" name="l03879"></a><span class="lineno"><a class="line" href="classConnStateData.html#ab538ca8c4b7cf767362cbce8e95a93ce"> 3879</a></span><a class="code hl_function" href="classConnStateData.html#ab538ca8c4b7cf767362cbce8e95a93ce">ConnStateData::unpinConnection</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> andClose)</div>
<div class="line"><a id="l03880" name="l03880"></a><span class="lineno"> 3880</span>{</div>
<div class="line"><a id="l03881" name="l03881"></a><span class="lineno"> 3881</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection);</div>
<div class="line"><a id="l03882" name="l03882"></a><span class="lineno"> 3882</span> </div>
<div class="line"><a id="l03883" name="l03883"></a><span class="lineno"> 3883</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection)) {</div>
<div class="line"><a id="l03884" name="l03884"></a><span class="lineno"> 3884</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.closeHandler != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03885" name="l03885"></a><span class="lineno"> 3885</span>            <a class="code hl_function" href="comm_8cc.html#a1813bd28707d918f0871c19aa55ca905">comm_remove_close_handler</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;fd, <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.closeHandler);</div>
<div class="line"><a id="l03886" name="l03886"></a><span class="lineno"> 3886</span>            <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.closeHandler = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03887" name="l03887"></a><span class="lineno"> 3887</span>        }</div>
<div class="line"><a id="l03888" name="l03888"></a><span class="lineno"> 3888</span> </div>
<div class="line"><a id="l03889" name="l03889"></a><span class="lineno"> 3889</span>        <a class="code hl_function" href="classConnStateData.html#a89ec5bbe58098706c5b5219432c33aef">stopPinnedConnectionMonitoring</a>();</div>
<div class="line"><a id="l03890" name="l03890"></a><span class="lineno"> 3890</span> </div>
<div class="line"><a id="l03891" name="l03891"></a><span class="lineno"> 3891</span>        <span class="comment">// close the server side socket if requested</span></div>
<div class="line"><a id="l03892" name="l03892"></a><span class="lineno"> 3892</span>        <span class="keywordflow">if</span> (andClose)</div>
<div class="line"><a id="l03893" name="l03893"></a><span class="lineno"> 3893</span>            <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection-&gt;close();</div>
<div class="line"><a id="l03894" name="l03894"></a><span class="lineno"> 3894</span>        <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.serverConnection = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03895" name="l03895"></a><span class="lineno"> 3895</span>    }</div>
<div class="line"><a id="l03896" name="l03896"></a><span class="lineno"> 3896</span> </div>
<div class="line"><a id="l03897" name="l03897"></a><span class="lineno"> 3897</span>    <a class="code hl_define" href="xalloc_8h.html#a74ad4c3c3aa58c8fea96eb0dc090fd67">safe_free</a>(<a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.host);</div>
<div class="line"><a id="l03898" name="l03898"></a><span class="lineno"> 3898</span> </div>
<div class="line"><a id="l03899" name="l03899"></a><span class="lineno"> 3899</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.zeroReply = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03900" name="l03900"></a><span class="lineno"> 3900</span>    <a class="code hl_variable" href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">pinning</a>.peerAccessDenied = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03901" name="l03901"></a><span class="lineno"> 3901</span> </div>
<div class="line"><a id="l03902" name="l03902"></a><span class="lineno"> 3902</span>    <span class="comment">/* NOTE: pinning.pinned should be kept. This combined with fd == -1 at the end of a request indicates that the host</span></div>
<div class="line"><a id="l03903" name="l03903"></a><span class="lineno"> 3903</span><span class="comment">     * connection has gone away */</span></div>
<div class="line"><a id="l03904" name="l03904"></a><span class="lineno"> 3904</span>}</div>
</div>
<div class="line"><a id="l03905" name="l03905"></a><span class="lineno"> 3905</span> </div>
<div class="line"><a id="l03906" name="l03906"></a><span class="lineno"> 3906</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03907" data-start="{" data-end="}">
<div class="line"><a id="l03907" name="l03907"></a><span class="lineno"><a class="line" href="classConnStateData.html#a66927b5570f7ee51400c0bca0751cee6"> 3907</a></span><a class="code hl_function" href="classConnStateData.html#a66927b5570f7ee51400c0bca0751cee6">ConnStateData::terminateAll</a>(<span class="keyword">const</span> <a class="code hl_class" href="classError.html">Error</a> &amp;rawError, <span class="keyword">const</span> <a class="code hl_class" href="classLogTagsErrors.html">LogTagsErrors</a> &amp;lte)</div>
<div class="line"><a id="l03908" name="l03908"></a><span class="lineno"> 3908</span>{</div>
<div class="line"><a id="l03909" name="l03909"></a><span class="lineno"> 3909</span>    <span class="keyword">auto</span> <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a> = rawError; <span class="comment">// (cheap) copy so that we can detail</span></div>
<div class="line"><a id="l03910" name="l03910"></a><span class="lineno"> 3910</span>    <span class="comment">// We detail even ERR_NONE: There should be no transactions left, and</span></div>
<div class="line"><a id="l03911" name="l03911"></a><span class="lineno"> 3911</span>    <span class="comment">// detailed ERR_NONE will be unused. Otherwise, this detail helps in triage.</span></div>
<div class="line"><a id="l03912" name="l03912"></a><span class="lineno"> 3912</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>.details.empty()) {</div>
<div class="line"><a id="l03913" name="l03913"></a><span class="lineno"> 3913</span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> d = <a class="code hl_function" href="Detail_8cc.html#a3daf1a4d3c9feca00e60712558a94558">MakeNamedErrorDetail</a>(<span class="stringliteral">&quot;WITH_CLIENT&quot;</span>);</div>
<div class="line"><a id="l03914" name="l03914"></a><span class="lineno"> 3914</span>        <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>.details.push_back(d);</div>
<div class="line"><a id="l03915" name="l03915"></a><span class="lineno"> 3915</span>    }</div>
<div class="line"><a id="l03916" name="l03916"></a><span class="lineno"> 3916</span> </div>
<div class="line"><a id="l03917" name="l03917"></a><span class="lineno"> 3917</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a2a570842f872e93817685f1d576e7375">count</a>() &lt;&lt; <span class="charliteral">&#39;/&#39;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_variable" href="classPipeline.html#a349118f98c80d65b033429b2faa2b564">nrequests</a> &lt;&lt; <span class="stringliteral">&quot; after &quot;</span> &lt;&lt; <a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>);</div>
<div class="line"><a id="l03918" name="l03918"></a><span class="lineno"> 3918</span> </div>
<div class="line"><a id="l03919" name="l03919"></a><span class="lineno"> 3919</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>()) {</div>
<div class="line"><a id="l03920" name="l03920"></a><span class="lineno"> 3920</span>        <a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>.<a class="code hl_function" href="classError.html#a6e163b6a5a08adf7f23ea363d8935ee3">update</a>(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>); <span class="comment">// XXX: bareLogTagsErrors</span></div>
<div class="line"><a id="l03921" name="l03921"></a><span class="lineno"> 3921</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03922" name="l03922"></a><span class="lineno"> 3922</span>        <span class="comment">// We terminate the current CONNECT/PUT/etc. context below, logging any</span></div>
<div class="line"><a id="l03923" name="l03923"></a><span class="lineno"> 3923</span>        <span class="comment">// error details, but that context may leave unparsed bytes behind.</span></div>
<div class="line"><a id="l03924" name="l03924"></a><span class="lineno"> 3924</span>        <span class="comment">// Consume them to stop checkLogging() from logging them again later.</span></div>
<div class="line"><a id="l03925" name="l03925"></a><span class="lineno"> 3925</span>        <span class="keyword">const</span> <span class="keyword">auto</span> intputToConsume =</div>
<div class="line"><a id="l03926" name="l03926"></a><span class="lineno"> 3926</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03927" name="l03927"></a><span class="lineno"> 3927</span>            <a class="code hl_variable" href="classConnStateData.html#adbe8b3f0075d4ba6c7a0ac7c62b43a23">parsingTlsHandshake</a> ? <span class="stringliteral">&quot;TLS handshake&quot;</span> : <span class="comment">// more specific than CONNECT</span></div>
<div class="line"><a id="l03928" name="l03928"></a><span class="lineno"> 3928</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03929" name="l03929"></a><span class="lineno"> 3929</span>            <a class="code hl_variable" href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">bodyPipe</a> ? <span class="stringliteral">&quot;HTTP request body&quot;</span> :</div>
<div class="line"><a id="l03930" name="l03930"></a><span class="lineno"> 3930</span>            <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a91846ca6159cbac102f4f914200d66f1">back</a>()-&gt;mayUseConnection() ? <span class="stringliteral">&quot;HTTP CONNECT&quot;</span> :</div>
<div class="line"><a id="l03931" name="l03931"></a><span class="lineno"> 3931</span>            <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03932" name="l03932"></a><span class="lineno"> 3932</span> </div>
<div class="line"><a id="l03933" name="l03933"></a><span class="lineno"> 3933</span>        <span class="keywordflow">while</span> (<span class="keyword">const</span> <span class="keyword">auto</span> context = <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>()) {</div>
<div class="line"><a id="l03934" name="l03934"></a><span class="lineno"> 3934</span>            context-&gt;noteIoError(<a class="code hl_function" href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a>, lte);</div>
<div class="line"><a id="l03935" name="l03935"></a><span class="lineno"> 3935</span>            context-&gt;finished(); <span class="comment">// cleanup and self-deregister</span></div>
<div class="line"><a id="l03936" name="l03936"></a><span class="lineno"> 3936</span>            <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context != <a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">front</a>());</div>
<div class="line"><a id="l03937" name="l03937"></a><span class="lineno"> 3937</span>        }</div>
<div class="line"><a id="l03938" name="l03938"></a><span class="lineno"> 3938</span> </div>
<div class="line"><a id="l03939" name="l03939"></a><span class="lineno"> 3939</span>        <span class="keywordflow">if</span> (intputToConsume &amp;&amp; !<a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>()) {</div>
<div class="line"><a id="l03940" name="l03940"></a><span class="lineno"> 3940</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(83, 5, <span class="stringliteral">&quot;forgetting client &quot;</span> &lt;&lt; intputToConsume &lt;&lt; <span class="stringliteral">&quot; bytes: &quot;</span> &lt;&lt; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l03941" name="l03941"></a><span class="lineno"> 3941</span>            <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">clear</a>();</div>
<div class="line"><a id="l03942" name="l03942"></a><span class="lineno"> 3942</span>        }</div>
<div class="line"><a id="l03943" name="l03943"></a><span class="lineno"> 3943</span>    }</div>
<div class="line"><a id="l03944" name="l03944"></a><span class="lineno"> 3944</span> </div>
<div class="line"><a id="l03945" name="l03945"></a><span class="lineno"> 3945</span>    <a class="code hl_variable" href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">clientConnection</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l03946" name="l03946"></a><span class="lineno"> 3946</span>}</div>
</div>
<div class="line"><a id="l03947" name="l03947"></a><span class="lineno"> 3947</span> </div>
<div class="line"><a id="l03949" name="l03949"></a><span class="lineno"> 3949</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen03950" data-start="{" data-end="}">
<div class="line"><a id="l03950" name="l03950"></a><span class="lineno"><a class="line" href="classConnStateData.html#ab50872ed0917e572c6191a522e8210b0"> 3950</a></span><a class="code hl_function" href="classConnStateData.html#ab50872ed0917e572c6191a522e8210b0">ConnStateData::checkLogging</a>()</div>
<div class="line"><a id="l03951" name="l03951"></a><span class="lineno"> 3951</span>{</div>
<div class="line"><a id="l03952" name="l03952"></a><span class="lineno"> 3952</span>    <span class="comment">// to simplify our logic, we assume that terminateAll() has been called</span></div>
<div class="line"><a id="l03953" name="l03953"></a><span class="lineno"> 3953</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_function" href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">empty</a>());</div>
<div class="line"><a id="l03954" name="l03954"></a><span class="lineno"> 3954</span> </div>
<div class="line"><a id="l03955" name="l03955"></a><span class="lineno"> 3955</span>    <span class="comment">// do not log connections that closed after a transaction (it is normal)</span></div>
<div class="line"><a id="l03956" name="l03956"></a><span class="lineno"> 3956</span>    <span class="comment">// TODO: access_log needs ACLs to match received-no-bytes connections</span></div>
<div class="line"><a id="l03957" name="l03957"></a><span class="lineno"> 3957</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_variable" href="classPipeline.html#a349118f98c80d65b033429b2faa2b564">nrequests</a> &amp;&amp; <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l03958" name="l03958"></a><span class="lineno"> 3958</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03959" name="l03959"></a><span class="lineno"> 3959</span> </div>
<div class="line"><a id="l03960" name="l03960"></a><span class="lineno"> 3960</span>    <span class="comment">/* Create a temporary ClientHttpRequest object. Its destructor will log. */</span></div>
<div class="line"><a id="l03961" name="l03961"></a><span class="lineno"> 3961</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> http(<span class="keyword">this</span>);</div>
<div class="line"><a id="l03962" name="l03962"></a><span class="lineno"> 3962</span>    http.<a class="code hl_variable" href="classClientHttpRequest.html#a88642d6f6a181e20927a9e54cabf3c91">req_sz</a> = <a class="code hl_variable" href="classServer.html#a9cbce101e5899cde000fb625418732ed">inBuf</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>();</div>
<div class="line"><a id="l03963" name="l03963"></a><span class="lineno"> 3963</span>    <span class="comment">// XXX: Or we died while waiting for the pinned connection to become idle.</span></div>
<div class="line"><a id="l03964" name="l03964"></a><span class="lineno"> 3964</span>    http.<a class="code hl_function" href="classClientHttpRequest.html#a9891746d2fe370c2930a7fddb44c1a35">setErrorUri</a>(<span class="stringliteral">&quot;error:transaction-end-before-headers&quot;</span>);</div>
<div class="line"><a id="l03965" name="l03965"></a><span class="lineno"> 3965</span>    http.<a class="code hl_function" href="classClientHttpRequest.html#a6c8eb3e0781de2af44142a360eec1738">updateError</a>(<a class="code hl_variable" href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">bareError</a>);</div>
<div class="line"><a id="l03966" name="l03966"></a><span class="lineno"> 3966</span>}</div>
</div>
<div class="line"><a id="l03967" name="l03967"></a><span class="lineno"> 3967</span> </div>
<div class="line"><a id="l03968" name="l03968"></a><span class="lineno"> 3968</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen03969" data-start="{" data-end="}">
<div class="line"><a id="l03969" name="l03969"></a><span class="lineno"><a class="line" href="classConnStateData.html#a847fd8d20965e6c7dd56c1cdab67ea90"> 3969</a></span><a class="code hl_function" href="classConnStateData.html#a847fd8d20965e6c7dd56c1cdab67ea90">ConnStateData::shouldPreserveClientData</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03970" name="l03970"></a><span class="lineno"> 3970</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03971" name="l03971"></a><span class="lineno"> 3971</span>    <span class="comment">// PROXY protocol bytes are meant for us and, hence, cannot be tunneled</span></div>
<div class="line"><a id="l03972" name="l03972"></a><span class="lineno"> 3972</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae3fb2cba948d6b47e86e6464a96b1191">needProxyProtocolHeader_</a>)</div>
<div class="line"><a id="l03973" name="l03973"></a><span class="lineno"> 3973</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03974" name="l03974"></a><span class="lineno"> 3974</span> </div>
<div class="line"><a id="l03975" name="l03975"></a><span class="lineno"> 3975</span>    <span class="comment">// If our decision here is negative, configuration changes are irrelevant.</span></div>
<div class="line"><a id="l03976" name="l03976"></a><span class="lineno"> 3976</span>    <span class="comment">// Otherwise, clientTunnelOnError() rechecks configuration before tunneling.</span></div>
<div class="line"><a id="l03977" name="l03977"></a><span class="lineno"> 3977</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#ac5b7d100001f066494a2fa4d6d39d994">on_unsupported_protocol</a>)</div>
<div class="line"><a id="l03978" name="l03978"></a><span class="lineno"> 3978</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03979" name="l03979"></a><span class="lineno"> 3979</span> </div>
<div class="line"><a id="l03980" name="l03980"></a><span class="lineno"> 3980</span>    <span class="comment">// TODO: Figure out whether/how we can support FTP tunneling.</span></div>
<div class="line"><a id="l03981" name="l03981"></a><span class="lineno"> 3981</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#ae06c387dd773449597078259a953013b">port</a>-&gt;transport.protocol == <a class="code hl_enumvalue" href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca6b36255bc8fc8723bdfa8d419847697c">AnyP::PROTO_FTP</a>)</div>
<div class="line"><a id="l03982" name="l03982"></a><span class="lineno"> 3982</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03983" name="l03983"></a><span class="lineno"> 3983</span> </div>
<div class="line"><a id="l03984" name="l03984"></a><span class="lineno"> 3984</span><span class="preprocessor">#if USE_OPENSSL</span></div>
<div class="line"><a id="l03985" name="l03985"></a><span class="lineno"> 3985</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classConnStateData.html#adbe8b3f0075d4ba6c7a0ac7c62b43a23">parsingTlsHandshake</a>)</div>
<div class="line"><a id="l03986" name="l03986"></a><span class="lineno"> 3986</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03987" name="l03987"></a><span class="lineno"> 3987</span> </div>
<div class="line"><a id="l03988" name="l03988"></a><span class="lineno"> 3988</span>    <span class="comment">// the 1st HTTP request on a bumped connection</span></div>
<div class="line"><a id="l03989" name="l03989"></a><span class="lineno"> 3989</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#aa8e7d3c1f7073ef1bcd21f91d53167a6">parsedBumpedRequestCount</a> &amp;&amp; <a class="code hl_function" href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">switchedToHttps</a>())</div>
<div class="line"><a id="l03990" name="l03990"></a><span class="lineno"> 3990</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03991" name="l03991"></a><span class="lineno"> 3991</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03992" name="l03992"></a><span class="lineno"> 3992</span> </div>
<div class="line"><a id="l03993" name="l03993"></a><span class="lineno"> 3993</span>    <span class="comment">// the 1st HTTP(S) request on a connection to an intercepting port</span></div>
<div class="line"><a id="l03994" name="l03994"></a><span class="lineno"> 3994</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">pipeline</a>.<a class="code hl_variable" href="classPipeline.html#a349118f98c80d65b033429b2faa2b564">nrequests</a> &amp;&amp; <a class="code hl_function" href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">transparent</a>())</div>
<div class="line"><a id="l03995" name="l03995"></a><span class="lineno"> 3995</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03996" name="l03996"></a><span class="lineno"> 3996</span> </div>
<div class="line"><a id="l03997" name="l03997"></a><span class="lineno"> 3997</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03998" name="l03998"></a><span class="lineno"> 3998</span>}</div>
</div>
<div class="line"><a id="l03999" name="l03999"></a><span class="lineno"> 3999</span> </div>
<div class="line"><a id="l04000" name="l04000"></a><span class="lineno"> 4000</span><a class="code hl_class" href="classRefCount.html">NotePairs::Pointer</a></div>
<div class="foldopen" id="foldopen04001" data-start="{" data-end="}">
<div class="line"><a id="l04001" name="l04001"></a><span class="lineno"><a class="line" href="classConnStateData.html#af5748f5afc6582d105773c5b9e1a3d5d"> 4001</a></span><a class="code hl_function" href="classConnStateData.html#af5748f5afc6582d105773c5b9e1a3d5d">ConnStateData::notes</a>()</div>
<div class="line"><a id="l04002" name="l04002"></a><span class="lineno"> 4002</span>{</div>
<div class="line"><a id="l04003" name="l04003"></a><span class="lineno"> 4003</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classConnStateData.html#af9e7fb8e222868389b301344c4585b5a">theNotes</a>)</div>
<div class="line"><a id="l04004" name="l04004"></a><span class="lineno"> 4004</span>        <a class="code hl_variable" href="classConnStateData.html#af9e7fb8e222868389b301344c4585b5a">theNotes</a> = <span class="keyword">new</span> <a class="code hl_class" href="classNotePairs.html">NotePairs</a>;</div>
<div class="line"><a id="l04005" name="l04005"></a><span class="lineno"> 4005</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classConnStateData.html#af9e7fb8e222868389b301344c4585b5a">theNotes</a>;</div>
<div class="line"><a id="l04006" name="l04006"></a><span class="lineno"> 4006</span>}</div>
</div>
<div class="line"><a id="l04007" name="l04007"></a><span class="lineno"> 4007</span> </div>
<div class="foldopen" id="foldopen04008" data-start="{" data-end="}">
<div class="line"><a id="l04008" name="l04008"></a><span class="lineno"><a class="line" href="client__side_8cc.html#ac237972e8482631d1091e2a7dc4119d0"> 4008</a></span>std::ostream &amp;</div>
<div class="line"><a id="l04009" name="l04009"></a><span class="lineno"> 4009</span><a class="code hl_function" href="client__side_8cc.html#ac237972e8482631d1091e2a7dc4119d0">operator &lt;&lt;</a>(std::ostream &amp;os, <span class="keyword">const</span> <a class="code hl_class" href="classConnStateData_1_1PinnedIdleContext.html">ConnStateData::PinnedIdleContext</a> &amp;pic)</div>
<div class="line"><a id="l04010" name="l04010"></a><span class="lineno"> 4010</span>{</div>
<div class="line"><a id="l04011" name="l04011"></a><span class="lineno"> 4011</span>    <span class="keywordflow">return</span> os &lt;&lt; pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#ad07351f67935319498317d281beffdf7">connection</a> &lt;&lt; <span class="stringliteral">&quot;, request=&quot;</span> &lt;&lt; pic.<a class="code hl_variable" href="classConnStateData_1_1PinnedIdleContext.html#addadc081ff7543e5d6dd5d7becf1888e">request</a>;</div>
<div class="line"><a id="l04012" name="l04012"></a><span class="lineno"> 4012</span>}</div>
</div>
<div class="line"><a id="l04013" name="l04013"></a><span class="lineno"> 4013</span> </div>
<div class="foldopen" id="foldopen04014" data-start="{" data-end="};">
<div class="line"><a id="l04014" name="l04014"></a><span class="lineno"><a class="line" href="classConnStateData_1_1ServerConnectionContext.html#accb77371ff7266cf5dbaf9b917bdb888"> 4014</a></span>std::ostream &amp;</div>
<div class="line"><a id="l04015" name="l04015"></a><span class="lineno"> 4015</span><a class="code hl_function" href="client__side_8cc.html#ac237972e8482631d1091e2a7dc4119d0">operator &lt;&lt;</a>(std::ostream &amp;os, <span class="keyword">const</span> <a class="code hl_class" href="classConnStateData_1_1ServerConnectionContext.html">ConnStateData::ServerConnectionContext</a> &amp;scc)</div>
<div class="line"><a id="l04016" name="l04016"></a><span class="lineno"> 4016</span>{</div>
<div class="line"><a id="l04017" name="l04017"></a><span class="lineno"> 4017</span>    <span class="keywordflow">return</span> os &lt;&lt; scc.<a class="code hl_variable" href="classConnStateData_1_1ServerConnectionContext.html#a0a93dfb368687dc0dbbe48fee379d48d">conn_</a> &lt;&lt; <span class="stringliteral">&quot;, srv_bytes=&quot;</span> &lt;&lt; scc.<a class="code hl_variable" href="classConnStateData_1_1ServerConnectionContext.html#a33069bdd3ccfb59299b698eb443b8e88">preReadServerBytes</a>.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>();</div>
<div class="line"><a id="l04018" name="l04018"></a><span class="lineno"> 4018</span>}</div>
</div>
</div>
<div class="line"><a id="l04019" name="l04019"></a><span class="lineno"> 4019</span> </div>
</div>
<div class="ttc" id="aAccessLogEntry_8h_html_abfbb0b730659ed7153add677242f7d06"><div class="ttname"><a href="AccessLogEntry_8h.html#abfbb0b730659ed7153add677242f7d06">accessLogLog</a></div><div class="ttdeci">void accessLogLog(const AccessLogEntryPointer &amp;, ACLChecklist *)</div><div class="ttdef"><b>Definition</b> <a href="access__log_8cc_source.html#l00136">access_log.cc:136</a></div></div>
<div class="ttc" id="aAssure_8h_html_a1fcca4cd6cfc3b9f835aa3652eb0c2f5"><div class="ttname"><a href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a></div><div class="ttdeci">#define Assure(condition)</div><div class="ttdef"><b>Definition</b> <a href="Assure_8h_source.html#l00035">Assure.h:35</a></div></div>
<div class="ttc" id="aAsyncCall_8h_html_ab4ed1188674ac6e234bc4e37b384035b"><div class="ttname"><a href="AsyncCall_8h.html#ab4ed1188674ac6e234bc4e37b384035b">asyncCall</a></div><div class="ttdeci">RefCount&lt; AsyncCallT&lt; Dialer &gt; &gt; asyncCall(int aDebugSection, int aDebugLevel, const char *aName, const Dialer &amp;aDialer)</div><div class="ttdef"><b>Definition</b> <a href="AsyncCall_8h_source.html#l00156">AsyncCall.h:156</a></div></div>
<div class="ttc" id="aAsyncCallbacks_8h_html"><div class="ttname"><a href="AsyncCallbacks_8h.html">AsyncCallbacks.h</a></div></div>
<div class="ttc" id="aAsyncJobCalls_8h_html_a3412f4fa1246aee4d4ac46a143075e03"><div class="ttname"><a href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a></div><div class="ttdeci">#define JobCallback(dbgSection, dbgLevel, Dialer, job, method)</div><div class="ttdoc">Convenience macro to create a Dialer-based job callback.</div><div class="ttdef"><b>Definition</b> <a href="AsyncJobCalls_8h_source.html#l00070">AsyncJobCalls.h:70</a></div></div>
<div class="ttc" id="aCachePeer_8h_html"><div class="ttname"><a href="CachePeer_8h.html">CachePeer.h</a></div></div>
<div class="ttc" id="aClientInfo_8h_html"><div class="ttname"><a href="ClientInfo_8h.html">ClientInfo.h</a></div></div>
<div class="ttc" id="aClientRequestContext_8h_html"><div class="ttname"><a href="ClientRequestContext_8h.html">ClientRequestContext.h</a></div></div>
<div class="ttc" id="aCommCalls_8h_html"><div class="ttname"><a href="CommCalls_8h.html">CommCalls.h</a></div></div>
<div class="ttc" id="aCommCalls_8h_html_a7e143fa246c3e54c90fa8d20b390b88d"><div class="ttname"><a href="CommCalls_8h.html#a7e143fa246c3e54c90fa8d20b390b88d">commCbCall</a></div><div class="ttdeci">CommCbFunPtrCallT&lt; Dialer &gt; * commCbCall(int debugSection, int debugLevel, const char *callName, const Dialer &amp;dialer)</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00312">CommCalls.h:312</a></div></div>
<div class="ttc" id="aCommCalls_8h_html_aacb094d7a8854d685479662a7a925a8f"><div class="ttname"><a href="CommCalls_8h.html#aacb094d7a8854d685479662a7a925a8f">IOACB</a></div><div class="ttdeci">void IOACB(const CommAcceptCbParams &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00031">CommCalls.h:31</a></div></div>
<div class="ttc" id="aCommunicationSecrets_8h_html"><div class="ttname"><a href="CommunicationSecrets_8h.html">CommunicationSecrets.h</a></div></div>
<div class="ttc" id="aConnection_8h_html"><div class="ttname"><a href="Connection_8h.html">Connection.h</a></div></div>
<div class="ttc" id="aConnection_8h_html_a303a4af3db144519ffdefde6bc1b9659"><div class="ttname"><a href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a></div><div class="ttdeci">#define COMM_TRANSPARENT</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00050">Connection.h:50</a></div></div>
<div class="ttc" id="aConnection_8h_html_a88a0705e6cacb385c3d25aaff2eb2326"><div class="ttname"><a href="Connection_8h.html#a88a0705e6cacb385c3d25aaff2eb2326">COMM_REUSEPORT</a></div><div class="ttdeci">#define COMM_REUSEPORT</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00052">Connection.h:52</a></div></div>
<div class="ttc" id="aConnection_8h_html_a8e482a7d3919ec1fefad794c35a4c81e"><div class="ttname"><a href="Connection_8h.html#a8e482a7d3919ec1fefad794c35a4c81e">COMM_INTERCEPTION</a></div><div class="ttdeci">#define COMM_INTERCEPTION</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00051">Connection.h:51</a></div></div>
<div class="ttc" id="aConnection_8h_html_aadad9238e4d0e913034b3dfc22f8ba44"><div class="ttname"><a href="Connection_8h.html#aadad9238e4d0e913034b3dfc22f8ba44">COMM_NONBLOCKING</a></div><div class="ttdeci">#define COMM_NONBLOCKING</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00046">Connection.h:46</a></div></div>
<div class="ttc" id="aDetail_8cc_html_a3daf1a4d3c9feca00e60712558a94558"><div class="ttname"><a href="Detail_8cc.html#a3daf1a4d3c9feca00e60712558a94558">MakeNamedErrorDetail</a></div><div class="ttdeci">ErrorDetail::Pointer MakeNamedErrorDetail(const char *name)</div><div class="ttdef"><b>Definition</b> <a href="Detail_8cc_source.html#l00054">Detail.cc:54</a></div></div>
<div class="ttc" id="aExceptionErrorDetail_8h_html"><div class="ttname"><a href="ExceptionErrorDetail_8h.html">ExceptionErrorDetail.h</a></div></div>
<div class="ttc" id="aFdNotes_8h_html"><div class="ttname"><a href="FdNotes_8h.html">FdNotes.h</a></div></div>
<div class="ttc" id="aFilledChecklist_8h_html"><div class="ttname"><a href="FilledChecklist_8h.html">FilledChecklist.h</a></div></div>
<div class="ttc" id="aFwdState_8h_html"><div class="ttname"><a href="FwdState_8h.html">FwdState.h</a></div></div>
<div class="ttc" id="aHeader_8h_html"><div class="ttname"><a href="Header_8h.html">Header.h</a></div></div>
<div class="ttc" id="aHere_8h_html_ae4d205e9d525856fbdfd44f7eccb309b"><div class="ttname"><a href="Here_8h.html#ae4d205e9d525856fbdfd44f7eccb309b">Here</a></div><div class="ttdeci">#define Here()</div><div class="ttdoc">source code location of the caller</div><div class="ttdef"><b>Definition</b> <a href="Here_8h_source.html#l00015">Here.h:15</a></div></div>
<div class="ttc" id="aHttpHdrContRange_8h_html"><div class="ttname"><a href="HttpHdrContRange_8h.html">HttpHdrContRange.h</a></div></div>
<div class="ttc" id="aHttpHdrContRange_8h_html_a5a226308b41749234ec3429f8d064314"><div class="ttname"><a href="HttpHdrContRange_8h.html#a5a226308b41749234ec3429f8d064314">httpHeaderAddContRange</a></div><div class="ttdeci">void httpHeaderAddContRange(HttpHeader *, HttpHdrRangeSpec, int64_t)</div><div class="ttdef"><b>Definition</b> <a href="HttpHeaderTools_8cc_source.html#l00047">HttpHeaderTools.cc:47</a></div></div>
<div class="ttc" id="aHttpHeader_8h_html_a2fd6ecc24bf950965aed06a4c6f70ce0a729c58961184c0ec26c220611020bb00"><div class="ttname"><a href="HttpHeader_8h.html#a2fd6ecc24bf950965aed06a4c6f70ce0a729c58961184c0ec26c220611020bb00">hoReply</a></div><div class="ttdeci">@ hoReply</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00037">HttpHeader.h:37</a></div></div>
<div class="ttc" id="aHttpReply_8h_html"><div class="ttname"><a href="HttpReply_8h.html">HttpReply.h</a></div></div>
<div class="ttc" id="aHttpRequest_8h_html"><div class="ttname"><a href="HttpRequest_8h.html">HttpRequest.h</a></div></div>
<div class="ttc" id="aIoManip_8h_html_afb10fe715d55bc0f31985b3de7269ce0"><div class="ttname"><a href="IoManip_8h.html#afb10fe715d55bc0f31985b3de7269ce0">RawPointer</a></div><div class="ttdeci">RawPointerT&lt; Pointer &gt; RawPointer(const char *label, const Pointer &amp;ptr)</div><div class="ttdoc">convenience wrapper for creating RawPointerT&lt;&gt; objects</div><div class="ttdef"><b>Definition</b> <a href="IoManip_8h_source.html#l00073">IoManip.h:73</a></div></div>
<div class="ttc" id="aIo_8h_html"><div class="ttname"><a href="Io_8h.html">Io.h</a></div></div>
<div class="ttc" id="aKeyLog_8h_html"><div class="ttname"><a href="KeyLog_8h.html">KeyLog.h</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5a426f2351c79f420e8fead9a1ba831be3"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a426f2351c79f420e8fead9a1ba831be3">LOG_TCP_OFFLINE_HIT</a></div><div class="ttdeci">@ LOG_TCP_OFFLINE_HIT</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00057">LogTags.h:57</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5a6b18a17e02ffba088ef54d6c6570a2da"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a6b18a17e02ffba088ef54d6c6570a2da">LOG_TCP_HIT</a></div><div class="ttdeci">@ LOG_TCP_HIT</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00042">LogTags.h:42</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5a73a7b8edaf3bd5b6cfe483e4b9e068a3"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a73a7b8edaf3bd5b6cfe483e4b9e068a3">LOG_TCP_MISS</a></div><div class="ttdeci">@ LOG_TCP_MISS</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00043">LogTags.h:43</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5a75f8d8f24297647ede5f517c1a659fe1"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a75f8d8f24297647ede5f517c1a659fe1">LOG_TCP_MEM_HIT</a></div><div class="ttdeci">@ LOG_TCP_MEM_HIT</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00054">LogTags.h:54</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5a8dc5d16057dd49c38a9d848b24f5a9dd"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5a8dc5d16057dd49c38a9d848b24f5a9dd">LOG_TCP_IMS_HIT</a></div><div class="ttdeci">@ LOG_TCP_IMS_HIT</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00050">LogTags.h:50</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5aa5ae6efde2911aca58a1954a66c2aeed"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5aa5ae6efde2911aca58a1954a66c2aeed">LOG_TAG_NONE</a></div><div class="ttdeci">@ LOG_TAG_NONE</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00041">LogTags.h:41</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5ab7d48c74f5c9b5611f95f59f40b28488"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5ab7d48c74f5c9b5611f95f59f40b28488">LOG_TCP_REFRESH_UNMODIFIED</a></div><div class="ttdeci">@ LOG_TCP_REFRESH_UNMODIFIED</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00044">LogTags.h:44</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5ae19fd4a06c3cb6bd8515559ffd304bfd"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5ae19fd4a06c3cb6bd8515559ffd304bfd">LOG_TCP_CLIENT_REFRESH_MISS</a></div><div class="ttdeci">@ LOG_TCP_CLIENT_REFRESH_MISS</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00049">LogTags.h:49</a></div></div>
<div class="ttc" id="aLogTags_8h_html_ab2f83b3caf1d5c271706d2a6d2e196f5aed35072ed898085622fe3d94b529bce1"><div class="ttname"><a href="LogTags_8h.html#ab2f83b3caf1d5c271706d2a6d2e196f5aed35072ed898085622fe3d94b529bce1">LOG_TCP_INM_HIT</a></div><div class="ttdeci">@ LOG_TCP_INM_HIT</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00051">LogTags.h:51</a></div></div>
<div class="ttc" id="aLoops_8h_html"><div class="ttname"><a href="Loops_8h.html">Loops.h</a></div></div>
<div class="ttc" id="aMemBuf_8h_html"><div class="ttname"><a href="MemBuf_8h.html">MemBuf.h</a></div></div>
<div class="ttc" id="aMemObject_8h_html"><div class="ttname"><a href="MemObject_8h.html">MemObject.h</a></div></div>
<div class="ttc" id="aMessageDelayPools_8h_html"><div class="ttname"><a href="MessageDelayPools_8h.html">MessageDelayPools.h</a></div></div>
<div class="ttc" id="aModDevPoll_8cc_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="ModDevPoll_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition</b> <a href="ModDevPoll_8cc_source.html#l00070">ModDevPoll.cc:70</a></div></div>
<div class="ttc" id="aModXact_8cc_html_a22777922b0ae6451894a83f1ec3614ed"><div class="ttname"><a href="ModXact_8cc.html#a22777922b0ae6451894a83f1ec3614ed">prepareLogWithRequestDetails</a></div><div class="ttdeci">void prepareLogWithRequestDetails(HttpRequest *, const AccessLogEntryPointer &amp;)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00322">client_side.cc:322</a></div></div>
<div class="ttc" id="aNegotiationHistory_8h_html"><div class="ttname"><a href="NegotiationHistory_8h.html">NegotiationHistory.h</a></div></div>
<div class="ttc" id="aPortCfg_8cc_html_a20da400521f3fa3eb2de9df0eb5f96fc"><div class="ttname"><a href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a></div><div class="ttdeci">int NHttpSockets</div><div class="ttdef"><b>Definition</b> <a href="PortCfg_8cc_source.html#l00025">PortCfg.cc:25</a></div></div>
<div class="ttc" id="aPortCfg_8cc_html_a8337e06015e8e25e86d184dabe575018"><div class="ttname"><a href="PortCfg_8cc.html#a8337e06015e8e25e86d184dabe575018">HttpSockets</a></div><div class="ttdeci">int HttpSockets[MAXTCPLISTENPORTS]</div><div class="ttdef"><b>Definition</b> <a href="PortCfg_8cc_source.html#l00026">PortCfg.cc:26</a></div></div>
<div class="ttc" id="aPortCfg_8cc_html_ab5fc0d5e05159674db133b2f17786721"><div class="ttname"><a href="PortCfg_8cc.html#ab5fc0d5e05159674db133b2f17786721">HttpPortList</a></div><div class="ttdeci">AnyP::PortCfgPointer HttpPortList</div><div class="ttdoc">list of Squid http(s)_port configured</div><div class="ttdef"><b>Definition</b> <a href="PortCfg_8cc_source.html#l00022">PortCfg.cc:22</a></div></div>
<div class="ttc" id="aPortCfg_8h_html"><div class="ttname"><a href="PortCfg_8h.html">PortCfg.h</a></div></div>
<div class="ttc" id="aPortCfg_8h_html_ad26669cbef20c833f401d0c236dfa54b"><div class="ttname"><a href="PortCfg_8h.html#ad26669cbef20c833f401d0c236dfa54b">MAXTCPLISTENPORTS</a></div><div class="ttdeci">#define MAXTCPLISTENPORTS</div><div class="ttdef"><b>Definition</b> <a href="PortCfg_8h_source.html#l00086">PortCfg.h:86</a></div></div>
<div class="ttc" id="aProxyCerts_8h_html"><div class="ttname"><a href="ProxyCerts_8h.html">ProxyCerts.h</a></div></div>
<div class="ttc" id="aRead_8h_html"><div class="ttname"><a href="Read_8h.html">Read.h</a></div></div>
<div class="ttc" id="aReply_8h_html"><div class="ttname"><a href="Reply_8h.html">Reply.h</a></div></div>
<div class="ttc" id="aRequestParser_8h_html"><div class="ttname"><a href="RequestParser_8h.html">RequestParser.h</a></div></div>
<div class="ttc" id="aSBuf_8h_html_a225d674d14bd9377da94fdb0edc08ecc"><div class="ttname"><a href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a></div><div class="ttdeci">#define SQUIDSBUFPH</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00031">SBuf.h:31</a></div></div>
<div class="ttc" id="aSBuf_8h_html_a826aafc8068f24cb125e700733cd2bee"><div class="ttname"><a href="SBuf_8h.html#a826aafc8068f24cb125e700733cd2bee">SBufToCstring</a></div><div class="ttdeci">void SBufToCstring(char *d, const SBuf &amp;s)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00756">SBuf.h:756</a></div></div>
<div class="ttc" id="aSBuf_8h_html_aba15ad960fbece70b7940c8d3a5c344b"><div class="ttname"><a href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a></div><div class="ttdeci">#define SQUIDSBUFPRINT(s)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00032">SBuf.h:32</a></div></div>
<div class="ttc" id="aServerBump_8h_html"><div class="ttname"><a href="ServerBump_8h.html">ServerBump.h</a></div></div>
<div class="ttc" id="aSquidConfig_8cc_html_a75b136e6a1eef61424d84596a404aafe"><div class="ttname"><a href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a></div><div class="ttdeci">class SquidConfig Config</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8cc_source.html#l00012">SquidConfig.cc:12</a></div></div>
<div class="ttc" id="aSquidConfig_8h_html"><div class="ttname"><a href="SquidConfig_8h.html">SquidConfig.h</a></div></div>
<div class="ttc" id="aSquidString_8h_html_ac683b536d1e88daafdee1942746c0939"><div class="ttname"><a href="SquidString_8h.html#ac683b536d1e88daafdee1942746c0939">SQUIDSTRINGPH</a></div><div class="ttdeci">#define SQUIDSTRINGPH</div><div class="ttdef"><b>Definition</b> <a href="SquidString_8h_source.html#l00022">SquidString.h:22</a></div></div>
<div class="ttc" id="aSquidString_8h_html_ad459357d193b2c271d3ee0beab60795c"><div class="ttname"><a href="SquidString_8h.html#ad459357d193b2c271d3ee0beab60795c">SQUIDSTRINGPRINT</a></div><div class="ttdeci">#define SQUIDSTRINGPRINT(s)</div><div class="ttdef"><b>Definition</b> <a href="SquidString_8h_source.html#l00023">SquidString.h:23</a></div></div>
<div class="ttc" id="aStartListening_8h_html"><div class="ttname"><a href="StartListening_8h.html">StartListening.h</a></div></div>
<div class="ttc" id="aStatCounters_8cc_html_a97511f6512b50279a2cd9cf1446060d7"><div class="ttname"><a href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a></div><div class="ttdeci">StatCounters statCounter</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8cc_source.html#l00012">StatCounters.cc:12</a></div></div>
<div class="ttc" id="aStatCounters_8h_html"><div class="ttname"><a href="StatCounters_8h.html">StatCounters.h</a></div></div>
<div class="ttc" id="aStatHist_8h_html"><div class="ttname"><a href="StatHist_8h.html">StatHist.h</a></div></div>
<div class="ttc" id="aStore_8h_html"><div class="ttname"><a href="Store_8h.html">Store.h</a></div></div>
<div class="ttc" id="aSubscription_8h_html"><div class="ttname"><a href="Subscription_8h.html">Subscription.h</a></div></div>
<div class="ttc" id="aTcpAcceptor_8h_html"><div class="ttname"><a href="TcpAcceptor_8h.html">TcpAcceptor.h</a></div></div>
<div class="ttc" id="aTeChunkedParser_8h_html"><div class="ttname"><a href="TeChunkedParser_8h.html">TeChunkedParser.h</a></div></div>
<div class="ttc" id="aTextException_8cc_html_aa73ff10b84f321d18602cf47b8695dd5"><div class="ttname"><a href="TextException_8cc.html#aa73ff10b84f321d18602cf47b8695dd5">CurrentException</a></div><div class="ttdeci">std::ostream &amp; CurrentException(std::ostream &amp;os)</div><div class="ttdoc">prints active (i.e., thrown but not yet handled) exception</div><div class="ttdef"><b>Definition</b> <a href="TextException_8cc_source.html#l00088">TextException.cc:88</a></div></div>
<div class="ttc" id="aTextException_8h_html"><div class="ttname"><a href="TextException_8h.html">TextException.h</a></div></div>
<div class="ttc" id="aTextException_8h_html_ad79a19f4098f2506d0aa28628f18fd36"><div class="ttname"><a href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a></div><div class="ttdeci">#define Must(condition)</div><div class="ttdef"><b>Definition</b> <a href="TextException_8h_source.html#l00075">TextException.h:75</a></div></div>
<div class="ttc" id="aTimeOrTag_8h_html"><div class="ttname"><a href="TimeOrTag_8h.html">TimeOrTag.h</a></div></div>
<div class="ttc" id="aUri_8cc_html_a0aaaea124c22af6f1bc00947934f67f5"><div class="ttname"><a href="Uri_8cc.html#a0aaaea124c22af6f1bc00947934f67f5">urlCheckRequest</a></div><div class="ttdeci">bool urlCheckRequest(const HttpRequest *r)</div><div class="ttdef"><b>Definition</b> <a href="Uri_8cc_source.html#l01002">Uri.cc:1002</a></div></div>
<div class="ttc" id="aUserRequest_8h_html"><div class="ttname"><a href="UserRequest_8h.html">UserRequest.h</a></div></div>
<div class="ttc" id="aWrite_8h_html"><div class="ttname"><a href="Write_8h.html">Write.h</a></div></div>
<div class="ttc" id="aXactionStep_8h_html_aaaaea1f6a486ef01fc1b35f92f6a81eea2da83aeb88de72bf1e8fdf166f300f26"><div class="ttname"><a href="XactionStep_8h.html#aaaaea1f6a486ef01fc1b35f92f6a81eea2da83aeb88de72bf1e8fdf166f300f26">XactionStep::tlsBump1</a></div><div class="ttdeci">@ tlsBump1</div></div>
<div class="ttc" id="aXactionStep_8h_html_aaaaea1f6a486ef01fc1b35f92f6a81eea7cf59ba890540dcb831984a8aa7f0d9b"><div class="ttname"><a href="XactionStep_8h.html#aaaaea1f6a486ef01fc1b35f92f6a81eea7cf59ba890540dcb831984a8aa7f0d9b">XactionStep::tlsBump2</a></div><div class="ttdeci">@ tlsBump2</div></div>
<div class="ttc" id="aXactionStep_8h_html_aaaaea1f6a486ef01fc1b35f92f6a81eeae2e942186ef7a2e4cb3b91412e241889"><div class="ttname"><a href="XactionStep_8h.html#aaaaea1f6a486ef01fc1b35f92f6a81eeae2e942186ef7a2e4cb3b91412e241889">XactionStep::tlsBump3</a></div><div class="ttdeci">@ tlsBump3</div></div>
<div class="ttc" id="aaccess__log_8h_html"><div class="ttname"><a href="access__log_8h.html">access_log.h</a></div></div>
<div class="ttc" id="aacl_2external_2kerberos__ldap__group_2support_8h_html_a3654b5eb0d17fed9fc1f1dee818ad49f"><div class="ttname"><a href="acl_2external_2kerberos__ldap__group_2support_8h.html#a3654b5eb0d17fed9fc1f1dee818ad49f">error</a></div><div class="ttdeci">void error(char *format,...)</div></div>
<div class="ttc" id="aanyp_2Host_8h_html"><div class="ttname"><a href="anyp_2Host_8h.html">Host.h</a></div></div>
<div class="ttc" id="aassert_8h_html_a33fa45e42155e69ce8d0da0fd978b351"><div class="ttname"><a href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a></div><div class="ttdeci">#define assert(EX)</div><div class="ttdef"><b>Definition</b> <a href="assert_8h_source.html#l00017">assert.h:17</a></div></div>
<div class="ttc" id="aautoconf_8h_html_a9960d83cf790f3296034632f5f27f830"><div class="ttname"><a href="autoconf_8h.html#a9960d83cf790f3296034632f5f27f830">USE_OPENSSL</a></div><div class="ttdeci">#define USE_OPENSSL</div><div class="ttdef"><b>Definition</b> <a href="autoconf_8h_source.html#l01557">autoconf.h:1557</a></div></div>
<div class="ttc" id="abio_8h_html"><div class="ttname"><a href="bio_8h.html">bio.h</a></div></div>
<div class="ttc" id="acbdata_8cc_html_aa6ed5c53b844c6f8f3e7c39daa051835"><div class="ttname"><a href="cbdata_8cc.html#aa6ed5c53b844c6f8f3e7c39daa051835">cbdataReferenceValid</a></div><div class="ttdeci">int cbdataReferenceValid(const void *p)</div><div class="ttdef"><b>Definition</b> <a href="cbdata_8cc_source.html#l00270">cbdata.cc:270</a></div></div>
<div class="ttc" id="aclassACLChecklist_html_a51ae541a90994e7ed5d11f2b242ac689"><div class="ttname"><a href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">ACLChecklist::fastCheck</a></div><div class="ttdeci">Acl::Answer const &amp; fastCheck()</div><div class="ttdef"><b>Definition</b> <a href="Checklist_8cc_source.html#l00298">Checklist.cc:298</a></div></div>
<div class="ttc" id="aclassACLChecklist_html_a6bea590fc67c7a9f7b90bb4590c9864d"><div class="ttname"><a href="classACLChecklist.html#a6bea590fc67c7a9f7b90bb4590c9864d">ACLChecklist::changeAcl</a></div><div class="ttdeci">void changeAcl(const acl_access *)</div><div class="ttdoc">change the current ACL list</div><div class="ttdef"><b>Definition</b> <a href="Checklist_8cc_source.html#l00187">Checklist.cc:187</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html"><div class="ttname"><a href="classACLFilledChecklist.html">ACLFilledChecklist</a></div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00033">FilledChecklist.h:34</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a0d62153af717fa13fd4dd8b2e509556b"><div class="ttname"><a href="classACLFilledChecklist.html#a0d62153af717fa13fd4dd8b2e509556b">ACLFilledChecklist::Make</a></div><div class="ttdeci">static MakingPointer Make(const acl_access *a, HttpRequest *r)</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00049">FilledChecklist.h:49</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a158f644bfa0d9e67cfd8bee15b6359e9"><div class="ttname"><a href="classACLFilledChecklist.html#a158f644bfa0d9e67cfd8bee15b6359e9">ACLFilledChecklist::requestErrorType</a></div><div class="ttdeci">err_type requestErrorType</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00128">FilledChecklist.h:128</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a1a7f36b9e8a65cd5486bcf76c31ff88c"><div class="ttname"><a href="classACLFilledChecklist.html#a1a7f36b9e8a65cd5486bcf76c31ff88c">ACLFilledChecklist::MakingPointer</a></div><div class="ttdeci">std::unique_ptr&lt; ACLFilledChecklist &gt; MakingPointer</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00041">FilledChecklist.h:41</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a37d4c2cb7c1e90cb1af02d054b90268c"><div class="ttname"><a href="classACLFilledChecklist.html#a37d4c2cb7c1e90cb1af02d054b90268c">ACLFilledChecklist::conn</a></div><div class="ttdeci">ConnStateData * conn() const</div><div class="ttdoc">The client connection manager.</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8cc_source.html#l00106">FilledChecklist.cc:106</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a3a4cc947a6e13258f602ad640e931e59"><div class="ttname"><a href="classACLFilledChecklist.html#a3a4cc947a6e13258f602ad640e931e59">ACLFilledChecklist::setRequest</a></div><div class="ttdeci">void setRequest(HttpRequest *)</div><div class="ttdoc">configure client request-related fields for the first time</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8cc_source.html#l00190">FilledChecklist.cc:190</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a4812be1882c53f8732bfb7838ae061d8"><div class="ttname"><a href="classACLFilledChecklist.html#a4812be1882c53f8732bfb7838ae061d8">ACLFilledChecklist::setConn</a></div><div class="ttdeci">void setConn(ConnStateData *)</div><div class="ttdoc">set either conn</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8cc_source.html#l00112">FilledChecklist.cc:112</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a53bba78d7127a7707cb956a87ff5914f"><div class="ttname"><a href="classACLFilledChecklist.html#a53bba78d7127a7707cb956a87ff5914f">ACLFilledChecklist::updateAle</a></div><div class="ttdeci">void updateAle(const AccessLogEntry::Pointer &amp;)</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8cc_source.html#l00209">FilledChecklist.cc:209</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a5521f60eda45233a9424f46161cf8809"><div class="ttname"><a href="classACLFilledChecklist.html#a5521f60eda45233a9424f46161cf8809">ACLFilledChecklist::NonBlockingCheck</a></div><div class="ttdeci">static void NonBlockingCheck(MakingPointer &amp;&amp;p, ACLCB *cb, void *data)</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00054">FilledChecklist.h:54</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_a5eede657a1f9b1bfe54ac2ee58af9d2e"><div class="ttname"><a href="classACLFilledChecklist.html#a5eede657a1f9b1bfe54ac2ee58af9d2e">ACLFilledChecklist::my_addr</a></div><div class="ttdeci">Ip::Address my_addr</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00099">FilledChecklist.h:99</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_aa75a941c2634f5faa0eef864c4153b93"><div class="ttname"><a href="classACLFilledChecklist.html#aa75a941c2634f5faa0eef864c4153b93">ACLFilledChecklist::src_addr</a></div><div class="ttdeci">Ip::Address src_addr</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00097">FilledChecklist.h:97</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_ab97626f356bacd93806236efcc00f737"><div class="ttname"><a href="classACLFilledChecklist.html#ab97626f356bacd93806236efcc00f737">ACLFilledChecklist::sslErrors</a></div><div class="ttdeci">CbcPointer&lt; Security::CertErrors &gt; sslErrors</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00117">FilledChecklist.h:117</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_ac9fc7ac3b0ef5a2a0d2811aa762dbeab"><div class="ttname"><a href="classACLFilledChecklist.html#ac9fc7ac3b0ef5a2a0d2811aa762dbeab">ACLFilledChecklist::al</a></div><div class="ttdeci">AccessLogEntry::Pointer al</div><div class="ttdoc">info for the future access.log, and external ACL</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00124">FilledChecklist.h:124</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_ae77611904901fa5f796cdd54ff5be235"><div class="ttname"><a href="classACLFilledChecklist.html#ae77611904901fa5f796cdd54ff5be235">ACLFilledChecklist::syncAle</a></div><div class="ttdeci">void syncAle(HttpRequest *adaptedRequest, const char *logUri) const override</div><div class="ttdoc">assigns uninitialized adapted_request and url ALE components</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8cc_source.html#l00093">FilledChecklist.cc:93</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_af7036126263e056df92f668a6c9aae03"><div class="ttname"><a href="classACLFilledChecklist.html#af7036126263e056df92f668a6c9aae03">ACLFilledChecklist::request</a></div><div class="ttdeci">HttpRequest::Pointer request</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00103">FilledChecklist.h:103</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1AdaptationDetails_html_adafded5cf3b47a661bbbb0f72a721b06"><div class="ttname"><a href="classAccessLogEntry_1_1AdaptationDetails.html#adafded5cf3b47a661bbbb0f72a721b06">AccessLogEntry::AdaptationDetails::last_meta</a></div><div class="ttdeci">char * last_meta</div><div class="ttdoc">image of the last ICAP response header or eCAP meta received</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00183">AccessLogEntry.h:183</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1CacheDetails_html_a17380db1a07c6fa0aa73c3107650a3f6"><div class="ttname"><a href="classAccessLogEntry_1_1CacheDetails.html#a17380db1a07c6fa0aa73c3107650a3f6">AccessLogEntry::CacheDetails::start_time</a></div><div class="ttdeci">struct timeval start_time</div><div class="ttdoc">The time the master transaction started.</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00155">AccessLogEntry.h:155</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1CacheDetails_html_a415f4133a8903b3eadb2e76dfc776b9d"><div class="ttname"><a href="classAccessLogEntry_1_1CacheDetails.html#a415f4133a8903b3eadb2e76dfc776b9d">AccessLogEntry::CacheDetails::objectSize</a></div><div class="ttdeci">int64_t objectSize</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00153">AccessLogEntry.h:153</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1CacheDetails_html_a5210a8077c0fd80a0f51172d4da8a40c"><div class="ttname"><a href="classAccessLogEntry_1_1CacheDetails.html#a5210a8077c0fd80a0f51172d4da8a40c">AccessLogEntry::CacheDetails::highOffset</a></div><div class="ttdeci">int64_t highOffset</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00152">AccessLogEntry.h:152</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1CacheDetails_html_a6df100dc295e5b0cb03773a19a859885"><div class="ttname"><a href="classAccessLogEntry_1_1CacheDetails.html#a6df100dc295e5b0cb03773a19a859885">AccessLogEntry::CacheDetails::ssluser</a></div><div class="ttdeci">const char * ssluser</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00159">AccessLogEntry.h:159</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1CacheDetails_html_a96594724e9c828bbfe14294dcc6fae05"><div class="ttname"><a href="classAccessLogEntry_1_1CacheDetails.html#a96594724e9c828bbfe14294dcc6fae05">AccessLogEntry::CacheDetails::trTime</a></div><div class="ttdeci">struct timeval trTime</div><div class="ttdoc">The response time.</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00156">AccessLogEntry.h:156</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1CacheDetails_html_afe682e33fa7a03c6421ecd0864924eec"><div class="ttname"><a href="classAccessLogEntry_1_1CacheDetails.html#afe682e33fa7a03c6421ecd0864924eec">AccessLogEntry::CacheDetails::extuser</a></div><div class="ttdeci">const char * extuser</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00157">AccessLogEntry.h:157</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1Headers_html_a120e1febd0837203a10d79654cdb0884"><div class="ttname"><a href="classAccessLogEntry_1_1Headers.html#a120e1febd0837203a10d79654cdb0884">AccessLogEntry::Headers::adapted_request</a></div><div class="ttdeci">char * adapted_request</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00172">AccessLogEntry.h:172</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1Headers_html_a2b4a0b6b9f423b94ad0f9de3ca7064fc"><div class="ttname"><a href="classAccessLogEntry_1_1Headers.html#a2b4a0b6b9f423b94ad0f9de3ca7064fc">AccessLogEntry::Headers::request</a></div><div class="ttdeci">char * request</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00171">AccessLogEntry.h:171</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1HttpDetails_html_a1fdb429e6cf625450b7e53c216a83e8a"><div class="ttname"><a href="classAccessLogEntry_1_1HttpDetails.html#a1fdb429e6cf625450b7e53c216a83e8a">AccessLogEntry::HttpDetails::clientReplySz</a></div><div class="ttdeci">MessageSizes clientReplySz</div><div class="ttdoc">counters for the response sent to client</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00105">AccessLogEntry.h:105</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1HttpDetails_html_a72835160a2c6cc283c402124c51627e9"><div class="ttname"><a href="classAccessLogEntry_1_1HttpDetails.html#a72835160a2c6cc283c402124c51627e9">AccessLogEntry::HttpDetails::content_type</a></div><div class="ttdeci">const char * content_type</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00094">AccessLogEntry.h:94</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1HttpDetails_html_aafdb4377ebb6a51a7eefe98f46a7b5d9"><div class="ttname"><a href="classAccessLogEntry_1_1HttpDetails.html#aafdb4377ebb6a51a7eefe98f46a7b5d9">AccessLogEntry::HttpDetails::method</a></div><div class="ttdeci">HttpRequestMethod method</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00092">AccessLogEntry.h:92</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1HttpDetails_html_abf4b4db4cf8fb6e7bb99d3e44f4e6767"><div class="ttname"><a href="classAccessLogEntry_1_1HttpDetails.html#abf4b4db4cf8fb6e7bb99d3e44f4e6767">AccessLogEntry::HttpDetails::clientRequestSz</a></div><div class="ttdeci">MessageSizes clientRequestSz</div><div class="ttdoc">counters for the original request received from client</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00100">AccessLogEntry.h:100</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1HttpDetails_html_ad3e0fec5db99d08a0baed5501209e7a1"><div class="ttname"><a href="classAccessLogEntry_1_1HttpDetails.html#ad3e0fec5db99d08a0baed5501209e7a1">AccessLogEntry::HttpDetails::version</a></div><div class="ttdeci">AnyP::ProtocolVersion version</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00095">AccessLogEntry.h:95</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1HttpDetails_html_afaef5bd16c55d6723beb468d0bc75643"><div class="ttname"><a href="classAccessLogEntry_1_1HttpDetails.html#afaef5bd16c55d6723beb468d0bc75643">AccessLogEntry::HttpDetails::code</a></div><div class="ttdeci">int code</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00093">AccessLogEntry.h:93</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1IcapLogEntry_html_a39a07b9281212b7538647125b010bf5a"><div class="ttname"><a href="classAccessLogEntry_1_1IcapLogEntry.html#a39a07b9281212b7538647125b010bf5a">AccessLogEntry::IcapLogEntry::processingTime</a></div><div class="ttdeci">struct timeval processingTime</div><div class="ttdoc">total ICAP processing time</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00248">AccessLogEntry.h:248</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_1_1IcpDetails_html_a68c9e88859de7fb2127ac61d8a7de4b8"><div class="ttname"><a href="classAccessLogEntry_1_1IcpDetails.html#a68c9e88859de7fb2127ac61d8a7de4b8">AccessLogEntry::IcpDetails::opcode</a></div><div class="ttdeci">icp_opcode opcode</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00115">AccessLogEntry.h:115</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html"><div class="ttname"><a href="classAccessLogEntry.html">AccessLogEntry</a></div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00040">AccessLogEntry.h:41</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a19bddcabb9a3d2f290c183a171afa4b3"><div class="ttname"><a href="classAccessLogEntry.html#a19bddcabb9a3d2f290c183a171afa4b3">AccessLogEntry::reply</a></div><div class="ttdeci">HttpReplyPointer reply</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00191">AccessLogEntry.h:191</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a4574f49181917c5496dca9ace95ea344"><div class="ttname"><a href="classAccessLogEntry.html#a4574f49181917c5496dca9ace95ea344">AccessLogEntry::cache</a></div><div class="ttdeci">class AccessLogEntry::CacheDetails cache</div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a4d0990d0207c3d555a408db2e18b3831"><div class="ttname"><a href="classAccessLogEntry.html#a4d0990d0207c3d555a408db2e18b3831">AccessLogEntry::url</a></div><div class="ttdeci">SBuf url</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00077">AccessLogEntry.h:77</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a550f1fb979566c3e705422eeb6d0b66c"><div class="ttname"><a href="classAccessLogEntry.html#a550f1fb979566c3e705422eeb6d0b66c">AccessLogEntry::hier</a></div><div class="ttdeci">HierarchyLogEntry hier</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00190">AccessLogEntry.h:190</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a551791241b593874d721ffdf04f6b4ed"><div class="ttname"><a href="classAccessLogEntry.html#a551791241b593874d721ffdf04f6b4ed">AccessLogEntry::syncNotes</a></div><div class="ttdeci">void syncNotes(HttpRequest *request)</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8cc_source.html#l00088">AccessLogEntry.cc:88</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a6d0f8f3a0db4d8d3fb1806e7feb3e510"><div class="ttname"><a href="classAccessLogEntry.html#a6d0f8f3a0db4d8d3fb1806e7feb3e510">AccessLogEntry::icap</a></div><div class="ttdeci">class AccessLogEntry::IcapLogEntry icap</div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a70767e3d5eee503cd1bbc63594584004"><div class="ttname"><a href="classAccessLogEntry.html#a70767e3d5eee503cd1bbc63594584004">AccessLogEntry::headers</a></div><div class="ttdeci">class AccessLogEntry::Headers headers</div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a753215d3854b1129173deb898f7c7e99"><div class="ttname"><a href="classAccessLogEntry.html#a753215d3854b1129173deb898f7c7e99">AccessLogEntry::http</a></div><div class="ttdeci">class AccessLogEntry::HttpDetails http</div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a830b5959845481ed29ca7dc4ff9cfd27"><div class="ttname"><a href="classAccessLogEntry.html#a830b5959845481ed29ca7dc4ff9cfd27">AccessLogEntry::adapted_request</a></div><div class="ttdeci">HttpRequest * adapted_request</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00193">AccessLogEntry.h:193</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html_a92312350a82deb4331b171bdea7ff3d5"><div class="ttname"><a href="classAccessLogEntry.html#a92312350a82deb4331b171bdea7ff3d5">AccessLogEntry::request</a></div><div class="ttdeci">HttpRequest * request</div><div class="ttdef"><b>Definition</b> <a href="AccessLogEntry_8h_source.html#l00192">AccessLogEntry.h:192</a></div></div>
<div class="ttc" id="aclassAccessLogEntry_html_acd2964cc976f54474430752e90b11eb1"><div class="ttname"><a href="classAccessLogEntry.html#acd2964cc976f54474430752e90b11eb1">AccessLogEntry::adapt</a></div><div class="ttdeci">class AccessLogEntry::AdaptationDetails adapt</div></div>
<div class="ttc" id="aclassAccessLogEntry_html_acd361d0cf82d7cd1838960e668347b8d"><div class="ttname"><a href="classAccessLogEntry.html#acd361d0cf82d7cd1838960e668347b8d">AccessLogEntry::icp</a></div><div class="ttdeci">class AccessLogEntry::IcpDetails icp</div></div>
<div class="ttc" id="aclassAcl_1_1Answer_html"><div class="ttname"><a href="classAcl_1_1Answer.html">Acl::Answer</a></div><div class="ttdef"><b>Definition</b> <a href="acl_2Acl_8h_source.html#l00053">Acl.h:54</a></div></div>
<div class="ttc" id="aclassAcl_1_1Answer_html_a2c742f67e11b7b92c02b286f91339298"><div class="ttname"><a href="classAcl_1_1Answer.html#a2c742f67e11b7b92c02b286f91339298">Acl::Answer::kind</a></div><div class="ttdeci">int kind</div><div class="ttdoc">the matched custom access list verb (or zero)</div><div class="ttdef"><b>Definition</b> <a href="acl_2Acl_8h_source.html#l00099">Acl.h:99</a></div></div>
<div class="ttc" id="aclassAcl_1_1Answer_html_af1a1444d19654eb50f7a4323b225f845"><div class="ttname"><a href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">Acl::Answer::allowed</a></div><div class="ttdeci">bool allowed() const</div><div class="ttdef"><b>Definition</b> <a href="acl_2Acl_8h_source.html#l00082">Acl.h:82</a></div></div>
<div class="ttc" id="aclassAdaptation_1_1History_html_ad7a7dac1a5329b364522e2a2e9b93d7e"><div class="ttname"><a href="classAdaptation_1_1History.html#ad7a7dac1a5329b364522e2a2e9b93d7e">Adaptation::History::lastMeta</a></div><div class="ttdeci">HttpHeader lastMeta</div><div class="ttdoc">Last received meta header (REQMOD or RESPMOD, whichever comes last).</div><div class="ttdef"><b>Definition</b> <a href="History_8h_source.html#l00061">History.h:61</a></div></div>
<div class="ttc" id="aclassAnyP_1_1ProtocolVersion_html"><div class="ttname"><a href="classAnyP_1_1ProtocolVersion.html">AnyP::ProtocolVersion</a></div><div class="ttdef"><b>Definition</b> <a href="anyp_2ProtocolVersion_8h_source.html#l00023">ProtocolVersion.h:24</a></div></div>
<div class="ttc" id="aclassAnyP_1_1ProtocolVersion_html_a3df69d890d2069fb76c68f9535e169f5"><div class="ttname"><a href="classAnyP_1_1ProtocolVersion.html#a3df69d890d2069fb76c68f9535e169f5">AnyP::ProtocolVersion::major</a></div><div class="ttdeci">unsigned int major</div><div class="ttdoc">major version number</div><div class="ttdef"><b>Definition</b> <a href="anyp_2ProtocolVersion_8h_source.html#l00040">ProtocolVersion.h:40</a></div></div>
<div class="ttc" id="aclassAnyP_1_1ProtocolVersion_html_a9b781ce0242bffdbc1694f09ceefffa5"><div class="ttname"><a href="classAnyP_1_1ProtocolVersion.html#a9b781ce0242bffdbc1694f09ceefffa5">AnyP::ProtocolVersion::protocol</a></div><div class="ttdeci">ProtocolType protocol</div><div class="ttdoc">which protocol this version is for</div><div class="ttdef"><b>Definition</b> <a href="anyp_2ProtocolVersion_8h_source.html#l00039">ProtocolVersion.h:39</a></div></div>
<div class="ttc" id="aclassAnyP_1_1ProtocolVersion_html_aba0b2b69fdc1345faafffda66a093667"><div class="ttname"><a href="classAnyP_1_1ProtocolVersion.html#aba0b2b69fdc1345faafffda66a093667">AnyP::ProtocolVersion::minor</a></div><div class="ttdeci">unsigned int minor</div><div class="ttdoc">minor version number</div><div class="ttdef"><b>Definition</b> <a href="anyp_2ProtocolVersion_8h_source.html#l00041">ProtocolVersion.h:41</a></div></div>
<div class="ttc" id="aclassAnyP_1_1UriScheme_html"><div class="ttname"><a href="classAnyP_1_1UriScheme.html">AnyP::UriScheme</a></div><div class="ttdef"><b>Definition</b> <a href="UriScheme_8h_source.html#l00031">UriScheme.h:32</a></div></div>
<div class="ttc" id="aclassAnyP_1_1UriScheme_html_ad8b4c9be997f989d140e2f179b5acc46"><div class="ttname"><a href="classAnyP_1_1UriScheme.html#ad8b4c9be997f989d140e2f179b5acc46">AnyP::UriScheme::image</a></div><div class="ttdeci">SBuf image() const</div><div class="ttdef"><b>Definition</b> <a href="UriScheme_8h_source.html#l00057">UriScheme.h:57</a></div></div>
<div class="ttc" id="aclassAnyP_1_1Uri_html_a446037a0d5240188b96983e256dfe48b"><div class="ttname"><a href="classAnyP_1_1Uri.html#a446037a0d5240188b96983e256dfe48b">AnyP::Uri::setScheme</a></div><div class="ttdeci">void setScheme(const AnyP::ProtocolType &amp;p, const char *str)</div><div class="ttdoc">convert the URL scheme to that given</div><div class="ttdef"><b>Definition</b> <a href="Uri_8h_source.html#l00061">Uri.h:61</a></div></div>
<div class="ttc" id="aclassAnyP_1_1Uri_html_a6be4200ae143482153d6c03a63e2c0e1"><div class="ttname"><a href="classAnyP_1_1Uri.html#a6be4200ae143482153d6c03a63e2c0e1">AnyP::Uri::parsedHost</a></div><div class="ttdeci">std::optional&lt; Host &gt; parsedHost() const</div><div class="ttdef"><b>Definition</b> <a href="Uri_8cc_source.html#l00181">Uri.cc:181</a></div></div>
<div class="ttc" id="aclassAnyP_1_1Uri_html_aa09ef977328523ec48e7440c83d728d3"><div class="ttname"><a href="classAnyP_1_1Uri.html#aa09ef977328523ec48e7440c83d728d3">AnyP::Uri::port</a></div><div class="ttdeci">void port(const Port p)</div><div class="ttdoc">reset authority port subcomponent</div><div class="ttdef"><b>Definition</b> <a href="Uri_8h_source.html#l00090">Uri.h:90</a></div></div>
<div class="ttc" id="aclassAnyP_1_1Uri_html_aab379cecc273683d9744197a8a2efe3f"><div class="ttname"><a href="classAnyP_1_1Uri.html#aab379cecc273683d9744197a8a2efe3f">AnyP::Uri::host</a></div><div class="ttdeci">void host(const char *src)</div><div class="ttdef"><b>Definition</b> <a href="Uri_8cc_source.html#l00154">Uri.cc:154</a></div></div>
<div class="ttc" id="aclassAnyP_1_1Uri_html_ae4525a8b4e9835c24f43e2e7b1995a31"><div class="ttname"><a href="classAnyP_1_1Uri.html#ae4525a8b4e9835c24f43e2e7b1995a31">AnyP::Uri::hostOrIp</a></div><div class="ttdeci">SBuf hostOrIp() const</div><div class="ttdef"><b>Definition</b> <a href="Uri_8cc_source.html#l00170">Uri.cc:170</a></div></div>
<div class="ttc" id="aclassAsyncCall_html"><div class="ttname"><a href="classAsyncCall.html">AsyncCall</a></div><div class="ttdef"><b>Definition</b> <a href="AsyncCall_8h_source.html#l00040">AsyncCall.h:41</a></div></div>
<div class="ttc" id="aclassAsyncCallback_html"><div class="ttname"><a href="classAsyncCallback.html">AsyncCallback</a></div><div class="ttdoc">a smart AsyncCall pointer for delivery of future results</div><div class="ttdef"><b>Definition</b> <a href="AsyncCallbacks_8h_source.html#l00031">AsyncCallbacks.h:32</a></div></div>
<div class="ttc" id="aclassAsyncJob_html"><div class="ttname"><a href="classAsyncJob.html">AsyncJob</a></div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8h_source.html#l00031">AsyncJob.h:32</a></div></div>
<div class="ttc" id="aclassAsyncJob_html_a1dd42e9842d751193268966d4e0de2fa"><div class="ttname"><a href="classAsyncJob.html#a1dd42e9842d751193268966d4e0de2fa">AsyncJob::Start</a></div><div class="ttdeci">static void Start(const Pointer &amp;job)</div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8cc_source.html#l00037">AsyncJob.cc:37</a></div></div>
<div class="ttc" id="aclassAsyncJob_html_a2d48992e9b3e9c3af60c1058d0d79782"><div class="ttname"><a href="classAsyncJob.html#a2d48992e9b3e9c3af60c1058d0d79782">AsyncJob::start</a></div><div class="ttdeci">virtual void start()</div><div class="ttdoc">called by AsyncStart; do not call directly</div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8cc_source.html#l00059">AsyncJob.cc:59</a></div></div>
<div class="ttc" id="aclassAsyncJob_html_a49969a02734d2cec84725dc683c180aa"><div class="ttname"><a href="classAsyncJob.html#a49969a02734d2cec84725dc683c180aa">AsyncJob::mustStop</a></div><div class="ttdeci">void mustStop(const char *aReason)</div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8cc_source.html#l00085">AsyncJob.cc:85</a></div></div>
<div class="ttc" id="aclassAsyncJob_html_a83973ca7a7663bb81ce0ba346b8bcd9f"><div class="ttname"><a href="classAsyncJob.html#a83973ca7a7663bb81ce0ba346b8bcd9f">AsyncJob::deleteThis</a></div><div class="ttdeci">void deleteThis(const char *aReason)</div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8cc_source.html#l00065">AsyncJob.cc:65</a></div></div>
<div class="ttc" id="aclassAsyncJob_html_aefd101ddca496c1372f282e0f15229b8"><div class="ttname"><a href="classAsyncJob.html#aefd101ddca496c1372f282e0f15229b8">AsyncJob::callException</a></div><div class="ttdeci">virtual void callException(const std::exception &amp;e)</div><div class="ttdoc">called when the job throws during an async call</div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8cc_source.html#l00143">AsyncJob.cc:143</a></div></div>
<div class="ttc" id="aclassAuth_1_1UserRequest_html_a4d92682f8dd700e05a57a87cc2e74f0c"><div class="ttname"><a href="classAuth_1_1UserRequest.html#a4d92682f8dd700e05a57a87cc2e74f0c">Auth::UserRequest::releaseAuthServer</a></div><div class="ttdeci">virtual void releaseAuthServer()</div><div class="ttdef"><b>Definition</b> <a href="UserRequest_8cc_source.html#l00219">UserRequest.cc:219</a></div></div>
<div class="ttc" id="aclassBodyPipeCheckout_html"><div class="ttname"><a href="classBodyPipeCheckout.html">BodyPipeCheckout</a></div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00061">BodyPipe.h:62</a></div></div>
<div class="ttc" id="aclassBodyPipeCheckout_html_a62723d6305175d8cc0933d64ec0e6701"><div class="ttname"><a href="classBodyPipeCheckout.html#a62723d6305175d8cc0933d64ec0e6701">BodyPipeCheckout::checkIn</a></div><div class="ttdeci">void checkIn()</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00501">BodyPipe.cc:501</a></div></div>
<div class="ttc" id="aclassBodyPipeCheckout_html_af5cabb26c71cf3560c5fa06d4858f003"><div class="ttname"><a href="classBodyPipeCheckout.html#af5cabb26c71cf3560c5fa06d4858f003">BodyPipeCheckout::buf</a></div><div class="ttdeci">MemBuf &amp; buf</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00074">BodyPipe.h:74</a></div></div>
<div class="ttc" id="aclassBodyPipe_html"><div class="ttname"><a href="classBodyPipe.html">BodyPipe</a></div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00090">BodyPipe.h:91</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a0ee59d371163434ddfd9d163ea18b7c6"><div class="ttname"><a href="classBodyPipe.html#a0ee59d371163434ddfd9d163ea18b7c6">BodyPipe::producedSize</a></div><div class="ttdeci">uint64_t producedSize() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00112">BodyPipe.h:112</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a0efa9af26ca9da7e778483b69be10898"><div class="ttname"><a href="classBodyPipe.html#a0efa9af26ca9da7e778483b69be10898">BodyPipe::expectNoConsumption</a></div><div class="ttdeci">void expectNoConsumption()</div><div class="ttdoc">there will be no more setConsumer() calls</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00267">BodyPipe.cc:267</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a1211db9a9516395570698aa214ac0411"><div class="ttname"><a href="classBodyPipe.html#a1211db9a9516395570698aa214ac0411">BodyPipe::putMoreData</a></div><div class="ttdeci">size_t putMoreData(const char *buf, size_t size)</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00213">BodyPipe.cc:213</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a1c2a49617812bb676c1d92296ce897fc"><div class="ttname"><a href="classBodyPipe.html#a1c2a49617812bb676c1d92296ce897fc">BodyPipe::buf</a></div><div class="ttdeci">const MemBuf &amp; buf() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00137">BodyPipe.h:137</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a50b998e50726e22e7fb46f35038597ad"><div class="ttname"><a href="classBodyPipe.html#a50b998e50726e22e7fb46f35038597ad">BodyPipe::bodySizeKnown</a></div><div class="ttdeci">bool bodySizeKnown() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00109">BodyPipe.h:109</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a5413d63a6d1dcda5e2050970dd8dc0ba"><div class="ttname"><a href="classBodyPipe.html#a5413d63a6d1dcda5e2050970dd8dc0ba">BodyPipe::unproducedSize</a></div><div class="ttdeci">uint64_t unproducedSize() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00179">BodyPipe.cc:179</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a542c050b846dba14c679156e7ae9f08d"><div class="ttname"><a href="classBodyPipe.html#a542c050b846dba14c679156e7ae9f08d">BodyPipe::setBodySize</a></div><div class="ttdeci">void setBodySize(uint64_t aSize)</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00147">BodyPipe.cc:147</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_a86a7bad07711a162dccad979af7d4a20"><div class="ttname"><a href="classBodyPipe.html#a86a7bad07711a162dccad979af7d4a20">BodyPipe::status</a></div><div class="ttdeci">const char * status() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00446">BodyPipe.cc:446</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_aa50d7774a478d4dfe72dfb8e9644d29a"><div class="ttname"><a href="classBodyPipe.html#aa50d7774a478d4dfe72dfb8e9644d29a">BodyPipe::productionEnded</a></div><div class="ttdeci">bool productionEnded() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00113">BodyPipe.h:113</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_aace0a9e8cb0590c0fcc3a812e739765f"><div class="ttname"><a href="classBodyPipe.html#aace0a9e8cb0590c0fcc3a812e739765f">BodyPipe::mayNeedMoreData</a></div><div class="ttdeci">bool mayNeedMoreData() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8h_source.html#l00118">BodyPipe.h:118</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_ab0fa925752b586541d3a3414ef1474c6"><div class="ttname"><a href="classBodyPipe.html#ab0fa925752b586541d3a3414ef1474c6">BodyPipe::bodySize</a></div><div class="ttdeci">uint64_t bodySize() const</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00161">BodyPipe.cc:161</a></div></div>
<div class="ttc" id="aclassBodyPipe_html_acfdac140a6c4b099c2ba12de5daa649f"><div class="ttname"><a href="classBodyPipe.html#acfdac140a6c4b099c2ba12de5daa649f">BodyPipe::enableAutoConsumption</a></div><div class="ttdeci">void enableAutoConsumption()</div><div class="ttdoc">start or continue consuming when producing without consumer</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00316">BodyPipe.cc:316</a></div></div>
<div class="ttc" id="aclassBodyProducer_html_a74c6e12314d91957acc4dbbc610ed8d6"><div class="ttname"><a href="classBodyProducer.html#a74c6e12314d91957acc4dbbc610ed8d6">BodyProducer::stopProducingFor</a></div><div class="ttdeci">void stopProducingFor(RefCount&lt; BodyPipe &gt; &amp;, bool atEof)</div><div class="ttdef"><b>Definition</b> <a href="BodyPipe_8cc_source.html#l00107">BodyPipe.cc:107</a></div></div>
<div class="ttc" id="aclassCachePeer_html"><div class="ttname"><a href="classCachePeer.html">CachePeer</a></div><div class="ttdef"><b>Definition</b> <a href="CachePeer_8h_source.html#l00028">CachePeer.h:29</a></div></div>
<div class="ttc" id="aclassCallDialer_html"><div class="ttname"><a href="classCallDialer.html">CallDialer</a></div><div class="ttdef"><b>Definition</b> <a href="AsyncCall_8h_source.html#l00106">AsyncCall.h:107</a></div></div>
<div class="ttc" id="aclassCallSubscription_html"><div class="ttname"><a href="classCallSubscription.html">CallSubscription</a></div><div class="ttdef"><b>Definition</b> <a href="Subscription_8h_source.html#l00048">Subscription.h:49</a></div></div>
<div class="ttc" id="aclassCharacterSet_html"><div class="ttname"><a href="classCharacterSet.html">CharacterSet</a></div><div class="ttdoc">optimized set of C chars, with quick membership test and merge support</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8h_source.html#l00017">CharacterSet.h:18</a></div></div>
<div class="ttc" id="aclassCharacterSet_html_a578edbb48255e9df5e21dabb18cd8ab0"><div class="ttname"><a href="classCharacterSet.html#a578edbb48255e9df5e21dabb18cd8ab0">CharacterSet::DIGIT</a></div><div class="ttdeci">static const CharacterSet DIGIT</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8h_source.html#l00084">CharacterSet.h:84</a></div></div>
<div class="ttc" id="aclassCharacterSet_html_a7627410399607914e9bfddfcadd5eeaa"><div class="ttname"><a href="classCharacterSet.html#a7627410399607914e9bfddfcadd5eeaa">CharacterSet::ALPHA</a></div><div class="ttdeci">static const CharacterSet ALPHA</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8h_source.html#l00076">CharacterSet.h:76</a></div></div>
<div class="ttc" id="aclassCharacterSet_html_a8babc6783779a8b1880bea53e7ba5a45"><div class="ttname"><a href="classCharacterSet.html#a8babc6783779a8b1880bea53e7ba5a45">CharacterSet::HEXDIG</a></div><div class="ttdeci">static const CharacterSet HEXDIG</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8h_source.html#l00088">CharacterSet.h:88</a></div></div>
<div class="ttc" id="aclassClientDelayConfig_html_a13f675439815b14729fdc9c78a5ef7a9"><div class="ttname"><a href="classClientDelayConfig.html#a13f675439815b14729fdc9c78a5ef7a9">ClientDelayConfig::initial</a></div><div class="ttdeci">unsigned short initial</div><div class="ttdef"><b>Definition</b> <a href="ClientDelayConfig_8h_source.html#l00074">ClientDelayConfig.h:74</a></div></div>
<div class="ttc" id="aclassClientDelayPools_html_a4be351bae53c16ae8c1f686a793efd9e"><div class="ttname"><a href="classClientDelayPools.html#a4be351bae53c16ae8c1f686a793efd9e">ClientDelayPools::pools</a></div><div class="ttdeci">std::vector&lt; ClientDelayPool::Pointer &gt; pools</div><div class="ttdef"><b>Definition</b> <a href="ClientDelayConfig_8h_source.html#l00047">ClientDelayConfig.h:47</a></div></div>
<div class="ttc" id="aclassClientDelayPools_html_ad922b6f4db246843a79a4c96628328bc"><div class="ttname"><a href="classClientDelayPools.html#ad922b6f4db246843a79a4c96628328bc">ClientDelayPools::Instance</a></div><div class="ttdeci">static ClientDelayPools * Instance()</div><div class="ttdef"><b>Definition</b> <a href="ClientDelayConfig_8cc_source.html#l00033">ClientDelayConfig.cc:33</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html"><div class="ttname"><a href="classClientHttpRequest.html">ClientHttpRequest</a></div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00030">client_side_request.h:35</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a220035029f64b125f600da80744a9ed1"><div class="ttname"><a href="classClientHttpRequest.html#a220035029f64b125f600da80744a9ed1">ClientHttpRequest::out</a></div><div class="ttdeci">struct ClientHttpRequest::Out out</div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a27dbe3e5b15be5edba058de0cfbf9f92"><div class="ttname"><a href="classClientHttpRequest.html#a27dbe3e5b15be5edba058de0cfbf9f92">ClientHttpRequest::clearRequest</a></div><div class="ttdeci">void clearRequest()</div><div class="ttdoc">resets the current request and log_uri to nil</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8cc_source.html#l01536">client_side_request.cc:1536</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a2becc63f591bbc0b40542099c1bb05a9"><div class="ttname"><a href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">ClientHttpRequest::request</a></div><div class="ttdeci">HttpRequest *const request</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00130">client_side_request.h:130</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a3b6e866b0c91455fb2f9041911e83e04"><div class="ttname"><a href="classClientHttpRequest.html#a3b6e866b0c91455fb2f9041911e83e04">ClientHttpRequest::updateCounters</a></div><div class="ttdeci">void updateCounters()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00308">client_side.cc:308</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a3f3960bd399a7b8e6905d5f95a7e7fdc"><div class="ttname"><a href="classClientHttpRequest.html#a3f3960bd399a7b8e6905d5f95a7e7fdc">ClientHttpRequest::mRangeCLen</a></div><div class="ttdeci">int64_t mRangeCLen() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00740">client_side.cc:740</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a3f6d0f7008f5302283e91937cdc67f75"><div class="ttname"><a href="classClientHttpRequest.html#a3f6d0f7008f5302283e91937cdc67f75">ClientHttpRequest::log_uri</a></div><div class="ttdeci">char *const log_uri</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00141">client_side_request.h:141</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a479a52ea68d38e907287b7e921d4fd68"><div class="ttname"><a href="classClientHttpRequest.html#a479a52ea68d38e907287b7e921d4fd68">ClientHttpRequest::logRequest</a></div><div class="ttdeci">void logRequest()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00374">client_side.cc:374</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a4ba011f5f09d32fba56441c385752255"><div class="ttname"><a href="classClientHttpRequest.html#a4ba011f5f09d32fba56441c385752255">ClientHttpRequest::getConn</a></div><div class="ttdeci">ConnStateData * getConn() const</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00068">client_side_request.h:68</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a52f95c3b38b4cacf5fa0e4d157b6eac6"><div class="ttname"><a href="classClientHttpRequest.html#a52f95c3b38b4cacf5fa0e4d157b6eac6">ClientHttpRequest::freeResources</a></div><div class="ttdeci">void freeResources()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00463">client_side.cc:463</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a53f0bfbec60d40769f21aff66eeaaa79"><div class="ttname"><a href="classClientHttpRequest.html#a53f0bfbec60d40769f21aff66eeaaa79">ClientHttpRequest::rangeBoundaryStr</a></div><div class="ttdeci">String rangeBoundaryStr() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00780">client_side.cc:780</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a5912c3e9af285d3f77ec815c719b8105"><div class="ttname"><a href="classClientHttpRequest.html#a5912c3e9af285d3f77ec815c719b8105">ClientHttpRequest::initRequest</a></div><div class="ttdeci">void initRequest(HttpRequest *)</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8cc_source.html#l01463">client_side_request.cc:1463</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a68e1aa2eaed3852cef68f86d4a1865c2"><div class="ttname"><a href="classClientHttpRequest.html#a68e1aa2eaed3852cef68f86d4a1865c2">ClientHttpRequest::checkForInternalAccess</a></div><div class="ttdeci">void checkForInternalAccess()</div><div class="ttdoc">Checks whether the current request is internal and adjusts it accordingly.</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8cc_source.html#l01502">client_side_request.cc:1502</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a6c8eb3e0781de2af44142a360eec1738"><div class="ttname"><a href="classClientHttpRequest.html#a6c8eb3e0781de2af44142a360eec1738">ClientHttpRequest::updateError</a></div><div class="ttdeci">void updateError(const Error &amp;)</div><div class="ttdoc">if necessary, stores new error information (if any)</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8cc_source.html#l01422">client_side_request.cc:1422</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a7b72433c2b94db09d5fa9725a2a189f0"><div class="ttname"><a href="classClientHttpRequest.html#a7b72433c2b94db09d5fa9725a2a189f0">ClientHttpRequest::memObject</a></div><div class="ttdeci">MemObject * memObject() const</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00055">client_side_request.h:55</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a88642d6f6a181e20927a9e54cabf3c91"><div class="ttname"><a href="classClientHttpRequest.html#a88642d6f6a181e20927a9e54cabf3c91">ClientHttpRequest::req_sz</a></div><div class="ttdeci">size_t req_sz</div><div class="ttdoc">raw request size on input, not current request size</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00159">client_side_request.h:159</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a9891746d2fe370c2930a7fddb44c1a35"><div class="ttname"><a href="classClientHttpRequest.html#a9891746d2fe370c2930a7fddb44c1a35">ClientHttpRequest::setErrorUri</a></div><div class="ttdeci">void setErrorUri(const char *)</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8cc_source.html#l01763">client_side_request.cc:1763</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_aa0e86897a7631b6c698f6ca2acb1d1ac"><div class="ttname"><a href="classClientHttpRequest.html#aa0e86897a7631b6c698f6ca2acb1d1ac">ClientHttpRequest::range_iter</a></div><div class="ttdeci">HttpHdrRangeIter range_iter</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00158">client_side_request.h:158</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_aaa05fd2e87baa36553d2039aa92901a3"><div class="ttname"><a href="classClientHttpRequest.html#aaa05fd2e87baa36553d2039aa92901a3">ClientHttpRequest::flags</a></div><div class="ttdeci">struct ClientHttpRequest::Flags flags</div></div>
<div class="ttc" id="aclassClientHttpRequest_html_aaccebea2e47cb4f216a2f3bf32590cb9"><div class="ttname"><a href="classClientHttpRequest.html#aaccebea2e47cb4f216a2f3bf32590cb9">ClientHttpRequest::multipartRangeRequest</a></div><div class="ttdeci">bool multipartRangeRequest() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00696">client_side.cc:696</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ab992ab634582a805bf248e2e311403e1"><div class="ttname"><a href="classClientHttpRequest.html#ab992ab634582a805bf248e2e311403e1">ClientHttpRequest::doCallouts</a></div><div class="ttdeci">void doCallouts()</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8cc_source.html#l01572">client_side_request.cc:1572</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ac1d305af64fb92ccfce613c1eb96d178"><div class="ttname"><a href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">ClientHttpRequest::uri</a></div><div class="ttdeci">char * uri</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00135">client_side_request.h:135</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ac8c0f73794781ce53acf6083e0077f34"><div class="ttname"><a href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">ClientHttpRequest::storeEntry</a></div><div class="ttdeci">StoreEntry * storeEntry() const</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00063">client_side_request.h:63</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ae2f400bf3f3d140535bfa6c43908a348"><div class="ttname"><a href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">ClientHttpRequest::client_stream</a></div><div class="ttdeci">dlink_list client_stream</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00174">client_side_request.h:174</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ae5d3bde3423ebc7185c259a6ae16efc3"><div class="ttname"><a href="classClientHttpRequest.html#ae5d3bde3423ebc7185c259a6ae16efc3">ClientHttpRequest::calloutContext</a></div><div class="ttdeci">ClientRequestContext * calloutContext</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00176">client_side_request.h:176</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_aee8237109aebae9e3711a066ddfa42c0"><div class="ttname"><a href="classClientHttpRequest.html#aee8237109aebae9e3711a066ddfa42c0">ClientHttpRequest::loggingTags</a></div><div class="ttdeci">const LogTags &amp; loggingTags() const</div><div class="ttdoc">the processing tags associated with this request transaction.</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00094">client_side_request.h:94</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_af1ec5778cbc7fcd488df2918c821f499"><div class="ttname"><a href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">ClientHttpRequest::al</a></div><div class="ttdeci">const AccessLogEntry::Pointer al</div><div class="ttdoc">access.log entry</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00161">client_side_request.h:161</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_af52b42fc3f7ed18172aa09d69f856e55"><div class="ttname"><a href="classClientHttpRequest.html#af52b42fc3f7ed18172aa09d69f856e55">ClientHttpRequest::loggingEntry</a></div><div class="ttdeci">StoreEntry * loggingEntry() const</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00065">client_side_request.h:65</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_afc0f851aa12908396cb5457c085a4e6f"><div class="ttname"><a href="classClientHttpRequest.html#afc0f851aa12908396cb5457c085a4e6f">ClientHttpRequest::redirect</a></div><div class="ttdeci">struct ClientHttpRequest::Redirect redirect</div></div>
<div class="ttc" id="aclassClientInfo_html"><div class="ttname"><a href="classClientInfo.html">ClientInfo</a></div><div class="ttdef"><b>Definition</b> <a href="ClientInfo_8h_source.html#l00030">ClientInfo.h:34</a></div></div>
<div class="ttc" id="aclassClientInfo_html_a6248c51b1e77e613cb4277823ccbf731"><div class="ttname"><a href="classClientInfo.html#a6248c51b1e77e613cb4277823ccbf731">ClientInfo::setWriteLimiter</a></div><div class="ttdeci">void setWriteLimiter(const int aWriteSpeedLimit, const double anInitialBurst, const double aHighWatermark)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l01343">comm.cc:1343</a></div></div>
<div class="ttc" id="aclassClientRequestContext_html"><div class="ttname"><a href="classClientRequestContext.html">ClientRequestContext</a></div><div class="ttdef"><b>Definition</b> <a href="ClientRequestContext_8h_source.html#l00028">ClientRequestContext.h:29</a></div></div>
<div class="ttc" id="aclassCodeContext_html_a13251c00d03b5a9cb9f3b164f0154969"><div class="ttname"><a href="classCodeContext.html#a13251c00d03b5a9cb9f3b164f0154969">CodeContext::Current</a></div><div class="ttdeci">static const Pointer &amp; Current()</div><div class="ttdef"><b>Definition</b> <a href="CodeContext_8cc_source.html#l00033">CodeContext.cc:33</a></div></div>
<div class="ttc" id="aclassCodeContext_html_aeed1567dd2fb1c97eb3fa3f10df4622e"><div class="ttname"><a href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a></div><div class="ttdeci">static void Reset()</div><div class="ttdoc">forgets the current context, setting it to nil/unknown</div><div class="ttdef"><b>Definition</b> <a href="CodeContext_8cc_source.html#l00077">CodeContext.cc:77</a></div></div>
<div class="ttc" id="aclassCommAcceptCbParams_html"><div class="ttname"><a href="classCommAcceptCbParams.html">CommAcceptCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00092">CommCalls.h:93</a></div></div>
<div class="ttc" id="aclassCommAcceptCbParams_html_a42535776245356fa787da0705fc46f40"><div class="ttname"><a href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">CommAcceptCbParams::port</a></div><div class="ttdeci">AnyP::PortCfgPointer port</div><div class="ttdoc">the configuration listening port this call relates to (may be nil)</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00100">CommCalls.h:100</a></div></div>
<div class="ttc" id="aclassCommAcceptCbPtrFun_html"><div class="ttname"><a href="classCommAcceptCbPtrFun.html">CommAcceptCbPtrFun</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00194">CommCalls.h:196</a></div></div>
<div class="ttc" id="aclassCommCbFunPtrCallT_html"><div class="ttname"><a href="classCommCbFunPtrCallT.html">CommCbFunPtrCallT</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00280">CommCalls.h:281</a></div></div>
<div class="ttc" id="aclassCommCbMemFunT_html"><div class="ttname"><a href="classCommCbMemFunT.html">CommCbMemFunT</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00165">CommCalls.h:166</a></div></div>
<div class="ttc" id="aclassCommCloseCbParams_html"><div class="ttname"><a href="classCommCloseCbParams.html">CommCloseCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00127">CommCalls.h:128</a></div></div>
<div class="ttc" id="aclassCommCommonCbParams_html_a5376946442719c10cc9307045e09460d"><div class="ttname"><a href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">CommCommonCbParams::xerrno</a></div><div class="ttdeci">int xerrno</div><div class="ttdoc">The last errno to occur. non-zero if flag is Comm::COMM_ERROR.</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00083">CommCalls.h:83</a></div></div>
<div class="ttc" id="aclassCommCommonCbParams_html_a6a391b2345409642778d85f241c5facb"><div class="ttname"><a href="classCommCommonCbParams.html#a6a391b2345409642778d85f241c5facb">CommCommonCbParams::fd</a></div><div class="ttdeci">int fd</div><div class="ttdoc">FD which the call was about. Set by the async call creator.</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00085">CommCalls.h:85</a></div></div>
<div class="ttc" id="aclassCommCommonCbParams_html_aaa1b70c6ff254ac72ac1503fc158df7e"><div class="ttname"><a href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">CommCommonCbParams::flag</a></div><div class="ttdeci">Comm::Flag flag</div><div class="ttdoc">comm layer result status.</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00082">CommCalls.h:82</a></div></div>
<div class="ttc" id="aclassCommCommonCbParams_html_acbcbe42d3ccd12c6de3b1f3d1d7c4bc3"><div class="ttname"><a href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">CommCommonCbParams::conn</a></div><div class="ttdeci">Comm::ConnectionPointer conn</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00080">CommCalls.h:80</a></div></div>
<div class="ttc" id="aclassCommIoCbParams_html"><div class="ttname"><a href="classCommIoCbParams.html">CommIoCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00113">CommCalls.h:114</a></div></div>
<div class="ttc" id="aclassCommIoCbParams_html_a34e29cc8266e4126764a5a6077859542"><div class="ttname"><a href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">CommIoCbParams::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00123">CommCalls.h:123</a></div></div>
<div class="ttc" id="aclassCommTimeoutCbParams_html"><div class="ttname"><a href="classCommTimeoutCbParams.html">CommTimeoutCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00133">CommCalls.h:134</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html"><div class="ttname"><a href="classComm_1_1Connection.html">Comm::Connection</a></div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00072">Connection.h:73</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a31fb1758ce5a186c27710515b69aa94e"><div class="ttname"><a href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">Comm::Connection::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00177">Connection.h:177</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a32253e90999f679dc032e19ad50d03ab"><div class="ttname"><a href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">Comm::Connection::close</a></div><div class="ttdeci">void close()</div><div class="ttdef"><b>Definition</b> <a href="Connection_8cc_source.html#l00091">Connection.cc:91</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a50af3f8fe1f64bcaffdbedcf8a83683f"><div class="ttname"><a href="classComm_1_1Connection.html#a50af3f8fe1f64bcaffdbedcf8a83683f">Comm::Connection::timeLeft</a></div><div class="ttdeci">time_t timeLeft(const time_t idleTimeout) const</div><div class="ttdef"><b>Definition</b> <a href="Connection_8cc_source.html#l00138">Connection.cc:138</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a60e1b863400f49a2ed17054982561f17"><div class="ttname"><a href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">Comm::Connection::remote</a></div><div class="ttdeci">Ip::Address remote</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00152">Connection.h:152</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a84e6544b719c79cbecbc7d2a891fbcb2"><div class="ttname"><a href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">Comm::Connection::local</a></div><div class="ttdeci">Ip::Address local</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00149">Connection.h:149</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a8e53f4d6fd38545947a5aac6efb98fca"><div class="ttname"><a href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">Comm::Connection::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00158">Connection.h:158</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a93501769b655ff67d8d195df07784df0"><div class="ttname"><a href="classComm_1_1Connection.html#a93501769b655ff67d8d195df07784df0">Comm::Connection::noteClosure</a></div><div class="ttdeci">void noteClosure()</div><div class="ttdef"><b>Definition</b> <a href="Connection_8cc_source.html#l00100">Connection.cc:100</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_ad896c0e8f260771b0d5d229357ef8acc"><div class="ttname"><a href="classComm_1_1Connection.html#ad896c0e8f260771b0d5d229357ef8acc">Comm::Connection::tlsNegotiations</a></div><div class="ttdeci">Security::NegotiationHistory * tlsNegotiations()</div><div class="ttdef"><b>Definition</b> <a href="Connection_8cc_source.html#l00148">Connection.cc:148</a></div></div>
<div class="ttc" id="aclassComm_1_1TcpAcceptor_html"><div class="ttname"><a href="classComm_1_1TcpAcceptor.html">Comm::TcpAcceptor</a></div><div class="ttdef"><b>Definition</b> <a href="TcpAcceptor_8h_source.html#l00038">TcpAcceptor.h:39</a></div></div>
<div class="ttc" id="aclassConnStateData_1_1PinnedIdleContext_html"><div class="ttname"><a href="classConnStateData_1_1PinnedIdleContext.html">ConnStateData::PinnedIdleContext</a></div><div class="ttdoc">parameters for the async notePinnedConnectionBecameIdle() call</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00182">client_side.h:183</a></div></div>
<div class="ttc" id="aclassConnStateData_1_1PinnedIdleContext_html_ad07351f67935319498317d281beffdf7"><div class="ttname"><a href="classConnStateData_1_1PinnedIdleContext.html#ad07351f67935319498317d281beffdf7">ConnStateData::PinnedIdleContext::connection</a></div><div class="ttdeci">Comm::ConnectionPointer connection</div><div class="ttdoc">to-server connection to be pinned</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00187">client_side.h:187</a></div></div>
<div class="ttc" id="aclassConnStateData_1_1PinnedIdleContext_html_addadc081ff7543e5d6dd5d7becf1888e"><div class="ttname"><a href="classConnStateData_1_1PinnedIdleContext.html#addadc081ff7543e5d6dd5d7becf1888e">ConnStateData::PinnedIdleContext::request</a></div><div class="ttdeci">HttpRequest::Pointer request</div><div class="ttdoc">to-server request that initiated serverConnection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00188">client_side.h:188</a></div></div>
<div class="ttc" id="aclassConnStateData_1_1ServerConnectionContext_html"><div class="ttname"><a href="classConnStateData_1_1ServerConnectionContext.html">ConnStateData::ServerConnectionContext</a></div><div class="ttdoc">noteTakeServerConnectionControl() callback parameter</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00213">client_side.h:213</a></div></div>
<div class="ttc" id="aclassConnStateData_1_1ServerConnectionContext_html_a0a93dfb368687dc0dbbe48fee379d48d"><div class="ttname"><a href="classConnStateData_1_1ServerConnectionContext.html#a0a93dfb368687dc0dbbe48fee379d48d">ConnStateData::ServerConnectionContext::conn_</a></div><div class="ttdeci">Comm::ConnectionPointer conn_</div><div class="ttdoc">to-server connection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00224">client_side.h:224</a></div></div>
<div class="ttc" id="aclassConnStateData_1_1ServerConnectionContext_html_a33069bdd3ccfb59299b698eb443b8e88"><div class="ttname"><a href="classConnStateData_1_1ServerConnectionContext.html#a33069bdd3ccfb59299b698eb443b8e88">ConnStateData::ServerConnectionContext::preReadServerBytes</a></div><div class="ttdeci">SBuf preReadServerBytes</div><div class="ttdoc">post-101 bytes received from the server</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00220">client_side.h:220</a></div></div>
<div class="ttc" id="aclassConnStateData_html"><div class="ttname"><a href="classConnStateData.html">ConnStateData</a></div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00079">client_side.h:84</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a00681c7edc00b7680dc7e63269434128"><div class="ttname"><a href="classConnStateData.html#a00681c7edc00b7680dc7e63269434128">ConnStateData::pipelinePrefetchMax</a></div><div class="ttdeci">virtual int pipelinePrefetchMax() const</div><div class="ttdoc">returning N allows a pipeline of 1+N requests (see pipeline_prefetch)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01716">client_side.cc:1716</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a03599e863786928346e70b03b3d30031"><div class="ttname"><a href="classConnStateData.html#a03599e863786928346e70b03b3d30031">ConnStateData::postHttpsAccept</a></div><div class="ttdeci">void postHttpsAccept()</div><div class="ttdoc">the second part of old httpsAccept, waiting for future HttpsServer home</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02465">client_side.cc:2465</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a0452329238b5201c25f125bfd39ebd5f"><div class="ttname"><a href="classConnStateData.html#a0452329238b5201c25f125bfd39ebd5f">ConnStateData::serverBump</a></div><div class="ttdeci">Ssl::ServerBump * serverBump()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00285">client_side.h:285</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a090da3709a1d4e3e0a5c858abc7496e7"><div class="ttname"><a href="classConnStateData.html#a090da3709a1d4e3e0a5c858abc7496e7">ConnStateData::endingShutdown</a></div><div class="ttdeci">void endingShutdown() override</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01025">client_side.cc:1025</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a0a6bcd9010a0dfdd48910ec1972c6d6e"><div class="ttname"><a href="classConnStateData.html#a0a6bcd9010a0dfdd48910ec1972c6d6e">ConnStateData::pinning</a></div><div class="ttdeci">struct ConnStateData::@29 pinning</div></div>
<div class="ttc" id="aclassConnStateData_html_a1130109009a83806a8c4f37f03d33388"><div class="ttname"><a href="classConnStateData.html#a1130109009a83806a8c4f37f03d33388">ConnStateData::fakeAConnectRequest</a></div><div class="ttdeci">bool fakeAConnectRequest(const char *reason, const SBuf &amp;payload)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03136">client_side.cc:3136</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a12339fb2c6778b15820c53a9137de210"><div class="ttname"><a href="classConnStateData.html#a12339fb2c6778b15820c53a9137de210">ConnStateData::switchedToHttps</a></div><div class="ttdeci">bool switchedToHttps() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00284">client_side.h:284</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a12dfeaee10cae92416b398b102345a4e"><div class="ttname"><a href="classConnStateData.html#a12dfeaee10cae92416b398b102345a4e">ConnStateData::readNextRequest</a></div><div class="ttdeci">void readNextRequest()</div><div class="ttdoc">Traffic parsing.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00857">client_side.cc:857</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a17f5c3c2de993a7edcf465054e08d8de"><div class="ttname"><a href="classConnStateData.html#a17f5c3c2de993a7edcf465054e08d8de">ConnStateData::clientPinnedConnectionClosed</a></div><div class="ttdeci">virtual void clientPinnedConnectionClosed(const CommCloseCbParams &amp;io)</div><div class="ttdoc">Our close handler called by Comm when the pinned connection is closed.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03660">client_side.cc:3660</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a18114504b3f8a86a67e0dc006e8309b4"><div class="ttname"><a href="classConnStateData.html#a18114504b3f8a86a67e0dc006e8309b4">ConnStateData::prepareTlsSwitchingURL</a></div><div class="ttdeci">char * prepareTlsSwitchingURL(const Http1::RequestParserPointer &amp;hp)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01196">client_side.cc:1196</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a18b9505239a47bf8922633f4cd7b0e1f"><div class="ttname"><a href="classConnStateData.html#a18b9505239a47bf8922633f4cd7b0e1f">ConnStateData::keyLogger</a></div><div class="ttdeci">Security::KeyLogger keyLogger</div><div class="ttdoc">managers logging of the being-accepted TLS connection secrets</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00384">client_side.h:384</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a21c5baeec729cb1b057502a6a0554fb5"><div class="ttname"><a href="classConnStateData.html#a21c5baeec729cb1b057502a6a0554fb5">ConnStateData::afterClientRead</a></div><div class="ttdeci">void afterClientRead() override</div><div class="ttdoc">processing to be done after a Comm::Read()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01910">client_side.cc:1910</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a24809cec94fdcd3e242ec9fdf19b61bc"><div class="ttname"><a href="classConnStateData.html#a24809cec94fdcd3e242ec9fdf19b61bc">ConnStateData::sslServerBump</a></div><div class="ttdeci">Ssl::ServerBump * sslServerBump</div><div class="ttdoc">HTTPS server cert. fetching state for bump-ssl-server-first.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00494">client_side.h:494</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a25dda3837772dfe4efcec4c88865265c"><div class="ttname"><a href="classConnStateData.html#a25dda3837772dfe4efcec4c88865265c">ConnStateData::parseHttpRequest</a></div><div class="ttdeci">Http::Stream * parseHttpRequest(const Http1::RequestParserPointer &amp;)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01255">client_side.cc:1255</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a2756cdd773238b531b34df1566a2ae58"><div class="ttname"><a href="classConnStateData.html#a2756cdd773238b531b34df1566a2ae58">ConnStateData::writeControlMsgAndCall</a></div><div class="ttdeci">virtual bool writeControlMsgAndCall(HttpReply *rep, AsyncCall::Pointer &amp;call)=0</div><div class="ttdoc">handle a control message received by context from a peer and call back</div></div>
<div class="ttc" id="aclassConnStateData_html_a2d458e5d1aecb62f7a9568e34467262c"><div class="ttname"><a href="classConnStateData.html#a2d458e5d1aecb62f7a9568e34467262c">ConnStateData::switchToHttps</a></div><div class="ttdeci">void switchToHttps(ClientHttpRequest *, Ssl::BumpMode bumpServerMode)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02772">client_side.cc:2772</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a2d787d1d6f3b575d1515887213e2172c"><div class="ttname"><a href="classConnStateData.html#a2d787d1d6f3b575d1515887213e2172c">ConnStateData::startPinnedConnectionMonitoring</a></div><div class="ttdeci">void startPinnedConnectionMonitoring()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03743">client_side.cc:3743</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a30d7e040d87665326b2cd9f63466cde2"><div class="ttname"><a href="classConnStateData.html#a30d7e040d87665326b2cd9f63466cde2">ConnStateData::stoppedReceiving</a></div><div class="ttdeci">const char * stoppedReceiving() const</div><div class="ttdoc">true if we stopped receiving the request</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00159">client_side.h:159</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a311713f0ae2a89a60327696b2f1188f4"><div class="ttname"><a href="classConnStateData.html#a311713f0ae2a89a60327696b2f1188f4">ConnStateData::consumeInput</a></div><div class="ttdeci">void consumeInput(const size_t byteCount)</div><div class="ttdoc">remove no longer needed leading bytes from the input buffer</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01409">client_side.cc:1409</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a31ff1f7aab0f5cb374c9d34d848eb7e3"><div class="ttname"><a href="classConnStateData.html#a31ff1f7aab0f5cb374c9d34d848eb7e3">ConnStateData::clientAfterReadingRequests</a></div><div class="ttdeci">void clientAfterReadingRequests()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01417">client_side.cc:1417</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a3282e887b7304282cd1cc35f37844df9"><div class="ttname"><a href="classConnStateData.html#a3282e887b7304282cd1cc35f37844df9">ConnStateData::buildFakeRequest</a></div><div class="ttdeci">ClientHttpRequest * buildFakeRequest(SBuf &amp;useHost, AnyP::KnownPort usePort, const SBuf &amp;payload)</div><div class="ttdoc">build a fake http request</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03165">client_side.cc:3165</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a353dfcbded7be4eb270547eb11f4b342"><div class="ttname"><a href="classConnStateData.html#a353dfcbded7be4eb270547eb11f4b342">ConnStateData::handleReply</a></div><div class="ttdeci">virtual void handleReply(HttpReply *header, StoreIOBuffer receivedData)=0</div></div>
<div class="ttc" id="aclassConnStateData_html_a365239c8b450a844e46cc7c28d465ba3"><div class="ttname"><a href="classConnStateData.html#a365239c8b450a844e46cc7c28d465ba3">ConnStateData::setAuth</a></div><div class="ttdeci">void setAuth(const Auth::UserRequest::Pointer &amp;aur, const char *cause)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00494">client_side.cc:494</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a37a1d6332f652d4b3aed9502f97b3fa2"><div class="ttname"><a href="classConnStateData.html#a37a1d6332f652d4b3aed9502f97b3fa2">ConnStateData::parseOneRequest</a></div><div class="ttdeci">virtual Http::Stream * parseOneRequest()=0</div></div>
<div class="ttc" id="aclassConnStateData_html_a38e92e04e08175ba90642ffb2cf311c8"><div class="ttname"><a href="classConnStateData.html#a38e92e04e08175ba90642ffb2cf311c8">ConnStateData::bodyPipe</a></div><div class="ttdeci">BodyPipe::Pointer bodyPipe</div><div class="ttdoc">set when we are reading request body</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00431">client_side.h:431</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a3b3e9d2ba84a1a8e42cc1088709b1c4f"><div class="ttname"><a href="classConnStateData.html#a3b3e9d2ba84a1a8e42cc1088709b1c4f">ConnStateData::tlsClientSni</a></div><div class="ttdeci">const SBuf &amp; tlsClientSni() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00294">client_side.h:294</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a3b89321dd8a2fe3e28137e1562f157ff"><div class="ttname"><a href="classConnStateData.html#a3b89321dd8a2fe3e28137e1562f157ff">ConnStateData::sendControlMsg</a></div><div class="ttdeci">void sendControlMsg(HttpControlMsg) override</div><div class="ttdoc">called to send the 1xx message and notify the Source</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03614">client_side.cc:3614</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a3cb67d29f73c36995e78cc0870235bd9"><div class="ttname"><a href="classConnStateData.html#a3cb67d29f73c36995e78cc0870235bd9">ConnStateData::kick</a></div><div class="ttdeci">void kick()</div><div class="ttdoc">try to make progress on a transaction or read more I/O</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00894">client_side.cc:894</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a4703123fe8d180f68321411d26ceb736"><div class="ttname"><a href="classConnStateData.html#a4703123fe8d180f68321411d26ceb736">ConnStateData::getAuth</a></div><div class="ttdeci">const Auth::UserRequest::Pointer &amp; getAuth() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00123">client_side.h:123</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a47c605492c85e115ccef1b66bca58a54"><div class="ttname"><a href="classConnStateData.html#a47c605492c85e115ccef1b66bca58a54">ConnStateData::getSslContextStart</a></div><div class="ttdeci">void getSslContextStart()</div><div class="ttdoc">Start to create dynamic Security::ContextPointer for host or uses static port SSL context.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02675">client_side.cc:2675</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a47fe99b93fb1bd926b43d19da19f1773"><div class="ttname"><a href="classConnStateData.html#a47fe99b93fb1bd926b43d19da19f1773">ConnStateData::httpsPeeked</a></div><div class="ttdeci">void httpsPeeked(PinnedIdleContext pic)</div><div class="ttdoc">called by FwdState when it is done bumping the server</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03071">client_side.cc:3071</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a49651ee9330d4206ff880a3fe93ee726"><div class="ttname"><a href="classConnStateData.html#a49651ee9330d4206ff880a3fe93ee726">ConnStateData::initiateTunneledRequest</a></div><div class="ttdeci">bool initiateTunneledRequest(HttpRequest::Pointer const &amp;cause, const char *reason, const SBuf &amp;payload)</div><div class="ttdoc">generates and sends to tunnel.cc a fake request with a given payload</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03089">client_side.cc:3089</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a497c8682cd967de8b087198e08c0dd66"><div class="ttname"><a href="classConnStateData.html#a497c8682cd967de8b087198e08c0dd66">ConnStateData::swanSong</a></div><div class="ttdeci">void swanSong() override</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00591">client_side.cc:591</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a49bf6c56e934b45073feea54e341c76d"><div class="ttname"><a href="classConnStateData.html#a49bf6c56e934b45073feea54e341c76d">ConnStateData::splice</a></div><div class="ttdeci">bool splice()</div><div class="ttdoc">Splice a bumped client connection on peek-and-splice mode.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02930">client_side.cc:2930</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a4cbbc46289185d9b973594b11f7649fa"><div class="ttname"><a href="classConnStateData.html#a4cbbc46289185d9b973594b11f7649fa">ConnStateData::start</a></div><div class="ttdeci">void start() override</div><div class="ttdoc">called by AsyncStart; do not call directly</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02128">client_side.cc:2128</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a4d4de1cff9d3c5f5d312fee3622e0fa2"><div class="ttname"><a href="classConnStateData.html#a4d4de1cff9d3c5f5d312fee3622e0fa2">ConnStateData::parseRequests</a></div><div class="ttdeci">void parseRequests()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01836">client_side.cc:1836</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a4dcb7a1c309024f3032f7d70b8827a96"><div class="ttname"><a href="classConnStateData.html#a4dcb7a1c309024f3032f7d70b8827a96">ConnStateData::tlsClientSni_</a></div><div class="ttdeci">SBuf tlsClientSni_</div><div class="ttdoc">TLS client delivered SNI value. Empty string if none has been received.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00490">client_side.h:490</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a5230ce05c11307d10d7f118c4246082f"><div class="ttname"><a href="classConnStateData.html#a5230ce05c11307d10d7f118c4246082f">ConnStateData::bareError</a></div><div class="ttdeci">Error bareError</div><div class="ttdoc">a problem that occurred without a request (e.g., while parsing headers)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00381">client_side.h:381</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a546c60dc348f44b3e75407f737abd849"><div class="ttname"><a href="classConnStateData.html#a546c60dc348f44b3e75407f737abd849">ConnStateData::handleReadData</a></div><div class="ttdeci">bool handleReadData() override</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01938">client_side.cc:1938</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a56c3ce7c30a3ab5ac9a83489ee862e20"><div class="ttname"><a href="classConnStateData.html#a56c3ce7c30a3ab5ac9a83489ee862e20">ConnStateData::expectNoForwarding</a></div><div class="ttdeci">void expectNoForwarding()</div><div class="ttdoc">cleans up virgin request [body] forwarding state</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03571">client_side.cc:3571</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a59583be538fbda5cdf2c6637142d71b8"><div class="ttname"><a href="classConnStateData.html#a59583be538fbda5cdf2c6637142d71b8">ConnStateData::abortRequestParsing</a></div><div class="ttdeci">Http::Stream * abortRequestParsing(const char *const errUri)</div><div class="ttdoc">stop parsing the request and create context for relaying error info</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00998">client_side.cc:998</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a5a39c2a4ae492e5914085fca73f73206"><div class="ttname"><a href="classConnStateData.html#a5a39c2a4ae492e5914085fca73f73206">ConnStateData::startShutdown</a></div><div class="ttdeci">void startShutdown() override</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01014">client_side.cc:1014</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a5a4dc94676ec0b6f8cfcb1f906eed6d4"><div class="ttname"><a href="classConnStateData.html#a5a4dc94676ec0b6f8cfcb1f906eed6d4">ConnStateData::sslCrtdHandleReply</a></div><div class="ttdeci">void sslCrtdHandleReply(const Helper::Reply &amp;reply)</div><div class="ttdoc">Process response from ssl_crtd.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02528">client_side.cc:2528</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a5abc8f5b749b7532794895b37c106153"><div class="ttname"><a href="classConnStateData.html#a5abc8f5b749b7532794895b37c106153">ConnStateData::handleChunkedRequestBody</a></div><div class="ttdeci">err_type handleChunkedRequestBody()</div><div class="ttdoc">parses available chunked encoded body bytes, checks size, returns errors</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01993">client_side.cc:1993</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a5d7e0e5953fa47b1f66af94ff1e11e43"><div class="ttname"><a href="classConnStateData.html#a5d7e0e5953fa47b1f66af94ff1e11e43">ConnStateData::sslCommonName_</a></div><div class="ttdeci">SBuf sslCommonName_</div><div class="ttdoc">CN name for SSL certificate generation.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00487">client_side.h:487</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a619aca0ed2a6bc79fc247b427c02c56b"><div class="ttname"><a href="classConnStateData.html#a619aca0ed2a6bc79fc247b427c02c56b">ConnStateData::resetSslCommonName</a></div><div class="ttdeci">void resetSslCommonName(const char *name)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00293">client_side.h:293</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a6341ca5b4d4ef0913c5008d47a406eae"><div class="ttname"><a href="classConnStateData.html#a6341ca5b4d4ef0913c5008d47a406eae">ConnStateData::afterClientWrite</a></div><div class="ttdeci">void afterClientWrite(size_t) override</div><div class="ttdoc">processing to sync state after a Comm::Write()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00983">client_side.cc:983</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a6364a30db9acc7c576c99fcdc52ba8b7"><div class="ttname"><a href="classConnStateData.html#a6364a30db9acc7c576c99fcdc52ba8b7">ConnStateData::doneWithControlMsg</a></div><div class="ttdeci">void doneWithControlMsg() override</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03648">client_side.cc:3648</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a66927b5570f7ee51400c0bca0751cee6"><div class="ttname"><a href="classConnStateData.html#a66927b5570f7ee51400c0bca0751cee6">ConnStateData::terminateAll</a></div><div class="ttdeci">void terminateAll(const Error &amp;, const LogTagsErrors &amp;) override</div><div class="ttdoc">abort any pending transactions and prevent new ones (by closing)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03907">client_side.cc:3907</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a69398fab21143d6e59b3a895caac3b6f"><div class="ttname"><a href="classConnStateData.html#a69398fab21143d6e59b3a895caac3b6f">ConnStateData::abortChunkedRequestBody</a></div><div class="ttdeci">void abortChunkedRequestBody(const err_type error)</div><div class="ttdoc">quit on errors related to chunked request body handling</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02034">client_side.cc:2034</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a694a73187eca3df02a099e60deff2b52"><div class="ttname"><a href="classConnStateData.html#a694a73187eca3df02a099e60deff2b52">ConnStateData::pinConnection</a></div><div class="ttdeci">void pinConnection(const Comm::ConnectionPointer &amp;pinServerConn, const HttpRequest &amp;request)</div><div class="ttdoc">Forward future client requests using the given server connection.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03699">client_side.cc:3699</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a6c10d6b2f8d50beaf9d32a6790c80a40"><div class="ttname"><a href="classConnStateData.html#a6c10d6b2f8d50beaf9d32a6790c80a40">ConnStateData::preservingClientData_</a></div><div class="ttdeci">bool preservingClientData_</div><div class="ttdoc">whether preservedClientData is valid and should be kept up to date</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00434">client_side.h:434</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a6fff1958cbee2ad5df8e5dc2c7cd1cda"><div class="ttname"><a href="classConnStateData.html#a6fff1958cbee2ad5df8e5dc2c7cd1cda">ConnStateData::callException</a></div><div class="ttdeci">void callException(const std::exception &amp;) override</div><div class="ttdoc">called when the job throws during an async call</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00615">client_side.cc:615</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a76db475761b01f59c02714670741fc90"><div class="ttname"><a href="classConnStateData.html#a76db475761b01f59c02714670741fc90">ConnStateData::sslCrtdHandleReplyWrapper</a></div><div class="ttdeci">static void sslCrtdHandleReplyWrapper(void *data, const Helper::Reply &amp;reply)</div><div class="ttdoc">Callback function. It is called when squid receive message from ssl_crtd.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02521">client_side.cc:2521</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a77178d9a4cfa208cb5bc71967e62ab79"><div class="ttname"><a href="classConnStateData.html#a77178d9a4cfa208cb5bc71967e62ab79">ConnStateData::lifetimeTimeout</a></div><div class="ttdeci">void lifetimeTimeout(const CommTimeoutCbParams &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02101">client_side.cc:2101</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a7941639cfdec70f4e4cec38abee800f1"><div class="ttname"><a href="classConnStateData.html#a7941639cfdec70f4e4cec38abee800f1">ConnStateData::signAlgorithm</a></div><div class="ttdeci">Ssl::CertSignAlgorithm signAlgorithm</div><div class="ttdoc">The signing algorithm to use.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00495">client_side.h:495</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a7d732f536835dc59e3f85e635e76598c"><div class="ttname"><a href="classConnStateData.html#a7d732f536835dc59e3f85e635e76598c">ConnStateData::getTlsContextFromCache</a></div><div class="ttdeci">Security::ContextPointer getTlsContextFromCache(const SBuf &amp;cacheKey, const Ssl::CertificateProperties &amp;certProperties)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02647">client_side.cc:2647</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a7f762686d33660c311ee33b8545a9759"><div class="ttname"><a href="classConnStateData.html#a7f762686d33660c311ee33b8545a9759">ConnStateData::tlsConnectPort</a></div><div class="ttdeci">AnyP::Port tlsConnectPort</div><div class="ttdoc">The TLS server port number as passed in the CONNECT request.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00486">client_side.h:486</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a7f95d063c54bfa6618b5d45869b5c21b"><div class="ttname"><a href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">ConnStateData::flags</a></div><div class="ttdeci">struct ConnStateData::@28 flags</div></div>
<div class="ttc" id="aclassConnStateData_html_a80471064340d6433f759488865310b4d"><div class="ttname"><a href="classConnStateData.html#a80471064340d6433f759488865310b4d">ConnStateData::auth_</a></div><div class="ttdeci">Auth::UserRequest::Pointer auth_</div><div class="ttdoc">some user details that can be used to perform authentication on this connection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00474">client_side.h:474</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a8051bf5fae85b96135b3e1e9bb767690"><div class="ttname"><a href="classConnStateData.html#a8051bf5fae85b96135b3e1e9bb767690">ConnStateData::borrowPinnedConnection</a></div><div class="ttdeci">Comm::ConnectionPointer borrowPinnedConnection(HttpRequest *, const AccessLogEntryPointer &amp;)</div><div class="ttdoc">ConnStateData-specific part of BorrowPinnedConnection()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03836">client_side.cc:3836</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a847fd8d20965e6c7dd56c1cdab67ea90"><div class="ttname"><a href="classConnStateData.html#a847fd8d20965e6c7dd56c1cdab67ea90">ConnStateData::shouldPreserveClientData</a></div><div class="ttdeci">bool shouldPreserveClientData() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03969">client_side.cc:3969</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a849eb5ad88b43ff7aa44d1b53620ca27"><div class="ttname"><a href="classConnStateData.html#a849eb5ad88b43ff7aa44d1b53620ca27">ConnStateData::parseTlsHandshake</a></div><div class="ttdeci">void parseTlsHandshake()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02825">client_side.cc:2825</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a89c4a9371afb6c0a45be3c0c1b0cb4f6"><div class="ttname"><a href="classConnStateData.html#a89c4a9371afb6c0a45be3c0c1b0cb4f6">ConnStateData::notePinnedConnectionBecameIdle</a></div><div class="ttdeci">void notePinnedConnectionBecameIdle(PinnedIdleContext pic)</div><div class="ttdoc">Called when a pinned connection becomes available for forwarding the next request.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03684">client_side.cc:3684</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a89ec5bbe58098706c5b5219432c33aef"><div class="ttname"><a href="classConnStateData.html#a89ec5bbe58098706c5b5219432c33aef">ConnStateData::stopPinnedConnectionMonitoring</a></div><div class="ttdeci">void stopPinnedConnectionMonitoring()</div><div class="ttdoc">The caller assumes responsibility for connection closure detection.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03755">client_side.cc:3755</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a8a118895aaccb8b055f9d9b907475a6d"><div class="ttname"><a href="classConnStateData.html#a8a118895aaccb8b055f9d9b907475a6d">ConnStateData::pinBusyConnection</a></div><div class="ttdeci">void pinBusyConnection(const Comm::ConnectionPointer &amp;pinServerConn, const HttpRequest::Pointer &amp;request)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03678">client_side.cc:3678</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a8c49dcd65230f89186098014ad03ebeb"><div class="ttname"><a href="classConnStateData.html#a8c49dcd65230f89186098014ad03ebeb">ConnStateData::handleIdleClientPinnedTlsRead</a></div><div class="ttdeci">bool handleIdleClientPinnedTlsRead()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03765">client_side.cc:3765</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a8cd416724951295b4758f7a5921abfc1"><div class="ttname"><a href="classConnStateData.html#a8cd416724951295b4758f7a5921abfc1">ConnStateData::proxyProtocolError</a></div><div class="ttdeci">bool proxyProtocolError(const char *reason)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01778">client_side.cc:1778</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a8d4968d64111a5355f5cbcd8aaa154c6"><div class="ttname"><a href="classConnStateData.html#a8d4968d64111a5355f5cbcd8aaa154c6">ConnStateData::serveDelayedError</a></div><div class="ttdeci">bool serveDelayedError(Http::Stream *)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01443">client_side.cc:1443</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a91a16739a0d5277fb2af4f54f5baf5f5"><div class="ttname"><a href="classConnStateData.html#a91a16739a0d5277fb2af4f54f5baf5f5">ConnStateData::preservedClientData</a></div><div class="ttdeci">SBuf preservedClientData</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00349">client_side.h:349</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a97dd48eb3cc7bdf5b33053afe7bb7c94"><div class="ttname"><a href="classConnStateData.html#a97dd48eb3cc7bdf5b33053afe7bb7c94">ConnStateData::stoppedSending_</a></div><div class="ttdeci">const char * stoppedSending_</div><div class="ttdoc">the reason why we no longer write the response or nil</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00499">client_side.h:499</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a99d824cc6cc7b3a71c3d9b094fd5cf77"><div class="ttname"><a href="classConnStateData.html#a99d824cc6cc7b3a71c3d9b094fd5cf77">ConnStateData::resetReadTimeout</a></div><div class="ttdeci">void resetReadTimeout(time_t timeout)</div><div class="ttdoc">(re)sets timeout for receiving more bytes from the client</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00574">client_side.cc:574</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a9e0315c5e20354949908e4ccd65011cb"><div class="ttname"><a href="classConnStateData.html#a9e0315c5e20354949908e4ccd65011cb">ConnStateData::quitAfterError</a></div><div class="ttdeci">void quitAfterError(HttpRequest *request)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01431">client_side.cc:1431</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aa4b38531a764b5f8bff7a8c92e578f9d"><div class="ttname"><a href="classConnStateData.html#aa4b38531a764b5f8bff7a8c92e578f9d">ConnStateData::tlsConnectHostOrIp</a></div><div class="ttdeci">SBuf tlsConnectHostOrIp</div><div class="ttdoc">The TLS server host name appears in CONNECT request or the server ip address for the intercepted requ...</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00485">client_side.h:485</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aa859a8faf2797fcdf46be1e63850b522"><div class="ttname"><a href="classConnStateData.html#aa859a8faf2797fcdf46be1e63850b522">ConnStateData::~ConnStateData</a></div><div class="ttdeci">~ConnStateData() override</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00647">client_side.cc:647</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aa891eb1dafb6ef7c0eefb8b1bf4fa737"><div class="ttname"><a href="classConnStateData.html#aa891eb1dafb6ef7c0eefb8b1bf4fa737">ConnStateData::receivedFirstByte</a></div><div class="ttdeci">void receivedFirstByte() override</div><div class="ttdoc">Update flags and timeout after the first byte received.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01824">client_side.cc:1824</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aa8e7d3c1f7073ef1bcd21f91d53167a6"><div class="ttname"><a href="classConnStateData.html#aa8e7d3c1f7073ef1bcd21f91d53167a6">ConnStateData::parsedBumpedRequestCount</a></div><div class="ttdeci">uint64_t parsedBumpedRequestCount</div><div class="ttdoc">The number of parsed HTTP requests headers on a bumped client connection.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00481">client_side.h:481</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aac6c6dfba90e4a817ad4f27204174a9c"><div class="ttname"><a href="classConnStateData.html#aac6c6dfba90e4a817ad4f27204174a9c">ConnStateData::acceptTls</a></div><div class="ttdeci">Security::IoResult acceptTls()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02220">client_side.cc:2220</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aadb0eaf2848509b73859a3bf509efc67"><div class="ttname"><a href="classConnStateData.html#aadb0eaf2848509b73859a3bf509efc67">ConnStateData::expectRequestBody</a></div><div class="ttdeci">BodyPipe::Pointer expectRequestBody(int64_t size)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03522">client_side.cc:3522</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aae4adb4bf5a824a62fed25c284b56a8b"><div class="ttname"><a href="classConnStateData.html#aae4adb4bf5a824a62fed25c284b56a8b">ConnStateData::switchedToHttps_</a></div><div class="ttdeci">bool switchedToHttps_</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00478">client_side.h:478</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aaeed787292abe965e062beadfe35ea42"><div class="ttname"><a href="classConnStateData.html#aaeed787292abe965e062beadfe35ea42">ConnStateData::isOpen</a></div><div class="ttdeci">bool isOpen() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00640">client_side.cc:640</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ab07ada10d17a89e0df7bf85e78229925"><div class="ttname"><a href="classConnStateData.html#ab07ada10d17a89e0df7bf85e78229925">ConnStateData::clientPinnedConnectionRead</a></div><div class="ttdeci">void clientPinnedConnectionRead(const CommIoCbParams &amp;io)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03807">client_side.cc:3807</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ab0a284b84d7ffec03db178d67bb810d8"><div class="ttname"><a href="classConnStateData.html#ab0a284b84d7ffec03db178d67bb810d8">ConnStateData::BorrowPinnedConnection</a></div><div class="ttdeci">static Comm::ConnectionPointer BorrowPinnedConnection(HttpRequest *, const AccessLogEntryPointer &amp;)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03867">client_side.cc:3867</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ab0b6b47377ef5853fc9c22e3ae62f1f8"><div class="ttname"><a href="classConnStateData.html#ab0b6b47377ef5853fc9c22e3ae62f1f8">ConnStateData::stopReceiving</a></div><div class="ttdeci">void stopReceiving(const char *error)</div><div class="ttdoc">note request receiving error and close as soon as we write the response</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03551">client_side.cc:3551</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ab4bed752a0b6a81679cdb594f98e7022"><div class="ttname"><a href="classConnStateData.html#ab4bed752a0b6a81679cdb594f98e7022">ConnStateData::log_addr</a></div><div class="ttdeci">Ip::Address log_addr</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00136">client_side.h:136</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ab50872ed0917e572c6191a522e8210b0"><div class="ttname"><a href="classConnStateData.html#ab50872ed0917e572c6191a522e8210b0">ConnStateData::checkLogging</a></div><div class="ttdeci">void checkLogging()</div><div class="ttdoc">log the last (attempt at) transaction if nobody else did</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03950">client_side.cc:3950</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ab538ca8c4b7cf767362cbce8e95a93ce"><div class="ttname"><a href="classConnStateData.html#ab538ca8c4b7cf767362cbce8e95a93ce">ConnStateData::unpinConnection</a></div><div class="ttdeci">void unpinConnection(const bool andClose)</div><div class="ttdoc">Undo pinConnection() and, optionally, close the pinned connection.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03879">client_side.cc:3879</a></div></div>
<div class="ttc" id="aclassConnStateData_html_abad0e63a39973dc6b6e6db437a68e697"><div class="ttname"><a href="classConnStateData.html#abad0e63a39973dc6b6e6db437a68e697">ConnStateData::handleSslBumpHandshakeError</a></div><div class="ttdeci">void handleSslBumpHandshakeError(const Security::IoResult &amp;)</div><div class="ttdoc">process a problematic Security::Accept() result on the SslBump code path</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03020">client_side.cc:3020</a></div></div>
<div class="ttc" id="aclassConnStateData_html_abb884f3561ead905fcfd7f47e463ad8e"><div class="ttname"><a href="classConnStateData.html#abb884f3561ead905fcfd7f47e463ad8e">ConnStateData::startDechunkingRequest</a></div><div class="ttdeci">void startDechunkingRequest()</div><div class="ttdoc">initialize dechunking state</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03581">client_side.cc:3581</a></div></div>
<div class="ttc" id="aclassConnStateData_html_abbfb5c2cf9071ecb5e439cb26de14218"><div class="ttname"><a href="classConnStateData.html#abbfb5c2cf9071ecb5e439cb26de14218">ConnStateData::startPeekAndSplice</a></div><div class="ttdeci">void startPeekAndSplice()</div><div class="ttdoc">Initializes and starts a peek-and-splice negotiation with the SSL client.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02964">client_side.cc:2964</a></div></div>
<div class="ttc" id="aclassConnStateData_html_abca96f1a2792ad7128762d1dac280cd6"><div class="ttname"><a href="classConnStateData.html#abca96f1a2792ad7128762d1dac280cd6">ConnStateData::sslBumpMode</a></div><div class="ttdeci">Ssl::BumpMode sslBumpMode</div><div class="ttdoc">ssl_bump decision (Ssl::bumpEnd if n/a).</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00304">client_side.h:304</a></div></div>
<div class="ttc" id="aclassConnStateData_html_abdd47e67edfe3760ed0fffea8d45bc25"><div class="ttname"><a href="classConnStateData.html#abdd47e67edfe3760ed0fffea8d45bc25">ConnStateData::concurrentRequestQueueFilled</a></div><div class="ttdeci">bool concurrentRequestQueueFilled() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01730">client_side.cc:1730</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac049eac9adf044f1310c48e058778f6d"><div class="ttname"><a href="classConnStateData.html#ac049eac9adf044f1310c48e058778f6d">ConnStateData::readMore</a></div><div class="ttdeci">bool readMore</div><div class="ttdoc">needs comm_read (for this request or new requests)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00139">client_side.h:139</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac17896e9d6f07308b7e75f49bec92810"><div class="ttname"><a href="classConnStateData.html#ac17896e9d6f07308b7e75f49bec92810">ConnStateData::ConnStateData</a></div><div class="ttdeci">ConnStateData(const MasterXactionPointer &amp;xact)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02111">client_side.cc:2111</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac21b0b5b9986f9088bcfc68016760454"><div class="ttname"><a href="classConnStateData.html#ac21b0b5b9986f9088bcfc68016760454">ConnStateData::extendLifetime</a></div><div class="ttdeci">void extendLifetime()</div><div class="ttdoc">(re)sets client_lifetime timeout</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00582">client_side.cc:582</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac355e8d0cc9e2d04851d44e9f4cd40e8"><div class="ttname"><a href="classConnStateData.html#ac355e8d0cc9e2d04851d44e9f4cd40e8">ConnStateData::proxyProtocolHeader_</a></div><div class="ttdeci">ProxyProtocol::HeaderPointer proxyProtocolHeader_</div><div class="ttdoc">the parsed PROXY protocol header</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00470">client_side.h:470</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac5a3dd64c021c6dfacdb86af0b3e90a6"><div class="ttname"><a href="classConnStateData.html#ac5a3dd64c021c6dfacdb86af0b3e90a6">ConnStateData::shouldCloseOnEof</a></div><div class="ttdeci">bool shouldCloseOnEof() const override</div><div class="ttdoc">whether to stop serving our client after reading EOF on its connection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01389">client_side.cc:1389</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac5c1df3a5c953078cb431edfe31c413a"><div class="ttname"><a href="classConnStateData.html#ac5c1df3a5c953078cb431edfe31c413a">ConnStateData::fillChecklist</a></div><div class="ttdeci">void fillChecklist(ACLFilledChecklist &amp;) const override</div><div class="ttdoc">configure the given checklist (to reflect the current transaction state)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03482">client_side.cc:3482</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac6d7b7b78efcf4f132f32fc88d96711e"><div class="ttname"><a href="classConnStateData.html#ac6d7b7b78efcf4f132f32fc88d96711e">ConnStateData::requestTimeout</a></div><div class="ttdeci">void requestTimeout(const CommTimeoutCbParams &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02078">client_side.cc:2078</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ac77da03e4e8e0e9d8365fc84e425bdfa"><div class="ttname"><a href="classConnStateData.html#ac77da03e4e8e0e9d8365fc84e425bdfa">ConnStateData::whenClientIpKnown</a></div><div class="ttdeci">void whenClientIpKnown()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02167">client_side.cc:2167</a></div></div>
<div class="ttc" id="aclassConnStateData_html_acd87648b0f6ad8b909cb17be57c493b1"><div class="ttname"><a href="classConnStateData.html#acd87648b0f6ad8b909cb17be57c493b1">ConnStateData::idleTimeout</a></div><div class="ttdeci">virtual time_t idleTimeout() const =0</div><div class="ttdoc">timeout to use when waiting for the next request</div></div>
<div class="ttc" id="aclassConnStateData_html_ad424e6c4c64842378e58b154b8ff7a7c"><div class="ttname"><a href="classConnStateData.html#ad424e6c4c64842378e58b154b8ff7a7c">ConnStateData::finishDechunkingRequest</a></div><div class="ttdeci">void finishDechunkingRequest(bool withSuccess)</div><div class="ttdoc">put parsed content into input buffer and clean up</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03591">client_side.cc:3591</a></div></div>
<div class="ttc" id="aclassConnStateData_html_adaa0bde9ddda622229fb75a904df02d4"><div class="ttname"><a href="classConnStateData.html#adaa0bde9ddda622229fb75a904df02d4">ConnStateData::processParsedRequest</a></div><div class="ttdeci">virtual void processParsedRequest(Http::StreamPointer &amp;)=0</div><div class="ttdoc">start processing a freshly parsed request</div></div>
<div class="ttc" id="aclassConnStateData_html_adaab9f8d5435e788b0d1c88a6dd4dcb4"><div class="ttname"><a href="classConnStateData.html#adaab9f8d5435e788b0d1c88a6dd4dcb4">ConnStateData::getSslContextDone</a></div><div class="ttdeci">void getSslContextDone(Security::ContextPointer &amp;)</div><div class="ttdoc">finish configuring the newly created SSL context&quot;</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02735">client_side.cc:2735</a></div></div>
<div class="ttc" id="aclassConnStateData_html_adab0bccf258e880e707090d504a881fa"><div class="ttname"><a href="classConnStateData.html#adab0bccf258e880e707090d504a881fa">ConnStateData::transparent</a></div><div class="ttdeci">bool transparent() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03516">client_side.cc:3516</a></div></div>
<div class="ttc" id="aclassConnStateData_html_adbe8b3f0075d4ba6c7a0ac7c62b43a23"><div class="ttname"><a href="classConnStateData.html#adbe8b3f0075d4ba6c7a0ac7c62b43a23">ConnStateData::parsingTlsHandshake</a></div><div class="ttdeci">bool parsingTlsHandshake</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00479">client_side.h:479</a></div></div>
<div class="ttc" id="aclassConnStateData_html_adfaf6853b9b2b580e8ba6f45292a07a3"><div class="ttname"><a href="classConnStateData.html#adfaf6853b9b2b580e8ba6f45292a07a3">ConnStateData::parseProxyProtocolHeader</a></div><div class="ttdeci">bool parseProxyProtocolHeader()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01799">client_side.cc:1799</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae06c387dd773449597078259a953013b"><div class="ttname"><a href="classConnStateData.html#ae06c387dd773449597078259a953013b">ConnStateData::port</a></div><div class="ttdeci">AnyP::Port port</div><div class="ttdoc">destination port of the request that caused serverConnection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00145">client_side.h:145</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae0ab21b98499a47569207ea2146ebe80"><div class="ttname"><a href="classConnStateData.html#ae0ab21b98499a47569207ea2146ebe80">ConnStateData::handleRequestBodyData</a></div><div class="ttdeci">bool handleRequestBodyData()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01954">client_side.cc:1954</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae28816c3d0d956810c7f67d11881f48d"><div class="ttname"><a href="classConnStateData.html#ae28816c3d0d956810c7f67d11881f48d">ConnStateData::updateError</a></div><div class="ttdeci">void updateError(const Error &amp;)</div><div class="ttdoc">if necessary, stores new error information (if any)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00628">client_side.cc:628</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae33befbd46050504b12953d75a807231"><div class="ttname"><a href="classConnStateData.html#ae33befbd46050504b12953d75a807231">ConnStateData::doPeekAndSpliceStep</a></div><div class="ttdeci">void doPeekAndSpliceStep()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03056">client_side.cc:3056</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae37f30536c4a7ab66385bec18d1f02ec"><div class="ttname"><a href="classConnStateData.html#ae37f30536c4a7ab66385bec18d1f02ec">ConnStateData::stoppedReceiving_</a></div><div class="ttdeci">const char * stoppedReceiving_</div><div class="ttdoc">the reason why we no longer read the request or nil</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00501">client_side.h:501</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae3fb2cba948d6b47e86e6464a96b1191"><div class="ttname"><a href="classConnStateData.html#ae3fb2cba948d6b47e86e6464a96b1191">ConnStateData::needProxyProtocolHeader_</a></div><div class="ttdeci">bool needProxyProtocolHeader_</div><div class="ttdoc">whether PROXY protocol header is still expected</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00467">client_side.h:467</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae41a2f60162e48d848dcb535fa1ab2ff"><div class="ttname"><a href="classConnStateData.html#ae41a2f60162e48d848dcb535fa1ab2ff">ConnStateData::noteBodyConsumerAborted</a></div><div class="ttdeci">void noteBodyConsumerAborted(BodyPipe::Pointer) override=0</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02067">client_side.cc:2067</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae85c6fd07a8415d08b9672de277ee24e"><div class="ttname"><a href="classConnStateData.html#ae85c6fd07a8415d08b9672de277ee24e">ConnStateData::tunnelOnError</a></div><div class="ttdeci">bool tunnelOnError(const err_type)</div><div class="ttdoc">initiate tunneling if possible or return false otherwise</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01521">client_side.cc:1521</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae8f9e3c4f202d0dace53b434ca29c8c0"><div class="ttname"><a href="classConnStateData.html#ae8f9e3c4f202d0dace53b434ca29c8c0">ConnStateData::stopSending</a></div><div class="ttdeci">void stopSending(const char *error)</div><div class="ttdoc">note response sending error and close as soon as we read the request</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00959">client_side.cc:959</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aec04ec17951deaf98852074bef3c171b"><div class="ttname"><a href="classConnStateData.html#aec04ec17951deaf98852074bef3c171b">ConnStateData::mayNeedToReadMoreBody</a></div><div class="ttdeci">int64_t mayNeedToReadMoreBody() const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03533">client_side.cc:3533</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aed9e73994565e139000ffcd900575fd9"><div class="ttname"><a href="classConnStateData.html#aed9e73994565e139000ffcd900575fd9">ConnStateData::host</a></div><div class="ttdeci">char * host</div><div class="ttdoc">host name of pinned connection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00144">client_side.h:144</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aedb54ea087dba0ed0294345997c8f4d6"><div class="ttname"><a href="classConnStateData.html#aedb54ea087dba0ed0294345997c8f4d6">ConnStateData::tlsParser</a></div><div class="ttdeci">Security::HandshakeParser tlsParser</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00308">client_side.h:308</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aeeff473d4b7444f702f1402292c48d42"><div class="ttname"><a href="classConnStateData.html#aeeff473d4b7444f702f1402292c48d42">ConnStateData::storeTlsContextToCache</a></div><div class="ttdeci">void storeTlsContextToCache(const SBuf &amp;cacheKey, Security::ContextPointer &amp;ctx)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02665">client_side.cc:2665</a></div></div>
<div class="ttc" id="aclassConnStateData_html_aeff8387932f77bdb4957099a4528f73e"><div class="ttname"><a href="classConnStateData.html#aeff8387932f77bdb4957099a4528f73e">ConnStateData::stoppedSending</a></div><div class="ttdeci">const char * stoppedSending() const</div><div class="ttdoc">true if we stopped sending the response</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00161">client_side.h:161</a></div></div>
<div class="ttc" id="aclassConnStateData_html_af216ff3d98bb3b3a1ec114e3673393fa"><div class="ttname"><a href="classConnStateData.html#af216ff3d98bb3b3a1ec114e3673393fa">ConnStateData::sslBumpCertKey</a></div><div class="ttdeci">SBuf sslBumpCertKey</div><div class="ttdoc">Key to use to store/retrieve generated certificate.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00491">client_side.h:491</a></div></div>
<div class="ttc" id="aclassConnStateData_html_af5748f5afc6582d105773c5b9e1a3d5d"><div class="ttname"><a href="classConnStateData.html#af5748f5afc6582d105773c5b9e1a3d5d">ConnStateData::notes</a></div><div class="ttdeci">NotePairs::Pointer notes()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l04001">client_side.cc:4001</a></div></div>
<div class="ttc" id="aclassConnStateData_html_af656fdc7cb06c43cb4b2330ce2b0c755"><div class="ttname"><a href="classConnStateData.html#af656fdc7cb06c43cb4b2330ce2b0c755">ConnStateData::bodyParser</a></div><div class="ttdeci">Http1::TeChunkedParser * bodyParser</div><div class="ttdoc">parses HTTP/1.1 chunked request body</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00108">client_side.h:108</a></div></div>
<div class="ttc" id="aclassConnStateData_html_af8d67b3cbbe0c7b9b61afbd59070ca93"><div class="ttname"><a href="classConnStateData.html#af8d67b3cbbe0c7b9b61afbd59070ca93">ConnStateData::fillConnectionLevelDetails</a></div><div class="ttdeci">void fillConnectionLevelDetails(ACLFilledChecklist &amp;) const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03499">client_side.cc:3499</a></div></div>
<div class="ttc" id="aclassConnStateData_html_af9e7fb8e222868389b301344c4585b5a"><div class="ttname"><a href="classConnStateData.html#af9e7fb8e222868389b301344c4585b5a">ConnStateData::theNotes</a></div><div class="ttdeci">NotePairs::Pointer theNotes</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00505">client_side.h:505</a></div></div>
<div class="ttc" id="aclassConnStateData_html_afaf0833711797e0b502ce8b4d59df6ab"><div class="ttname"><a href="classConnStateData.html#afaf0833711797e0b502ce8b4d59df6ab">ConnStateData::connStateClosed</a></div><div class="ttdeci">void connStateClosed(const CommCloseCbParams &amp;io)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00483">client_side.cc:483</a></div></div>
<div class="ttc" id="aclassConnStateData_html_afb1bfcf4b5632bc9be148767f1b1dedb"><div class="ttname"><a href="classConnStateData.html#afb1bfcf4b5632bc9be148767f1b1dedb">ConnStateData::proxyProtocolValidateClient</a></div><div class="ttdeci">bool proxyProtocolValidateClient()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01759">client_side.cc:1759</a></div></div>
<div class="ttc" id="aclassConnStateData_html_afcb7d56815832d278dabcdf5fc601dcb"><div class="ttname"><a href="classConnStateData.html#afcb7d56815832d278dabcdf5fc601dcb">ConnStateData::add</a></div><div class="ttdeci">void add(const Http::StreamPointer &amp;context)</div><div class="ttdoc">registers a newly created stream</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01702">client_side.cc:1702</a></div></div>
<div class="ttc" id="aclassConnStateData_html_afdc562359cb07fafe88a73eaf9ec6e6a"><div class="ttname"><a href="classConnStateData.html#afdc562359cb07fafe88a73eaf9ec6e6a">ConnStateData::buildSslCertGenerationParams</a></div><div class="ttdeci">void buildSslCertGenerationParams(Ssl::CertificateProperties &amp;certProperties)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02571">client_side.cc:2571</a></div></div>
<div class="ttc" id="aclassDebug_html_a44b82c996aedfa84dd8b61427f393e42"><div class="ttname"><a href="classDebug.html#a44b82c996aedfa84dd8b61427f393e42">Debug::Enabled</a></div><div class="ttdeci">static bool Enabled(const int section, const int level)</div><div class="ttdoc">whether debugging the given section and the given level produces output</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00075">Stream.h:75</a></div></div>
<div class="ttc" id="aclassDebug_html_a469eccf6573cacd9bc0682d3fc0eaf11"><div class="ttname"><a href="classDebug.html#a469eccf6573cacd9bc0682d3fc0eaf11">Debug::Extra</a></div><div class="ttdeci">static std::ostream &amp; Extra(std::ostream &amp;)</div><div class="ttdef"><b>Definition</b> <a href="src_2debug_2debug_8cc_source.html#l01316">debug.cc:1316</a></div></div>
<div class="ttc" id="aclassErrorState_html"><div class="ttname"><a href="classErrorState.html">ErrorState</a></div><div class="ttdef"><b>Definition</b> <a href="errorpage_8h_source.html#l00088">errorpage.h:89</a></div></div>
<div class="ttc" id="aclassErrorState_html_a04f86c86cccfd0cd52bda8075fc90ae4"><div class="ttname"><a href="classErrorState.html#a04f86c86cccfd0cd52bda8075fc90ae4">ErrorState::NewForwarding</a></div><div class="ttdeci">static ErrorState * NewForwarding(err_type, HttpRequestPointer &amp;, const AccessLogEntryPointer &amp;)</div><div class="ttdoc">Creates a general request forwarding error with the right http_status.</div><div class="ttdef"><b>Definition</b> <a href="errorpage_8cc_source.html#l00691">errorpage.cc:691</a></div></div>
<div class="ttc" id="aclassError_html"><div class="ttname"><a href="classError.html">Error</a></div><div class="ttdoc">a transaction problem</div><div class="ttdef"><b>Definition</b> <a href="Error_8h_source.html#l00027">Error.h:27</a></div></div>
<div class="ttc" id="aclassError_html_a6e163b6a5a08adf7f23ea363d8935ee3"><div class="ttname"><a href="classError.html#a6e163b6a5a08adf7f23ea363d8935ee3">Error::update</a></div><div class="ttdeci">void update(const Error &amp;)</div><div class="ttdoc">if necessary, stores the given error information (if any)</div><div class="ttdef"><b>Definition</b> <a href="Error_8cc_source.html#l00051">Error.cc:51</a></div></div>
<div class="ttc" id="aclassError_html_ad7428d246e004f2aeec1590cf501ec74"><div class="ttname"><a href="classError.html#ad7428d246e004f2aeec1590cf501ec74">Error::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">switch to the default &quot;no error information&quot; state</div><div class="ttdef"><b>Definition</b> <a href="Error_8h_source.html#l00053">Error.h:53</a></div></div>
<div class="ttc" id="aclassExceptionErrorDetail_html"><div class="ttname"><a href="classExceptionErrorDetail.html">ExceptionErrorDetail</a></div><div class="ttdef"><b>Definition</b> <a href="ExceptionErrorDetail_8h_source.html#l00022">ExceptionErrorDetail.h:23</a></div></div>
<div class="ttc" id="aclassFwdState_html_a391d66921577e62e543723f978062e97"><div class="ttname"><a href="classFwdState.html#a391d66921577e62e543723f978062e97">FwdState::Start</a></div><div class="ttdeci">static void Start(const Comm::ConnectionPointer &amp;client, StoreEntry *, HttpRequest *, const AccessLogEntryPointer &amp;alp)</div><div class="ttdoc">Initiates request forwarding to a peer or origin server.</div><div class="ttdef"><b>Definition</b> <a href="FwdState_8cc_source.html#l00338">FwdState.cc:338</a></div></div>
<div class="ttc" id="aclassHelper_1_1Reply_html"><div class="ttname"><a href="classHelper_1_1Reply.html">Helper::Reply</a></div><div class="ttdef"><b>Definition</b> <a href="Reply_8h_source.html#l00029">Reply.h:30</a></div></div>
<div class="ttc" id="aclassHelper_1_1Reply_html_a9c644b392f1fea31662c2532c25ebaa4"><div class="ttname"><a href="classHelper_1_1Reply.html#a9c644b392f1fea31662c2532c25ebaa4">Helper::Reply::result</a></div><div class="ttdeci">Helper::ResultCode result</div><div class="ttdoc">The helper response 'result' field.</div><div class="ttdef"><b>Definition</b> <a href="Reply_8h_source.html#l00059">Reply.h:59</a></div></div>
<div class="ttc" id="aclassHelper_1_1Reply_html_aa229360b4f0721acd012d1014547d8cc"><div class="ttname"><a href="classHelper_1_1Reply.html#aa229360b4f0721acd012d1014547d8cc">Helper::Reply::other</a></div><div class="ttdeci">const MemBuf &amp; other() const</div><div class="ttdef"><b>Definition</b> <a href="Reply_8h_source.html#l00042">Reply.h:42</a></div></div>
<div class="ttc" id="aclassHierarchyLogEntry_html"><div class="ttname"><a href="classHierarchyLogEntry.html">HierarchyLogEntry</a></div><div class="ttdef"><b>Definition</b> <a href="HierarchyLogEntry_8h_source.html#l00023">HierarchyLogEntry.h:24</a></div></div>
<div class="ttc" id="aclassHierarchyLogEntry_html_a91f7c81bcfdf9882ff978942c85568f4"><div class="ttname"><a href="classHierarchyLogEntry.html#a91f7c81bcfdf9882ff978942c85568f4">HierarchyLogEntry::ping</a></div><div class="ttdeci">ping_data ping</div><div class="ttdef"><b>Definition</b> <a href="HierarchyLogEntry_8h_source.html#l00048">HierarchyLogEntry.h:48</a></div></div>
<div class="ttc" id="aclassHierarchyLogEntry_html_ac79cc06b0d8333ee14e8cc66d3941e6d"><div class="ttname"><a href="classHierarchyLogEntry.html#ac79cc06b0d8333ee14e8cc66d3941e6d">HierarchyLogEntry::code</a></div><div class="ttdeci">hier_code code</div><div class="ttdef"><b>Definition</b> <a href="HierarchyLogEntry_8h_source.html#l00046">HierarchyLogEntry.h:46</a></div></div>
<div class="ttc" id="aclassHttpControlMsgSink_html_a10a891d78d81fd0683ac76c3d3aa7e6e"><div class="ttname"><a href="classHttpControlMsgSink.html#a10a891d78d81fd0683ac76c3d3aa7e6e">HttpControlMsgSink::cbControlMsgSent</a></div><div class="ttdeci">AsyncCall::Pointer cbControlMsgSent</div><div class="ttdoc">Call to schedule when the control msg has been sent.</div><div class="ttdef"><b>Definition</b> <a href="HttpControlMsg_8h_source.html#l00042">HttpControlMsg.h:42</a></div></div>
<div class="ttc" id="aclassHttpControlMsgSink_html_a4a0ae86dd606efd90dee861258cb3081"><div class="ttname"><a href="classHttpControlMsgSink.html#a4a0ae86dd606efd90dee861258cb3081">HttpControlMsgSink::wroteControlMsg</a></div><div class="ttdeci">void wroteControlMsg(const CommIoCbParams &amp;)</div><div class="ttdoc">callback to handle Comm::Write completion</div><div class="ttdef"><b>Definition</b> <a href="HttpControlMsg_8cc_source.html#l00025">HttpControlMsg.cc:25</a></div></div>
<div class="ttc" id="aclassHttpControlMsgSink_html_adecf27e052bf565c42ba459ff38b0247"><div class="ttname"><a href="classHttpControlMsgSink.html#adecf27e052bf565c42ba459ff38b0247">HttpControlMsgSink::doneWithControlMsg</a></div><div class="ttdeci">virtual void doneWithControlMsg()</div><div class="ttdef"><b>Definition</b> <a href="HttpControlMsg_8cc_source.html#l00015">HttpControlMsg.cc:15</a></div></div>
<div class="ttc" id="aclassHttpControlMsg_html"><div class="ttname"><a href="classHttpControlMsg.html">HttpControlMsg</a></div><div class="ttdoc">bundles HTTP 1xx reply and the &quot;successfully forwarded&quot; callback</div><div class="ttdef"><b>Definition</b> <a href="HttpControlMsg_8h_source.html#l00046">HttpControlMsg.h:47</a></div></div>
<div class="ttc" id="aclassHttpControlMsg_html_a41e5b0b9fadc256124dc226669893ce8"><div class="ttname"><a href="classHttpControlMsg.html#a41e5b0b9fadc256124dc226669893ce8">HttpControlMsg::cbSuccess</a></div><div class="ttdeci">Callback cbSuccess</div><div class="ttdoc">called after successfully writing the 1xx message</div><div class="ttdef"><b>Definition</b> <a href="HttpControlMsg_8h_source.html#l00056">HttpControlMsg.h:56</a></div></div>
<div class="ttc" id="aclassHttpControlMsg_html_a59062ff487258eb32b6f1081db160988"><div class="ttname"><a href="classHttpControlMsg.html#a59062ff487258eb32b6f1081db160988">HttpControlMsg::reply</a></div><div class="ttdeci">HttpReply::Pointer reply</div><div class="ttdoc">the 1xx message being forwarded</div><div class="ttdef"><b>Definition</b> <a href="HttpControlMsg_8h_source.html#l00055">HttpControlMsg.h:55</a></div></div>
<div class="ttc" id="aclassHttpHdrRangeIter_html_ab6e6dd729f76e0e4a34ac1105af0e715"><div class="ttname"><a href="classHttpHdrRangeIter.html#ab6e6dd729f76e0e4a34ac1105af0e715">HttpHdrRangeIter::boundary</a></div><div class="ttdeci">String boundary</div><div class="ttdef"><b>Definition</b> <a href="HttpHeaderRange_8h_source.html#l00106">HttpHeaderRange.h:106</a></div></div>
<div class="ttc" id="aclassHttpHdrRangeSpec_html"><div class="ttname"><a href="classHttpHdrRangeSpec.html">HttpHdrRangeSpec</a></div><div class="ttdef"><b>Definition</b> <a href="HttpHeaderRange_8h_source.html#l00026">HttpHeaderRange.h:27</a></div></div>
<div class="ttc" id="aclassHttpHdrRange_html_a04631e9268ea83022b6c98179d6960c9"><div class="ttname"><a href="classHttpHdrRange.html#a04631e9268ea83022b6c98179d6960c9">HttpHdrRange::iterator</a></div><div class="ttdeci">std::vector&lt; HttpHdrRangeSpec * &gt;::iterator iterator</div><div class="ttdef"><b>Definition</b> <a href="HttpHeaderRange_8h_source.html#l00065">HttpHeaderRange.h:65</a></div></div>
<div class="ttc" id="aclassHttpHdrRange_html_a4caf5a47b28b4f4e141b98e95914fe95"><div class="ttname"><a href="classHttpHdrRange.html#a4caf5a47b28b4f4e141b98e95914fe95">HttpHdrRange::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition</b> <a href="HttpHdrRange_8cc_source.html#l00284">HttpHdrRange.cc:284</a></div></div>
<div class="ttc" id="aclassHttpHdrRange_html_a5eefced91bb33dc3f5a518746238de0e"><div class="ttname"><a href="classHttpHdrRange.html#a5eefced91bb33dc3f5a518746238de0e">HttpHdrRange::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition</b> <a href="HttpHdrRange_8cc_source.html#l00290">HttpHdrRange.cc:290</a></div></div>
<div class="ttc" id="aclassHttpHeader_html"><div class="ttname"><a href="classHttpHeader.html">HttpHeader</a></div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00074">HttpHeader.h:75</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a187949b24278b65f28338947c605b130"><div class="ttname"><a href="classHttpHeader.html#a187949b24278b65f28338947c605b130">HttpHeader::putStr</a></div><div class="ttdeci">void putStr(Http::HdrType id, const char *str)</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01128">HttpHeader.cc:1128</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a390f6c5a57abc40cac483a52464a4b8b"><div class="ttname"><a href="classHttpHeader.html#a390f6c5a57abc40cac483a52464a4b8b">HttpHeader::chunked</a></div><div class="ttdeci">bool chunked() const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00169">HttpHeader.h:169</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a89a87680aa68d7143be79793bcbce500"><div class="ttname"><a href="classHttpHeader.html#a89a87680aa68d7143be79793bcbce500">HttpHeader::getStr</a></div><div class="ttdeci">const char * getStr(Http::HdrType id) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01296">HttpHeader.cc:1296</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_abe3327167942e75a78385e92bc1b26b7"><div class="ttname"><a href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">HttpHeader::has</a></div><div class="ttdeci">int has(Http::HdrType id) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01070">HttpHeader.cc:1070</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_abf9ae83ecee9c6ee5de511131993567b"><div class="ttname"><a href="classHttpHeader.html#abf9ae83ecee9c6ee5de511131993567b">HttpHeader::getInt64</a></div><div class="ttdeci">int64_t getInt64(Http::HdrType id) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01266">HttpHeader.cc:1266</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_ac29e77be1230373c0a0d5d3d1dd2d67d"><div class="ttname"><a href="classHttpHeader.html#ac29e77be1230373c0a0d5d3d1dd2d67d">HttpHeader::clean</a></div><div class="ttdeci">void clean()</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00318">HttpHeader.cc:318</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_ae8065947ee37c85af4d9b98bc9519a98"><div class="ttname"><a href="classHttpHeader.html#ae8065947ee37c85af4d9b98bc9519a98">HttpHeader::packInto</a></div><div class="ttdeci">void packInto(Packable *p, bool mask_sensitive_info=false) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00672">HttpHeader.cc:672</a></div></div>
<div class="ttc" id="aclassHttpReply_html"><div class="ttname"><a href="classHttpReply.html">HttpReply</a></div><div class="ttdef"><b>Definition</b> <a href="HttpReply_8h_source.html#l00024">HttpReply.h:25</a></div></div>
<div class="ttc" id="aclassHttpRequest_html"><div class="ttname"><a href="classHttpRequest.html">HttpRequest</a></div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00048">HttpRequest.h:49</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a0e84a414e1c5857a0d8681f0a9c13317"><div class="ttname"><a href="classHttpRequest.html#a0e84a414e1c5857a0d8681f0a9c13317">HttpRequest::range</a></div><div class="ttdeci">HttpHdrRange * range</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00143">HttpRequest.h:143</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a1f0af82ff15e9a29d15319fc3cf05a54"><div class="ttname"><a href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">HttpRequest::method</a></div><div class="ttdeci">HttpRequestMethod method</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00114">HttpRequest.h:114</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a222ed70d81b4f8846d6512d3e6da69e8"><div class="ttname"><a href="classHttpRequest.html#a222ed70d81b4f8846d6512d3e6da69e8">HttpRequest::myportname</a></div><div class="ttdeci">String myportname</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00172">HttpRequest.h:172</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a494fed99df72f89fc219ad8809f22781"><div class="ttname"><a href="classHttpRequest.html#a494fed99df72f89fc219ad8809f22781">HttpRequest::extacl_user</a></div><div class="ttdeci">String extacl_user</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00176">HttpRequest.h:176</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a52c61e6b8c61c28ff10381895aa114a9"><div class="ttname"><a href="classHttpRequest.html#a52c61e6b8c61c28ff10381895aa114a9">HttpRequest::multipartRangeRequest</a></div><div class="ttdeci">bool multipartRangeRequest() const</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00431">HttpRequest.cc:431</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a5c031f584be4a77277cccd49b0d4cea1"><div class="ttname"><a href="classHttpRequest.html#a5c031f584be4a77277cccd49b0d4cea1">HttpRequest::hier</a></div><div class="ttdeci">HierarchyLogEntry hier</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00157">HttpRequest.h:157</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a76422841293a4230a1a76479e6964c04"><div class="ttname"><a href="classHttpRequest.html#a76422841293a4230a1a76479e6964c04">HttpRequest::flags</a></div><div class="ttdeci">RequestFlags flags</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00141">HttpRequest.h:141</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a88c3369b97fa30b60dc234b21dda9b91"><div class="ttname"><a href="classHttpRequest.html#a88c3369b97fa30b60dc234b21dda9b91">HttpRequest::notes</a></div><div class="ttdeci">NotePairs::Pointer notes()</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00749">HttpRequest.cc:749</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a8b90084ccd19905f1fc8eebc9ff3a60e"><div class="ttname"><a href="classHttpRequest.html#a8b90084ccd19905f1fc8eebc9ff3a60e">HttpRequest::vary_headers</a></div><div class="ttdeci">SBuf vary_headers</div><div class="ttdoc">The variant second-stage cache key. Generated from Vary header pattern for this request.</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00168">HttpRequest.h:168</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a98624db05b1d0e020b1178042857038b"><div class="ttname"><a href="classHttpRequest.html#a98624db05b1d0e020b1178042857038b">HttpRequest::pinnedConnection</a></div><div class="ttdeci">ConnStateData * pinnedConnection()</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00722">HttpRequest.cc:722</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a9ad7e32caa679d92c966271dc94032a9"><div class="ttname"><a href="classHttpRequest.html#a9ad7e32caa679d92c966271dc94032a9">HttpRequest::dnsWait</a></div><div class="ttdeci">int dnsWait</div><div class="ttdoc">sum of DNS lookup delays in milliseconds, for dt</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00159">HttpRequest.h:159</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_ac42bf8d09e3be5ccc28068c9963c44da"><div class="ttname"><a href="classHttpRequest.html#ac42bf8d09e3be5ccc28068c9963c44da">HttpRequest::adaptLogHistory</a></div><div class="ttdeci">Adaptation::History::Pointer adaptLogHistory() const</div><div class="ttdoc">Returns possibly nil history, creating it if adapt. logging is enabled.</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00412">HttpRequest.cc:412</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_ac498f2030321d6bc845b115a5cabc6d1"><div class="ttname"><a href="classHttpRequest.html#ac498f2030321d6bc845b115a5cabc6d1">HttpRequest::auth_user_request</a></div><div class="ttdeci">Auth::UserRequest::Pointer auth_user_request</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00127">HttpRequest.h:127</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_ad74059f2de350cf5a93ca5acb3909774"><div class="ttname"><a href="classHttpRequest.html#ad74059f2de350cf5a93ca5acb3909774">HttpRequest::checkEntityFraming</a></div><div class="ttdeci">Http::StatusCode checkEntityFraming() const</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00644">HttpRequest.cc:644</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_aeeb3de67d14be944d152c249379832cb"><div class="ttname"><a href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">HttpRequest::error</a></div><div class="ttdeci">Error error</div><div class="ttdoc">the first transaction problem encountered (or falsy)</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00161">HttpRequest.h:161</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_af12cd51466974ad702972c18238ef5a2"><div class="ttname"><a href="classHttpRequest.html#af12cd51466974ad702972c18238ef5a2">HttpRequest::icapHistory</a></div><div class="ttdeci">Adaptation::Icap::History::Pointer icapHistory() const</div><div class="ttdoc">Returns possibly nil history, creating it if icap logging is enabled.</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00386">HttpRequest.cc:386</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_af191362e7cf9b99f7f15dd20a0076e89"><div class="ttname"><a href="classHttpRequest.html#af191362e7cf9b99f7f15dd20a0076e89">HttpRequest::url</a></div><div class="ttdeci">AnyP::Uri url</div><div class="ttdoc">the request URI</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00115">HttpRequest.h:115</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_afa44c5ce6b6cce602572b33ca6456235"><div class="ttname"><a href="classHttpRequest.html#afa44c5ce6b6cce602572b33ca6456235">HttpRequest::manager</a></div><div class="ttdeci">void manager(const CbcPointer&lt; ConnStateData &gt; &amp;aMgr, const AccessLogEntryPointer &amp;al)</div><div class="ttdoc">associates the request with a from-client connection manager</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00771">HttpRequest.cc:771</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_afc7b4dd61a4232033c8b06826f02ae29"><div class="ttname"><a href="classHttpRequest.html#afc7b4dd61a4232033c8b06826f02ae29">HttpRequest::effectiveRequestUri</a></div><div class="ttdeci">const SBuf &amp; effectiveRequestUri() const</div><div class="ttdoc">RFC 7230 section 5.5 - Effective Request URI.</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00741">HttpRequest.cc:741</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a20853132c742d7eebf16d495c8da4fe9a0261d7de1b407ee2d9211e840b05be94"><div class="ttname"><a href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9a0261d7de1b407ee2d9211e840b05be94">Http::Message::srcHttp</a></div><div class="ttdeci">@ srcHttp</div><div class="ttdoc">http_port or HTTP server</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00039">Message.h:39</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a20853132c742d7eebf16d495c8da4fe9a5a794b7b856a3aefb5eb5c1278bc2856"><div class="ttname"><a href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9a5a794b7b856a3aefb5eb5c1278bc2856">Http::Message::srcHttps</a></div><div class="ttdeci">@ srcHttps</div><div class="ttdoc">https_port or bumped http_port tunnel; HTTPS server</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00033">Message.h:33</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a20853132c742d7eebf16d495c8da4fe9aa950ffb6dbd1a9c7063b6a645803cf05"><div class="ttname"><a href="classHttp_1_1Message.html#a20853132c742d7eebf16d495c8da4fe9aa950ffb6dbd1a9c7063b6a645803cf05">Http::Message::srcFtp</a></div><div class="ttdeci">@ srcFtp</div><div class="ttdoc">ftp_port or FTP server</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00040">Message.h:40</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a321ae82a5f96da7438f3054d38c8fe5c"><div class="ttname"><a href="classHttp_1_1Message.html#a321ae82a5f96da7438f3054d38c8fe5c">Http::Message::persistent</a></div><div class="ttdeci">bool persistent() const</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8cc_source.html#l00236">Message.cc:236</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a332610b0eddfe955427b9efcafcc80ea"><div class="ttname"><a href="classHttp_1_1Message.html#a332610b0eddfe955427b9efcafcc80ea">Http::Message::sources</a></div><div class="ttdeci">uint32_t sources</div><div class="ttdoc">The message sources.</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00099">Message.h:99</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a79ae935ff618211b139dcfdd8a5277ec"><div class="ttname"><a href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">Http::Message::header</a></div><div class="ttdeci">HttpHeader header</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00074">Message.h:74</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_aa6074e26e4827d7a52e5ae9500c10500"><div class="ttname"><a href="classHttp_1_1Message.html#aa6074e26e4827d7a52e5ae9500c10500">Http::Message::content_length</a></div><div class="ttdeci">int64_t content_length</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00083">Message.h:83</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_ad9f13ecd98f1ef921791a25163226f39"><div class="ttname"><a href="classHttp_1_1Message.html#ad9f13ecd98f1ef921791a25163226f39">Http::Message::body_pipe</a></div><div class="ttdeci">BodyPipe::Pointer body_pipe</div><div class="ttdoc">optional pipeline to receive message body</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00097">Message.h:97</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_afcb0c1d278e61a1379032790c427788d"><div class="ttname"><a href="classHttp_1_1Message.html#afcb0c1d278e61a1379032790c427788d">Http::Message::http_ver</a></div><div class="ttdeci">AnyP::ProtocolVersion http_ver</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00072">Message.h:72</a></div></div>
<div class="ttc" id="aclassHttp_1_1One_1_1Parser_html_a8a61ca899c082efeb9fe7d0203ece39e"><div class="ttname"><a href="classHttp_1_1One_1_1Parser.html#a8a61ca899c082efeb9fe7d0203ece39e">Http::One::Parser::remaining</a></div><div class="ttdeci">const SBuf &amp; remaining() const</div><div class="ttdoc">the remaining unprocessed section of buffer</div><div class="ttdef"><b>Definition</b> <a href="http_2one_2Parser_8h_source.html#l00098">Parser.h:98</a></div></div>
<div class="ttc" id="aclassHttp_1_1One_1_1Parser_html_af1e818c3f5caf4a375eedf31a99f88d8"><div class="ttname"><a href="classHttp_1_1One_1_1Parser.html#af1e818c3f5caf4a375eedf31a99f88d8">Http::One::Parser::needsMoreData</a></div><div class="ttdeci">bool needsMoreData() const</div><div class="ttdef"><b>Definition</b> <a href="http_2one_2Parser_8h_source.html#l00066">Parser.h:66</a></div></div>
<div class="ttc" id="aclassHttp_1_1One_1_1TeChunkedParser_html"><div class="ttname"><a href="classHttp_1_1One_1_1TeChunkedParser.html">Http::One::TeChunkedParser</a></div><div class="ttdef"><b>Definition</b> <a href="TeChunkedParser_8h_source.html#l00051">TeChunkedParser.h:52</a></div></div>
<div class="ttc" id="aclassHttp_1_1One_1_1TeChunkedParser_html_a1ef246170720fa36d1a06d20f8728b56"><div class="ttname"><a href="classHttp_1_1One_1_1TeChunkedParser.html#a1ef246170720fa36d1a06d20f8728b56">Http::One::TeChunkedParser::parse</a></div><div class="ttdeci">bool parse(const SBuf &amp;) override</div><div class="ttdef"><b>Definition</b> <a href="TeChunkedParser_8cc_source.html#l00045">TeChunkedParser.cc:45</a></div></div>
<div class="ttc" id="aclassHttp_1_1One_1_1TeChunkedParser_html_acb09f5b320fe3ccf41bff35b5945bb51"><div class="ttname"><a href="classHttp_1_1One_1_1TeChunkedParser.html#acb09f5b320fe3ccf41bff35b5945bb51">Http::One::TeChunkedParser::needsMoreSpace</a></div><div class="ttdeci">bool needsMoreSpace() const</div><div class="ttdef"><b>Definition</b> <a href="TeChunkedParser_8cc_source.html#l00082">TeChunkedParser.cc:82</a></div></div>
<div class="ttc" id="aclassHttp_1_1One_1_1TeChunkedParser_html_ad97d8216e4d5b3e76b60639ea1fbd2b5"><div class="ttname"><a href="classHttp_1_1One_1_1TeChunkedParser.html#ad97d8216e4d5b3e76b60639ea1fbd2b5">Http::One::TeChunkedParser::setPayloadBuffer</a></div><div class="ttdeci">void setPayloadBuffer(MemBuf *parsedContent)</div><div class="ttdoc">set the buffer to be used to store decoded chunk data</div><div class="ttdef"><b>Definition</b> <a href="TeChunkedParser_8h_source.html#l00058">TeChunkedParser.h:58</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html"><div class="ttname"><a href="classHttp_1_1Stream.html">Http::Stream</a></div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00072">Stream.h:73</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_a19ce29fe9e19e5a7ea0f5dedc37895c2"><div class="ttname"><a href="classHttp_1_1Stream.html#a19ce29fe9e19e5a7ea0f5dedc37895c2">Http::Stream::parsed_ok</a></div><div class="ttdeci">unsigned parsed_ok</div><div class="ttdoc">Was this parsed correctly?</div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00140">Stream.h:140</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_a522a8b7cab8e595188b6354a65a41613"><div class="ttname"><a href="classHttp_1_1Stream.html#a522a8b7cab8e595188b6354a65a41613">Http::Stream::registerWithConn</a></div><div class="ttdeci">void registerWithConn()</div><div class="ttdoc">register this stream with the Server</div><div class="ttdef"><b>Definition</b> <a href="Stream_8cc_source.html#l00053">Stream.cc:53</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_a720b33b5850e89ebda3011c853c20f9f"><div class="ttname"><a href="classHttp_1_1Stream.html#a720b33b5850e89ebda3011c853c20f9f">Http::Stream::flags</a></div><div class="ttdeci">struct Http::Stream::@58 flags</div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_aa13355bfcaa6f65caf4b0a64765d5968"><div class="ttname"><a href="classHttp_1_1Stream.html#aa13355bfcaa6f65caf4b0a64765d5968">Http::Stream::reqbuf</a></div><div class="ttdeci">char reqbuf[HTTP_REQBUF_SZ]</div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00137">Stream.h:137</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_aa440325d7261074611d9150b3133bc26"><div class="ttname"><a href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">Http::Stream::getClientReplyContext</a></div><div class="ttdeci">clientStreamNode * getClientReplyContext() const</div><div class="ttdef"><b>Definition</b> <a href="Stream_8cc_source.html#l00511">Stream.cc:511</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_af977ae01fc040b1c42e388726801f749"><div class="ttname"><a href="classHttp_1_1Stream.html#af977ae01fc040b1c42e388726801f749">Http::Stream::mayUseConnection</a></div><div class="ttdeci">bool mayUseConnection() const</div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00143">Stream.h:143</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_afcc7ea64a46ddbdddcfb3d58529499ea"><div class="ttname"><a href="classHttp_1_1Stream.html#afcc7ea64a46ddbdddcfb3d58529499ea">Http::Stream::pullData</a></div><div class="ttdeci">void pullData()</div><div class="ttdoc">get more data to send</div><div class="ttdef"><b>Definition</b> <a href="Stream_8cc_source.html#l00110">Stream.cc:110</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_afcdcad504145430c704db2efe6b5de17"><div class="ttname"><a href="classHttp_1_1Stream.html#afcdcad504145430c704db2efe6b5de17">Http::Stream::http</a></div><div class="ttdeci">ClientHttpRequest * http</div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00135">Stream.h:135</a></div></div>
<div class="ttc" id="aclassIndependentRunner_html_af3c2f4f2ff88ff65d6089fa77025de95"><div class="ttname"><a href="classIndependentRunner.html#af3c2f4f2ff88ff65d6089fa77025de95">IndependentRunner::registerRunner</a></div><div class="ttdeci">void registerRunner()</div><div class="ttdef"><b>Definition</b> <a href="RunnersRegistry_8cc_source.html#l00104">RunnersRegistry.cc:104</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_a00a47f51e0c2b78115495af295924aee"><div class="ttname"><a href="classIp_1_1Address.html#a00a47f51e0c2b78115495af295924aee">Ip::Address::toStr</a></div><div class="ttdeci">char * toStr(char *buf, const unsigned int blen, int force=AF_UNSPEC) const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00804">Address.cc:804</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_a2696806ea5ee1a73dbe87849a7d43539"><div class="ttname"><a href="classIp_1_1Address.html#a2696806ea5ee1a73dbe87849a7d43539">Ip::Address::toHostStr</a></div><div class="ttdeci">unsigned int toHostStr(char *buf, const unsigned int len) const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00854">Address.cc:854</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_a5c88542f8e90d3b49f743e079b9383bb"><div class="ttname"><a href="classIp_1_1Address.html#a5c88542f8e90d3b49f743e079b9383bb">Ip::Address::applyClientMask</a></div><div class="ttdeci">void applyClientMask(const Address &amp;mask)</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00125">Address.cc:125</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_ac22c561fa1b3873a204feb18dd9a16b1"><div class="ttname"><a href="classIp_1_1Address.html#ac22c561fa1b3873a204feb18dd9a16b1">Ip::Address::toUrl</a></div><div class="ttdeci">char * toUrl(char *buf, unsigned int len) const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00886">Address.cc:886</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_aeea3c669850f18acd2efcd336fcf2438"><div class="ttname"><a href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">Ip::Address::port</a></div><div class="ttdeci">unsigned short port() const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00790">Address.cc:790</a></div></div>
<div class="ttc" id="aclassIpc_1_1StartListeningAnswer_html"><div class="ttname"><a href="classIpc_1_1StartListeningAnswer.html">Ipc::StartListeningAnswer</a></div><div class="ttdoc">StartListening() result.</div><div class="ttdef"><b>Definition</b> <a href="StartListening_8h_source.html#l00027">StartListening.h:28</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html"><div class="ttname"><a href="classListeningStartedDialer.html">ListeningStartedDialer</a></div><div class="ttdoc">dials clientListenerConnectionOpened call</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00152">client_side.cc:155</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_a06e1d91758e776651034abaca8ac6f66"><div class="ttname"><a href="classListeningStartedDialer.html#a06e1d91758e776651034abaca8ac6f66">ListeningStartedDialer::handler</a></div><div class="ttdeci">Handler handler</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00173">client_side.cc:173</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_a08a8a4d4818fcf6ec60d74fe07b44639"><div class="ttname"><a href="classListeningStartedDialer.html#a08a8a4d4818fcf6ec60d74fe07b44639">ListeningStartedDialer::sub</a></div><div class="ttdeci">Subscription::Pointer sub</div><div class="ttdoc">The handler to be subscribed for this connection listener.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00180">client_side.cc:180</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_a319c84474dfd15db9722b7ad1a582f79"><div class="ttname"><a href="classListeningStartedDialer.html#a319c84474dfd15db9722b7ad1a582f79">ListeningStartedDialer::ListeningStartedDialer</a></div><div class="ttdeci">ListeningStartedDialer(Handler aHandler, AnyP::PortCfgPointer &amp;aPortCfg, const Ipc::FdNoteId note, const Subscription::Pointer &amp;aSub)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00158">client_side.cc:158</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_a34d75c7a3305ced0fe45d970dfa1fddf"><div class="ttname"><a href="classListeningStartedDialer.html#a34d75c7a3305ced0fe45d970dfa1fddf">ListeningStartedDialer::portCfg</a></div><div class="ttdeci">AnyP::PortCfgPointer portCfg</div><div class="ttdoc">from HttpPortList</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00178">client_side.cc:178</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_a4e7a9049579f091a171ad4def320887c"><div class="ttname"><a href="classListeningStartedDialer.html#a4e7a9049579f091a171ad4def320887c">ListeningStartedDialer::answer</a></div><div class="ttdeci">Ipc::StartListeningAnswer &amp; answer() override</div><div class="ttdoc">callback results setter</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00170">client_side.cc:170</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_a839fc1a76be2258ef2871772d955e1ea"><div class="ttname"><a href="classListeningStartedDialer.html#a839fc1a76be2258ef2871772d955e1ea">ListeningStartedDialer::print</a></div><div class="ttdeci">void print(std::ostream &amp;os) const override</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00162">client_side.cc:162</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_a919ddbde35300a051710e02513fc6dfd"><div class="ttname"><a href="classListeningStartedDialer.html#a919ddbde35300a051710e02513fc6dfd">ListeningStartedDialer::dial</a></div><div class="ttdeci">virtual void dial(AsyncCall &amp;)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00167">client_side.cc:167</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_aa164476edc5a6f3196a26c7dff9b11d5"><div class="ttname"><a href="classListeningStartedDialer.html#aa164476edc5a6f3196a26c7dff9b11d5">ListeningStartedDialer::Handler</a></div><div class="ttdeci">void(* Handler)(AnyP::PortCfgPointer &amp;portCfg, const Ipc::FdNoteId note, const Subscription::Pointer &amp;sub)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00157">client_side.cc:157</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_aa4df33e08bd8063710c8f470a4b5e036"><div class="ttname"><a href="classListeningStartedDialer.html#aa4df33e08bd8063710c8f470a4b5e036">ListeningStartedDialer::portTypeNote</a></div><div class="ttdeci">Ipc::FdNoteId portTypeNote</div><div class="ttdoc">Type of IPC socket being opened.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00179">client_side.cc:179</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_acdf175a6591ae02faf86bec80a89323c"><div class="ttname"><a href="classListeningStartedDialer.html#acdf175a6591ae02faf86bec80a89323c">ListeningStartedDialer::answer_</a></div><div class="ttdeci">Ipc::StartListeningAnswer answer_</div><div class="ttdoc">StartListening() results.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00177">client_side.cc:177</a></div></div>
<div class="ttc" id="aclassListeningStartedDialer_html_ae9bbb7f856e3667883e347b29f1857a1"><div class="ttname"><a href="classListeningStartedDialer.html#ae9bbb7f856e3667883e347b29f1857a1">ListeningStartedDialer::canDial</a></div><div class="ttdeci">virtual bool canDial(AsyncCall &amp;) const</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00166">client_side.cc:166</a></div></div>
<div class="ttc" id="aclassLogTagsErrors_html"><div class="ttname"><a href="classLogTagsErrors.html">LogTagsErrors</a></div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00017">LogTags.h:18</a></div></div>
<div class="ttc" id="aclassLogTagsErrors_html_a50bf712f141a85310cd37c162634bb0b"><div class="ttname"><a href="classLogTagsErrors.html#a50bf712f141a85310cd37c162634bb0b">LogTagsErrors::timedout</a></div><div class="ttdeci">bool timedout</div><div class="ttdoc">_TIMEDOUT: terminated due to a lifetime or I/O timeout</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00028">LogTags.h:28</a></div></div>
<div class="ttc" id="aclassLogTags_html"><div class="ttname"><a href="classLogTags.html">LogTags</a></div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00069">LogTags.h:70</a></div></div>
<div class="ttc" id="aclassLogTags_html_abed628637be6b214d7860ed402927259"><div class="ttname"><a href="classLogTags.html#abed628637be6b214d7860ed402927259">LogTags::oldType</a></div><div class="ttdeci">LogTags_ot oldType</div><div class="ttdoc">a set of client protocol, cache use, and other transaction outcome tags</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8h_source.html#l00096">LogTags.h:96</a></div></div>
<div class="ttc" id="aclassLogTags_html_aea1194c638b43a3273a8280cee485215"><div class="ttname"><a href="classLogTags.html#aea1194c638b43a3273a8280cee485215">LogTags::isTcpHit</a></div><div class="ttdeci">bool isTcpHit() const</div><div class="ttdoc">determine if the log tag code indicates a cache HIT</div><div class="ttdef"><b>Definition</b> <a href="LogTags_8cc_source.html#l00110">LogTags.cc:110</a></div></div>
<div class="ttc" id="aclassMasterXaction_html_a6face8463c6b8abc85820ca7e63497f4"><div class="ttname"><a href="classMasterXaction.html#a6face8463c6b8abc85820ca7e63497f4">MasterXaction::tcpClient</a></div><div class="ttdeci">Comm::ConnectionPointer tcpClient</div><div class="ttdoc">the client TCP connection which originated this transaction</div><div class="ttdef"><b>Definition</b> <a href="MasterXaction_8h_source.html#l00066">MasterXaction.h:66</a></div></div>
<div class="ttc" id="aclassMasterXaction_html_af3cb33c92de57dbb4f9b5a0bf5488ad4"><div class="ttname"><a href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a></div><div class="ttdeci">static Pointer MakePortful(const AnyP::PortCfgPointer &amp;aPort)</div><div class="ttdef"><b>Definition</b> <a href="MasterXaction_8h_source.html#l00054">MasterXaction.h:54</a></div></div>
<div class="ttc" id="aclassMemBuf_html"><div class="ttname"><a href="classMemBuf.html">MemBuf</a></div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00023">MemBuf.h:24</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a085688f536a13949b005f7bb59bae333"><div class="ttname"><a href="classMemBuf.html#a085688f536a13949b005f7bb59bae333">MemBuf::clean</a></div><div class="ttdeci">void clean()</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8cc_source.html#l00110">MemBuf.cc:110</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a2e7319f5feaf76c1fd43f163a87ddaad"><div class="ttname"><a href="classMemBuf.html#a2e7319f5feaf76c1fd43f163a87ddaad">MemBuf::append</a></div><div class="ttdeci">void append(const char *c, int sz) override</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8cc_source.html#l00209">MemBuf.cc:209</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a4a615d8e887439c66e04aab70f8be60a"><div class="ttname"><a href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">MemBuf::init</a></div><div class="ttdeci">void init(mb_size_t szInit, mb_size_t szMax)</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8cc_source.html#l00093">MemBuf.cc:93</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a512e0e6f4a6b327f31c9db28fe9aaeb3"><div class="ttname"><a href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">MemBuf::size</a></div><div class="ttdeci">mb_size_t size</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00135">MemBuf.h:135</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a78daaa064a5aa4557e283a01c4aa27f1"><div class="ttname"><a href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">MemBuf::buf</a></div><div class="ttdeci">char * buf</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00134">MemBuf.h:134</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a7a189b679e374a2cca1d01f9ba4e195f"><div class="ttname"><a href="classMemBuf.html#a7a189b679e374a2cca1d01f9ba4e195f">MemBuf::content</a></div><div class="ttdeci">char * content()</div><div class="ttdoc">start of the added data</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00041">MemBuf.h:41</a></div></div>
<div class="ttc" id="aclassMemBuf_html_aaaf0cc30487417b07680613bcf518dca"><div class="ttname"><a href="classMemBuf.html#aaaf0cc30487417b07680613bcf518dca">MemBuf::contentSize</a></div><div class="ttdeci">mb_size_t contentSize() const</div><div class="ttdoc">available data size</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00047">MemBuf.h:47</a></div></div>
<div class="ttc" id="aclassMemBuf_html_ac0eda16694c0752050a1da95db2be3e6"><div class="ttname"><a href="classMemBuf.html#ac0eda16694c0752050a1da95db2be3e6">MemBuf::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8cc_source.html#l00129">MemBuf.cc:129</a></div></div>
<div class="ttc" id="aclassMemBuf_html_acd16af1c1ce00158c868f6b378b59c8c"><div class="ttname"><a href="classMemBuf.html#acd16af1c1ce00158c868f6b378b59c8c">MemBuf::hasContent</a></div><div class="ttdeci">bool hasContent() const</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00054">MemBuf.h:54</a></div></div>
<div class="ttc" id="aclassMemObject_html_a226d829dcd5f4008a5f31028891bfac8"><div class="ttname"><a href="classMemObject.html#a226d829dcd5f4008a5f31028891bfac8">MemObject::urlXXX</a></div><div class="ttdeci">const char * urlXXX() const</div><div class="ttdef"><b>Definition</b> <a href="MemObject_8h_source.html#l00138">MemObject.h:138</a></div></div>
<div class="ttc" id="aclassMemObject_html_a66e95211cec7250b591bd1eaf9fe4f08"><div class="ttname"><a href="classMemObject.html#a66e95211cec7250b591bd1eaf9fe4f08">MemObject::vary_headers</a></div><div class="ttdeci">SBuf vary_headers</div><div class="ttdef"><b>Definition</b> <a href="MemObject_8h_source.html#l00221">MemObject.h:221</a></div></div>
<div class="ttc" id="aclassMemObject_html_a89697947bc40cdbe591b9e26951b59ba"><div class="ttname"><a href="classMemObject.html#a89697947bc40cdbe591b9e26951b59ba">MemObject::freshestReply</a></div><div class="ttdeci">const HttpReply &amp; freshestReply() const</div><div class="ttdef"><b>Definition</b> <a href="MemObject_8h_source.html#l00068">MemObject.h:68</a></div></div>
<div class="ttc" id="aclassMessageSizes_html_a0a1f33259faa7a15a3b38ffe37fe0ced"><div class="ttname"><a href="classMessageSizes.html#a0a1f33259faa7a15a3b38ffe37fe0ced">MessageSizes::payloadData</a></div><div class="ttdeci">uint64_t payloadData</div><div class="ttdoc">total size of payload block(s) excluding transfer encoding overheads</div><div class="ttdef"><b>Definition</b> <a href="MessageSizes_8h_source.html#l00024">MessageSizes.h:24</a></div></div>
<div class="ttc" id="aclassMessageSizes_html_a7611eec2ef8fd9d6ba17519409cd5762"><div class="ttname"><a href="classMessageSizes.html#a7611eec2ef8fd9d6ba17519409cd5762">MessageSizes::header</a></div><div class="ttdeci">uint64_t header</div><div class="ttdef"><b>Definition</b> <a href="MessageSizes_8h_source.html#l00021">MessageSizes.h:21</a></div></div>
<div class="ttc" id="aclassNotePairs_html"><div class="ttname"><a href="classNotePairs.html">NotePairs</a></div><div class="ttdef"><b>Definition</b> <a href="Notes_8h_source.html#l00180">Notes.h:181</a></div></div>
<div class="ttc" id="aclassNotePairs_html_a36b603c72d7682e871987f66d1dceac6"><div class="ttname"><a href="classNotePairs.html#a36b603c72d7682e871987f66d1dceac6">NotePairs::add</a></div><div class="ttdeci">void add(const SBuf &amp;key, const SBuf &amp;value)</div><div class="ttdef"><b>Definition</b> <a href="Notes_8cc_source.html#l00322">Notes.cc:322</a></div></div>
<div class="ttc" id="aclassPackable_html_ab3147943b218d2943726aeaf135dd776"><div class="ttname"><a href="classPackable.html#ab3147943b218d2943726aeaf135dd776">Packable::appendf</a></div><div class="ttdeci">void appendf(const char *fmt,...) PRINTF_FORMAT_ARG2</div><div class="ttdoc">Append operation with printf-style arguments.</div><div class="ttdef"><b>Definition</b> <a href="Packable_8h_source.html#l00061">Packable.h:61</a></div></div>
<div class="ttc" id="aclassParser_1_1InsufficientInput_html"><div class="ttname"><a href="classParser_1_1InsufficientInput.html">Parser::InsufficientInput</a></div><div class="ttdoc">thrown by modern &quot;incremental&quot; parsers when they need more data</div><div class="ttdef"><b>Definition</b> <a href="parser_2forward_8h_source.html#l00018">forward.h:18</a></div></div>
<div class="ttc" id="aclassParser_1_1Tokenizer_html"><div class="ttname"><a href="classParser_1_1Tokenizer.html">Parser::Tokenizer</a></div><div class="ttdef"><b>Definition</b> <a href="parser_2Tokenizer_8h_source.html#l00029">Tokenizer.h:30</a></div></div>
<div class="ttc" id="aclassPipeline_html_a01d0fbd71a5106906074bc45cb8db2a6"><div class="ttname"><a href="classPipeline.html#a01d0fbd71a5106906074bc45cb8db2a6">Pipeline::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">whether there are none or any requests currently pipelined</div><div class="ttdef"><b>Definition</b> <a href="Pipeline_8h_source.html#l00056">Pipeline.h:56</a></div></div>
<div class="ttc" id="aclassPipeline_html_a2a570842f872e93817685f1d576e7375"><div class="ttname"><a href="classPipeline.html#a2a570842f872e93817685f1d576e7375">Pipeline::count</a></div><div class="ttdeci">size_t count() const</div><div class="ttdoc">how many requests are currently pipelined</div><div class="ttdef"><b>Definition</b> <a href="Pipeline_8h_source.html#l00053">Pipeline.h:53</a></div></div>
<div class="ttc" id="aclassPipeline_html_a349118f98c80d65b033429b2faa2b564"><div class="ttname"><a href="classPipeline.html#a349118f98c80d65b033429b2faa2b564">Pipeline::nrequests</a></div><div class="ttdeci">uint32_t nrequests</div><div class="ttdef"><b>Definition</b> <a href="Pipeline_8h_source.html#l00063">Pipeline.h:63</a></div></div>
<div class="ttc" id="aclassPipeline_html_a3c943ab8769e1c69332d2d938347ec2a"><div class="ttname"><a href="classPipeline.html#a3c943ab8769e1c69332d2d938347ec2a">Pipeline::front</a></div><div class="ttdeci">Http::StreamPointer front() const</div><div class="ttdoc">get the first request context in the pipeline</div><div class="ttdef"><b>Definition</b> <a href="Pipeline_8cc_source.html#l00028">Pipeline.cc:28</a></div></div>
<div class="ttc" id="aclassPipeline_html_a60b07fdbb2863d4a32325c84cb724cb4"><div class="ttname"><a href="classPipeline.html#a60b07fdbb2863d4a32325c84cb724cb4">Pipeline::add</a></div><div class="ttdeci">void add(const Http::StreamPointer &amp;)</div><div class="ttdoc">register a new request context to the pipeline</div><div class="ttdef"><b>Definition</b> <a href="Pipeline_8cc_source.html#l00020">Pipeline.cc:20</a></div></div>
<div class="ttc" id="aclassPipeline_html_a91846ca6159cbac102f4f914200d66f1"><div class="ttname"><a href="classPipeline.html#a91846ca6159cbac102f4f914200d66f1">Pipeline::back</a></div><div class="ttdeci">Http::StreamPointer back() const</div><div class="ttdoc">get the last request context in the pipeline</div><div class="ttdef"><b>Definition</b> <a href="Pipeline_8cc_source.html#l00040">Pipeline.cc:40</a></div></div>
<div class="ttc" id="aclassRefCount_html"><div class="ttname"><a href="classRefCount.html">RefCount&lt; PortCfg &gt;</a></div></div>
<div class="ttc" id="aclassRefCount_html_a9f2168c1df4a4ab6b7931425d85c37f0"><div class="ttname"><a href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">RefCount::getRaw</a></div><div class="ttdeci">C * getRaw() const</div><div class="ttdef"><b>Definition</b> <a href="RefCount_8h_source.html#l00089">RefCount.h:89</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_a0e7db730c27abb7eac3b676961773797"><div class="ttname"><a href="classRequestFlags.html#a0e7db730c27abb7eac3b676961773797">RequestFlags::accelerated</a></div><div class="ttdeci">bool accelerated</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00062">RequestFlags.h:62</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_a1cb8c962b36f5ebd3f897fede719dd43"><div class="ttname"><a href="classRequestFlags.html#a1cb8c962b36f5ebd3f897fede719dd43">RequestFlags::connectionAuth</a></div><div class="ttdeci">bool connectionAuth</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00085">RequestFlags.h:85</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_a1ec3ec0b8c3d8f8cd603180e8312885b"><div class="ttname"><a href="classRequestFlags.html#a1ec3ec0b8c3d8f8cd603180e8312885b">RequestFlags::forceTunnel</a></div><div class="ttdeci">bool forceTunnel</div><div class="ttdoc">whether to forward via TunnelStateData (instead of FwdState)</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00120">RequestFlags.h:120</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_a8014770f9112fe68a085fc4ecec68680"><div class="ttname"><a href="classRequestFlags.html#a8014770f9112fe68a085fc4ecec68680">RequestFlags::proxyKeepalive</a></div><div class="ttdeci">bool proxyKeepalive</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00042">RequestFlags.h:42</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_abb9e233ddb38e78e34478b9222f0d849"><div class="ttname"><a href="classRequestFlags.html#abb9e233ddb38e78e34478b9222f0d849">RequestFlags::resetTcp</a></div><div class="ttdeci">bool resetTcp</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00115">RequestFlags.h:115</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_abbde600374891ccc540eea4812414b69"><div class="ttname"><a href="classRequestFlags.html#abbde600374891ccc540eea4812414b69">RequestFlags::sslBumped</a></div><div class="ttdeci">bool sslBumped</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00110">RequestFlags.h:110</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_af02e789de94255ee89cbfb1f960ccba8"><div class="ttname"><a href="classRequestFlags.html#af02e789de94255ee89cbfb1f960ccba8">RequestFlags::noDirect</a></div><div class="ttdeci">bool noDirect</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00097">RequestFlags.h:97</a></div></div>
<div class="ttc" id="aclassSBuf_html"><div class="ttname"><a href="classSBuf.html">SBuf</a></div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00093">SBuf.h:94</a></div></div>
<div class="ttc" id="aclassSBuf_html_a1af20d84cdd1e4f380c74a08d67d0edb"><div class="ttname"><a href="classSBuf.html#a1af20d84cdd1e4f380c74a08d67d0edb">SBuf::rawContent</a></div><div class="ttdeci">const char * rawContent() const</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00509">SBuf.cc:509</a></div></div>
<div class="ttc" id="aclassSBuf_html_a1db91b2f039b38745f7d73b56ac9311f"><div class="ttname"><a href="classSBuf.html#a1db91b2f039b38745f7d73b56ac9311f">SBuf::npos</a></div><div class="ttdeci">static const size_type npos</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00100">SBuf.h:100</a></div></div>
<div class="ttc" id="aclassSBuf_html_a27c3dd8867d72547428ebb9de5894eeb"><div class="ttname"><a href="classSBuf.html#a27c3dd8867d72547428ebb9de5894eeb">SBuf::consume</a></div><div class="ttdeci">SBuf consume(size_type n=npos)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00481">SBuf.cc:481</a></div></div>
<div class="ttc" id="aclassSBuf_html_a2a7fda503e54cb36b023dcaaab633f65"><div class="ttname"><a href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">SBuf::c_str</a></div><div class="ttdeci">const char * c_str()</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00516">SBuf.cc:516</a></div></div>
<div class="ttc" id="aclassSBuf_html_a2f7b8f1302ad82646cc285927b453b87"><div class="ttname"><a href="classSBuf.html#a2f7b8f1302ad82646cc285927b453b87">SBuf::chop</a></div><div class="ttdeci">SBuf &amp; chop(size_type pos, size_type n=npos)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00530">SBuf.cc:530</a></div></div>
<div class="ttc" id="aclassSBuf_html_a4fdfe954309aa6da19240f11a8f6b583"><div class="ttname"><a href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">SBuf::length</a></div><div class="ttdeci">size_type length() const</div><div class="ttdoc">Returns the number of bytes stored in SBuf.</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00419">SBuf.h:419</a></div></div>
<div class="ttc" id="aclassSBuf_html_a511d819cac33f02d5c50352d4a87c963"><div class="ttname"><a href="classSBuf.html#a511d819cac33f02d5c50352d4a87c963">SBuf::appendf</a></div><div class="ttdeci">SBuf &amp; appendf(const char *fmt,...) PRINTF_FORMAT_ARG2</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00229">SBuf.cc:229</a></div></div>
<div class="ttc" id="aclassSBuf_html_a531a0dd882ff1af666b03a8437701013"><div class="ttname"><a href="classSBuf.html#a531a0dd882ff1af666b03a8437701013">SBuf::rfind</a></div><div class="ttdeci">size_type rfind(char c, size_type endPos=npos) const</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00692">SBuf.cc:692</a></div></div>
<div class="ttc" id="aclassSBuf_html_a5ec49865cc982a78e48245f546a38ea4"><div class="ttname"><a href="classSBuf.html#a5ec49865cc982a78e48245f546a38ea4">SBuf::cmp</a></div><div class="ttdeci">int cmp(const SBuf &amp;S, const size_type n) const</div><div class="ttdoc">shorthand version for compare()</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00279">SBuf.h:279</a></div></div>
<div class="ttc" id="aclassSBuf_html_a8bda8fe69e451e61946b35c2a2d2340b"><div class="ttname"><a href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">SBuf::isEmpty</a></div><div class="ttdeci">bool isEmpty() const</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00435">SBuf.h:435</a></div></div>
<div class="ttc" id="aclassSBuf_html_aa12ede16b167c60722946fc8fe9292da"><div class="ttname"><a href="classSBuf.html#aa12ede16b167c60722946fc8fe9292da">SBuf::append</a></div><div class="ttdeci">SBuf &amp; append(const SBuf &amp;S)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00185">SBuf.cc:185</a></div></div>
<div class="ttc" id="aclassSBuf_html_ab489e62b349e678e32103f5e24de28ea"><div class="ttname"><a href="classSBuf.html#ab489e62b349e678e32103f5e24de28ea">SBuf::rbegin</a></div><div class="ttdeci">const_reverse_iterator rbegin() const</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00595">SBuf.h:595</a></div></div>
<div class="ttc" id="aclassSBuf_html_adb0c2508d8e83b2fd5f931d65cc775d8"><div class="ttname"><a href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">SBuf::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00175">SBuf.cc:175</a></div></div>
<div class="ttc" id="aclassSBuf_html_aeba82ab78d0c4038a35d52e06f3cfd75"><div class="ttname"><a href="classSBuf.html#aeba82ab78d0c4038a35d52e06f3cfd75">SBuf::assign</a></div><div class="ttdeci">SBuf &amp; assign(const SBuf &amp;S)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00083">SBuf.cc:83</a></div></div>
<div class="ttc" id="aclassSecurity_1_1CertError_html"><div class="ttname"><a href="classSecurity_1_1CertError.html">Security::CertError</a></div><div class="ttdef"><b>Definition</b> <a href="CertError_8h_source.html#l00019">CertError.h:20</a></div></div>
<div class="ttc" id="aclassSecurity_1_1ErrorDetail_html"><div class="ttname"><a href="classSecurity_1_1ErrorDetail.html">Security::ErrorDetail</a></div><div class="ttdef"><b>Definition</b> <a href="security_2ErrorDetail_8h_source.html#l00039">ErrorDetail.h:40</a></div></div>
<div class="ttc" id="aclassSecurity_1_1HandshakeParser_html_a50569cdaf13012704027c283b5d47e31"><div class="ttname"><a href="classSecurity_1_1HandshakeParser.html#a50569cdaf13012704027c283b5d47e31">Security::HandshakeParser::details</a></div><div class="ttdeci">TlsDetails::Pointer details</div><div class="ttdoc">TLS handshake meta info. Never nil.</div><div class="ttdef"><b>Definition</b> <a href="Handshake_8h_source.html#l00077">Handshake.h:77</a></div></div>
<div class="ttc" id="aclassSecurity_1_1HandshakeParser_html_a8d67c95e311df6afd49d7a790d0eb085"><div class="ttname"><a href="classSecurity_1_1HandshakeParser.html#a8d67c95e311df6afd49d7a790d0eb085">Security::HandshakeParser::parseHello</a></div><div class="ttdeci">bool parseHello(const SBuf &amp;data)</div><div class="ttdef"><b>Definition</b> <a href="Handshake_8cc_source.html#l00641">Handshake.cc:641</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html"><div class="ttname"><a href="classSecurity_1_1IoResult.html">Security::IoResult</a></div><div class="ttdoc">a summary a TLS I/O operation outcome</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00019">Io.h:19</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html_a0c916adba5475a6fc020af70e1e091cc"><div class="ttname"><a href="classSecurity_1_1IoResult.html#a0c916adba5475a6fc020af70e1e091cc">Security::IoResult::errorDetail</a></div><div class="ttdeci">ErrorDetailPointer errorDetail</div><div class="ttdoc">ioError case details (or nil)</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00043">Io.h:43</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html_a495a10433284e17473d4e2116662287d"><div class="ttname"><a href="classSecurity_1_1IoResult.html#a495a10433284e17473d4e2116662287d">Security::IoResult::category</a></div><div class="ttdeci">Category category</div><div class="ttdoc">primary outcome classification</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00045">Io.h:45</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html_a586ce9b462f90960aff34ad192940317a1eafdd2f000f06b7396b040f19e92386"><div class="ttname"><a href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317a1eafdd2f000f06b7396b040f19e92386">Security::IoResult::ioError</a></div><div class="ttdeci">@ ioError</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00024">Io.h:24</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html_a586ce9b462f90960aff34ad192940317a6351c5537fff92ccae5284a623de9fb7"><div class="ttname"><a href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317a6351c5537fff92ccae5284a623de9fb7">Security::IoResult::ioSuccess</a></div><div class="ttdeci">@ ioSuccess</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00024">Io.h:24</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html_a586ce9b462f90960aff34ad192940317ae3a476a231aa75bc7764fe1644cfac1b"><div class="ttname"><a href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317ae3a476a231aa75bc7764fe1644cfac1b">Security::IoResult::ioWantWrite</a></div><div class="ttdeci">@ ioWantWrite</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00024">Io.h:24</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html_a586ce9b462f90960aff34ad192940317af17e1855920ff08d4245c92730762b99"><div class="ttname"><a href="classSecurity_1_1IoResult.html#a586ce9b462f90960aff34ad192940317af17e1855920ff08d4245c92730762b99">Security::IoResult::ioWantRead</a></div><div class="ttdeci">@ ioWantRead</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00024">Io.h:24</a></div></div>
<div class="ttc" id="aclassSecurity_1_1IoResult_html_a7a1767d793710b3859a65b536493f584"><div class="ttname"><a href="classSecurity_1_1IoResult.html#a7a1767d793710b3859a65b536493f584">Security::IoResult::important</a></div><div class="ttdeci">bool important</div><div class="ttdoc">whether the error was serious/unusual</div><div class="ttdef"><b>Definition</b> <a href="Io_8h_source.html#l00049">Io.h:49</a></div></div>
<div class="ttc" id="aclassSecurity_1_1KeyLogger_html_a4fb01a38846a91cff9fd8c4913e429f1"><div class="ttname"><a href="classSecurity_1_1KeyLogger.html#a4fb01a38846a91cff9fd8c4913e429f1">Security::KeyLogger::checkpoint</a></div><div class="ttdeci">void checkpoint(const Connection &amp;, const Acl::ChecklistFiller &amp;)</div><div class="ttdef"><b>Definition</b> <a href="KeyLogger_8h_source.html#l00050">KeyLogger.h:50</a></div></div>
<div class="ttc" id="aclassSecurity_1_1LockingPointer_html"><div class="ttname"><a href="classSecurity_1_1LockingPointer.html">Security::LockingPointer&lt; X509, X509_free_cpp, HardFun&lt; int, X509 *, X509_up_ref &gt; &gt;</a></div></div>
<div class="ttc" id="aclassSecurity_1_1LockingPointer_html_ab599b2876300635a15afee3bc7e7af4f"><div class="ttname"><a href="classSecurity_1_1LockingPointer.html#ab599b2876300635a15afee3bc7e7af4f">Security::LockingPointer::resetAndLock</a></div><div class="ttdeci">void resetAndLock(T *t)</div><div class="ttdef"><b>Definition</b> <a href="LockingPointer_8h_source.html#l00111">LockingPointer.h:111</a></div></div>
<div class="ttc" id="aclassSecurity_1_1LockingPointer_html_abd5883cbae01116de745ff8496a65664"><div class="ttname"><a href="classSecurity_1_1LockingPointer.html#abd5883cbae01116de745ff8496a65664">Security::LockingPointer::get</a></div><div class="ttdeci">T * get() const</div><div class="ttdoc">Returns raw and possibly nullptr pointer.</div><div class="ttdef"><b>Definition</b> <a href="LockingPointer_8h_source.html#l00103">LockingPointer.h:103</a></div></div>
<div class="ttc" id="aclassSecurity_1_1NegotiationHistory_html_a49368783be183f00d1da3fdabb559844"><div class="ttname"><a href="classSecurity_1_1NegotiationHistory.html#a49368783be183f00d1da3fdabb559844">Security::NegotiationHistory::retrieveParsedInfo</a></div><div class="ttdeci">void retrieveParsedInfo(Security::TlsDetails::Pointer const &amp;details)</div><div class="ttdoc">Extract information from parser stored in TlsDetails object.</div><div class="ttdef"><b>Definition</b> <a href="NegotiationHistory_8cc_source.html#l00095">NegotiationHistory.cc:95</a></div></div>
<div class="ttc" id="aclassSecurity_1_1NegotiationHistory_html_adfd1ceb3a60ef74c1af08a3c2e7836ff"><div class="ttname"><a href="classSecurity_1_1NegotiationHistory.html#adfd1ceb3a60ef74c1af08a3c2e7836ff">Security::NegotiationHistory::retrieveNegotiatedInfo</a></div><div class="ttdeci">void retrieveNegotiatedInfo(const Security::SessionPointer &amp;)</div><div class="ttdoc">Extract negotiation information from TLS object.</div><div class="ttdef"><b>Definition</b> <a href="NegotiationHistory_8cc_source.html#l00072">NegotiationHistory.cc:72</a></div></div>
<div class="ttc" id="aclassServer_html"><div class="ttname"><a href="classServer.html">Server</a></div><div class="ttdef"><b>Definition</b> <a href="Server_8h_source.html#l00031">Server.h:32</a></div></div>
<div class="ttc" id="aclassServer_html_a12cdf2616768902693acb3896283d29b"><div class="ttname"><a href="classServer.html#a12cdf2616768902693acb3896283d29b">Server::readSomeData</a></div><div class="ttdeci">void readSomeData()</div><div class="ttdoc">maybe grow the inBuf and schedule Comm::Read()</div><div class="ttdef"><b>Definition</b> <a href="Server_8cc_source.html#l00101">Server.cc:101</a></div></div>
<div class="ttc" id="aclassServer_html_a2a9a523bdde2eda0f9bd32dae617ddc6"><div class="ttname"><a href="classServer.html#a2a9a523bdde2eda0f9bd32dae617ddc6">Server::pipeline</a></div><div class="ttdeci">Pipeline pipeline</div><div class="ttdoc">set of requests waiting to be serviced</div><div class="ttdef"><b>Definition</b> <a href="Server_8h_source.html#l00118">Server.h:118</a></div></div>
<div class="ttc" id="aclassServer_html_a438d70c555b84d3f98b6379c49380c9f"><div class="ttname"><a href="classServer.html#a438d70c555b84d3f98b6379c49380c9f">Server::transferProtocol</a></div><div class="ttdeci">AnyP::ProtocolVersion transferProtocol</div><div class="ttdef"><b>Definition</b> <a href="Server_8h_source.html#l00107">Server.h:107</a></div></div>
<div class="ttc" id="aclassServer_html_a58c3313bde9ea0c6e23f047d203187dc"><div class="ttname"><a href="classServer.html#a58c3313bde9ea0c6e23f047d203187dc">Server::clientConnection</a></div><div class="ttdeci">Comm::ConnectionPointer clientConnection</div><div class="ttdef"><b>Definition</b> <a href="Server_8h_source.html#l00100">Server.h:100</a></div></div>
<div class="ttc" id="aclassServer_html_a6101c252f4eaf112503cb9d21d5eb5ce"><div class="ttname"><a href="classServer.html#a6101c252f4eaf112503cb9d21d5eb5ce">Server::receivedFirstByte_</a></div><div class="ttdeci">bool receivedFirstByte_</div><div class="ttdoc">true if at least one byte received on this connection</div><div class="ttdef"><b>Definition</b> <a href="Server_8h_source.html#l00115">Server.h:115</a></div></div>
<div class="ttc" id="aclassServer_html_a9cbce101e5899cde000fb625418732ed"><div class="ttname"><a href="classServer.html#a9cbce101e5899cde000fb625418732ed">Server::inBuf</a></div><div class="ttdeci">SBuf inBuf</div><div class="ttdoc">read I/O buffer for the client connection</div><div class="ttdef"><b>Definition</b> <a href="Server_8h_source.html#l00113">Server.h:113</a></div></div>
<div class="ttc" id="aclassServer_html_ae6ce5210cefc979791043ae510b77380"><div class="ttname"><a href="classServer.html#ae6ce5210cefc979791043ae510b77380">Server::swanSong</a></div><div class="ttdeci">void swanSong() override</div><div class="ttdef"><b>Definition</b> <a href="Server_8cc_source.html#l00051">Server.cc:51</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a0b1074aa43f2a83f9c26ede921fab749"><div class="ttname"><a href="classSquidConfig.html#a0b1074aa43f2a83f9c26ede921fab749">SquidConfig::request_start_timeout</a></div><div class="ttdeci">time_t request_start_timeout</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00125">SquidConfig.h:125</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a0e2640ef960e9c60996095d393cfd9c5"><div class="ttname"><a href="classSquidConfig.html#a0e2640ef960e9c60996095d393cfd9c5">SquidConfig::ssl_client</a></div><div class="ttdeci">struct SquidConfig::@99 ssl_client</div></div>
<div class="ttc" id="aclassSquidConfig_html_a10945ff98ac5fedfaac23c4b8f4f2512"><div class="ttname"><a href="classSquidConfig.html#a10945ff98ac5fedfaac23c4b8f4f2512">SquidConfig::appendDomainLen</a></div><div class="ttdeci">size_t appendDomainLen</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00223">SquidConfig.h:223</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a192f969ecf6d3604b1e91a8497f0f8a5"><div class="ttname"><a href="classSquidConfig.html#a192f969ecf6d3604b1e91a8497f0f8a5">SquidConfig::cert_adapt</a></div><div class="ttdeci">sslproxy_cert_adapt * cert_adapt</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00514">SquidConfig.h:514</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a477cbe078174efa10f1e6cdc6d65d461"><div class="ttname"><a href="classSquidConfig.html#a477cbe078174efa10f1e6cdc6d65d461">SquidConfig::ClientDelay</a></div><div class="ttdeci">ClientDelayConfig ClientDelay</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00446">SquidConfig.h:446</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a4888a7cfa1001662e3e3be32d7c544fe"><div class="ttname"><a href="classSquidConfig.html#a4888a7cfa1001662e3e3be32d7c544fe">SquidConfig::notes</a></div><div class="ttdeci">Notes notes</div><div class="ttdoc">note</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00471">SquidConfig.h:471</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a562d3b9f30cf9f07f338acaf055f14dc"><div class="ttname"><a href="classSquidConfig.html#a562d3b9f30cf9f07f338acaf055f14dc">SquidConfig::client_db</a></div><div class="ttdeci">int client_db</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00281">SquidConfig.h:281</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a57e9c06b9a99354b526a765e5b019c74"><div class="ttname"><a href="classSquidConfig.html#a57e9c06b9a99354b526a765e5b019c74">SquidConfig::request</a></div><div class="ttdeci">time_t request</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00118">SquidConfig.h:118</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a5b6f79ca04d2c3f0a514bf87890f8472"><div class="ttname"><a href="classSquidConfig.html#a5b6f79ca04d2c3f0a514bf87890f8472">SquidConfig::maxRequestBodySize</a></div><div class="ttdeci">int64_t maxRequestBodySize</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00135">SquidConfig.h:135</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a616f6fb80c58175d607c035c74744b17"><div class="ttname"><a href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">SquidConfig::Timeout</a></div><div class="ttdeci">struct SquidConfig::@77 Timeout</div></div>
<div class="ttc" id="aclassSquidConfig_html_a628b280b07f322c6cd729a4e129eed98"><div class="ttname"><a href="classSquidConfig.html#a628b280b07f322c6cd729a4e129eed98">SquidConfig::lifetime</a></div><div class="ttdeci">time_t lifetime</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00114">SquidConfig.h:114</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a68726bf1c38ae6752d24c53355e5177e"><div class="ttname"><a href="classSquidConfig.html#a68726bf1c38ae6752d24c53355e5177e">SquidConfig::cert_sign</a></div><div class="ttdeci">sslproxy_cert_sign * cert_sign</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00513">SquidConfig.h:513</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a7359b8e7d76021bb050a0399c1516e94"><div class="ttname"><a href="classSquidConfig.html#a7359b8e7d76021bb050a0399c1516e94">SquidConfig::Addrs</a></div><div class="ttdeci">struct SquidConfig::@85 Addrs</div></div>
<div class="ttc" id="aclassSquidConfig_html_a747b46f46f25817607b0a26f00aae709"><div class="ttname"><a href="classSquidConfig.html#a747b46f46f25817607b0a26f00aae709">SquidConfig::cert_error</a></div><div class="ttdeci">acl_access * cert_error</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00512">SquidConfig.h:512</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a89b927014e22814889b6f23ad9a6e44d"><div class="ttname"><a href="classSquidConfig.html#a89b927014e22814889b6f23ad9a6e44d">SquidConfig::log_mime_hdrs</a></div><div class="ttdeci">int log_mime_hdrs</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00286">SquidConfig.h:286</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a89bec7bc02d66eb2ab65c74c3f6b13ac"><div class="ttname"><a href="classSquidConfig.html#a89bec7bc02d66eb2ab65c74c3f6b13ac">SquidConfig::onoff</a></div><div class="ttdeci">struct SquidConfig::@90 onoff</div></div>
<div class="ttc" id="aclassSquidConfig_html_a919d6cc2ff9a2f64b9d8fda58ab86032"><div class="ttname"><a href="classSquidConfig.html#a919d6cc2ff9a2f64b9d8fda58ab86032">SquidConfig::stats_collection</a></div><div class="ttdeci">acl_access * stats_collection</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00369">SquidConfig.h:369</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a9a5a4aaa278ec44c9807fb2c5433b49b"><div class="ttname"><a href="classSquidConfig.html#a9a5a4aaa278ec44c9807fb2c5433b49b">SquidConfig::maxRequestHeaderSize</a></div><div class="ttdeci">size_t maxRequestHeaderSize</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00134">SquidConfig.h:134</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_aa6bcbad5359c0b290dffff6716171c55"><div class="ttname"><a href="classSquidConfig.html#aa6bcbad5359c0b290dffff6716171c55">SquidConfig::ssl_bump</a></div><div class="ttdeci">acl_access * ssl_bump</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00388">SquidConfig.h:388</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_ac5b7d100001f066494a2fa4d6d39d994"><div class="ttname"><a href="classSquidConfig.html#ac5b7d100001f066494a2fa4d6d39d994">SquidConfig::on_unsupported_protocol</a></div><div class="ttdeci">acl_access * on_unsupported_protocol</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00400">SquidConfig.h:400</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_ac7381aa2d2a2298ff02d01faa10c1dcd"><div class="ttname"><a href="classSquidConfig.html#ac7381aa2d2a2298ff02d01faa10c1dcd">SquidConfig::client_netmask</a></div><div class="ttdeci">Ip::Address client_netmask</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00242">SquidConfig.h:242</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_ac7f1138fffbdda4a9a888100e3187691"><div class="ttname"><a href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">SquidConfig::accessList</a></div><div class="ttdeci">struct SquidConfig::@91 accessList</div></div>
<div class="ttc" id="aclassSquidConfig_html_ad94914cc28bee59463dfefdf9fccd93f"><div class="ttname"><a href="classSquidConfig.html#ad94914cc28bee59463dfefdf9fccd93f">SquidConfig::pipeline_max_prefetch</a></div><div class="ttdeci">int pipeline_max_prefetch</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00347">SquidConfig.h:347</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_adcc196a756093097e03b50d1a796a7ef"><div class="ttname"><a href="classSquidConfig.html#adcc196a756093097e03b50d1a796a7ef">SquidConfig::proxyProtocol</a></div><div class="ttdeci">acl_access * proxyProtocol</div><div class="ttdoc">acceptable PROXY protocol clients</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00395">SquidConfig.h:395</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_aeb41be9b7b69278da79a47837a0db41c"><div class="ttname"><a href="classSquidConfig.html#aeb41be9b7b69278da79a47837a0db41c">SquidConfig::half_closed_clients</a></div><div class="ttdeci">int half_closed_clients</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00289">SquidConfig.h:289</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html">Ssl::CertificateProperties</a></div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00231">gadgets.h:232</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_a02801c0f57427909bdc1bd3f25fc05d9"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#a02801c0f57427909bdc1bd3f25fc05d9">Ssl::CertificateProperties::signWithPkey</a></div><div class="ttdeci">Security::PrivateKeyPointer signWithPkey</div><div class="ttdoc">The key of the signing certificate.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00237">gadgets.h:237</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_a696da8f4b3c1a1f1429135bb9759280b"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#a696da8f4b3c1a1f1429135bb9759280b">Ssl::CertificateProperties::signWithX509</a></div><div class="ttdeci">Security::CertPointer signWithX509</div><div class="ttdoc">Certificate to sign the generated request.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00236">gadgets.h:236</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_a7f540a634da4dc1393dc853a427fb18e"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#a7f540a634da4dc1393dc853a427fb18e">Ssl::CertificateProperties::setCommonName</a></div><div class="ttdeci">bool setCommonName</div><div class="ttdoc">Replace the CN field of the mimicking subject with the given.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00240">gadgets.h:240</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_a936ed7b81a65aa2bc1f6c707a53722e5"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#a936ed7b81a65aa2bc1f6c707a53722e5">Ssl::CertificateProperties::setValidAfter</a></div><div class="ttdeci">bool setValidAfter</div><div class="ttdoc">Do not mimic &quot;Not Valid After&quot; field.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00238">gadgets.h:238</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_a96a9264cbc454c9b7aff464bdfc113e5"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#a96a9264cbc454c9b7aff464bdfc113e5">Ssl::CertificateProperties::signAlgorithm</a></div><div class="ttdeci">CertSignAlgorithm signAlgorithm</div><div class="ttdoc">The signing algorithm to use.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00242">gadgets.h:242</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_aae49c04db7ded1e07a8f78be8f620db7"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#aae49c04db7ded1e07a8f78be8f620db7">Ssl::CertificateProperties::setValidBefore</a></div><div class="ttdeci">bool setValidBefore</div><div class="ttdoc">Do not mimic &quot;Not Valid Before&quot; field.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00239">gadgets.h:239</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_abe15b8d355343b1fa18bab6060f1d0bd"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#abe15b8d355343b1fa18bab6060f1d0bd">Ssl::CertificateProperties::mimicCert</a></div><div class="ttdeci">Security::CertPointer mimicCert</div><div class="ttdoc">Certificate to mimic.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00235">gadgets.h:235</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_af6250b526cf6b3df279810de9544d06f"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#af6250b526cf6b3df279810de9544d06f">Ssl::CertificateProperties::signHash</a></div><div class="ttdeci">const EVP_MD * signHash</div><div class="ttdoc">The signing hash to use.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00243">gadgets.h:243</a></div></div>
<div class="ttc" id="aclassSsl_1_1CertificateProperties_html_afe7c23e9e7cec3f582e753fe2f016624"><div class="ttname"><a href="classSsl_1_1CertificateProperties.html#afe7c23e9e7cec3f582e753fe2f016624">Ssl::CertificateProperties::commonName</a></div><div class="ttdeci">std::string commonName</div><div class="ttdoc">A CN to use for the generated certificate.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00241">gadgets.h:241</a></div></div>
<div class="ttc" id="aclassSsl_1_1ClientBio_html"><div class="ttname"><a href="classSsl_1_1ClientBio.html">Ssl::ClientBio</a></div><div class="ttdef"><b>Definition</b> <a href="bio_8h_source.html#l00070">bio.h:71</a></div></div>
<div class="ttc" id="aclassSsl_1_1ClientBio_html_a48f9b318ad34451b9c1a8976bf133486"><div class="ttname"><a href="classSsl_1_1ClientBio.html#a48f9b318ad34451b9c1a8976bf133486">Ssl::ClientBio::setReadBufData</a></div><div class="ttdeci">void setReadBufData(SBuf &amp;data)</div><div class="ttdef"><b>Definition</b> <a href="bio_8h_source.html#l00091">bio.h:91</a></div></div>
<div class="ttc" id="aclassSsl_1_1ClientBio_html_a9693b62e7d5bc66337b1db3c8f065557"><div class="ttname"><a href="classSsl_1_1ClientBio.html#a9693b62e7d5bc66337b1db3c8f065557">Ssl::ClientBio::hold</a></div><div class="ttdeci">void hold(bool h)</div><div class="ttdoc">Prevents or allow writing on socket.</div><div class="ttdef"><b>Definition</b> <a href="bio_8h_source.html#l00086">bio.h:86</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html">Ssl::CrtdMessage</a></div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8h_source.html#l00024">crtd_message.h:25</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_a0d95b965f4020a923ff9779934d98e3c"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#a0d95b965f4020a923ff9779934d98e3c">Ssl::CrtdMessage::setCode</a></div><div class="ttdeci">void setCode(std::string const &amp;aCode)</div><div class="ttdoc">Set new request/reply code to compose.</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8cc_source.html#l00126">crtd_message.cc:126</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_a6388eb57cea29b950604e15b6d529170"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#a6388eb57cea29b950604e15b6d529170">Ssl::CrtdMessage::code_new_certificate</a></div><div class="ttdeci">static const std::string code_new_certificate</div><div class="ttdoc">String code for &quot;new_certificate&quot; messages.</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8h_source.html#l00076">crtd_message.h:76</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_a6ec98cd6eddf405988732d64ed3efeb5"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#a6ec98cd6eddf405988732d64ed3efeb5">Ssl::CrtdMessage::getBody</a></div><div class="ttdeci">std::string const &amp; getBody() const</div><div class="ttdoc">Current body. If parsing is not finished the method returns incompleted body.</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8cc_source.html#l00120">crtd_message.cc:120</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_a7d6be0d52d128f19fd067af35b04caacac37d4fc22240e516c2e438929aef8f4b"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#a7d6be0d52d128f19fd067af35b04caacac37d4fc22240e516c2e438929aef8f4b">Ssl::CrtdMessage::OK</a></div><div class="ttdeci">@ OK</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8h_source.html#l00030">crtd_message.h:30</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_ab16a925e365a7d69bf83aa7b06a0ef40"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#ab16a925e365a7d69bf83aa7b06a0ef40">Ssl::CrtdMessage::parse</a></div><div class="ttdeci">ParseResult parse(const char *buffer, size_t len)</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8cc_source.html#l00023">crtd_message.cc:23</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_adb501b854f90fc863a05be9d99de4721"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#adb501b854f90fc863a05be9d99de4721">Ssl::CrtdMessage::composeRequest</a></div><div class="ttdeci">void composeRequest(Ssl::CertificateProperties const &amp;)</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8cc_source.html#l00233">crtd_message.cc:233</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_ae2482f04c31d57ad2ae8866eed8eb1eaa7711b142529800543cfcceecb46b1ee9"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#ae2482f04c31d57ad2ae8866eed8eb1eaa7711b142529800543cfcceecb46b1ee9">Ssl::CrtdMessage::REQUEST</a></div><div class="ttdeci">@ REQUEST</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8h_source.html#l00037">crtd_message.h:36</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_ae2482f04c31d57ad2ae8866eed8eb1eaad1007523c42a6ffab464059141e9163c"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#ae2482f04c31d57ad2ae8866eed8eb1eaad1007523c42a6ffab464059141e9163c">Ssl::CrtdMessage::REPLY</a></div><div class="ttdeci">@ REPLY</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8h_source.html#l00035">crtd_message.h:35</a></div></div>
<div class="ttc" id="aclassSsl_1_1CrtdMessage_html_afa09c41a96caaeb96dd15aa26da9d4a6"><div class="ttname"><a href="classSsl_1_1CrtdMessage.html#afa09c41a96caaeb96dd15aa26da9d4a6">Ssl::CrtdMessage::compose</a></div><div class="ttdeci">std::string compose() const</div><div class="ttdef"><b>Definition</b> <a href="crtd__message_8cc_source.html#l00128">crtd_message.cc:128</a></div></div>
<div class="ttc" id="aclassSsl_1_1GlobalContextStorage_html_a171a2add4e1703bf383af5fb0c6fec01"><div class="ttname"><a href="classSsl_1_1GlobalContextStorage.html#a171a2add4e1703bf383af5fb0c6fec01">Ssl::GlobalContextStorage::addLocalStorage</a></div><div class="ttdeci">void addLocalStorage(Ip::Address const &amp;address, size_t size_of_store)</div><div class="ttdoc">Create new SSL context storage for the local listening address/port.</div><div class="ttdef"><b>Definition</b> <a href="context__storage_8cc_source.html#l00074">context_storage.cc:74</a></div></div>
<div class="ttc" id="aclassSsl_1_1GlobalContextStorage_html_a72a41bca276f8d614552bbe2d5d83e93"><div class="ttname"><a href="classSsl_1_1GlobalContextStorage.html#a72a41bca276f8d614552bbe2d5d83e93">Ssl::GlobalContextStorage::getLocalStorage</a></div><div class="ttdeci">LocalContextStorage * getLocalStorage(Ip::Address const &amp;address)</div><div class="ttdoc">Return the local storage for the given listening address/port.</div><div class="ttdef"><b>Definition</b> <a href="context__storage_8cc_source.html#l00080">context_storage.cc:80</a></div></div>
<div class="ttc" id="aclassSsl_1_1Helper_html_a3f523a393ebebc53dffd8bed67043e3e"><div class="ttname"><a href="classSsl_1_1Helper.html#a3f523a393ebebc53dffd8bed67043e3e">Ssl::Helper::Submit</a></div><div class="ttdeci">static void Submit(CrtdMessage const &amp;message, HLPCB *callback, void *data)</div><div class="ttdoc">Submit crtd message to external crtd server.</div><div class="ttdef"><b>Definition</b> <a href="ssl_2helper_8cc_source.html#l00128">helper.cc:128</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html"><div class="ttname"><a href="classSsl_1_1ServerBump.html">Ssl::ServerBump</a></div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00033">ServerBump.h:34</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_a011ad80b2b50cbf592615642809c74ee"><div class="ttname"><a href="classSsl_1_1ServerBump.html#a011ad80b2b50cbf592615642809c74ee">Ssl::ServerBump::act</a></div><div class="ttdeci">struct Ssl::ServerBump::@103 act</div><div class="ttdoc">bumping actions at various bumping steps</div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_a51cb62b4cccfa1e6d1e0b9f97bdb76cd"><div class="ttname"><a href="classSsl_1_1ServerBump.html#a51cb62b4cccfa1e6d1e0b9f97bdb76cd">Ssl::ServerBump::entry</a></div><div class="ttdeci">StoreEntry * entry</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00054">ServerBump.h:54</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_a65f6edc9928c6e1f7a494e12a48a9af1"><div class="ttname"><a href="classSsl_1_1ServerBump.html#a65f6edc9928c6e1f7a494e12a48a9af1">Ssl::ServerBump::at</a></div><div class="ttdeci">bool at(const BumpStep stp) const</div><div class="ttdoc">whether we are currently performing the given processing step</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00047">ServerBump.h:47</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_a77506da609c0ee1e8af131e408af9ca2"><div class="ttname"><a href="classSsl_1_1ServerBump.html#a77506da609c0ee1e8af131e408af9ca2">Ssl::ServerBump::sslErrors</a></div><div class="ttdeci">Security::CertErrors * sslErrors() const</div><div class="ttdoc">SSL [certificate validation] errors.</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8cc_source.html#l00066">ServerBump.cc:66</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_a83a1623a479040e0badfcc858c1b034c"><div class="ttname"><a href="classSsl_1_1ServerBump.html#a83a1623a479040e0badfcc858c1b034c">Ssl::ServerBump::step2</a></div><div class="ttdeci">Ssl::BumpMode step2</div><div class="ttdoc">The SSL bump mode at step2.</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00060">ServerBump.h:60</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_a8c22dd3523704699b13bea1062d65dbc"><div class="ttname"><a href="classSsl_1_1ServerBump.html#a8c22dd3523704699b13bea1062d65dbc">Ssl::ServerBump::step1</a></div><div class="ttdeci">Ssl::BumpMode step1</div><div class="ttdoc">The SSL bump mode at step1.</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00059">ServerBump.h:59</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_aaa318ba6ee683f0db877f2d3f34fea52"><div class="ttname"><a href="classSsl_1_1ServerBump.html#aaa318ba6ee683f0db877f2d3f34fea52">Ssl::ServerBump::step</a></div><div class="ttdeci">Ssl::BumpStep step</div><div class="ttdoc">The SSL bumping step.</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00063">ServerBump.h:63</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_ac00f74e107968a88807b205e1f53058c"><div class="ttname"><a href="classSsl_1_1ServerBump.html#ac00f74e107968a88807b205e1f53058c">Ssl::ServerBump::request</a></div><div class="ttdeci">HttpRequest::Pointer request</div><div class="ttdoc">faked, minimal request; required by Client API</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00053">ServerBump.h:53</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_ade4dbe5af4cec14e5416a75f51a1c6c7"><div class="ttname"><a href="classSsl_1_1ServerBump.html#ade4dbe5af4cec14e5416a75f51a1c6c7">Ssl::ServerBump::connectedOk</a></div><div class="ttdeci">bool connectedOk() const</div><div class="ttdoc">whether there was a successful connection to (and peeking at) the origin server</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00044">ServerBump.h:44</a></div></div>
<div class="ttc" id="aclassSsl_1_1ServerBump_html_afa21f04f6d7072a8b541732790a0ec18"><div class="ttname"><a href="classSsl_1_1ServerBump.html#afa21f04f6d7072a8b541732790a0ec18">Ssl::ServerBump::serverCert</a></div><div class="ttdeci">Security::CertPointer serverCert</div><div class="ttdef"><b>Definition</b> <a href="ServerBump_8h_source.html#l00057">ServerBump.h:57</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a0c349cdd4b2da5c7c36f4a57ac1fdd85"><div class="ttname"><a href="classStatCounters.html#a0c349cdd4b2da5c7c36f4a57ac1fdd85">StatCounters::querySvcTime</a></div><div class="ttdeci">StatHist querySvcTime</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00082">StatCounters.h:82</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a28aa8251678753402433e583e0bd14bc"><div class="ttname"><a href="classStatCounters.html#a28aa8251678753402433e583e0bd14bc">StatCounters::nearHitSvcTime</a></div><div class="ttdeci">StatHist nearHitSvcTime</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00050">StatCounters.h:50</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a46197273c850cec456b5a45072a363b7"><div class="ttname"><a href="classStatCounters.html#a46197273c850cec456b5a45072a363b7">StatCounters::missSvcTime</a></div><div class="ttdeci">StatHist missSvcTime</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00048">StatCounters.h:48</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a521030ab419aab60abd94890fb11771d"><div class="ttname"><a href="classStatCounters.html#a521030ab419aab60abd94890fb11771d">StatCounters::hits</a></div><div class="ttdeci">int hits</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00041">StatCounters.h:41</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a58fd5a18aeb684f968af469e22c76e56"><div class="ttname"><a href="classStatCounters.html#a58fd5a18aeb684f968af469e22c76e56">StatCounters::hitSvcTime</a></div><div class="ttdeci">StatHist hitSvcTime</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00051">StatCounters.h:51</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a637679d6acf6ce048ec6299166492d4c"><div class="ttname"><a href="classStatCounters.html#a637679d6acf6ce048ec6299166492d4c">StatCounters::times_used</a></div><div class="ttdeci">int times_used</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00085">StatCounters.h:85</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a6ea85e50bdac37a196e72285225ec743"><div class="ttname"><a href="classStatCounters.html#a6ea85e50bdac37a196e72285225ec743">StatCounters::allSvcTime</a></div><div class="ttdeci">StatHist allSvcTime</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00052">StatCounters.h:52</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a76bbd29fad3e173cdeb1d8fc87430fc3"><div class="ttname"><a href="classStatCounters.html#a76bbd29fad3e173cdeb1d8fc87430fc3">StatCounters::netdb</a></div><div class="ttdeci">struct StatCounters::@111 netdb</div></div>
<div class="ttc" id="aclassStatCounters_html_a865b73b8d290e02c6fb333ddec66ee21"><div class="ttname"><a href="classStatCounters.html#a865b73b8d290e02c6fb333ddec66ee21">StatCounters::query_timeouts</a></div><div class="ttdeci">int query_timeouts</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00084">StatCounters.h:84</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a8cd6e48b996bbdf19dbb6bf4fe5b4431"><div class="ttname"><a href="classStatCounters.html#a8cd6e48b996bbdf19dbb6bf4fe5b4431">StatCounters::kbytes_out</a></div><div class="ttdeci">ByteCounter kbytes_out</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00046">StatCounters.h:46</a></div></div>
<div class="ttc" id="aclassStatCounters_html_a93ee104c406cb7f6cddec42a031f674b"><div class="ttname"><a href="classStatCounters.html#a93ee104c406cb7f6cddec42a031f674b">StatCounters::requests</a></div><div class="ttdeci">int requests</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00040">StatCounters.h:40</a></div></div>
<div class="ttc" id="aclassStatCounters_html_aa00575c8fd1645b8e42c0062dc8f84ad"><div class="ttname"><a href="classStatCounters.html#aa00575c8fd1645b8e42c0062dc8f84ad">StatCounters::cd</a></div><div class="ttdeci">struct StatCounters::@110 cd</div></div>
<div class="ttc" id="aclassStatCounters_html_aa87bb28e8f026dba59d90cee344b6f4a"><div class="ttname"><a href="classStatCounters.html#aa87bb28e8f026dba59d90cee344b6f4a">StatCounters::nearMissSvcTime</a></div><div class="ttdeci">StatHist nearMissSvcTime</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00049">StatCounters.h:49</a></div></div>
<div class="ttc" id="aclassStatCounters_html_aa9bd802b635bb0f5b9fc404c54bbb565"><div class="ttname"><a href="classStatCounters.html#aa9bd802b635bb0f5b9fc404c54bbb565">StatCounters::errors</a></div><div class="ttdeci">int errors</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00044">StatCounters.h:44</a></div></div>
<div class="ttc" id="aclassStatCounters_html_aadc939133f4aa79c5889a83eaf071d15"><div class="ttname"><a href="classStatCounters.html#aadc939133f4aa79c5889a83eaf071d15">StatCounters::hit_kbytes_out</a></div><div class="ttdeci">ByteCounter hit_kbytes_out</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00047">StatCounters.h:47</a></div></div>
<div class="ttc" id="aclassStatCounters_html_acc53db8d01577746bb79d407f889bb19"><div class="ttname"><a href="classStatCounters.html#acc53db8d01577746bb79d407f889bb19">StatCounters::icp</a></div><div class="ttdeci">struct StatCounters::@106 icp</div></div>
<div class="ttc" id="aclassStatCounters_html_ace4cc867ca19ccefca9caf75a515e4be"><div class="ttname"><a href="classStatCounters.html#ace4cc867ca19ccefca9caf75a515e4be">StatCounters::disk_hits</a></div><div class="ttdeci">int disk_hits</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00043">StatCounters.h:43</a></div></div>
<div class="ttc" id="aclassStatCounters_html_ad06d5587d2fdde49526194cc4fa5b991"><div class="ttname"><a href="classStatCounters.html#ad06d5587d2fdde49526194cc4fa5b991">StatCounters::mem_hits</a></div><div class="ttdeci">int mem_hits</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00042">StatCounters.h:42</a></div></div>
<div class="ttc" id="aclassStatCounters_html_ae0515f9863b6255630e2563b01f8ca43"><div class="ttname"><a href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">StatCounters::client_http</a></div><div class="ttdeci">struct StatCounters::@104 client_http</div></div>
<div class="ttc" id="aclassStatHist_html_ac040b690ee1c593fe3e5e32960abfc53"><div class="ttname"><a href="classStatHist.html#ac040b690ee1c593fe3e5e32960abfc53">StatHist::count</a></div><div class="ttdeci">void count(double val)</div><div class="ttdef"><b>Definition</b> <a href="StatHist_8cc_source.html#l00055">StatHist.cc:55</a></div></div>
<div class="ttc" id="aclassStoreEntry_html"><div class="ttname"><a href="classStoreEntry.html">StoreEntry</a></div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00037">Store.h:38</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a19fd5af89e99c467c29f7bd951ac901d"><div class="ttname"><a href="classStoreEntry.html#a19fd5af89e99c467c29f7bd951ac901d">StoreEntry::mem</a></div><div class="ttdeci">MemObject &amp; mem()</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00047">Store.h:47</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_a88e8fcd41e9d2d0c24ea68daa9a4eb57"><div class="ttname"><a href="classStoreEntry.html#a88e8fcd41e9d2d0c24ea68daa9a4eb57">StoreEntry::getMD5Text</a></div><div class="ttdeci">const char * getMD5Text() const</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l00207">store.cc:207</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_ab79c9d3fba14d5c997bae61161d9992f"><div class="ttname"><a href="classStoreEntry.html#ab79c9d3fba14d5c997bae61161d9992f">StoreEntry::mem_obj</a></div><div class="ttdeci">MemObject * mem_obj</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00220">Store.h:220</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_ae4dc05b6c5ca398130c0a155156592d2"><div class="ttname"><a href="classStoreEntry.html#ae4dc05b6c5ca398130c0a155156592d2">StoreEntry::isEmpty</a></div><div class="ttdeci">bool isEmpty() const</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00065">Store.h:65</a></div></div>
<div class="ttc" id="aclassStoreEntry_html_ae730bbd0568e47c42942cac64ee191e2"><div class="ttname"><a href="classStoreEntry.html#ae730bbd0568e47c42942cac64ee191e2">StoreEntry::contentLen</a></div><div class="ttdeci">int64_t contentLen() const</div><div class="ttdef"><b>Definition</b> <a href="Store_8h_source.html#l00254">Store.h:254</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html"><div class="ttname"><a href="classStoreIOBuffer.html">StoreIOBuffer</a></div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00015">StoreIOBuffer.h:16</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a08224ebb5a73aa6b18c0e7a60ebf00b5"><div class="ttname"><a href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">StoreIOBuffer::data</a></div><div class="ttdeci">char * data</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00059">StoreIOBuffer.h:59</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a97772bf328fe745e1d1fc23ee91cec39"><div class="ttname"><a href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">StoreIOBuffer::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00057">StoreIOBuffer.h:57</a></div></div>
<div class="ttc" id="aclassString_html"><div class="ttname"><a href="classString.html">String</a></div><div class="ttdef"><b>Definition</b> <a href="SquidString_8h_source.html#l00026">SquidString.h:27</a></div></div>
<div class="ttc" id="aclassString_html_a60a0fdff84d3470d812b2adbcb2cbf38"><div class="ttname"><a href="classString.html#a60a0fdff84d3470d812b2adbcb2cbf38">String::clean</a></div><div class="ttdeci">void clean()</div><div class="ttdef"><b>Definition</b> <a href="String_8cc_source.html#l00104">String.cc:104</a></div></div>
<div class="ttc" id="aclassString_html_aba5551ee62c6e82730c0cb1856238c14"><div class="ttname"><a href="classString.html#aba5551ee62c6e82730c0cb1856238c14">String::termedBuf</a></div><div class="ttdeci">char const * termedBuf() const</div><div class="ttdef"><b>Definition</b> <a href="SquidString_8h_source.html#l00093">SquidString.h:93</a></div></div>
<div class="ttc" id="aclassString_html_abd8b379e2e87081854ed606d9e941c95"><div class="ttname"><a href="classString.html#abd8b379e2e87081854ed606d9e941c95">String::append</a></div><div class="ttdeci">void append(char const *buf, int len)</div><div class="ttdef"><b>Definition</b> <a href="String_8cc_source.html#l00131">String.cc:131</a></div></div>
<div class="ttc" id="aclassTextException_html"><div class="ttname"><a href="classTextException.html">TextException</a></div><div class="ttdoc">an std::runtime_error with thrower location info</div><div class="ttdef"><b>Definition</b> <a href="TextException_8h_source.html#l00020">TextException.h:21</a></div></div>
<div class="ttc" id="aclassTextException_html_abfea83f3cf2b694b5c9d8ab98fe9b6d0"><div class="ttname"><a href="classTextException.html#abfea83f3cf2b694b5c9d8ab98fe9b6d0">TextException::id</a></div><div class="ttdeci">SourceLocationId id() const</div><div class="ttdoc">same-location exceptions have the same ID</div><div class="ttdef"><b>Definition</b> <a href="TextException_8h_source.html#l00040">TextException.h:40</a></div></div>
<div class="ttc" id="aclassWithAnswer_html"><div class="ttname"><a href="classWithAnswer.html">WithAnswer</a></div><div class="ttdoc">access to a callback result carried by an asynchronous CallDialer</div><div class="ttdef"><b>Definition</b> <a href="AsyncCallbacks_8h_source.html#l00018">AsyncCallbacks.h:19</a></div></div>
<div class="ttc" id="aclassWithExtras_html"><div class="ttname"><a href="classWithExtras.html">WithExtras</a></div><div class="ttdoc">Helps prints T object using object's T::printWithExtras() method.</div><div class="ttdef"><b>Definition</b> <a href="IoManip_8h_source.html#l00293">IoManip.h:294</a></div></div>
<div class="ttc" id="aclassclientReplyContext_html"><div class="ttname"><a href="classclientReplyContext.html">clientReplyContext</a></div><div class="ttdef"><b>Definition</b> <a href="client__side__reply_8h_source.html#l00022">client_side_reply.h:23</a></div></div>
<div class="ttc" id="aclassclientReplyContext_html_a54642fc1f8d38e1860d4e945d820889d"><div class="ttname"><a href="classclientReplyContext.html#a54642fc1f8d38e1860d4e945d820889d">clientReplyContext::setReplyToStoreEntry</a></div><div class="ttdeci">void setReplyToStoreEntry(StoreEntry *e, const char *reason)</div><div class="ttdoc">replaces current response store entry with the given one</div><div class="ttdef"><b>Definition</b> <a href="client__side__reply_8cc_source.html#l00149">client_side_reply.cc:149</a></div></div>
<div class="ttc" id="aclassclientReplyContext_html_ababe13d071231c0cf2a4956ff911bd5f"><div class="ttname"><a href="classclientReplyContext.html#ababe13d071231c0cf2a4956ff911bd5f">clientReplyContext::http</a></div><div class="ttdeci">ClientHttpRequest * http</div><div class="ttdef"><b>Definition</b> <a href="client__side__reply_8h_source.html#l00070">client_side_reply.h:70</a></div></div>
<div class="ttc" id="aclassclientReplyContext_html_aefdedf444de122be303a2c56dc7ef1a9"><div class="ttname"><a href="classclientReplyContext.html#aefdedf444de122be303a2c56dc7ef1a9">clientReplyContext::setReplyToError</a></div><div class="ttdeci">void setReplyToError(err_type, Http::StatusCode, char const *, const ConnStateData *, HttpRequest *, const char *, Auth::UserRequest::Pointer)</div><div class="ttdoc">builds error using clientBuildError() and calls setReplyToError() below</div><div class="ttdef"><b>Definition</b> <a href="client__side__reply_8cc_source.html#l00094">client_side_reply.cc:94</a></div></div>
<div class="ttc" id="aclassclientStreamNode_html"><div class="ttname"><a href="classclientStreamNode.html">clientStreamNode</a></div><div class="ttdef"><b>Definition</b> <a href="clientStream_8h_source.html#l00075">clientStream.h:76</a></div></div>
<div class="ttc" id="aclassdlink__list_html_a532f15958755b4d0d6356f7a52291d4e"><div class="ttname"><a href="classdlink__list.html#a532f15958755b4d0d6356f7a52291d4e">dlink_list::tail</a></div><div class="ttdeci">dlink_node * tail</div><div class="ttdef"><b>Definition</b> <a href="dlink_8h_source.html#l00027">dlink.h:27</a></div></div>
<div class="ttc" id="aclassdlink__node_html_a06bd2bfe93cc751ab5b29b033e6ac65e"><div class="ttname"><a href="classdlink__node.html#a06bd2bfe93cc751ab5b29b033e6ac65e">dlink_node::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition</b> <a href="dlink_8h_source.html#l00018">dlink.h:18</a></div></div>
<div class="ttc" id="aclassping__data_html"><div class="ttname"><a href="classping__data.html">ping_data</a></div><div class="ttdoc">ICP probing of cache_peers during peer selection.</div><div class="ttdef"><b>Definition</b> <a href="PingData_8h_source.html#l00025">PingData.h:26</a></div></div>
<div class="ttc" id="aclassping__data_html_a06ee5e33529ba7d6b7684b67c44b6eb2"><div class="ttname"><a href="classping__data.html#a06ee5e33529ba7d6b7684b67c44b6eb2">ping_data::start</a></div><div class="ttdeci">struct timeval start</div><div class="ttdef"><b>Definition</b> <a href="PingData_8h_source.html#l00035">PingData.h:35</a></div></div>
<div class="ttc" id="aclassping__data_html_a4c6316b5ae6fb68a7fc40588423694f7"><div class="ttname"><a href="classping__data.html#a4c6316b5ae6fb68a7fc40588423694f7">ping_data::timeout</a></div><div class="ttdeci">int timeout</div><div class="ttdef"><b>Definition</b> <a href="PingData_8h_source.html#l00041">PingData.h:41</a></div></div>
<div class="ttc" id="aclassping__data_html_a4eef39d2e9073372d1dce22c6e6c1a43"><div class="ttname"><a href="classping__data.html#a4eef39d2e9073372d1dce22c6e6c1a43">ping_data::stop</a></div><div class="ttdeci">struct timeval stop</div><div class="ttdef"><b>Definition</b> <a href="PingData_8h_source.html#l00037">PingData.h:37</a></div></div>
<div class="ttc" id="aclasssslproxy__cert__adapt_html"><div class="ttname"><a href="classsslproxy__cert__adapt.html">sslproxy_cert_adapt</a></div><div class="ttdef"><b>Definition</b> <a href="ProxyCerts_8h_source.html#l00038">ProxyCerts.h:39</a></div></div>
<div class="ttc" id="aclasssslproxy__cert__sign_html"><div class="ttname"><a href="classsslproxy__cert__sign.html">sslproxy_cert_sign</a></div><div class="ttdef"><b>Definition</b> <a href="ProxyCerts_8h_source.html#l00017">ProxyCerts.h:18</a></div></div>
<div class="ttc" id="aclientStream_8h_html"><div class="ttname"><a href="clientStream_8h.html">clientStream.h</a></div></div>
<div class="ttc" id="aclient__db_8cc_html_a3f1ddfeb929e358b2398430c1b888a2f"><div class="ttname"><a href="client__db_8cc.html#a3f1ddfeb929e358b2398430c1b888a2f">clientdbEstablished</a></div><div class="ttdeci">int clientdbEstablished(const Ip::Address &amp;addr, int delta)</div><div class="ttdef"><b>Definition</b> <a href="client__db_8cc_source.html#l00182">client_db.cc:182</a></div></div>
<div class="ttc" id="aclient__db_8cc_html_a44a785ce283010d0e916ae0710dcd7f6"><div class="ttname"><a href="client__db_8cc.html#a44a785ce283010d0e916ae0710dcd7f6">clientdbUpdate</a></div><div class="ttdeci">void clientdbUpdate(const Ip::Address &amp;addr, const LogTags &amp;ltype, AnyP::ProtocolType p, size_t size)</div><div class="ttdef"><b>Definition</b> <a href="client__db_8cc_source.html#l00138">client_db.cc:138</a></div></div>
<div class="ttc" id="aclient__db_8cc_html_ad7454f361eaba3ee92bbe4403255edf2"><div class="ttname"><a href="client__db_8cc.html#ad7454f361eaba3ee92bbe4403255edf2">clientdbGetInfo</a></div><div class="ttdeci">ClientInfo * clientdbGetInfo(const Ip::Address &amp;addr)</div><div class="ttdef"><b>Definition</b> <a href="client__db_8cc_source.html#l00119">client_db.cc:119</a></div></div>
<div class="ttc" id="aclient__db_8h_html"><div class="ttname"><a href="client__db_8h.html">client_db.h</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a00d61405a518ee24f5beedc0a9a8b3b6"><div class="ttname"><a href="client__side_8cc.html#a00d61405a518ee24f5beedc0a9a8b3b6">clientListenerConnectionOpened</a></div><div class="ttdeci">static void clientListenerConnectionOpened(AnyP::PortCfgPointer &amp;s, const Ipc::FdNoteId portTypeNote, const Subscription::Pointer &amp;sub)</div><div class="ttdoc">process clientHttpConnectionsOpen result</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03321">client_side.cc:3321</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a0ae37ef9173185eeab5a1581363f4925"><div class="ttname"><a href="client__side_8cc.html#a0ae37ef9173185eeab5a1581363f4925">clientUpdateStatHistCounters</a></div><div class="ttdeci">static void clientUpdateStatHistCounters(const LogTags &amp;logType, int svc_time)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00212">client_side.cc:212</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a0f7eff99f419b5281561a72ef2635824"><div class="ttname"><a href="client__side_8cc.html#a0f7eff99f419b5281561a72ef2635824">prepareTransparentURL</a></div><div class="ttdeci">static char * prepareTransparentURL(ConnStateData *conn, const Http1::RequestParserPointer &amp;hp)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01230">client_side.cc:1230</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a11791d48b590d9dc9185647d5bdb5d30"><div class="ttname"><a href="client__side_8cc.html#a11791d48b590d9dc9185647d5bdb5d30">clientHttpConnectionsOpen</a></div><div class="ttdeci">static void clientHttpConnectionsOpen(void)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03244">client_side.cc:3244</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a132279318afa1e5ec7a73f85754f6535"><div class="ttname"><a href="client__side_8cc.html#a132279318afa1e5ec7a73f85754f6535">findTrailingHTTPVersion</a></div><div class="ttdeci">const char * findTrailingHTTPVersion(const char *uriAndHTTPVersion, const char *end)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01052">client_side.cc:1052</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a135b38eb4ef6e03860b1407c774988fa"><div class="ttname"><a href="client__side_8cc.html#a135b38eb4ef6e03860b1407c774988fa">clientPingHasFinished</a></div><div class="ttdeci">static bool clientPingHasFinished(ping_data const *aPing)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00254">client_side.cc:254</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a172a2bb05c54e4da9bad9bbcdf9c8ad0"><div class="ttname"><a href="client__side_8cc.html#a172a2bb05c54e4da9bad9bbcdf9c8ad0">httpsEstablish</a></div><div class="ttdeci">static void httpsEstablish(ConnStateData *connState, const Security::ContextPointer &amp;ctx)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02394">client_side.cc:2394</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a22777922b0ae6451894a83f1ec3614ed"><div class="ttname"><a href="client__side_8cc.html#a22777922b0ae6451894a83f1ec3614ed">prepareLogWithRequestDetails</a></div><div class="ttdeci">void prepareLogWithRequestDetails(HttpRequest *, const AccessLogEntryPointer &amp;)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00322">client_side.cc:322</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a272c72729edfb97946075fa94bbb0b02"><div class="ttname"><a href="client__side_8cc.html#a272c72729edfb97946075fa94bbb0b02">clientProcessRequestFinished</a></div><div class="ttdeci">void clientProcessRequestFinished(ConnStateData *conn, const HttpRequest::Pointer &amp;request)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01552">client_side.cc:1552</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a3367b6cc488434bdbffe8eed828b055b"><div class="ttname"><a href="client__side_8cc.html#a3367b6cc488434bdbffe8eed828b055b">httpsSslBumpAccessCheckDone</a></div><div class="ttdeci">static void httpsSslBumpAccessCheckDone(Acl::Answer answer, void *data)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02412">client_side.cc:2412</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a347fa37628f399b885a509417a7aa493"><div class="ttname"><a href="client__side_8cc.html#a347fa37628f399b885a509417a7aa493">clientOpenListenSockets</a></div><div class="ttdeci">void clientOpenListenSockets(void)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03359">client_side.cc:3359</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a543c6b42543c68733190d18e2a933a58"><div class="ttname"><a href="client__side_8cc.html#a543c6b42543c68733190d18e2a933a58">clientProcessRequest</a></div><div class="ttdeci">void clientProcessRequest(ConnStateData *conn, const Http1::RequestParserPointer &amp;hp, Http::Stream *context)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01568">client_side.cc:1568</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a596a46d13b2e131ece4f5d986a1e30ac"><div class="ttname"><a href="client__side_8cc.html#a596a46d13b2e131ece4f5d986a1e30ac">httpsCreate</a></div><div class="ttdeci">static bool httpsCreate(const ConnStateData *connState, const Security::ContextPointer &amp;ctx)</div><div class="ttdoc">Create TLS connection structure and update fd_table.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02263">client_side.cc:2263</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a5a4f905ea37316b8a11b79df1faa99db"><div class="ttname"><a href="client__side_8cc.html#a5a4f905ea37316b8a11b79df1faa99db">OpenedHttpSocket</a></div><div class="ttdeci">static bool OpenedHttpSocket(const Comm::ConnectionPointer &amp;c, const Ipc::FdNoteId portType)</div><div class="ttdoc">check FD after clientHttp[s]ConnectionOpened, adjust HttpSockets as needed</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03216">client_side.cc:3216</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a71615419ed103d56cb288e1cbc1dbe38"><div class="ttname"><a href="client__side_8cc.html#a71615419ed103d56cb288e1cbc1dbe38">clientNegotiateSSL</a></div><div class="ttdeci">static void clientNegotiateSSL(int fd, void *data)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02278">client_side.cc:2278</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a738fe2a8ee19820909d5ba8f7f4ca85d"><div class="ttname"><a href="client__side_8cc.html#a738fe2a8ee19820909d5ba8f7f4ca85d">buildUrlFromHost</a></div><div class="ttdeci">static char * buildUrlFromHost(ConnStateData *conn, const Http1::RequestParserPointer &amp;hp)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01179">client_side.cc:1179</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a766113836f4b2ce05e7dfe662c5d161a"><div class="ttname"><a href="client__side_8cc.html#a766113836f4b2ce05e7dfe662c5d161a">clientIsRequestBodyTooLargeForPolicy</a></div><div class="ttdeci">static int clientIsRequestBodyTooLargeForPolicy(int64_t bodyLength)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00686">client_side.cc:686</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a977550c14579d24c36cc8f663a64dd15"><div class="ttname"><a href="client__side_8cc.html#a977550c14579d24c36cc8f663a64dd15">httpRequestFree</a></div><div class="ttdeci">void httpRequestFree(void *data)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00475">client_side.cc:475</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a97924d6b6b7c2ddc072fe0caecbcfe1d"><div class="ttname"><a href="client__side_8cc.html#a97924d6b6b7c2ddc072fe0caecbcfe1d">AddOpenedHttpSocket</a></div><div class="ttdeci">static bool AddOpenedHttpSocket(const Comm::ConnectionPointer &amp;conn)</div><div class="ttdoc">find any unused HttpSockets[] slot and store fd there or return false</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03233">client_side.cc:3233</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a99e22f88fd50b4f1daa837e39f18ab04"><div class="ttname"><a href="client__side_8cc.html#a99e22f88fd50b4f1daa837e39f18ab04">httpsAccept</a></div><div class="ttdeci">static void httpsAccept(const CommAcceptCbParams &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02440">client_side.cc:2440</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_aa132546cdd82acdfa0a650943f6d936b"><div class="ttname"><a href="client__side_8cc.html#aa132546cdd82acdfa0a650943f6d936b">clientUpdateHierCounters</a></div><div class="ttdeci">static void clientUpdateHierCounters(HierarchyLogEntry *)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00263">client_side.cc:263</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_aa43c942879dd80b024c465afa58f85aa"><div class="ttname"><a href="client__side_8cc.html#aa43c942879dd80b024c465afa58f85aa">clientAclChecklistCreate</a></div><div class="ttdeci">ACLFilledChecklist::MakingPointer clientAclChecklistCreate(const acl_access *acl, ClientHttpRequest *http)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03457">client_side.cc:3457</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_aa598a3822a54b412815630007ed6982b"><div class="ttname"><a href="client__side_8cc.html#aa598a3822a54b412815630007ed6982b">clientSetKeepaliveFlag</a></div><div class="ttdeci">void clientSetKeepaliveFlag(ClientHttpRequest *http)</div><div class="ttdoc">decide whether to expect multiple requests on the corresponding connection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00674">client_side.cc:674</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_aabee8b7031277506f399a75979659b38"><div class="ttname"><a href="client__side_8cc.html#aabee8b7031277506f399a75979659b38">clientPackTermBound</a></div><div class="ttdeci">void clientPackTermBound(String boundary, MemBuf *mb)</div><div class="ttdoc">put terminating boundary for multiparts to the buffer</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00702">client_side.cc:702</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_aacbb7e426f92f53cf8fe185fd095f4b9"><div class="ttname"><a href="client__side_8cc.html#aacbb7e426f92f53cf8fe185fd095f4b9">prepareAcceleratedURL</a></div><div class="ttdeci">static char * prepareAcceleratedURL(ConnStateData *conn, const Http1::RequestParserPointer &amp;hp)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01075">client_side.cc:1075</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_ab489de204612ef3a359eee05b1556dda"><div class="ttname"><a href="client__side_8cc.html#ab489de204612ef3a359eee05b1556dda">ClientSocketContextPushDeferredIfNeeded</a></div><div class="ttdeci">static void ClientSocketContextPushDeferredIfNeeded(Http::StreamPointer deferredRequest, ConnStateData *conn)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00872">client_side.cc:872</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_ab9b84c4e1325a12972ccd56432a946a0"><div class="ttname"><a href="client__side_8cc.html#ab9b84c4e1325a12972ccd56432a946a0">skipLeadingSpace</a></div><div class="ttdeci">char * skipLeadingSpace(char *aString)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01036">client_side.cc:1036</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_abc48bb93b6bb570b3ffee98f883c7f79"><div class="ttname"><a href="client__side_8cc.html#abc48bb93b6bb570b3ffee98f883c7f79">varyEvaluateMatch</a></div><div class="ttdeci">int varyEvaluateMatch(StoreEntry *entry, HttpRequest *request)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03393">client_side.cc:3393</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_abce78a023899deca91d058bb3a4b44c5"><div class="ttname"><a href="client__side_8cc.html#abce78a023899deca91d058bb3a4b44c5">clientUpdateStatCounters</a></div><div class="ttdeci">static void clientUpdateStatCounters(const LogTags &amp;logType)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00198">client_side.cc:198</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_ac237972e8482631d1091e2a7dc4119d0"><div class="ttname"><a href="client__side_8cc.html#ac237972e8482631d1091e2a7dc4119d0">operator&lt;&lt;</a></div><div class="ttdeci">std::ostream &amp; operator&lt;&lt;(std::ostream &amp;os, const ConnStateData::PinnedIdleContext &amp;pic)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l04008">client_side.cc:4009</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_acabcacffff4309ce2ac0aa3252eaf2ba"><div class="ttname"><a href="client__side_8cc.html#acabcacffff4309ce2ac0aa3252eaf2ba">clientAclChecklistFill</a></div><div class="ttdeci">void clientAclChecklistFill(ACLFilledChecklist &amp;checklist, ClientHttpRequest *http)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03465">client_side.cc:3465</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_acb06d6b31feae712eada0ba24c2c009f"><div class="ttname"><a href="client__side_8cc.html#acb06d6b31feae712eada0ba24c2c009f">httpsSslBumpStep2AccessCheckDone</a></div><div class="ttdeci">static void httpsSslBumpStep2AccessCheckDone(Acl::Answer answer, void *data)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02899">client_side.cc:2899</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_ad4b535b12e4c55b5763c6644d0e40a6e"><div class="ttname"><a href="client__side_8cc.html#ad4b535b12e4c55b5763c6644d0e40a6e">clientStartListeningOn</a></div><div class="ttdeci">void clientStartListeningOn(AnyP::PortCfgPointer &amp;port, const RefCount&lt; CommCbFunPtrCallT&lt; CommAcceptCbPtrFun &gt; &gt; &amp;subCall, const Ipc::FdNoteId fdNote)</div><div class="ttdoc">accept requests to a given port and inform subCall about them</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03293">client_side.cc:3293</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_ae29c88c073239e35ef8f8a82e9d5f689"><div class="ttname"><a href="client__side_8cc.html#ae29c88c073239e35ef8f8a82e9d5f689">clientConnectionsClose</a></div><div class="ttdeci">void clientConnectionsClose()</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03369">client_side.cc:3369</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_af77cbb84079fd464aaf980442dcd8870"><div class="ttname"><a href="client__side_8cc.html#af77cbb84079fd464aaf980442dcd8870">clientPackRangeHdr</a></div><div class="ttdeci">void clientPackRangeHdr(const HttpReplyPointer &amp;rep, const HttpHdrRangeSpec *spec, String boundary, MemBuf *mb)</div><div class="ttdoc">append a &quot;part&quot; HTTP header (as in a multi-part/range reply) to the buffer</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00709">client_side.cc:709</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_af8290b502a5da8718ddd609a1688a2e5"><div class="ttname"><a href="client__side_8cc.html#af8290b502a5da8718ddd609a1688a2e5">httpAccept</a></div><div class="ttdeci">static IOACB httpAccept</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00185">client_side.cc:185</a></div></div>
<div class="ttc" id="aclient__side_8h_html"><div class="ttname"><a href="client__side_8h.html">client_side.h</a></div></div>
<div class="ttc" id="aclient__side_8h_html_a2800047b5d0d3e31d1739cd35378f4ab"><div class="ttname"><a href="client__side_8h.html#a2800047b5d0d3e31d1739cd35378f4ab">clientSocketDetach</a></div><div class="ttdeci">CSD clientSocketDetach</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00533">client_side.h:533</a></div></div>
<div class="ttc" id="aclient__side_8h_html_a2e46b3ff86603b779741bcc021809a50"><div class="ttname"><a href="client__side_8h.html#a2e46b3ff86603b779741bcc021809a50">clientProcessRequestFinished</a></div><div class="ttdeci">void clientProcessRequestFinished(ConnStateData *, const HttpRequest::Pointer &amp;)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01552">client_side.cc:1552</a></div></div>
<div class="ttc" id="aclient__side_8h_html_a3d42a7ece901f14e6ec973a0feb096e1"><div class="ttname"><a href="client__side_8h.html#a3d42a7ece901f14e6ec973a0feb096e1">clientReplyStatus</a></div><div class="ttdeci">CSS clientReplyStatus</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00530">client_side.h:530</a></div></div>
<div class="ttc" id="aclient__side_8h_html_aa4068f99f4e406110e3f13bfe5904a93"><div class="ttname"><a href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a></div><div class="ttdeci">CSCB clientSocketRecipient</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00532">client_side.h:532</a></div></div>
<div class="ttc" id="aclient__side_8h_html_ab806362f706a7b39732957bb45e3c2df"><div class="ttname"><a href="client__side_8h.html#ab806362f706a7b39732957bb45e3c2df">clientReplyDetach</a></div><div class="ttdeci">CSD clientReplyDetach</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00531">client_side.h:531</a></div></div>
<div class="ttc" id="aclient__side_8h_html_ae73f7b10b6c2bd55c5f96c9d62839e8d"><div class="ttname"><a href="client__side_8h.html#ae73f7b10b6c2bd55c5f96c9d62839e8d">clientGetMoreData</a></div><div class="ttdeci">CSR clientGetMoreData</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00529">client_side.h:529</a></div></div>
<div class="ttc" id="aclient__side__reply_8h_html"><div class="ttname"><a href="client__side__reply_8h.html">client_side_reply.h</a></div></div>
<div class="ttc" id="aclient__side__request_8h_html"><div class="ttname"><a href="client__side__request_8h.html">client_side_request.h</a></div></div>
<div class="ttc" id="acomm_8cc_html_a12f74ce8bc526212a2ba72cecab4ac2b"><div class="ttname"><a href="comm_8cc.html#a12f74ce8bc526212a2ba72cecab4ac2b">comm_add_close_handler</a></div><div class="ttdeci">AsyncCall::Pointer comm_add_close_handler(int fd, CLCB *handler, void *data)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l00942">comm.cc:942</a></div></div>
<div class="ttc" id="acomm_8cc_html_a1813bd28707d918f0871c19aa55ca905"><div class="ttname"><a href="comm_8cc.html#a1813bd28707d918f0871c19aa55ca905">comm_remove_close_handler</a></div><div class="ttdeci">void comm_remove_close_handler(int fd, CLCB *handler, void *data)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l00971">comm.cc:971</a></div></div>
<div class="ttc" id="acomm_8cc_html_a1d65b72cb3685143bbc87633b7f53b3e"><div class="ttname"><a href="comm_8cc.html#a1d65b72cb3685143bbc87633b7f53b3e">commSetConnTimeout</a></div><div class="ttdeci">void commSetConnTimeout(const Comm::ConnectionPointer &amp;conn, time_t timeout, AsyncCall::Pointer &amp;callback)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l00594">comm.cc:594</a></div></div>
<div class="ttc" id="acomm_8cc_html_af74f102f673b39ad806aafefdd1e948c"><div class="ttname"><a href="comm_8cc.html#af74f102f673b39ad806aafefdd1e948c">comm_reset_close</a></div><div class="ttdeci">void comm_reset_close(const Comm::ConnectionPointer &amp;conn)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l00787">comm.cc:787</a></div></div>
<div class="ttc" id="acomm_8h_html"><div class="ttname"><a href="comm_8h.html">comm.h</a></div></div>
<div class="ttc" id="acomm_8h_html_ad684c6dba13b91c274ad5332508e735b"><div class="ttname"><a href="comm_8h.html#ad684c6dba13b91c274ad5332508e735b">commIsHalfClosed</a></div><div class="ttdeci">bool commIsHalfClosed(int fd)</div><div class="ttdef"><b>Definition</b> <a href="comm_8h_source.html#l00104">comm.h:104</a></div></div>
<div class="ttc" id="acontext__storage_8h_html"><div class="ttname"><a href="context__storage_8h.html">context_storage.h</a></div></div>
<div class="ttc" id="adebug_2Messages_8h_html"><div class="ttname"><a href="debug_2Messages_8h.html">Messages.h</a></div></div>
<div class="ttc" id="adebug_2Messages_8h_html_a3627f132658efd674ba366496239d303"><div class="ttname"><a href="debug_2Messages_8h.html#a3627f132658efd674ba366496239d303">Important</a></div><div class="ttdeci">#define Important(id)</div><div class="ttdef"><b>Definition</b> <a href="debug_2Messages_8h_source.html#l00093">Messages.h:93</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_ab7c36646d2082a51e1f8a7c3341d59c7"><div class="ttname"><a href="debug_2Stream_8h.html#ab7c36646d2082a51e1f8a7c3341d59c7">MYNAME</a></div><div class="ttdeci">#define MYNAME</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00219">Stream.h:219</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_ad1f6f001d275799243ee96d0b1519d3a"><div class="ttname"><a href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a></div><div class="ttdeci">#define DBG_IMPORTANT</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00038">Stream.h:38</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_ad8cd33a7d75c0efd4d3fd369dc6a8f13"><div class="ttname"><a href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a></div><div class="ttdeci">#define debugs(SECTION, LEVEL, CONTENT)</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00192">Stream.h:192</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_af0ecf487aee4d8ff164c0f40e71c5150"><div class="ttname"><a href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a></div><div class="ttdeci">#define DBG_CRITICAL</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00037">Stream.h:37</a></div></div>
<div class="ttc" id="adefines_8h_html_a0d83ade59d0c0d3c0f71c50bc14e314e"><div class="ttname"><a href="defines_8h.html#a0d83ade59d0c0d3c0f71c50bc14e314e">COMM_SELECT_READ</a></div><div class="ttdeci">#define COMM_SELECT_READ</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00024">defines.h:24</a></div></div>
<div class="ttc" id="adefines_8h_html_a346c1caf1aa0b2062a853c4f6f67b459"><div class="ttname"><a href="defines_8h.html#a346c1caf1aa0b2062a853c4f6f67b459">FQDN_LOOKUP_IF_MISS</a></div><div class="ttdeci">#define FQDN_LOOKUP_IF_MISS</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00034">defines.h:34</a></div></div>
<div class="ttc" id="adefines_8h_html_a466a4c545dd6c5d996d8ab8f1d0d2270"><div class="ttname"><a href="defines_8h.html#a466a4c545dd6c5d996d8ab8f1d0d2270">COMM_SELECT_WRITE</a></div><div class="ttdeci">#define COMM_SELECT_WRITE</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00025">defines.h:25</a></div></div>
<div class="ttc" id="adefines_8h_html_afe066d3a9be213351016ccfad3dd374c"><div class="ttname"><a href="defines_8h.html#afe066d3a9be213351016ccfad3dd374c">FD_DESC_SZ</a></div><div class="ttdeci">#define FD_DESC_SZ</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00032">defines.h:32</a></div></div>
<div class="ttc" id="aeDirectory_2ldap__backend_8cc_html_a63c89c04d1feae07ca35558055155ffb"><div class="ttname"><a href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a></div><div class="ttdeci">static int port</div><div class="ttdef"><b>Definition</b> <a href="eDirectory_2ldap__backend_8cc_source.html#l00070">ldap_backend.cc:70</a></div></div>
<div class="ttc" id="aenums_8h_html_a1fb9092bcdeada2d206bdc74afbbe122a117633d22d4a5338627c410f0289f627"><div class="ttname"><a href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a117633d22d4a5338627c410f0289f627">VARY_OTHER</a></div><div class="ttdeci">@ VARY_OTHER</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00190">enums.h:190</a></div></div>
<div class="ttc" id="aenums_8h_html_a1fb9092bcdeada2d206bdc74afbbe122a23c487ebaabba2cc8dcd41323b136aa9"><div class="ttname"><a href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a23c487ebaabba2cc8dcd41323b136aa9">VARY_NONE</a></div><div class="ttdeci">@ VARY_NONE</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00188">enums.h:188</a></div></div>
<div class="ttc" id="aenums_8h_html_a1fb9092bcdeada2d206bdc74afbbe122a5dec4f1a3a983ae7827f08367330b4ab"><div class="ttname"><a href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122a5dec4f1a3a983ae7827f08367330b4ab">VARY_CANCEL</a></div><div class="ttdeci">@ VARY_CANCEL</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00192">enums.h:191</a></div></div>
<div class="ttc" id="aenums_8h_html_a1fb9092bcdeada2d206bdc74afbbe122ae9e4dfb086bac9073f90a3b614cc6c6d"><div class="ttname"><a href="enums_8h.html#a1fb9092bcdeada2d206bdc74afbbe122ae9e4dfb086bac9073f90a3b614cc6c6d">VARY_MATCH</a></div><div class="ttdeci">@ VARY_MATCH</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00189">enums.h:189</a></div></div>
<div class="ttc" id="aenums_8h_html_a84627a72058502328269676b81780f89a0d6100f1b0cf2c5aff81194a2cf07713"><div class="ttname"><a href="enums_8h.html#a84627a72058502328269676b81780f89a0d6100f1b0cf2c5aff81194a2cf07713">DISABLE_PMTU_ALWAYS</a></div><div class="ttdeci">@ DISABLE_PMTU_ALWAYS</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00226">enums.h:226</a></div></div>
<div class="ttc" id="aenums_8h_html_a84627a72058502328269676b81780f89acd9d155761fdd879cc51cd809b976dd9"><div class="ttname"><a href="enums_8h.html#a84627a72058502328269676b81780f89acd9d155761fdd879cc51cd809b976dd9">DISABLE_PMTU_OFF</a></div><div class="ttdeci">@ DISABLE_PMTU_OFF</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00225">enums.h:225</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1a"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1a">err_type</a></div><div class="ttdeci">err_type</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00014">forward.h:14</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa06dbb9679d23daac15bfa00176c68222"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa06dbb9679d23daac15bfa00176c68222">ERR_SECURE_ACCEPT_FAIL</a></div><div class="ttdeci">@ ERR_SECURE_ACCEPT_FAIL</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00080">forward.h:80</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa06df3911c86a3b9032b302d21b43e060"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa06df3911c86a3b9032b302d21b43e060">ERR_LIFETIME_EXP</a></div><div class="ttdeci">@ ERR_LIFETIME_EXP</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00027">forward.h:27</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa1771725fc43b0def5b6bdafaf014ab92"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa1771725fc43b0def5b6bdafaf014ab92">ERR_PROTOCOL_UNKNOWN</a></div><div class="ttdeci">@ ERR_PROTOCOL_UNKNOWN</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00073">forward.h:73</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa298ac2b8812fe165e53492b830384bc5"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa298ac2b8812fe165e53492b830384bc5">ERR_SECURE_CONNECT_FAIL</a></div><div class="ttdeci">@ ERR_SECURE_CONNECT_FAIL</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00031">forward.h:31</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa3e1a19ec477c60b1f7cae3af23cfbbfa"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa3e1a19ec477c60b1f7cae3af23cfbbfa">ERR_UNSUP_REQ</a></div><div class="ttdeci">@ ERR_UNSUP_REQ</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00044">forward.h:44</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa484c5a83c6dddc445cad0243e75d88e1"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa484c5a83c6dddc445cad0243e75d88e1">ERR_GATEWAY_FAILURE</a></div><div class="ttdeci">@ ERR_GATEWAY_FAILURE</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00067">forward.h:67</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa5203071ca85e00df6bf2526855b6df0d"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa5203071ca85e00df6bf2526855b6df0d">ERR_NONE</a></div><div class="ttdeci">@ ERR_NONE</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00015">forward.h:15</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa60842fd3916ff9e8fc8bebc607b94470"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa60842fd3916ff9e8fc8bebc607b94470">ERR_REQUEST_PARSE_TIMEOUT</a></div><div class="ttdeci">@ ERR_REQUEST_PARSE_TIMEOUT</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00082">forward.h:82</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aa7d3e07fde16dcbe18a924fc6d8331708"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aa7d3e07fde16dcbe18a924fc6d8331708">ERR_REQUEST_START_TIMEOUT</a></div><div class="ttdeci">@ ERR_REQUEST_START_TIMEOUT</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00081">forward.h:81</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aab442793281e45c7214a6e3d221b49505"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aab442793281e45c7214a6e3d221b49505">ERR_TOO_BIG</a></div><div class="ttdeci">@ ERR_TOO_BIG</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00040">forward.h:40</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aac10a09448de9d88d00da6cb19d2c965b"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aac10a09448de9d88d00da6cb19d2c965b">ERR_ZERO_SIZE_OBJECT</a></div><div class="ttdeci">@ ERR_ZERO_SIZE_OBJECT</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00046">forward.h:46</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aadeac22da21d5e129eba8311e18baa0ac"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aadeac22da21d5e129eba8311e18baa0ac">ERR_CANNOT_FORWARD</a></div><div class="ttdeci">@ ERR_CANNOT_FORWARD</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00023">forward.h:23</a></div></div>
<div class="ttc" id="aerror_2forward_8h_html_a0c0ad09d74260ddc16d72bc291116e1aae371804ada2a7013ccba421a120d3fa9"><div class="ttname"><a href="error_2forward_8h.html#a0c0ad09d74260ddc16d72bc291116e1aae371804ada2a7013ccba421a120d3fa9">ERR_INVALID_REQ</a></div><div class="ttdeci">@ ERR_INVALID_REQ</div><div class="ttdef"><b>Definition</b> <a href="error_2forward_8h_source.html#l00043">forward.h:43</a></div></div>
<div class="ttc" id="aerrorpage_8h_html"><div class="ttname"><a href="errorpage_8h.html">errorpage.h</a></div></div>
<div class="ttc" id="afatal_8cc_html_ab64d40563aeeae7c01b72bea4c3ed032"><div class="ttname"><a href="fatal_8cc.html#ab64d40563aeeae7c01b72bea4c3ed032">fatal</a></div><div class="ttdeci">void fatal(const char *message)</div><div class="ttdef"><b>Definition</b> <a href="fatal_8cc_source.html#l00028">fatal.cc:28</a></div></div>
<div class="ttc" id="afatal_8cc_html_ae0269dd75e50d469da2f2416e0cfb7cf"><div class="ttname"><a href="fatal_8cc.html#ae0269dd75e50d469da2f2416e0cfb7cf">fatalf</a></div><div class="ttdeci">void fatalf(const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="fatal_8cc_source.html#l00068">fatal.cc:68</a></div></div>
<div class="ttc" id="afd_8cc_html_a397dc4e5e5cf728d8f1a48b32cb4e60d"><div class="ttname"><a href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a></div><div class="ttdeci">void fd_note(int fd, const char *s)</div><div class="ttdef"><b>Definition</b> <a href="fd_8cc_source.html#l00211">fd.cc:211</a></div></div>
<div class="ttc" id="afd_8h_html"><div class="ttname"><a href="fd_8h.html">fd.h</a></div></div>
<div class="ttc" id="afde_8h_html"><div class="ttname"><a href="fde_8h.html">fde.h</a></div></div>
<div class="ttc" id="afde_8h_html_a0f820c6a388ea0380a19a97713736a35"><div class="ttname"><a href="fde_8h.html#a0f820c6a388ea0380a19a97713736a35">fd_table</a></div><div class="ttdeci">#define fd_table</div><div class="ttdef"><b>Definition</b> <a href="fde_8h_source.html#l00189">fde.h:189</a></div></div>
<div class="ttc" id="afqdncache_8h_html"><div class="ttname"><a href="fqdncache_8h.html">fqdncache.h</a></div></div>
<div class="ttc" id="aglobals_8h_html"><div class="ttname"><a href="globals_8h.html">globals.h</a></div></div>
<div class="ttc" id="aglobals_8h_html_a506a078460793d09337c2ef6455e3600"><div class="ttname"><a href="globals_8h.html#a506a078460793d09337c2ef6455e3600">opt_no_daemon</a></div><div class="ttdeci">int opt_no_daemon</div></div>
<div class="ttc" id="aglobals_8h_html_a53aa0ddf7c75914f127ffbf47dcf53e3"><div class="ttname"><a href="globals_8h.html#a53aa0ddf7c75914f127ffbf47dcf53e3">opt_foreground</a></div><div class="ttdeci">int opt_foreground</div></div>
<div class="ttc" id="aglobals_8h_html_a8532b327d486a5d5e1b01ca7761e9805"><div class="ttname"><a href="globals_8h.html#a8532b327d486a5d5e1b01ca7761e9805">visible_appname_string</a></div><div class="ttdeci">char const  * visible_appname_string</div></div>
<div class="ttc" id="agroup__ACLAPI_html_gga449cde9b9fa7a3ddb6d83d61080c1df5a9c57583ad491217a69a63fdabf336c8e"><div class="ttname"><a href="group__ACLAPI.html#gga449cde9b9fa7a3ddb6d83d61080c1df5a9c57583ad491217a69a63fdabf336c8e">ACCESS_DENIED</a></div><div class="ttdeci">@ ACCESS_DENIED</div><div class="ttdef"><b>Definition</b> <a href="acl_2Acl_8h_source.html#l00041">Acl.h:41</a></div></div>
<div class="ttc" id="agroup__ACLAPI_html_gga449cde9b9fa7a3ddb6d83d61080c1df5aa3d37d87d9b3887abc5466afb368cb8a"><div class="ttname"><a href="group__ACLAPI.html#gga449cde9b9fa7a3ddb6d83d61080c1df5aa3d37d87d9b3887abc5466afb368cb8a">ACCESS_ALLOWED</a></div><div class="ttdeci">@ ACCESS_ALLOWED</div><div class="ttdef"><b>Definition</b> <a href="acl_2Acl_8h_source.html#l00042">Acl.h:42</a></div></div>
<div class="ttc" id="agroup__ClientStreamInternal_html_ga20d6859b35ca5de01819e32d92ec775d"><div class="ttname"><a href="group__ClientStreamInternal.html#ga20d6859b35ca5de01819e32d92ec775d">clientStreamAbort</a></div><div class="ttdeci">void clientStreamAbort(clientStreamNode *thisObject, ClientHttpRequest *http)</div><div class="ttdef"><b>Definition</b> <a href="clientStream_8cc_source.html#l00235">clientStream.cc:235</a></div></div>
<div class="ttc" id="agroup__ClientStreamInternal_html_ga73019262f28c27affc3937cac3441a43"><div class="ttname"><a href="group__ClientStreamInternal.html#ga73019262f28c27affc3937cac3441a43">clientStreamInit</a></div><div class="ttdeci">void clientStreamInit(dlink_list *list, CSR *func, CSD *rdetach, CSS *readstatus, const ClientStreamData &amp;readdata, CSCB *callback, CSD *cdetach, const ClientStreamData &amp;callbackdata, StoreIOBuffer tailBuffer)</div><div class="ttdef"><b>Definition</b> <a href="clientStream_8cc_source.html#l00112">clientStream.cc:112</a></div></div>
<div class="ttc" id="agroup__ClientStreamInternal_html_gae62c467856741b9fdc6c8b919ea65462"><div class="ttname"><a href="group__ClientStreamInternal.html#gae62c467856741b9fdc6c8b919ea65462">clientStreamDetach</a></div><div class="ttdeci">void clientStreamDetach(clientStreamNode *thisObject, ClientHttpRequest *http)</div><div class="ttdef"><b>Definition</b> <a href="clientStream_8cc_source.html#l00192">clientStream.cc:192</a></div></div>
<div class="ttc" id="agroup__FQDNCacheAPI_html_ga8075670505bd7c7ff30bbeaa0d835c4b"><div class="ttname"><a href="group__FQDNCacheAPI.html#ga8075670505bd7c7ff30bbeaa0d835c4b">fqdncache_gethostbyaddr</a></div><div class="ttdeci">const char * fqdncache_gethostbyaddr(const Ip::Address &amp;addr, int flags)</div><div class="ttdef"><b>Definition</b> <a href="fqdncache_8cc_source.html#l00481">fqdncache.cc:481</a></div></div>
<div class="ttc" id="agroup__ServerProtocolICPAPI_html_gga6d172cc0273c7eb44afd1351198704c6a373bcfac3cc95d63c2fe4043f41dbd94"><div class="ttname"><a href="group__ServerProtocolICPAPI.html#gga6d172cc0273c7eb44afd1351198704c6a373bcfac3cc95d63c2fe4043f41dbd94">ICP_INVALID</a></div><div class="ttdeci">@ ICP_INVALID</div><div class="ttdef"><b>Definition</b> <a href="icp__opcode_8h_source.html#l00015">icp_opcode.h:15</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ga2e10b88f6a651cc2f1027241c19dbad4"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ga2e10b88f6a651cc2f1027241c19dbad4">Ssl::GenerateSslContext</a></div><div class="ttdeci">Security::ContextPointer GenerateSslContext(CertificateProperties const &amp;, Security::ServerOptions &amp;, bool trusted)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01052">support.cc:1052</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ga326212e49d2774b730d08ae598a11e30"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ga326212e49d2774b730d08ae598a11e30">Ssl::bumpMode</a></div><div class="ttdeci">const char * bumpMode(int bm)</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00144">support.h:144</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ga3a5dd7968318545fa2556ec4df78ca87"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ga3a5dd7968318545fa2556ec4df78ca87">Ssl::configureSSL</a></div><div class="ttdeci">bool configureSSL(SSL *ssl, CertificateProperties const &amp;properties, AnyP::PortCfg &amp;port)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01098">support.cc:1098</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ga68b9e5cdd919c6ba8a90c35d16b24203"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ga68b9e5cdd919c6ba8a90c35d16b24203">Ssl::InRamCertificateDbKey</a></div><div class="ttdeci">void InRamCertificateDbKey(const Ssl::CertificateProperties &amp;certProperties, SBuf &amp;key)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01486">support.cc:1486</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ga8b646bfba6b409e0acef284766f80da3"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ga8b646bfba6b409e0acef284766f80da3">Ssl::createSSLContext</a></div><div class="ttdeci">Security::ContextPointer createSSLContext(Security::CertPointer &amp;x509, Security::PrivateKeyPointer &amp;pkey, Security::ServerOptions &amp;)</div><div class="ttdoc">Create SSL context and apply ssl certificate and private key to it.</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01021">support.cc:1021</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ga8f33496b41afebbd6d8c3191d3d8917a"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ga8f33496b41afebbd6d8c3191d3d8917a">Ssl::verifySslCertificate</a></div><div class="ttdeci">bool verifySslCertificate(const Security::ContextPointer &amp;, CertificateProperties const &amp;)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01141">support.cc:1141</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_gaa637f8ee27c5c83e8c1264ff57ab91b0"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#gaa637f8ee27c5c83e8c1264ff57ab91b0">Ssl::configureSSLUsingPkeyAndCertFromMemory</a></div><div class="ttdeci">bool configureSSLUsingPkeyAndCertFromMemory(SSL *ssl, const char *data, AnyP::PortCfg &amp;port)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01121">support.cc:1121</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_gab2033cd047ea4081e8f383815753ed39"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#gab2033cd047ea4081e8f383815753ed39">Ssl::GenerateSslContextUsingPkeyAndCertFromMemory</a></div><div class="ttdeci">Security::ContextPointer GenerateSslContextUsingPkeyAndCertFromMemory(const char *data, Security::ServerOptions &amp;, bool trusted)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01038">support.cc:1038</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_gacba2b8658a052836ea33238f9d55470a"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#gacba2b8658a052836ea33238f9d55470a">Ssl::configureUnconfiguredSslContext</a></div><div class="ttdeci">void configureUnconfiguredSslContext(Security::ContextPointer &amp;, Ssl::CertSignAlgorithm signAlgorithm, AnyP::PortCfg &amp;)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l01091">support.cc:1091</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_gadf059a1837d13958f66199a0b0676aa1"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#gadf059a1837d13958f66199a0b0676aa1">sslGetUserEmail</a></div><div class="ttdeci">const char * sslGetUserEmail(SSL *ssl)</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l00981">support.cc:981</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_gae6b7865118af149a83cc4569060c1af9"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#gae6b7865118af149a83cc4569060c1af9">Ssl::BumpMode</a></div><div class="ttdeci">BumpMode</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ggae6b7865118af149a83cc4569060c1af9a0048f5b977ec8cb08f3afa8f9554876a"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a0048f5b977ec8cb08f3afa8f9554876a">Ssl::bumpTerminate</a></div><div class="ttdeci">@ bumpTerminate</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ggae6b7865118af149a83cc4569060c1af9a3520bffc77077f787821da0081ede771"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a3520bffc77077f787821da0081ede771">Ssl::bumpPeek</a></div><div class="ttdeci">@ bumpPeek</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ggae6b7865118af149a83cc4569060c1af9a63dd03e830a0746569e5635a3dfa28dc"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a63dd03e830a0746569e5635a3dfa28dc">Ssl::bumpClientFirst</a></div><div class="ttdeci">@ bumpClientFirst</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ggae6b7865118af149a83cc4569060c1af9a6ff031aa135572a0f8f968b29fda9f72"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9a6ff031aa135572a0f8f968b29fda9f72">Ssl::bumpNone</a></div><div class="ttdeci">@ bumpNone</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ggae6b7865118af149a83cc4569060c1af9aa4067f0eef0c928826c7865f55c8057c"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aa4067f0eef0c928826c7865f55c8057c">Ssl::bumpStare</a></div><div class="ttdeci">@ bumpStare</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ggae6b7865118af149a83cc4569060c1af9aaa41037e8896833d425589e945cbb064"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9aaa41037e8896833d425589e945cbb064">Ssl::bumpSplice</a></div><div class="ttdeci">@ bumpSplice</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__ServerProtocolSSLAPI_html_ggae6b7865118af149a83cc4569060c1af9ac82a0f09e800f147573716d281aad690"><div class="ttname"><a href="group__ServerProtocolSSLAPI.html#ggae6b7865118af149a83cc4569060c1af9ac82a0f09e800f147573716d281aad690">Ssl::bumpServerFirst</a></div><div class="ttdeci">@ bumpServerFirst</div><div class="ttdef"><b>Definition</b> <a href="ssl_2support_8h_source.html#l00132">support.h:132</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_ga87ed0e1c2b78fa6575e2c0c16cff01ab"><div class="ttname"><a href="group__SslCrtdSslAPI.html#ga87ed0e1c2b78fa6575e2c0c16cff01ab">Ssl::CertSignAlgorithm</a></div><div class="ttdeci">CertSignAlgorithm</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00169">gadgets.h:169</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_gaf188fc5926a4a522eef378f7a6e97cf6"><div class="ttname"><a href="group__SslCrtdSslAPI.html#gaf188fc5926a4a522eef378f7a6e97cf6">Ssl::CertAdaptAlgorithmStr</a></div><div class="ttdeci">const char * CertAdaptAlgorithmStr[]</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8cc_source.html#l00285">gadgets.cc:285</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_gga78011f589191c6cb01000f6aaf960518a33fa176796aac85f607a0e7dc18cb544"><div class="ttname"><a href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518a33fa176796aac85f607a0e7dc18cb544">Ssl::algSetValidAfter</a></div><div class="ttdeci">@ algSetValidAfter</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00207">gadgets.h:207</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_gga78011f589191c6cb01000f6aaf960518a6f265ebdf1256dfce0086aa5285af383"><div class="ttname"><a href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518a6f265ebdf1256dfce0086aa5285af383">Ssl::algSetCommonName</a></div><div class="ttdeci">@ algSetCommonName</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00207">gadgets.h:207</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_gga78011f589191c6cb01000f6aaf960518ae7a427498f9a8d4b2be6d116bb232696"><div class="ttname"><a href="group__SslCrtdSslAPI.html#gga78011f589191c6cb01000f6aaf960518ae7a427498f9a8d4b2be6d116bb232696">Ssl::algSetValidBefore</a></div><div class="ttdeci">@ algSetValidBefore</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00207">gadgets.h:207</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_gga87ed0e1c2b78fa6575e2c0c16cff01aba11c2a5f79f56c3580ea6fb6178cfd570"><div class="ttname"><a href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba11c2a5f79f56c3580ea6fb6178cfd570">Ssl::algSignEnd</a></div><div class="ttdeci">@ algSignEnd</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00169">gadgets.h:169</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_gga87ed0e1c2b78fa6575e2c0c16cff01aba3b2f7ad911a421046bc60691daac32d5"><div class="ttname"><a href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba3b2f7ad911a421046bc60691daac32d5">Ssl::algSignTrusted</a></div><div class="ttdeci">@ algSignTrusted</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00169">gadgets.h:169</a></div></div>
<div class="ttc" id="agroup__SslCrtdSslAPI_html_gga87ed0e1c2b78fa6575e2c0c16cff01aba8490e7915099e125cc3004b50c058266"><div class="ttname"><a href="group__SslCrtdSslAPI.html#gga87ed0e1c2b78fa6575e2c0c16cff01aba8490e7915099e125cc3004b50c058266">Ssl::algSignUntrusted</a></div><div class="ttdeci">@ algSignUntrusted</div><div class="ttdef"><b>Definition</b> <a href="ssl_2gadgets_8h_source.html#l00169">gadgets.h:169</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177da21b0ce8be23fceba9d022381ed3e8141"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da21b0ce8be23fceba9d022381ed3e8141">CD_SIBLING_HIT</a></div><div class="ttdeci">@ CD_SIBLING_HIT</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00029">hier_code.h:29</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177da3c8bcd791a8e2b159b0772eaabb89e9d"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da3c8bcd791a8e2b159b0772eaabb89e9d">CD_PARENT_HIT</a></div><div class="ttdeci">@ CD_PARENT_HIT</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00028">hier_code.h:28</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177da4e414b3bd28bffa1221e417edafdf8bd"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da4e414b3bd28bffa1221e417edafdf8bd">PARENT_HIT</a></div><div class="ttdeci">@ PARENT_HIT</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00016">hier_code.h:16</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177da58b66ca8d18fdd0d52934dad3f0ab386"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da58b66ca8d18fdd0d52934dad3f0ab386">CLOSEST_PARENT</a></div><div class="ttdeci">@ CLOSEST_PARENT</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00022">hier_code.h:22</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177da71997b9847150b787d135b5bbe856ce1"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da71997b9847150b787d135b5bbe856ce1">SIBLING_HIT</a></div><div class="ttdeci">@ SIBLING_HIT</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00015">hier_code.h:15</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177da7f53c781a633950c909c3850a66a785d"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177da7f53c781a633950c909c3850a66a785d">CLOSEST_DIRECT</a></div><div class="ttdeci">@ CLOSEST_DIRECT</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00023">hier_code.h:23</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177daa92079b2127e6cbf155d50b6b5b110f9"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177daa92079b2127e6cbf155d50b6b5b110f9">FIRST_PARENT_MISS</a></div><div class="ttdeci">@ FIRST_PARENT_MISS</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00020">hier_code.h:20</a></div></div>
<div class="ttc" id="ahier__code_8h_html_a8836a137c62397b51ab64e564c94177dac532a9a791bde35f28867d5a87d21897"><div class="ttname"><a href="hier__code_8h.html#a8836a137c62397b51ab64e564c94177dac532a9a791bde35f28867d5a87d21897">CLOSEST_PARENT_MISS</a></div><div class="ttdeci">@ CLOSEST_PARENT_MISS</div><div class="ttdef"><b>Definition</b> <a href="hier__code_8h_source.html#l00021">hier_code.h:21</a></div></div>
<div class="ttc" id="ahttp_2Message_8h_html_adc5c03415efc511e2b62e809310969b6"><div class="ttname"><a href="http_2Message_8h.html#adc5c03415efc511e2b62e809310969b6">HTTPMSGUNLOCK</a></div><div class="ttdeci">void HTTPMSGUNLOCK(M *&amp;a)</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00150">Message.h:150</a></div></div>
<div class="ttc" id="ahttp_2Message_8h_html_afbf13ecd1cc5c007367ae094c1aa19a9"><div class="ttname"><a href="http_2Message_8h.html#afbf13ecd1cc5c007367ae094c1aa19a9">HTTPMSGLOCK</a></div><div class="ttdeci">void HTTPMSGLOCK(Http::Message *a)</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00161">Message.h:161</a></div></div>
<div class="ttc" id="ahttp_2Stream_8h_html"><div class="ttname"><a href="http_2Stream_8h.html">Stream.h</a></div></div>
<div class="ttc" id="ahttp_2forward_8h_html_a196f6d12d102aebcc7a2778bea3e6b19"><div class="ttname"><a href="http_2forward_8h.html#a196f6d12d102aebcc7a2778bea3e6b19">HTTP_REQBUF_SZ</a></div><div class="ttdeci">#define HTTP_REQBUF_SZ</div><div class="ttdef"><b>Definition</b> <a href="http_2forward_8h_source.html#l00014">forward.h:14</a></div></div>
<div class="ttc" id="ahttp_8cc_html_a8a42723675f705f8c391373dc1578c0b"><div class="ttname"><a href="http_8cc.html#a8a42723675f705f8c391373dc1578c0b">httpMakeVaryMark</a></div><div class="ttdeci">SBuf httpMakeVaryMark(HttpRequest *request, HttpReply const *reply)</div><div class="ttdef"><b>Definition</b> <a href="http_8cc_source.html#l00590">http.cc:590</a></div></div>
<div class="ttc" id="ahttp_8h_html"><div class="ttname"><a href="http_8h.html">http.h</a></div></div>
<div class="ttc" id="ainternal_8cc_html_a628c7ecf666dc0f0f708f2a37fb4fd7a"><div class="ttname"><a href="internal_8cc.html#a628c7ecf666dc0f0f708f2a37fb4fd7a">internalLocalUri</a></div><div class="ttdeci">char * internalLocalUri(const char *dir, const SBuf &amp;name)</div><div class="ttdef"><b>Definition</b> <a href="internal_8cc_source.html#l00139">internal.cc:139</a></div></div>
<div class="ttc" id="ainternal_8cc_html_a76eaf4388b308548216736a932f7ec44"><div class="ttname"><a href="internal_8cc.html#a76eaf4388b308548216736a932f7ec44">internalCheck</a></div><div class="ttdeci">bool internalCheck(const SBuf &amp;urlPath)</div><div class="ttdef"><b>Definition</b> <a href="internal_8cc_source.html#l00072">internal.cc:72</a></div></div>
<div class="ttc" id="ainternal_8h_html"><div class="ttname"><a href="internal_8h.html">internal.h</a></div></div>
<div class="ttc" id="aip_2forward_8h_html_a28806a9f06b4d32dab73b27053f10494"><div class="ttname"><a href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a></div><div class="ttdeci">#define MAX_IPSTRLEN</div><div class="ttdoc">Length of buffer that needs to be allocated to old a null-terminated IP-string.</div><div class="ttdef"><b>Definition</b> <a href="ip_2forward_8h_source.html#l00025">forward.h:25</a></div></div>
<div class="ttc" id="amime__header_8h_html"><div class="ttname"><a href="mime__header_8h.html">mime_header.h</a></div></div>
<div class="ttc" id="anamespaceAnyP_html_a091f10181394fdbe707c17c91f250793"><div class="ttname"><a href="namespaceAnyP.html#a091f10181394fdbe707c17c91f250793">AnyP::Port</a></div><div class="ttdeci">std::optional&lt; KnownPort &gt; Port</div><div class="ttdoc">validated/supported port number (if any)</div><div class="ttdef"><b>Definition</b> <a href="UriScheme_8h_source.html#l00026">UriScheme.h:26</a></div></div>
<div class="ttc" id="anamespaceAnyP_html_ab24b85a8b8fc74bc945707195c85d228"><div class="ttname"><a href="namespaceAnyP.html#ab24b85a8b8fc74bc945707195c85d228">AnyP::KnownPort</a></div><div class="ttdeci">uint16_t KnownPort</div><div class="ttdoc">validated/supported port number; these values are never zero</div><div class="ttdef"><b>Definition</b> <a href="UriScheme_8h_source.html#l00023">UriScheme.h:23</a></div></div>
<div class="ttc" id="anamespaceAnyP_html_af0ba7042d4344a04b758836b3e6e7acca0f99ccafd63891be16873f9f2abe94ba"><div class="ttname"><a href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca0f99ccafd63891be16873f9f2abe94ba">AnyP::PROTO_HTTPS</a></div><div class="ttdeci">@ PROTO_HTTPS</div><div class="ttdef"><b>Definition</b> <a href="ProtocolType_8h_source.html#l00027">ProtocolType.h:27</a></div></div>
<div class="ttc" id="anamespaceAnyP_html_af0ba7042d4344a04b758836b3e6e7acca2cb2b78051771087034e23c3882999dd"><div class="ttname"><a href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca2cb2b78051771087034e23c3882999dd">AnyP::PROTO_AUTHORITY_FORM</a></div><div class="ttdeci">@ PROTO_AUTHORITY_FORM</div><div class="ttdef"><b>Definition</b> <a href="ProtocolType_8h_source.html#l00040">ProtocolType.h:40</a></div></div>
<div class="ttc" id="anamespaceAnyP_html_af0ba7042d4344a04b758836b3e6e7acca62d94ce7433f7892fb4541f72ac4ac7d"><div class="ttname"><a href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca62d94ce7433f7892fb4541f72ac4ac7d">AnyP::PROTO_HTTP</a></div><div class="ttdeci">@ PROTO_HTTP</div><div class="ttdef"><b>Definition</b> <a href="ProtocolType_8h_source.html#l00025">ProtocolType.h:25</a></div></div>
<div class="ttc" id="anamespaceAnyP_html_af0ba7042d4344a04b758836b3e6e7acca6b36255bc8fc8723bdfa8d419847697c"><div class="ttname"><a href="namespaceAnyP.html#af0ba7042d4344a04b758836b3e6e7acca6b36255bc8fc8723bdfa8d419847697c">AnyP::PROTO_FTP</a></div><div class="ttdeci">@ PROTO_FTP</div><div class="ttdef"><b>Definition</b> <a href="ProtocolType_8h_source.html#l00026">ProtocolType.h:26</a></div></div>
<div class="ttc" id="anamespaceComm_html_a24de01312960dba5c38466509cadb831"><div class="ttname"><a href="namespaceComm.html#a24de01312960dba5c38466509cadb831">Comm::ReadCancel</a></div><div class="ttdeci">void ReadCancel(int fd, AsyncCall::Pointer &amp;callback)</div><div class="ttdoc">Cancel the read pending on FD. No action if none pending.</div><div class="ttdef"><b>Definition</b> <a href="Read_8cc_source.html#l00219">Read.cc:219</a></div></div>
<div class="ttc" id="anamespaceComm_html_a4bfe8d9fd94f42d950099a60be308b17"><div class="ttname"><a href="namespaceComm.html#a4bfe8d9fd94f42d950099a60be308b17">Comm::ResetSelect</a></div><div class="ttdeci">void ResetSelect(int fd)</div><div class="ttdoc">reset/undo/unregister the watch for an FD which was set by Comm::SetSelect()</div><div class="ttdef"><b>Definition</b> <a href="Loops_8h_source.html#l00030">Loops.h:30</a></div></div>
<div class="ttc" id="anamespaceComm_html_a77060c1b076eaeab719e81a92a5c6589"><div class="ttname"><a href="namespaceComm.html#a77060c1b076eaeab719e81a92a5c6589">Comm::Read</a></div><div class="ttdeci">void Read(const Comm::ConnectionPointer &amp;conn, AsyncCall::Pointer &amp;callback)</div><div class="ttdef"><b>Definition</b> <a href="Read_8cc_source.html#l00040">Read.cc:40</a></div></div>
<div class="ttc" id="anamespaceComm_html_a91f0a0e22e74a7ad6f7c44c137c6f005"><div class="ttname"><a href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a></div><div class="ttdeci">bool IsConnOpen(const Comm::ConnectionPointer &amp;conn)</div><div class="ttdef"><b>Definition</b> <a href="Connection_8cc_source.html#l00027">Connection.cc:27</a></div></div>
<div class="ttc" id="anamespaceComm_html_a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24"><div class="ttname"><a href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a></div><div class="ttdeci">@ OK</div><div class="ttdef"><b>Definition</b> <a href="Flag_8h_source.html#l00016">Flag.h:16</a></div></div>
<div class="ttc" id="anamespaceComm_html_a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c"><div class="ttname"><a href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c">Comm::ERR_CLOSING</a></div><div class="ttdeci">@ ERR_CLOSING</div><div class="ttdef"><b>Definition</b> <a href="Flag_8h_source.html#l00024">Flag.h:24</a></div></div>
<div class="ttc" id="anamespaceComm_html_ae3a7e8f0df297346e84f0e9943033a3e"><div class="ttname"><a href="namespaceComm.html#ae3a7e8f0df297346e84f0e9943033a3e">Comm::SetSelect</a></div><div class="ttdeci">void SetSelect(int, unsigned int, PF *, void *, time_t)</div><div class="ttdoc">Mark an FD to be watched for its IO status.</div><div class="ttdef"><b>Definition</b> <a href="ModDevPoll_8cc_source.html#l00220">ModDevPoll.cc:220</a></div></div>
<div class="ttc" id="anamespaceDns_html_a2cd038103702e02a3dbb5f4c55fe1302"><div class="ttname"><a href="namespaceDns.html#a2cd038103702e02a3dbb5f4c55fe1302">Dns::ResolveClientAddressesAsap</a></div><div class="ttdeci">bool ResolveClientAddressesAsap</div><div class="ttdoc">whether to do reverse DNS lookups for source IPs of accepted connections</div><div class="ttdef"><b>Definition</b> <a href="fqdncache_8cc_source.html#l00030">fqdncache.cc:30</a></div></div>
<div class="ttc" id="anamespaceFtp_html_adf377404cef36010cd7e17ec7b5a8a87"><div class="ttname"><a href="namespaceFtp.html#adf377404cef36010cd7e17ec7b5a8a87">Ftp::StopListening</a></div><div class="ttdeci">void StopListening()</div><div class="ttdoc">reject new connections to any configured ftp_port</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00287">FtpServer.cc:287</a></div></div>
<div class="ttc" id="anamespaceFtp_html_ae2b3b88ec5c7af470746a1658d7434f3"><div class="ttname"><a href="namespaceFtp.html#ae2b3b88ec5c7af470746a1658d7434f3">Ftp::StartListening</a></div><div class="ttdeci">void StartListening()</div><div class="ttdoc">accept connections on all configured ftp_ports</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00265">FtpServer.cc:265</a></div></div>
<div class="ttc" id="anamespaceHelper_html_a35b330f6ec77649f82ba735d7b19a984a69cdbb4d469ada5a0f13681d9ab8940e"><div class="ttname"><a href="namespaceHelper.html#a35b330f6ec77649f82ba735d7b19a984a69cdbb4d469ada5a0f13681d9ab8940e">Helper::BrokenHelper</a></div><div class="ttdeci">@ BrokenHelper</div><div class="ttdef"><b>Definition</b> <a href="ResultCode_8h_source.html#l00020">ResultCode.h:20</a></div></div>
<div class="ttc" id="anamespaceHelper_html_a35b330f6ec77649f82ba735d7b19a984af5ab78a4aaa17e6dbcf76c28a2f6d198"><div class="ttname"><a href="namespaceHelper.html#a35b330f6ec77649f82ba735d7b19a984af5ab78a4aaa17e6dbcf76c28a2f6d198">Helper::Okay</a></div><div class="ttdeci">@ Okay</div><div class="ttdef"><b>Definition</b> <a href="ResultCode_8h_source.html#l00018">ResultCode.h:18</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722">Http::StatusCode</a></div><div class="ttdeci">StatusCode</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00020">StatusCode.h:20</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722a108a3f73860c17d6581b0fbddb4d2e1e"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722a108a3f73860c17d6581b0fbddb4d2e1e">Http::scUriTooLong</a></div><div class="ttdeci">@ scUriTooLong</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00059">StatusCode.h:59</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722a3a896c4c837cff6ec3414fcc23adac68"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722a3a896c4c837cff6ec3414fcc23adac68">Http::scNotImplemented</a></div><div class="ttdeci">@ scNotImplemented</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00074">StatusCode.h:74</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722a74568860e1daf616488c945a9b3d4416"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722a74568860e1daf616488c945a9b3d4416">Http::scBadRequest</a></div><div class="ttdeci">@ scBadRequest</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00045">StatusCode.h:45</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722a963543f2bd6f3e4feb67e79b90876597"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722a963543f2bd6f3e4feb67e79b90876597">Http::scMethodNotAllowed</a></div><div class="ttdeci">@ scMethodNotAllowed</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00050">StatusCode.h:50</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722aab61d70dce6e121feb658b24ef1cd815"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722aab61d70dce6e121feb658b24ef1cd815">Http::scNone</a></div><div class="ttdeci">@ scNone</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00021">StatusCode.h:21</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722af056fd80f0ad36efe17c794a9ee7a988"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722af056fd80f0ad36efe17c794a9ee7a988">Http::scContentTooLarge</a></div><div class="ttdeci">@ scContentTooLarge</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00058">StatusCode.h:58</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722af1ac1084571f6b8e40506939e193de66"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722af1ac1084571f6b8e40506939e193de66">Http::scRequestHeaderFieldsTooLarge</a></div><div class="ttdeci">@ scRequestHeaderFieldsTooLarge</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00071">StatusCode.h:71</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722afce0b1a37bd52da9d6eeac5a0a37743c"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722afce0b1a37bd52da9d6eeac5a0a37743c">Http::scServiceUnavailable</a></div><div class="ttdeci">@ scServiceUnavailable</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00076">StatusCode.h:76</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a4400a96a7d5790f5a9b5591296de84a8"><div class="ttname"><a href="namespaceHttp.html#a4400a96a7d5790f5a9b5591296de84a8">Http::NewServer</a></div><div class="ttdeci">ConnStateData * NewServer(const MasterXactionPointer &amp;xact)</div><div class="ttdoc">create a new HTTP connection handler; never returns NULL</div><div class="ttdef"><b>Definition</b> <a href="Http1Server_8cc_source.html#l00392">Http1Server.cc:392</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a84eb275fbe86f9dcc2a0ce9164a60787a17353570f8312493328aa9ade6ff514a"><div class="ttname"><a href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a17353570f8312493328aa9ade6ff514a">Http::METHOD_NONE</a></div><div class="ttdeci">@ METHOD_NONE</div><div class="ttdef"><b>Definition</b> <a href="MethodType_8h_source.html#l00022">MethodType.h:22</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a84eb275fbe86f9dcc2a0ce9164a60787a4fbb358ee66d6fe96e79cb8cf49b260a"><div class="ttname"><a href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a4fbb358ee66d6fe96e79cb8cf49b260a">Http::METHOD_OPTIONS</a></div><div class="ttdeci">@ METHOD_OPTIONS</div><div class="ttdef"><b>Definition</b> <a href="MethodType_8h_source.html#l00031">MethodType.h:31</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a84eb275fbe86f9dcc2a0ce9164a60787a555311cec8eb7016770ccd41b4ddc024"><div class="ttname"><a href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a555311cec8eb7016770ccd41b4ddc024">Http::METHOD_PRI</a></div><div class="ttdeci">@ METHOD_PRI</div><div class="ttdef"><b>Definition</b> <a href="MethodType_8h_source.html#l00089">MethodType.h:89</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a84eb275fbe86f9dcc2a0ce9164a60787a8ecea905b7d7b048a979e590cb11b9d7"><div class="ttname"><a href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a8ecea905b7d7b048a979e590cb11b9d7">Http::METHOD_CONNECT</a></div><div class="ttdeci">@ METHOD_CONNECT</div><div class="ttdef"><b>Definition</b> <a href="MethodType_8h_source.html#l00029">MethodType.h:29</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a8f5de7a6ddd395e9aaf0dffd043c2276"><div class="ttname"><a href="namespaceHttp.html#a8f5de7a6ddd395e9aaf0dffd043c2276">Http::ProtocolVersion</a></div><div class="ttdeci">AnyP::ProtocolVersion ProtocolVersion()</div><div class="ttdef"><b>Definition</b> <a href="http_2ProtocolVersion_8h_source.html#l00032">ProtocolVersion.h:32</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a304355a5f731e2a76ba795ebe1ffd247"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a304355a5f731e2a76ba795ebe1ffd247">Http::HOST</a></div><div class="ttdeci">@ HOST</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00059">RegisteredHeaders.h:59</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a3ae0960cb7589909b60ec5958769568f"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a3ae0960cb7589909b60ec5958769568f">Http::VARY</a></div><div class="ttdeci">@ VARY</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00105">RegisteredHeaders.h:105</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a78311c3bedd99c69c01b5ada747f1de4"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a78311c3bedd99c69c01b5ada747f1de4">Http::MAX_FORWARDS</a></div><div class="ttdeci">@ MAX_FORWARDS</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00073">RegisteredHeaders.h:73</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4ad15c8839ee936e050b9d9f6d438076b2"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4ad15c8839ee936e050b9d9f6d438076b2">Http::HDR_X_ACCELERATOR_VARY</a></div><div class="ttdeci">@ HDR_X_ACCELERATOR_VARY</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00110">RegisteredHeaders.h:110</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4ae6d0191b9e6d18bf8b6821b4505a68c2"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4ae6d0191b9e6d18bf8b6821b4505a68c2">Http::CONTENT_TYPE</a></div><div class="ttdeci">@ CONTENT_TYPE</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00046">RegisteredHeaders.h:46</a></div></div>
<div class="ttc" id="anamespaceHttps_html_a9dc3dda85de6a0ad4cc79a24e4a330bb"><div class="ttname"><a href="namespaceHttps.html#a9dc3dda85de6a0ad4cc79a24e4a330bb">Https::NewServer</a></div><div class="ttdeci">ConnStateData * NewServer(const MasterXactionPointer &amp;xact)</div><div class="ttdoc">create a new HTTPS connection handler; never returns NULL</div><div class="ttdef"><b>Definition</b> <a href="Http1Server_8cc_source.html#l00398">Http1Server.cc:398</a></div></div>
<div class="ttc" id="anamespaceIpc_html_a08603c9424a847b7951bb043ed92c6d7"><div class="ttname"><a href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7">Ipc::FdNoteId</a></div><div class="ttdeci">FdNoteId</div><div class="ttdoc">We cannot send char* FD notes to other processes. Pass int IDs and convert.</div><div class="ttdef"><b>Definition</b> <a href="FdNotes_8h_source.html#l00020">FdNotes.h:20</a></div></div>
<div class="ttc" id="anamespaceIpc_html_a08603c9424a847b7951bb043ed92c6d7a19490345a33230e8042a46aaa352d8e3"><div class="ttname"><a href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7a19490345a33230e8042a46aaa352d8e3">Ipc::fdnHttpSocket</a></div><div class="ttdeci">@ fdnHttpSocket</div><div class="ttdef"><b>Definition</b> <a href="FdNotes_8h_source.html#l00020">FdNotes.h:20</a></div></div>
<div class="ttc" id="anamespaceIpc_html_a08603c9424a847b7951bb043ed92c6d7aaf8453e105f4660ed3f0309065f347c7"><div class="ttname"><a href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7aaf8453e105f4660ed3f0309065f347c7">Ipc::fdnHttpsSocket</a></div><div class="ttdeci">@ fdnHttpsSocket</div><div class="ttdef"><b>Definition</b> <a href="FdNotes_8h_source.html#l00020">FdNotes.h:20</a></div></div>
<div class="ttc" id="anamespaceIpc_html_a37dd3ff45a0f99fdf2f730e4125110ce"><div class="ttname"><a href="namespaceIpc.html#a37dd3ff45a0f99fdf2f730e4125110ce">Ipc::StartListening</a></div><div class="ttdeci">void StartListening(int sock_type, int proto, const Comm::ConnectionPointer &amp;listenConn, FdNoteId, StartListeningCallback &amp;)</div><div class="ttdef"><b>Definition</b> <a href="StartListening_8cc_source.html#l00032">StartListening.cc:32</a></div></div>
<div class="ttc" id="anamespaceProxyProtocol_html_a276022b31f1ffa89440172bfcf0285b3"><div class="ttname"><a href="namespaceProxyProtocol.html#a276022b31f1ffa89440172bfcf0285b3">ProxyProtocol::Parse</a></div><div class="ttdeci">Parsed Parse(const SBuf &amp;)</div><div class="ttdef"><b>Definition</b> <a href="proxyp_2Parser_8cc_source.html#l00252">Parser.cc:252</a></div></div>
<div class="ttc" id="anamespaceSecurity_html"><div class="ttname"><a href="namespaceSecurity.html">Security</a></div><div class="ttdoc">Network/connection security abstraction layer.</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00033">Connection.h:34</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_a22a6ec2bd7340b66fe60a5e0cb9b179e"><div class="ttname"><a href="namespaceSecurity.html#a22a6ec2bd7340b66fe60a5e0cb9b179e">Security::IssuerName</a></div><div class="ttdeci">SBuf IssuerName(Certificate &amp;)</div><div class="ttdoc">The Issuer field of the given certificate (if found) or an empty SBuf.</div><div class="ttdef"><b>Definition</b> <a href="security_2Certificate_8cc_source.html#l00028">Certificate.cc:28</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_a289bb0a9b338c16283687117714d2d9e"><div class="ttname"><a href="namespaceSecurity.html#a289bb0a9b338c16283687117714d2d9e">Security::ContextPointer</a></div><div class="ttdeci">std::shared_ptr&lt; SSL_CTX &gt; ContextPointer</div><div class="ttdef"><b>Definition</b> <a href="Context_8h_source.html#l00029">Context.h:29</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_a488f9ba5dcc69f185102178fc510fb73"><div class="ttname"><a href="namespaceSecurity.html#a488f9ba5dcc69f185102178fc510fb73">Security::CreateServerSession</a></div><div class="ttdeci">bool CreateServerSession(const Security::ContextPointer &amp;, const Comm::ConnectionPointer &amp;, Security::PeerOptions &amp;, const char *squidCtx)</div><div class="ttdef"><b>Definition</b> <a href="security_2Session_8cc_source.html#l00227">Session.cc:227</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_a5184cf80d640561cc955883a77ccbf88"><div class="ttname"><a href="namespaceSecurity.html#a5184cf80d640561cc955883a77ccbf88">Security::Accept</a></div><div class="ttdeci">IoResult Accept(Comm::Connection &amp;transport)</div><div class="ttdoc">accept a TLS connection over the specified to-Squid transport connection</div><div class="ttdef"><b>Definition</b> <a href="Io_8cc_source.html#l00208">Io.cc:208</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_a682c638417cc45a4452a76db4eb1780b"><div class="ttname"><a href="namespaceSecurity.html#a682c638417cc45a4452a76db4eb1780b">Security::SessionPointer</a></div><div class="ttdeci">std::shared_ptr&lt; SSL &gt; SessionPointer</div><div class="ttdef"><b>Definition</b> <a href="security_2Session_8h_source.html#l00053">Session.h:53</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_a79f403b4ae232250d95e98f8184070b3"><div class="ttname"><a href="namespaceSecurity.html#a79f403b4ae232250d95e98f8184070b3">Security::SessionIsResumed</a></div><div class="ttdeci">bool SessionIsResumed(const Security::SessionPointer &amp;)</div><div class="ttdoc">whether the session is a resumed one</div><div class="ttdef"><b>Definition</b> <a href="security_2Session_8cc_source.html#l00246">Session.cc:246</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_ab4dfe29d04dc3880668fd3b41a5595aa"><div class="ttname"><a href="namespaceSecurity.html#ab4dfe29d04dc3880668fd3b41a5595aa">Security::SubjectName</a></div><div class="ttdeci">SBuf SubjectName(Certificate &amp;)</div><div class="ttdoc">The SubjectName field of the given certificate (if found) or an empty SBuf.</div><div class="ttdef"><b>Definition</b> <a href="security_2Certificate_8cc_source.html#l00068">Certificate.cc:68</a></div></div>
<div class="ttc" id="anamespaceSecurity_html_ad2e4c897d0d9fc3d8716915860ca5426"><div class="ttname"><a href="namespaceSecurity.html#ad2e4c897d0d9fc3d8716915860ca5426">Security::GetFrom</a></div><div class="ttdeci">Security::ContextPointer GetFrom(Security::SessionPointer &amp;s)</div><div class="ttdoc">Helper function to retrieve a (non-locked) ContextPointer from a SessionPointer.</div><div class="ttdef"><b>Definition</b> <a href="security_2Session_8h_source.html#l00109">Session.h:109</a></div></div>
<div class="ttc" id="anamespaceSsl_html_a0e1e8752a0a2eea39f2ce2f2b60fde2d"><div class="ttname"><a href="namespaceSsl.html#a0e1e8752a0a2eea39f2ce2f2b60fde2d">Ssl::HasSubjectName</a></div><div class="ttdeci">bool HasSubjectName(X509 &amp;, const AnyP::Host &amp;)</div><div class="ttdoc">whether at least one common or alternate subject name matches the given one</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l00338">support.cc:338</a></div></div>
<div class="ttc" id="anamespaceSsl_html_a120da00096164ddaf09963fb45aa2dc7"><div class="ttname"><a href="namespaceSsl.html#a120da00096164ddaf09963fb45aa2dc7">Ssl::TheGlobalContextStorage</a></div><div class="ttdeci">GlobalContextStorage &amp; TheGlobalContextStorage()</div><div class="ttdoc">Global cache for store all SSL server certificates.</div><div class="ttdef"><b>Definition</b> <a href="context__storage_8cc_source.html#l00124">context_storage.cc:124</a></div></div>
<div class="ttc" id="anamespaceSsl_html_a77a0059e4dc01bedd3b91f89230574ad"><div class="ttname"><a href="namespaceSsl.html#a77a0059e4dc01bedd3b91f89230574ad">Ssl::DefaultSignHash</a></div><div class="ttdeci">const EVP_MD * DefaultSignHash</div><div class="ttdef"><b>Definition</b> <a href="support_8cc_source.html#l00044">support.cc:44</a></div></div>
<div class="ttc" id="anegotiate__wrapper_8cc_html_a5eb055ca3b42205cc134b4a438cd9a72"><div class="ttname"><a href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a></div><div class="ttdeci">#define xstrdup</div><div class="ttdef"><b>Definition</b> <a href="negotiate__wrapper_8cc_source.html#l00047">negotiate_wrapper.cc:47</a></div></div>
<div class="ttc" id="aopenssl_8h_html_a2c4abfe8977f1984d98b5987d315e21c"><div class="ttname"><a href="openssl_8h.html#a2c4abfe8977f1984d98b5987d315e21c">BIO_get_data</a></div><div class="ttdeci">void * BIO_get_data(BIO *table)</div><div class="ttdef"><b>Definition</b> <a href="openssl_8h_source.html#l00062">openssl.h:62</a></div></div>
<div class="ttc" id="aparser_2Tokenizer_8h_html"><div class="ttname"><a href="parser_2Tokenizer_8h.html">Tokenizer.h</a></div></div>
<div class="ttc" id="aproxyp_2Parser_8h_html"><div class="ttname"><a href="proxyp_2Parser_8h.html">Parser.h</a></div></div>
<div class="ttc" id="asbuf_2Stream_8h_html"><div class="ttname"><a href="sbuf_2Stream_8h.html">Stream.h</a></div></div>
<div class="ttc" id="asecurity_2Certificate_8h_html"><div class="ttname"><a href="security_2Certificate_8h.html">Certificate.h</a></div></div>
<div class="ttc" id="asecurity_2forward_8h_html_ad63240694c6dc2a28c24bfc2db90ad7aa32fb3a7ce3b6de31cc7c206438c129ab"><div class="ttname"><a href="security_2forward_8h.html#ad63240694c6dc2a28c24bfc2db90ad7aa32fb3a7ce3b6de31cc7c206438c129ab">SQUID_X509_V_ERR_DOMAIN_MISMATCH</a></div><div class="ttdeci">@ SQUID_X509_V_ERR_DOMAIN_MISMATCH</div><div class="ttdef"><b>Definition</b> <a href="security_2forward_8h_source.html#l00238">forward.h:238</a></div></div>
<div class="ttc" id="aservers_2forward_8h_html"><div class="ttname"><a href="servers_2forward_8h.html">forward.h</a></div></div>
<div class="ttc" id="asocket_8h_html"><div class="ttname"><a href="socket_8h.html">socket.h</a></div></div>
<div class="ttc" id="asocket_8h_html_a712fdb6a1f96f6ba746ef8da018bb216"><div class="ttname"><a href="socket_8h.html#a712fdb6a1f96f6ba746ef8da018bb216">xsetsockopt</a></div><div class="ttdeci">int xsetsockopt(int socketFd, int level, int option, const void *value, socklen_t valueLength)</div><div class="ttdoc">POSIX setsockopt(2) equivalent.</div><div class="ttdef"><b>Definition</b> <a href="socket_8h_source.html#l00122">socket.h:122</a></div></div>
<div class="ttc" id="asquid_8h_html"><div class="ttname"><a href="squid_8h.html">squid.h</a></div></div>
<div class="ttc" id="asrc_2debug_2debug_8cc_html_a0d2107ed0503ce532330be150c12906b"><div class="ttname"><a href="src_2debug_2debug_8cc.html#a0d2107ed0503ce532330be150c12906b">DebugStream</a></div><div class="ttdeci">FILE * DebugStream()</div><div class="ttdef"><b>Definition</b> <a href="src_2debug_2debug_8cc_source.html#l00355">debug.cc:355</a></div></div>
<div class="ttc" id="assl_2gadgets_8h_html"><div class="ttname"><a href="ssl_2gadgets_8h.html">gadgets.h</a></div></div>
<div class="ttc" id="assl_2helper_8h_html"><div class="ttname"><a href="ssl_2helper_8h.html">helper.h</a></div></div>
<div class="ttc" id="assl_2support_8h_html"><div class="ttname"><a href="ssl_2support_8h.html">support.h</a></div></div>
<div class="ttc" id="astructClientHttpRequest_1_1Flags_html_a409fd4d5e3b72f06df2921bd417e0a5c"><div class="ttname"><a href="structClientHttpRequest_1_1Flags.html#a409fd4d5e3b72f06df2921bd417e0a5c">ClientHttpRequest::Flags::accel</a></div><div class="ttdeci">bool accel</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00164">client_side_request.h:164</a></div></div>
<div class="ttc" id="astructClientHttpRequest_1_1Out_html_a31bec2ac65476dcbe95fda9ce0bd9385"><div class="ttname"><a href="structClientHttpRequest_1_1Out.html#a31bec2ac65476dcbe95fda9ce0bd9385">ClientHttpRequest::Out::headers_sz</a></div><div class="ttdeci">size_t headers_sz</div><div class="ttdoc">Response header bytes written to the client connection.</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00155">client_side_request.h:155</a></div></div>
<div class="ttc" id="astructClientHttpRequest_1_1Out_html_a4d7061fef2fd2cd55f1cc534cb43f040"><div class="ttname"><a href="structClientHttpRequest_1_1Out.html#a4d7061fef2fd2cd55f1cc534cb43f040">ClientHttpRequest::Out::offset</a></div><div class="ttdeci">int64_t offset</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00151">client_side_request.h:151</a></div></div>
<div class="ttc" id="astructClientHttpRequest_1_1Out_html_acbc2aeb0bd5adc0d5a30e22b03532129"><div class="ttname"><a href="structClientHttpRequest_1_1Out.html#acbc2aeb0bd5adc0d5a30e22b03532129">ClientHttpRequest::Out::size</a></div><div class="ttdeci">uint64_t size</div><div class="ttdoc">Response header and body bytes written to the client connection.</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00153">client_side_request.h:153</a></div></div>
<div class="ttc" id="astructClientHttpRequest_1_1Redirect_html_a98ac56cf94b890c981797389fba6b520"><div class="ttname"><a href="structClientHttpRequest_1_1Redirect.html#a98ac56cf94b890c981797389fba6b520">ClientHttpRequest::Redirect::location</a></div><div class="ttdeci">char * location</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00170">client_side_request.h:170</a></div></div>
<div class="ttc" id="astructnode_html"><div class="ttname"><a href="structnode.html">node</a></div><div class="ttdef"><b>Definition</b> <a href="parse_8c_source.html#l00104">parse.c:104</a></div></div>
<div class="ttc" id="astructnode_html_aa3e8aa83f864292b5a01210f4453fcc0"><div class="ttname"><a href="structnode.html#aa3e8aa83f864292b5a01210f4453fcc0">node::next</a></div><div class="ttdeci">struct node * next</div><div class="ttdef"><b>Definition</b> <a href="parse_8c_source.html#l00105">parse.c:105</a></div></div>
<div class="ttc" id="astructtok_html"><div class="ttname"><a href="structtok.html">tok</a></div><div class="ttdef"><b>Definition</b> <a href="parse_8c_source.html#l00160">parse.c:160</a></div></div>
<div class="ttc" id="atime_2gadgets_8cc_html_a2bf2be1c87c9581298c5112d6c07b004"><div class="ttname"><a href="time_2gadgets_8cc.html#a2bf2be1c87c9581298c5112d6c07b004">tvSub</a></div><div class="ttdeci">void tvSub(struct timeval &amp;res, struct timeval const &amp;t1, struct timeval const &amp;t2)</div><div class="ttdef"><b>Definition</b> <a href="time_2gadgets_8cc_source.html#l00058">gadgets.cc:58</a></div></div>
<div class="ttc" id="atime_2gadgets_8cc_html_a305b269a5a22b54bea1a2db923b55cd6"><div class="ttname"><a href="time_2gadgets_8cc.html#a305b269a5a22b54bea1a2db923b55cd6">tvSubUsec</a></div><div class="ttdeci">int tvSubUsec(struct timeval t1, struct timeval t2)</div><div class="ttdef"><b>Definition</b> <a href="time_2gadgets_8cc_source.html#l00037">gadgets.cc:37</a></div></div>
<div class="ttc" id="atime_2gadgets_8cc_html_a502612b4a32c5902726b120d713d7952"><div class="ttname"><a href="time_2gadgets_8cc.html#a502612b4a32c5902726b120d713d7952">current_time</a></div><div class="ttdeci">struct timeval current_time</div><div class="ttdoc">the current UNIX time in timeval {seconds, microseconds} format</div><div class="ttdef"><b>Definition</b> <a href="time_2gadgets_8cc_source.html#l00018">gadgets.cc:18</a></div></div>
<div class="ttc" id="atime_2gadgets_8cc_html_af7a3c9de59180267762f047ffd42e503"><div class="ttname"><a href="time_2gadgets_8cc.html#af7a3c9de59180267762f047ffd42e503">tvSubMsec</a></div><div class="ttdeci">int tvSubMsec(struct timeval t1, struct timeval t2)</div><div class="ttdef"><b>Definition</b> <a href="time_2gadgets_8cc_source.html#l00051">gadgets.cc:51</a></div></div>
<div class="ttc" id="atools_8h_html"><div class="ttname"><a href="tools_8h.html">tools.h</a></div></div>
<div class="ttc" id="atypes_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00145">types.h:145</a></div></div>
<div class="ttc" id="axalloc_8cc_html_ad10c7ad81edd7cbbdfd8b6502aa88d65"><div class="ttname"><a href="xalloc_8cc.html#ad10c7ad81edd7cbbdfd8b6502aa88d65">xcalloc</a></div><div class="ttdeci">void * xcalloc(size_t n, size_t sz)</div><div class="ttdef"><b>Definition</b> <a href="xalloc_8cc_source.html#l00071">xalloc.cc:71</a></div></div>
<div class="ttc" id="axalloc_8h_html_a74ad4c3c3aa58c8fea96eb0dc090fd67"><div class="ttname"><a href="xalloc_8h.html#a74ad4c3c3aa58c8fea96eb0dc090fd67">safe_free</a></div><div class="ttdeci">#define safe_free(x)</div><div class="ttdef"><b>Definition</b> <a href="xalloc_8h_source.html#l00073">xalloc.h:73</a></div></div>
<div class="ttc" id="axis_8h_html_a1ddc35653ddbcf46386d5c824a83a150"><div class="ttname"><a href="xis_8h.html#a1ddc35653ddbcf46386d5c824a83a150">xisspace</a></div><div class="ttdeci">#define xisspace(x)</div><div class="ttdef"><b>Definition</b> <a href="xis_8h_source.html#l00015">xis.h:15</a></div></div>
<div class="ttc" id="axstrerror_8cc_html_a3d643f764de4776e5489d4eb55a99849"><div class="ttname"><a href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a></div><div class="ttdeci">const char * xstrerr(int error)</div><div class="ttdef"><b>Definition</b> <a href="xstrerror_8cc_source.html#l00083">xstrerror.cc:83</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3c69fff7f634b97773a4d39d4565ffb4.html">squid</a></li><li class="navelem"><a class="el" href="dir_27a06220d184fcc3bd2c56b7794ae45b.html">src</a></li><li class="navelem"><a class="el" href="client__side_8cc.html">client_side.cc</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
